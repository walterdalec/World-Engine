/*! For license information please see main.ce02de17.js.LICENSE.txt */
(()=>{"use strict";var e={27:(e,t,n)=>{n.d(t,{LD:()=>v,Pe:()=>x,f$:()=>y,getChunkBiome:()=>f,getChunkTile:()=>m,sampleChunkArea:()=>g,we:()=>b,zs:()=>p});var r=n(379),a=n(571),i=n(32),o=n(986);const s={chunkSize:64,seaLevel:0,warpStrength:20,temperatureBase:0,moistureBase:0,poiDensity:.5,riverDensity:.1},l={water:0,shallows:1,sand:2,grass:3,forest:4,rock:5,snow:6,swamp:7,desert:8,tundra:9,road:10,town:11,ruin:12,shrine:13,mine:14,crystal:15},c=Object.keys(l),d=["deep_ocean","shallow_ocean","beach","plains","steppe","temperate_forest","boreal_forest","swamp","hot_desert","cold_desert","foothills","mountains","peaks","tundra"];function u(e){return l[e]||0}function h(e){const t=d.indexOf(e);return t>=0?t:0}function p(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=performance.now(),c=(0,r.A)((0,r.A)({},s),n),d=(0,a.xD)(e,t.cx,t.cy),{cx:p,cy:m}=t,f=c.chunkSize,g=new Uint8Array(f*f),y=new Uint8Array(f*f);let x=0,v=0,b=0;const w=new Map;for(let r=0;r<f;r++)for(let t=0;t<f;t++){const n=p*f+t,a=m*f+r,s=(0,i.zO)(n,a,c.warpStrength,e),l=(0,i._q)(s.x,s.y,e),k=(0,i.tO)(s.x,s.y,e)+c.temperatureBase,S=(0,i.P8)(s.x,s.y,e)+c.moistureBase,j=(0,o.O2)(l,k,S,d),C=r*f+t;g[C]=u(j.tile),y[C]=h(j.biome.id),x+=l,v+=k,b+=S,w.set(j.biome.id,(w.get(j.biome.id)||0)+1)}const k=f*f,S=x/k,j=v/k,C=b/k;let M="plains",T=0;w.forEach((e,t)=>{e>T&&(T=e,M=t)});const A=[];d.next()<c.riverDensity&&A.push({x:d.range(0,f-1),y:d.range(0,f-1),width:d.range(1,3),flow:d.next()});const E=[],P=Math.floor(c.poiDensity+d.next());for(let r=0;r<P;r++){const e=["town","ruin","mine","crystal","shrine","tower"];E.push({id:"poi_".concat(p,"_").concat(m,"_").concat(r),kind:d.pick(e),x:d.range(0,f-1),y:d.range(0,f-1),seed:d.range(0,1e6),discovered:!1})}const R=performance.now()-l,_=function(e,t){let n=0;for(let r=0;r<e.length;r++)n=(n<<5)-n+e[r]&4294967295,n=(n<<5)-n+t[r]&4294967295;return n.toString(16)}(g,y);return{id:t,tiles:g,biomes:y,width:f,height:f,meta:{averageHeight:S,averageTemperature:j,averageMoisture:C,dominantBiome:M,rivers:A,pois:E,discovered:!1,lastGenTime:R},generated:!0,hash:_}}function m(e,t,n){if(t<0||t>=e.width||n<0||n>=e.height)return null;const r=n*e.width+t;return a=e.tiles[r],c[a]||"water";var a}function f(e,t,n){if(t<0||t>=e.width||n<0||n>=e.height)return null;const r=n*e.width+t;return a=e.biomes[r],d[a]||"deep_ocean";var a}function g(e,t,n,r,a){const i=[],o=[];for(let s=0;s<a;s++){const a=[],l=[];for(let i=0;i<r;i++){const r=t+i,o=n+s;a.push(m(e,r,o)||"water"),l.push(f(e,r,o)||"deep_ocean")}i.push(a),o.push(l)}return{tiles:i,biomes:o}}function y(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64;return{x:e.cx*r+t,y:e.cy*r+n}}function x(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64;const r=Math.floor(e/n),a=Math.floor(t/n);return{chunkId:{cx:r,cy:a},localX:e-r*n,localY:t-a*n}}function v(e,t,n){const r=p(e,t,n),a=p(e,t,n);return r.hash===a.hash}function b(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2?arguments[2]:void 0;const r=[];for(let i=0;i<t;i++){const t=p(e,{cx:i%10,cy:Math.floor(i/10)},n);r.push(t.meta.lastGenTime)}const a=r.reduce((e,t)=>e+t,0);return{averageTime:a/r.length,minTime:Math.min(...r),maxTime:Math.max(...r),totalTime:a}}},32:(e,t,n)=>{n.d(t,{P8:()=>s,_q:()=>o,tO:()=>l,zO:()=>c});var r=n(379);const a={seed:0,frequency:.01,amplitude:1,octaves:4,lacunarity:2,persistence:.5};function i(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=(0,r.A)((0,r.A)({},a),n);let o=0,s=0,l=i.amplitude,c=i.frequency;for(let r=0;r<i.octaves;r++)o+=d(e*c,t*c,i.seed+r)*l,s+=l,l*=i.persistence,c*=i.lacunarity;return o/s}function o(e,t){return i(e,t,{seed:arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,frequency:.005,octaves:6,lacunarity:2,persistence:.6})}function s(e,t){return i(e,t,{seed:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)+1e3,frequency:.008,octaves:4,lacunarity:2.1,persistence:.5})}function l(e,t){return i(e,t,{seed:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)+2e3,frequency:.003,octaves:3,lacunarity:2.2,persistence:.4})}function c(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return{x:e+i(e,t,{seed:r+100,frequency:.01})*n,y:t+i(e,t,{seed:r+200,frequency:.01})*n}}function d(e,t,n){const r=Math.floor(e),a=Math.floor(t),i=e-r,o=t-a,s=u(r,a,n),l=u(r+1,a,n),c=u(r,a+1,n),d=u(r+1,a+1,n),p=h(s,l,i),m=h(c,d,i);return h(p,m,o)}function u(e,t,n){let r=Math.imul(e+57*t,n+1);return r^=r<<13,r=Math.imul(r,r*r*15731+789221+1376312589),.5*(1-(2147483647&r)/1073741824)}function h(e,t,n){const r=n*n*(3-2*n);return e*(1-r)+t*r}},49:(e,t)=>{var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator;var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f=Object.assign,g={};function y(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}function x(){}function v(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||m}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},x.prototype=y.prototype;var b=v.prototype=new x;b.constructor=v,f(b,y.prototype),b.isPureReactComponent=!0;var w=Array.isArray,k=Object.prototype.hasOwnProperty,S={current:null},j={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)k.call(t,a)&&!j.hasOwnProperty(a)&&(i[a]=t[a]);var l=arguments.length-2;if(1===l)i.children=r;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}if(e&&e.defaultProps)for(a in l=e.defaultProps)void 0===i[a]&&(i[a]=l[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:S.current}}function M(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function A(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function E(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return o=o(l=e),e=""===i?"."+A(l,0):i,w(o)?(a="",null!=e&&(a=e.replace(T,"$&/")+"/"),E(o,t,a,"",function(e){return e})):null!=o&&(M(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(T,"$&/")+"/")+e)),t.push(o)),1;if(l=0,i=""===i?".":i+":",w(e))for(var c=0;c<e.length;c++){var d=i+A(s=e[c],c);l+=E(s,t,a,d,o)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(s=e.next()).done;)l+=E(s=s.value,t,a,d=i+A(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function P(e,t,n){if(null==e)return e;var r=[],a=0;return E(e,r,"","",function(e){return t.call(n,e,a++)}),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var _={current:null},N={transition:null},B={ReactCurrentDispatcher:_,ReactCurrentBatchConfig:N,ReactCurrentOwner:S};function z(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,n){P(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return P(e,function(){t++}),t},toArray:function(e){return P(e,function(e){return e})||[]},only:function(e){if(!M(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=a,t.Profiler=o,t.PureComponent=v,t.StrictMode=i,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,t.act=z,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=f({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)k.call(t,c)&&!j.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];a.children=l}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=M,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},t.unstable_act=z,t.useCallback=function(e,t){return _.current.useCallback(e,t)},t.useContext=function(e){return _.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return _.current.useDeferredValue(e)},t.useEffect=function(e,t){return _.current.useEffect(e,t)},t.useId=function(){return _.current.useId()},t.useImperativeHandle=function(e,t,n){return _.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return _.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return _.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return _.current.useMemo(e,t)},t.useReducer=function(e,t,n){return _.current.useReducer(e,t,n)},t.useRef=function(e){return _.current.useRef(e)},t.useState=function(e){return _.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return _.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return _.current.useTransition()},t.version="18.3.1"},119:(e,t,n)=>{!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(345)},340:(e,t,n)=>{e.exports=n(761)},345:(e,t,n)=>{var r=n(950),a=n(340);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function f(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){g[e]=new f(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];g[t]=new f(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){g[e]=new f(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){g[e]=new f(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){g[e]=new f(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){g[e]=new f(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){g[e]=new f(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){g[e]=new f(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){g[e]=new f(e,5,!1,e.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function x(e){return e[1].toUpperCase()}function v(e,t,n,r){var a=g.hasOwnProperty(t)?g[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!u.call(m,e)||!u.call(p,e)&&(h.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(y,x);g[t]=new f(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(y,x);g[t]=new f(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(y,x);g[t]=new f(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!1,!1)}),g.xlinkHref=new f("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){g[e]=new f(e,1,!1,e.toLowerCase(),null,!0,!0)});var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),k=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),T=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var B=Symbol.iterator;function z(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=B&&e[B]||e["@@iterator"])?e:null}var L,I=Object.assign;function q(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var D=!1;function O(e,t){if(!e||D)return"";D=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(Ln){var r=Ln}Reflect.construct(e,[],t)}else{try{t.call()}catch(Ln){r=Ln}e.call(t.prototype)}else{try{throw Error()}catch(Ln){r=Ln}e()}}catch(Ln){if(Ln&&r&&"string"===typeof Ln.stack){for(var a=Ln.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var l="\n"+a[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{D=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?q(e):""}function W(e){switch(e.tag){case 5:return q(e.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return e=O(e.type,!1);case 11:return e=O(e.type.render,!1);case 1:return e=O(e.type,!0);default:return""}}function H(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case k:return"Portal";case C:return"Profiler";case j:return"StrictMode";case E:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case M:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:H(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return H(e(t))}catch(n){}}return null}function F(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return H(t);case 8:return t===j?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function U(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function V(e){e._valueTracker||(e._valueTracker=function(e){var t=U(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Y(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=U(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(cr){return e.body}}function X(e,t){var n=t.checked;return I({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function J(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Q(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function $(e,t){Q(e,t);var n=G(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return I({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function ie(e,t){var n=G(t.value),r=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n)})}:e}(function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function ue(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var he={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||he.hasOwnProperty(e)&&he[e]?(""+t).trim():t+"px"}function fe(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(he).forEach(function(e){pe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),he[t]=he[e]})});var ge=I({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function xe(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,ke=null,Se=null;function je(e){if(e=wa(e)){if("function"!==typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=Sa(t),we(e.stateNode,e.type,t))}}function Ce(e){ke?Se?Se.push(e):Se=[e]:ke=e}function Me(){if(ke){var e=ke,t=Se;if(Se=ke=null,je(e),t)for(e=0;e<t.length;e++)je(t[e])}}function Te(e,t){return e(t)}function Ae(){}var Ee=!1;function Pe(e,t,n){if(Ee)return e(t,n);Ee=!0;try{return Te(e,t,n)}finally{Ee=!1,(null!==ke||null!==Se)&&(Ae(),Me())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=Sa(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var _e=!1;if(d)try{var Ne={};Object.defineProperty(Ne,"passive",{get:function(){_e=!0}}),window.addEventListener("test",Ne,Ne),window.removeEventListener("test",Ne,Ne)}catch(ir){_e=!1}function Be(e,t,n,r,a,i,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var ze=!1,Le=null,Ie=!1,qe=null,De={onError:function(e){ze=!0,Le=e}};function Oe(e,t,n,r,a,i,o,s,l){ze=!1,Le=null,Be.apply(De,arguments)}function We(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function He(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Fe(e){if(We(e)!==e)throw Error(i(188))}function Ge(e){return e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Fe(a),e;if(o===r)return Fe(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,l=a.child;l;){if(l===n){s=!0,n=a,r=o;break}if(l===r){s=!0,r=a,n=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===n){s=!0,n=o,r=a;break}if(l===r){s=!0,r=o,n=a;break}l=l.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e),null!==e?Ue(e):null}function Ue(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ue(e);if(null!==t)return t;e=e.sibling}return null}var Ve=a.unstable_scheduleCallback,Ye=a.unstable_cancelCallback,Ke=a.unstable_shouldYield,Xe=a.unstable_requestPaint,Je=a.unstable_now,Qe=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,Ze=a.unstable_UserBlockingPriority,et=a.unstable_NormalPriority,tt=a.unstable_LowPriority,nt=a.unstable_IdlePriority,rt=null,at=null;var it=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/st|0)|0},ot=Math.log,st=Math.LN2;var lt=64,ct=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ut(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=dt(s):0!==(i&=o)&&(r=dt(i))}else 0!==(o=n&~a)?r=dt(o):0!==i&&(r=dt(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-it(t)),r|=e[n],t&=~a;return r}function ht(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=lt;return 0===(4194240&(lt<<=1))&&(lt=64),e}function ft(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-it(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-it(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var xt=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,kt,St,jt,Ct=!1,Mt=[],Tt=null,At=null,Et=null,Pt=new Map,Rt=new Map,_t=[],Nt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bt(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Et=null;break;case"pointerover":case"pointerout":Pt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function zt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=wa(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Lt(e){var t=ba(e.target);if(null!==t){var n=We(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=He(n)))return e.blockedOn=t,void jt(e.priority,function(){kt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function It(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=wa(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ve=r,n.target.dispatchEvent(r),ve=null,t.shift()}return!0}function qt(e,t,n){It(e)&&n.delete(t)}function Dt(){Ct=!1,null!==Tt&&It(Tt)&&(Tt=null),null!==At&&It(At)&&(At=null),null!==Et&&It(Et)&&(Et=null),Pt.forEach(qt),Rt.forEach(qt)}function Ot(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Dt)))}function Wt(e){function t(t){return Ot(t,e)}if(0<Mt.length){Ot(Mt[0],e);for(var n=1;n<Mt.length;n++){var r=Mt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&Ot(Tt,e),null!==At&&Ot(At,e),null!==Et&&Ot(Et,e),Pt.forEach(t),Rt.forEach(t),n=0;n<_t.length;n++)(r=_t[n]).blockedOn===e&&(r.blockedOn=null);for(;0<_t.length&&null===(n=_t[0]).blockedOn;)Lt(n),null===n.blockedOn&&_t.shift()}var Ht=b.ReactCurrentBatchConfig,Ft=!0;function Gt(e,t,n,r){var a=xt,i=Ht.transition;Ht.transition=null;try{xt=1,Vt(e,t,n,r)}finally{xt=a,Ht.transition=i}}function Ut(e,t,n,r){var a=xt,i=Ht.transition;Ht.transition=null;try{xt=4,Vt(e,t,n,r)}finally{xt=a,Ht.transition=i}}function Vt(e,t,n,r){if(Ft){var a=Kt(e,t,n,r);if(null===a)Vr(e,t,r,Yt,n),Bt(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Tt=zt(Tt,e,t,n,r,a),!0;case"dragenter":return At=zt(At,e,t,n,r,a),!0;case"mouseover":return Et=zt(Et,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Pt.set(i,zt(Pt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Rt.set(i,zt(Rt.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Bt(e,r),4&t&&-1<Nt.indexOf(e)){for(;null!==a;){var i=wa(a);if(null!==i&&bt(i),null===(i=Kt(e,t,n,r))&&Vr(e,t,r,Yt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Vr(e,t,r,null,n)}}var Yt=null;function Kt(e,t,n,r){if(Yt=null,null!==(e=ba(e=be(r))))if(null===(t=We(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=He(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qe()){case $e:return 1;case Ze:return 4;case et:case tt:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Jt=null,Qt=null,$t=null;function Zt(){if($t)return $t;var e,t,n=Qt,r=n.length,a="value"in Jt?Jt.value:Jt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function en(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function tn(){return!0}function nn(){return!1}function rn(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?tn:nn,this.isPropagationStopped=nn,this}return I(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=tn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=tn)},persist:function(){},isPersistent:tn}),t}var an,on,sn,ln={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cn=rn(ln),dn=I({},ln,{view:0,detail:0}),un=rn(dn),hn=I({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:jn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==sn&&(sn&&"mousemove"===e.type?(an=e.screenX-sn.screenX,on=e.screenY-sn.screenY):on=an=0,sn=e),an)},movementY:function(e){return"movementY"in e?e.movementY:on}}),pn=rn(hn),mn=rn(I({},hn,{dataTransfer:0})),fn=rn(I({},dn,{relatedTarget:0})),gn=rn(I({},ln,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=I({},ln,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),xn=rn(yn),vn=rn(I({},ln,{data:0})),bn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},kn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=kn[e])&&!!t[e]}function jn(){return Sn}var Cn=I({},dn,{key:function(e){if(e.key){var t=bn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=en(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:jn,charCode:function(e){return"keypress"===e.type?en(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?en(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mn=rn(Cn),Tn=rn(I({},hn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=rn(I({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:jn})),En=rn(I({},ln,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pn=I({},hn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=rn(Pn),_n=[9,13,27,32],Nn=d&&"CompositionEvent"in window,Bn=null;d&&"documentMode"in document&&(Bn=document.documentMode);var zn=d&&"TextEvent"in window&&!Bn,In=d&&(!Nn||Bn&&8<Bn&&11>=Bn),qn=String.fromCharCode(32),Dn=!1;function On(e,t){switch(e){case"keyup":return-1!==_n.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Wn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Hn=!1;var Fn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Fn[e.type]:"textarea"===t}function Un(e,t,n,r){Ce(r),0<(t=Kr(t,"onChange")).length&&(n=new cn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Vn=null,Yn=null;function Kn(e){Or(e,0)}function Xn(e){if(Y(ka(e)))return e}function Jn(e,t){if("change"===e)return t}var Qn=!1;if(d){var $n;if(d){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}$n=Zn}else $n=!1;Qn=$n&&(!document.documentMode||9<document.documentMode)}function tr(){Vn&&(Vn.detachEvent("onpropertychange",nr),Yn=Vn=null)}function nr(e){if("value"===e.propertyName&&Xn(Yn)){var t=[];Un(t,Yn,e,be(e)),Pe(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Yn=n,(Vn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(Yn)}function or(e,t){if("click"===e)return Xn(t)}function sr(e,t){if("input"===e||"change"===e)return Xn(t)}var lr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function dr(e,t){if(lr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!u.call(t,a)||!lr(e[a],t[a]))return!1}return!0}function ur(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hr(e,t){var n,r=ur(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=ur(r)}}function pr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function mr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gr(e){var t=mr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&pr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=hr(n,i);var o=hr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var yr=d&&"documentMode"in document&&11>=document.documentMode,xr=null,vr=null,br=null,wr=!1;function kr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;wr||null==xr||xr!==K(r)||("selectionStart"in(r=xr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},br&&dr(br,r)||(br=r,0<(r=Kr(vr,"onSelect")).length&&(t=new cn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=xr)))}function Sr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var jr={animationend:Sr("Animation","AnimationEnd"),animationiteration:Sr("Animation","AnimationIteration"),animationstart:Sr("Animation","AnimationStart"),transitionend:Sr("Transition","TransitionEnd")},Cr={},Mr={};function Tr(e){if(Cr[e])return Cr[e];if(!jr[e])return e;var t,n=jr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Mr)return Cr[e]=n[t];return e}d&&(Mr=document.createElement("div").style,"AnimationEvent"in window||(delete jr.animationend.animation,delete jr.animationiteration.animation,delete jr.animationstart.animation),"TransitionEvent"in window||delete jr.transitionend.transition);var Ar=Tr("animationend"),Er=Tr("animationiteration"),Pr=Tr("animationstart"),Rr=Tr("transitionend"),_r=new Map,Nr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Br(e,t){_r.set(e,t),l(t,[e])}for(var zr=0;zr<Nr.length;zr++){var Lr=Nr[zr];Br(Lr.toLowerCase(),"on"+(Lr[0].toUpperCase()+Lr.slice(1)))}Br(Ar,"onAnimationEnd"),Br(Er,"onAnimationIteration"),Br(Pr,"onAnimationStart"),Br("dblclick","onDoubleClick"),Br("focusin","onFocus"),Br("focusout","onBlur"),Br(Rr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ir="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),qr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ir));function Dr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,l,c){if(Oe.apply(this,arguments),ze){if(!ze)throw Error(i(198));var d=Le;ze=!1,Le=null,Ie||(Ie=!0,qe=d)}}(r,t,void 0,e),e.currentTarget=null}function Or(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==i&&a.isPropagationStopped())break e;Dr(a,s,c),i=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==i&&a.isPropagationStopped())break e;Dr(a,s,c),i=l}}}if(Ie)throw e=qe,Ie=!1,qe=null,e}function Wr(e,t){var n=t[ya];void 0===n&&(n=t[ya]=new Set);var r=e+"__bubble";n.has(r)||(Ur(t,e,2,!1),n.add(r))}function Hr(e,t,n){var r=0;t&&(r|=4),Ur(n,e,r,t)}var Fr="_reactListening"+Math.random().toString(36).slice(2);function Gr(e){if(!e[Fr]){e[Fr]=!0,o.forEach(function(t){"selectionchange"!==t&&(qr.has(t)||Hr(t,!1,e),Hr(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Fr]||(t[Fr]=!0,Hr("selectionchange",!1,t))}}function Ur(e,t,n,r){switch(Xt(t)){case 1:var a=Gt;break;case 4:a=Ut;break;default:a=Vt}n=a.bind(null,t,n,e),a=void 0,!_e||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Vr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===a||8===l.nodeType&&l.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ba(s)))return;if(5===(l=o.tag)||6===l){r=i=o;continue e}s=s.parentNode}}r=r.return}Pe(function(){var r=i,a=be(n),o=[];e:{var s=_r.get(e);if(void 0!==s){var l=cn,c=e;switch(e){case"keypress":if(0===en(n))break e;case"keydown":case"keyup":l=Mn;break;case"focusin":c="focus",l=fn;break;case"focusout":c="blur",l=fn;break;case"beforeblur":case"afterblur":l=fn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=An;break;case Ar:case Er:case Pr:l=gn;break;case Rr:l=En;break;case"scroll":l=un;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Tn}var d=0!==(4&t),u=!d&&"scroll"===e,h=d?null!==s?s+"Capture":null:s;d=[];for(var p,m=r;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==h&&(null!=(f=Re(m,h))&&d.push(Yr(m,f,p)))),u)break;m=m.return}0<d.length&&(s=new l(s,c,null,n,a),o.push({event:s,listeners:d}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===ve||!(c=n.relatedTarget||n.fromElement)||!ba(c)&&!c[ga])&&(l||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?ba(c):null)&&(c!==(u=We(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(d=pn,f="onMouseLeave",h="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Tn,f="onPointerLeave",h="onPointerEnter",m="pointer"),u=null==l?s:ka(l),p=null==c?s:ka(c),(s=new d(f,m+"leave",l,n,a)).target=u,s.relatedTarget=p,f=null,ba(a)===r&&((d=new d(h,m+"enter",c,n,a)).target=p,d.relatedTarget=u,f=d),u=f,l&&c)e:{for(h=c,m=0,p=d=l;p;p=Xr(p))m++;for(p=0,f=h;f;f=Xr(f))p++;for(;0<m-p;)d=Xr(d),m--;for(;0<p-m;)h=Xr(h),p--;for(;m--;){if(d===h||null!==h&&d===h.alternate)break e;d=Xr(d),h=Xr(h)}d=null}else d=null;null!==l&&Jr(o,s,l,d,!1),null!==c&&null!==u&&Jr(o,u,c,d,!0)}if("select"===(l=(s=r?ka(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Jn;else if(Gn(s))if(Qn)g=sr;else{g=ar;var y=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=or);switch(g&&(g=g(e,r))?Un(o,g,n,a):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ee(s,"number",s.value)),y=r?ka(r):window,e){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(xr=y,vr=r,br=null);break;case"focusout":br=vr=xr=null;break;case"mousedown":wr=!0;break;case"contextmenu":case"mouseup":case"dragend":wr=!1,kr(o,n,a);break;case"selectionchange":if(yr)break;case"keydown":case"keyup":kr(o,n,a)}var x;if(Nn)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Hn?On(e,n)&&(v="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(v="onCompositionStart");v&&(In&&"ko"!==n.locale&&(Hn||"onCompositionStart"!==v?"onCompositionEnd"===v&&Hn&&(x=Zt()):(Qt="value"in(Jt=a)?Jt.value:Jt.textContent,Hn=!0)),0<(y=Kr(r,v)).length&&(v=new vn(v,e,null,n,a),o.push({event:v,listeners:y}),x?v.data=x:null!==(x=Wn(n))&&(v.data=x))),(x=zn?function(e,t){switch(e){case"compositionend":return Wn(t);case"keypress":return 32!==t.which?null:(Dn=!0,qn);case"textInput":return(e=t.data)===qn&&Dn?null:e;default:return null}}(e,n):function(e,t){if(Hn)return"compositionend"===e||!Nn&&On(e,t)?(e=Zt(),$t=Qt=Jt=null,Hn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return In&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Kr(r,"onBeforeInput")).length&&(a=new vn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=x))}Or(o,t)})}function Yr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Kr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Re(e,n))&&r.unshift(Yr(e,i,a)),null!=(i=Re(e,t))&&r.push(Yr(e,i,a))),e=e.return}return r}function Xr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Jr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,a?null!=(l=Re(n,i))&&o.unshift(Yr(n,l,s)):a||null!=(l=Re(n,i))&&o.push(Yr(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Qr=/\r\n?/g,$r=/\u0000|\uFFFD/g;function Zr(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace($r,"")}function ea(e,t,n){if(t=Zr(t),Zr(e)!==t&&n)throw Error(i(425))}function ta(){}var na=null,ra=null;function aa(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ia="function"===typeof setTimeout?setTimeout:void 0,oa="function"===typeof clearTimeout?clearTimeout:void 0,sa="function"===typeof Promise?Promise:void 0,la="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof sa?function(e){return sa.resolve(null).then(e).catch(ca)}:ia;function ca(e){setTimeout(function(){throw e})}function da(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Wt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Wt(t)}function ua(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ha(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var pa=Math.random().toString(36).slice(2),ma="__reactFiber$"+pa,fa="__reactProps$"+pa,ga="__reactContainer$"+pa,ya="__reactEvents$"+pa,xa="__reactListeners$"+pa,va="__reactHandles$"+pa;function ba(e){var t=e[ma];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ga]||n[ma]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ha(e);null!==e;){if(n=e[ma])return n;e=ha(e)}return t}n=(e=n).parentNode}return null}function wa(e){return!(e=e[ma]||e[ga])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ka(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function Sa(e){return e[fa]||null}var ja=[],Ca=-1;function Ma(e){return{current:e}}function Ta(e){0>Ca||(e.current=ja[Ca],ja[Ca]=null,Ca--)}function Aa(e,t){Ca++,ja[Ca]=e.current,e.current=t}var Ea={},Pa=Ma(Ea),Ra=Ma(!1),_a=Ea;function Na(e,t){var n=e.type.contextTypes;if(!n)return Ea;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Ba(e){return null!==(e=e.childContextTypes)&&void 0!==e}function za(){Ta(Ra),Ta(Pa)}function La(e,t,n){if(Pa.current!==Ea)throw Error(i(168));Aa(Pa,t),Aa(Ra,n)}function Ia(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,F(e)||"Unknown",a));return I({},n,r)}function qa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ea,_a=Pa.current,Aa(Pa,e),Aa(Ra,Ra.current),!0}function Da(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Ia(e,t,_a),r.__reactInternalMemoizedMergedChildContext=e,Ta(Ra),Ta(Pa),Aa(Pa,e)):Ta(Ra),Aa(Ra,n)}var Oa=null,Wa=!1,Ha=!1;function Fa(e){null===Oa?Oa=[e]:Oa.push(e)}function Ga(){if(!Ha&&null!==Oa){Ha=!0;var e=0,t=xt;try{var n=Oa;for(xt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Oa=null,Wa=!1}catch(a){throw null!==Oa&&(Oa=Oa.slice(e+1)),Ve($e,Ga),a}finally{xt=t,Ha=!1}}return null}var Ua=[],Va=0,Ya=null,Ka=0,Xa=[],Ja=0,Qa=null,$a=1,Za="";function ei(e,t){Ua[Va++]=Ka,Ua[Va++]=Ya,Ya=e,Ka=t}function ti(e,t,n){Xa[Ja++]=$a,Xa[Ja++]=Za,Xa[Ja++]=Qa,Qa=e;var r=$a;e=Za;var a=32-it(r)-1;r&=~(1<<a),n+=1;var i=32-it(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,$a=1<<32-it(t)+a|n<<a|r,Za=i+e}else $a=1<<i|n<<a|r,Za=e}function ni(e){null!==e.return&&(ei(e,1),ti(e,1,0))}function ri(e){for(;e===Ya;)Ya=Ua[--Va],Ua[Va]=null,Ka=Ua[--Va],Ua[Va]=null;for(;e===Qa;)Qa=Xa[--Ja],Xa[Ja]=null,Za=Xa[--Ja],Xa[Ja]=null,$a=Xa[--Ja],Xa[Ja]=null}var ai=null,ii=null,oi=!1,si=null;function li(e,t){var n=Nc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ci(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ai=e,ii=ua(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ai=e,ii=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qa?{id:$a,overflow:Za}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ai=e,ii=null,!0);default:return!1}}function di(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ui(e){if(oi){var t=ii;if(t){var n=t;if(!ci(e,t)){if(di(e))throw Error(i(418));t=ua(n.nextSibling);var r=ai;t&&ci(e,t)?li(r,n):(e.flags=-4097&e.flags|2,oi=!1,ai=e)}}else{if(di(e))throw Error(i(418));e.flags=-4097&e.flags|2,oi=!1,ai=e}}}function hi(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ai=e}function pi(e){if(e!==ai)return!1;if(!oi)return hi(e),oi=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!aa(e.type,e.memoizedProps)),t&&(t=ii)){if(di(e))throw mi(),Error(i(418));for(;t;)li(e,t),t=ua(t.nextSibling)}if(hi(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ii=ua(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ii=null}}else ii=ai?ua(e.stateNode.nextSibling):null;return!0}function mi(){for(var e=ii;e;)e=ua(e.nextSibling)}function fi(){ii=ai=null,oi=!1}function gi(e){null===si?si=[e]:si.push(e)}var yi=b.ReactCurrentBatchConfig;function xi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function vi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function bi(e){return(0,e._init)(e._payload)}function wi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=zc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Dc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===S?u(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===_&&bi(i)===t.type)?((r=a(t,n.props)).ref=xi(e,t,n),r.return=e,r):((r=Lc(n.type,n.key,n.props,null,e.mode,r)).ref=xi(e,t,n),r.return=e,r)}function d(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Oc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function u(e,t,n,r,i){return null===t||7!==t.tag?((t=Ic(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function h(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Dc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Lc(t.type,t.key,t.props,null,e.mode,n)).ref=xi(e,null,t),n.return=e,n;case k:return(t=Oc(t,e.mode,n)).return=e,t;case _:return h(e,(0,t._init)(t._payload),n)}if(te(t)||z(t))return(t=Ic(t,e.mode,n,null)).return=e,t;vi(e,t)}return null}function p(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===a?c(e,t,n,r):null;case k:return n.key===a?d(e,t,n,r):null;case _:return p(e,t,(a=n._init)(n._payload),r)}if(te(n)||z(n))return null!==a?null:u(e,t,n,r,null);vi(e,n)}return null}function m(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case k:return d(t,e=e.get(null===r.key?n:r.key)||null,r,a);case _:return m(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||z(r))return u(t,e=e.get(n)||null,r,a,null);vi(t,r)}return null}function f(a,i,s,l){for(var c=null,d=null,u=i,f=i=0,g=null;null!==u&&f<s.length;f++){u.index>f?(g=u,u=null):g=u.sibling;var y=p(a,u,s[f],l);if(null===y){null===u&&(u=g);break}e&&u&&null===y.alternate&&t(a,u),i=o(y,i,f),null===d?c=y:d.sibling=y,d=y,u=g}if(f===s.length)return n(a,u),oi&&ei(a,f),c;if(null===u){for(;f<s.length;f++)null!==(u=h(a,s[f],l))&&(i=o(u,i,f),null===d?c=u:d.sibling=u,d=u);return oi&&ei(a,f),c}for(u=r(a,u);f<s.length;f++)null!==(g=m(u,a,f,s[f],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?f:g.key),i=o(g,i,f),null===d?c=g:d.sibling=g,d=g);return e&&u.forEach(function(e){return t(a,e)}),oi&&ei(a,f),c}function g(a,s,l,c){var d=z(l);if("function"!==typeof d)throw Error(i(150));if(null==(l=d.call(l)))throw Error(i(151));for(var u=d=null,f=s,g=s=0,y=null,x=l.next();null!==f&&!x.done;g++,x=l.next()){f.index>g?(y=f,f=null):y=f.sibling;var v=p(a,f,x.value,c);if(null===v){null===f&&(f=y);break}e&&f&&null===v.alternate&&t(a,f),s=o(v,s,g),null===u?d=v:u.sibling=v,u=v,f=y}if(x.done)return n(a,f),oi&&ei(a,g),d;if(null===f){for(;!x.done;g++,x=l.next())null!==(x=h(a,x.value,c))&&(s=o(x,s,g),null===u?d=x:u.sibling=x,u=x);return oi&&ei(a,g),d}for(f=r(a,f);!x.done;g++,x=l.next())null!==(x=m(f,a,g,x.value,c))&&(e&&null!==x.alternate&&f.delete(null===x.key?g:x.key),s=o(x,s,g),null===u?d=x:u.sibling=x,u=x);return e&&f.forEach(function(e){return t(a,e)}),oi&&ei(a,g),d}return function e(r,i,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case w:e:{for(var c=o.key,d=i;null!==d;){if(d.key===c){if((c=o.type)===S){if(7===d.tag){n(r,d.sibling),(i=a(d,o.props.children)).return=r,r=i;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===_&&bi(c)===d.type){n(r,d.sibling),(i=a(d,o.props)).ref=xi(r,d,o),i.return=r,r=i;break e}n(r,d);break}t(r,d),d=d.sibling}o.type===S?((i=Ic(o.props.children,r.mode,l,o.key)).return=r,r=i):((l=Lc(o.type,o.key,o.props,null,r.mode,l)).ref=xi(r,i,o),l.return=r,r=l)}return s(r);case k:e:{for(d=o.key;null!==i;){if(i.key===d){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Oc(o,r.mode,l)).return=r,r=i}return s(r);case _:return e(r,i,(d=o._init)(o._payload),l)}if(te(o))return f(r,i,o,l);if(z(o))return g(r,i,o,l);vi(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=Dc(o,r.mode,l)).return=r,r=i),s(r)):n(r,i)}}var ki=wi(!0),Si=wi(!1),ji=Ma(null),Ci=null,Mi=null,Ti=null;function Ai(){Ti=Mi=Ci=null}function Ei(e){var t=ji.current;Ta(ji),e._currentValue=t}function Pi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ri(e,t){Ci=e,Ti=Mi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ws=!0),e.firstContext=null)}function _i(e){var t=e._currentValue;if(Ti!==e)if(e={context:e,memoizedValue:t,next:null},null===Mi){if(null===Ci)throw Error(i(308));Mi=e,Ci.dependencies={lanes:0,firstContext:e}}else Mi=Mi.next=e;return t}var Ni=null;function Bi(e){null===Ni?Ni=[e]:Ni.push(e)}function zi(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Bi(t)):(n.next=a.next,a.next=n),t.interleaved=n,Li(e,r)}function Li(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ii=!1;function qi(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Di(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Oi(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Wi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Pl)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Li(e,n)}return null===(a=r.interleaved)?(t.next=t,Bi(r)):(t.next=a.next,a.next=t),r.interleaved=t,Li(e,n)}function Hi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Fi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Gi(e,t,n,r){var a=e.updateQueue;Ii=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?i=c:o.next=c,o=l;var d=e.alternate;null!==d&&((s=(d=d.updateQueue).lastBaseUpdate)!==o&&(null===s?d.firstBaseUpdate=c:s.next=c,d.lastBaseUpdate=l))}if(null!==i){var u=a.baseState;for(o=0,d=c=l=null,s=i;;){var h=s.lane,p=s.eventTime;if((r&h)===h){null!==d&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var m=e,f=s;switch(h=t,p=n,f.tag){case 1:if("function"===typeof(m=f.payload)){u=m.call(p,u,h);break e}u=m;break e;case 3:m.flags=-65537&m.flags|128;case 0:if(null===(h="function"===typeof(m=f.payload)?m.call(p,u,h):m)||void 0===h)break e;u=I({},u,h);break e;case 2:Ii=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=a.effects)?a.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===d?(c=d=p,l=u):d=d.next=p,o|=h;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(h=s).next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}if(null===d&&(l=u),a.baseState=l,a.firstBaseUpdate=c,a.lastBaseUpdate=d,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);ql|=o,e.lanes=o,e.memoizedState=u}}function Ui(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Vi={},Yi=Ma(Vi),Ki=Ma(Vi),Xi=Ma(Vi);function Ji(e){if(e===Vi)throw Error(i(174));return e}function Qi(e,t){switch(Aa(Xi,t),Aa(Ki,e),Aa(Yi,Vi),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ta(Yi),Aa(Yi,t)}function $i(){Ta(Yi),Ta(Ki),Ta(Xi)}function Zi(e){Ji(Xi.current);var t=Ji(Yi.current),n=le(t,e.type);t!==n&&(Aa(Ki,e),Aa(Yi,n))}function eo(e){Ki.current===e&&(Ta(Yi),Ta(Ki))}var to=Ma(0);function no(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ro=[];function ao(){for(var e=0;e<ro.length;e++)ro[e]._workInProgressVersionPrimary=null;ro.length=0}var io=b.ReactCurrentDispatcher,oo=b.ReactCurrentBatchConfig,so=0,lo=null,co=null,uo=null,ho=!1,po=!1,mo=0,fo=0;function go(){throw Error(i(321))}function yo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!lr(e[n],t[n]))return!1;return!0}function xo(e,t,n,r,a,o){if(so=o,lo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,io.current=null===e||null===e.memoizedState?ts:ns,e=n(r,a),po){o=0;do{if(po=!1,mo=0,25<=o)throw Error(i(301));o+=1,uo=co=null,t.updateQueue=null,io.current=rs,e=n(r,a)}while(po)}if(io.current=es,t=null!==co&&null!==co.next,so=0,uo=co=lo=null,ho=!1,t)throw Error(i(300));return e}function vo(){var e=0!==mo;return mo=0,e}function bo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===uo?lo.memoizedState=uo=e:uo=uo.next=e,uo}function wo(){if(null===co){var e=lo.alternate;e=null!==e?e.memoizedState:null}else e=co.next;var t=null===uo?lo.memoizedState:uo.next;if(null!==t)uo=t,co=e;else{if(null===e)throw Error(i(310));e={memoizedState:(co=e).memoizedState,baseState:co.baseState,baseQueue:co.baseQueue,queue:co.queue,next:null},null===uo?lo.memoizedState=uo=e:uo=uo.next=e}return uo}function ko(e,t){return"function"===typeof t?t(e):t}function So(e){var t=wo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=co,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var l=s=null,c=null,d=o;do{var u=d.lane;if((so&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:e(r,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(l=c=h,s=r):c=c.next=h,lo.lanes|=u,ql|=u}d=d.next}while(null!==d&&d!==o);null===c?s=r:c.next=l,lr(r,t.memoizedState)||(ws=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,lo.lanes|=o,ql|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function jo(e){var t=wo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);lr(o,t.memoizedState)||(ws=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Co(){}function Mo(e,t){var n=lo,r=wo(),a=t(),o=!lr(r.memoizedState,a);if(o&&(r.memoizedState=a,ws=!0),r=r.queue,qo(Eo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==uo&&1&uo.memoizedState.tag){if(n.flags|=2048,No(9,Ao.bind(null,n,r,a,t),void 0,null),null===Rl)throw Error(i(349));0!==(30&so)||To(n,t,a)}return a}function To(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=lo.updateQueue)?(t={lastEffect:null,stores:null},lo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Ao(e,t,n,r){t.value=n,t.getSnapshot=r,Po(t)&&Ro(e)}function Eo(e,t,n){return n(function(){Po(t)&&Ro(e)})}function Po(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!lr(e,n)}catch(r){return!0}}function Ro(e){var t=Li(e,1);null!==t&&ac(t,e,1,-1)}function _o(e){var t=bo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ko,lastRenderedState:e},t.queue=e,e=e.dispatch=Jo.bind(null,lo,e),[t.memoizedState,e]}function No(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=lo.updateQueue)?(t={lastEffect:null,stores:null},lo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bo(){return wo().memoizedState}function zo(e,t,n,r){var a=bo();lo.flags|=e,a.memoizedState=No(1|t,n,void 0,void 0===r?null:r)}function Lo(e,t,n,r){var a=wo();r=void 0===r?null:r;var i=void 0;if(null!==co){var o=co.memoizedState;if(i=o.destroy,null!==r&&yo(r,o.deps))return void(a.memoizedState=No(t,n,i,r))}lo.flags|=e,a.memoizedState=No(1|t,n,i,r)}function Io(e,t){return zo(8390656,8,e,t)}function qo(e,t){return Lo(2048,8,e,t)}function Do(e,t){return Lo(4,2,e,t)}function Oo(e,t){return Lo(4,4,e,t)}function Wo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ho(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Lo(4,4,Wo.bind(null,t,e),n)}function Fo(){}function Go(e,t){var n=wo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&yo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Uo(e,t){var n=wo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&yo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Vo(e,t,n){return 0===(21&so)?(e.baseState&&(e.baseState=!1,ws=!0),e.memoizedState=n):(lr(n,t)||(n=mt(),lo.lanes|=n,ql|=n,e.baseState=!0),t)}function Yo(e,t){var n=xt;xt=0!==n&&4>n?n:4,e(!0);var r=oo.transition;oo.transition={};try{e(!1),t()}finally{xt=n,oo.transition=r}}function Ko(){return wo().memoizedState}function Xo(e,t,n){var r=rc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Qo(e))$o(t,n);else if(null!==(n=zi(e,t,n,r))){ac(n,e,r,nc()),Zo(n,t,r)}}function Jo(e,t,n){var r=rc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Qo(e))$o(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,lr(s,o)){var l=t.interleaved;return null===l?(a.next=a,Bi(t)):(a.next=l.next,l.next=a),void(t.interleaved=a)}}catch(Ln){}null!==(n=zi(e,t,a,r))&&(ac(n,e,r,a=nc()),Zo(n,t,r))}}function Qo(e){var t=e.alternate;return e===lo||null!==t&&t===lo}function $o(e,t){po=ho=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Zo(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var es={readContext:_i,useCallback:go,useContext:go,useEffect:go,useImperativeHandle:go,useInsertionEffect:go,useLayoutEffect:go,useMemo:go,useReducer:go,useRef:go,useState:go,useDebugValue:go,useDeferredValue:go,useTransition:go,useMutableSource:go,useSyncExternalStore:go,useId:go,unstable_isNewReconciler:!1},ts={readContext:_i,useCallback:function(e,t){return bo().memoizedState=[e,void 0===t?null:t],e},useContext:_i,useEffect:Io,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,zo(4194308,4,Wo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return zo(4194308,4,e,t)},useInsertionEffect:function(e,t){return zo(4,2,e,t)},useMemo:function(e,t){var n=bo();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=bo();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Xo.bind(null,lo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},bo().memoizedState=e},useState:_o,useDebugValue:Fo,useDeferredValue:function(e){return bo().memoizedState=e},useTransition:function(){var e=_o(!1),t=e[0];return e=Yo.bind(null,e[1]),bo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=lo,a=bo();if(oi){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Rl)throw Error(i(349));0!==(30&so)||To(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Io(Eo.bind(null,r,o,e),[e]),r.flags|=2048,No(9,Ao.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=bo(),t=Rl.identifierPrefix;if(oi){var n=Za;t=":"+t+"R"+(n=($a&~(1<<32-it($a)-1)).toString(32)+n),0<(n=mo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=fo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},ns={readContext:_i,useCallback:Go,useContext:_i,useEffect:qo,useImperativeHandle:Ho,useInsertionEffect:Do,useLayoutEffect:Oo,useMemo:Uo,useReducer:So,useRef:Bo,useState:function(){return So(ko)},useDebugValue:Fo,useDeferredValue:function(e){return Vo(wo(),co.memoizedState,e)},useTransition:function(){return[So(ko)[0],wo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Mo,useId:Ko,unstable_isNewReconciler:!1},rs={readContext:_i,useCallback:Go,useContext:_i,useEffect:qo,useImperativeHandle:Ho,useInsertionEffect:Do,useLayoutEffect:Oo,useMemo:Uo,useReducer:jo,useRef:Bo,useState:function(){return jo(ko)},useDebugValue:Fo,useDeferredValue:function(e){var t=wo();return null===co?t.memoizedState=e:Vo(t,co.memoizedState,e)},useTransition:function(){return[jo(ko)[0],wo().memoizedState]},useMutableSource:Co,useSyncExternalStore:Mo,useId:Ko,unstable_isNewReconciler:!1};function as(e,t){if(e&&e.defaultProps){for(var n in t=I({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function is(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:I({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var os={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=nc(),a=rc(e),i=Oi(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Wi(e,i,a))&&(ac(t,e,a,r),Hi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=nc(),a=rc(e),i=Oi(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Wi(e,i,a))&&(ac(t,e,a,r),Hi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=nc(),r=rc(e),a=Oi(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Wi(e,a,r))&&(ac(t,e,r,n),Hi(t,e,r))}};function ss(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!dr(n,r)||!dr(a,i))}function ls(e,t,n){var r=!1,a=Ea,i=t.contextType;return"object"===typeof i&&null!==i?i=_i(i):(a=Ba(t)?_a:Pa.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Na(e,a):Ea),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=os,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function cs(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&os.enqueueReplaceState(t,t.state,null)}function ds(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},qi(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=_i(i):(i=Ba(t)?_a:Pa.current,a.context=Na(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(is(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&os.enqueueReplaceState(a,a.state,null),Gi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function us(e,t){try{var n="",r=t;do{n+=W(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ps(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ms="function"===typeof WeakMap?WeakMap:Map;function fs(e,t,n){(n=Oi(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Vl||(Vl=!0,Yl=r),ps(0,t)},n}function gs(e,t,n){(n=Oi(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ps(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){ps(0,t),"function"!==typeof r&&(null===Kl?Kl=new Set([this]):Kl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ys(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ms;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Tc.bind(null,e,t,n),t.then(e,e))}function xs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function vs(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Oi(-1,1)).tag=2,Wi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=b.ReactCurrentOwner,ws=!1;function ks(e,t,n,r){t.child=null===e?Si(t,null,n,r):ki(t,e.child,n,r)}function Ss(e,t,n,r,a){n=n.render;var i=t.ref;return Ri(t,a),r=xo(e,t,n,r,i,a),n=vo(),null===e||ws?(oi&&n&&ni(t),t.flags|=1,ks(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vs(e,t,a))}function js(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Bc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Cs(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:dr)(o,r)&&e.ref===t.ref)return Vs(e,t,a)}return t.flags|=1,(e=zc(i,r)).ref=t.ref,e.return=t,t.child=e}function Cs(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(dr(i,r)&&e.ref===t.ref){if(ws=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Vs(e,t,a);0!==(131072&e.flags)&&(ws=!0)}}return As(e,t,n,r,a)}function Ms(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Aa(zl,Bl),Bl|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Aa(zl,Bl),Bl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Aa(zl,Bl),Bl|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Aa(zl,Bl),Bl|=r;return ks(e,t,a,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function As(e,t,n,r,a){var i=Ba(n)?_a:Pa.current;return i=Na(t,i),Ri(t,a),n=xo(e,t,n,r,i,a),r=vo(),null===e||ws?(oi&&r&&ni(t),t.flags|=1,ks(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Vs(e,t,a))}function Es(e,t,n,r,a){if(Ba(n)){var i=!0;qa(t)}else i=!1;if(Ri(t,a),null===t.stateNode)Us(e,t),ls(t,n,r),ds(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=_i(c):c=Na(t,c=Ba(n)?_a:Pa.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||l!==c)&&cs(t,o,r,c),Ii=!1;var h=t.memoizedState;o.state=h,Gi(t,r,o,a),l=t.memoizedState,s!==r||h!==l||Ra.current||Ii?("function"===typeof d&&(is(t,n,d,r),l=t.memoizedState),(s=Ii||ss(t,n,s,r,h,l,c))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Di(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:as(t.type,s),o.props=c,u=t.pendingProps,h=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=_i(l):l=Na(t,l=Ba(n)?_a:Pa.current);var p=n.getDerivedStateFromProps;(d="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==u||h!==l)&&cs(t,o,r,l),Ii=!1,h=t.memoizedState,o.state=h,Gi(t,r,o,a);var m=t.memoizedState;s!==u||h!==m||Ra.current||Ii?("function"===typeof p&&(is(t,n,p,r),m=t.memoizedState),(c=Ii||ss(t,n,c,r,h,m,l)||!1)?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,m,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,m,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=m),o.props=r,o.state=m,o.context=l,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return Ps(e,t,n,r,i,a)}function Ps(e,t,n,r,a,i){Ts(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&Da(t,n,!1),Vs(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=ki(t,e.child,null,i),t.child=ki(t,null,s,i)):ks(e,t,s,i),t.memoizedState=r.state,a&&Da(t,n,!0),t.child}function Rs(e){var t=e.stateNode;t.pendingContext?La(0,t.pendingContext,t.pendingContext!==t.context):t.context&&La(0,t.context,!1),Qi(e,t.containerInfo)}function _s(e,t,n,r,a){return fi(),gi(a),t.flags|=256,ks(e,t,n,r),t.child}var Ns,Bs,zs,Ls,Is={dehydrated:null,treeContext:null,retryLane:0};function qs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ds(e,t,n){var r,a=t.pendingProps,o=to.current,s=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Aa(to,1&o),null===e)return ui(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=a.children,e=a.fallback,s?(a=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=qc(l,a,0,null),e=Ic(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=qs(n),t.memoizedState=Is,e):Os(t,l));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Ws(e,t,s,r=hs(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=qc({mode:"visible",children:r.children},a,0,null),(o=Ic(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&ki(t,e.child,null,s),t.child.memoizedState=qs(s),t.memoizedState=Is,o);if(0===(1&t.mode))return Ws(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var l=r.dgst;return r=l,Ws(e,t,s,r=hs(o=Error(i(419)),r,void 0))}if(l=0!==(s&e.childLanes),ws||l){if(null!==(r=Rl)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Li(e,a),ac(r,e,a,-1))}return yc(),Ws(e,t,s,r=hs(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Ec.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ii=ua(a.nextSibling),ai=t,oi=!0,si=null,null!==e&&(Xa[Ja++]=$a,Xa[Ja++]=Za,Xa[Ja++]=Qa,$a=e.id,Za=e.overflow,Qa=t),t=Os(t,r.children),t.flags|=4096,t)}(e,t,l,a,r,o,n);if(s){s=a.fallback,l=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&l)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=zc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=zc(r,s):(s=Ic(s,l,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,l=null===(l=e.child.memoizedState)?qs(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~n,t.memoizedState=Is,a}return e=(s=e.child).sibling,a=zc(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Os(e,t){return(t=qc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ws(e,t,n,r){return null!==r&&gi(r),ki(t,e.child,null,n),(e=Os(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Hs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Pi(e.return,t,n)}function Fs(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Gs(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(ks(e,t,r.children,n),0!==(2&(r=to.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Hs(e,n,t);else if(19===e.tag)Hs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Aa(to,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===no(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Fs(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===no(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Fs(t,!0,n,null,i);break;case"together":Fs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Us(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),ql|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=zc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=zc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Ys(e,t){if(!oi)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ks(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xs(e,t,n){var r=t.pendingProps;switch(ri(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ks(t),null;case 1:case 17:return Ba(t.type)&&za(),Ks(t),null;case 3:return r=t.stateNode,$i(),Ta(Ra),Ta(Pa),ao(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(pi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==si&&(lc(si),si=null))),Bs(e,t),Ks(t),null;case 5:eo(t);var a=Ji(Xi.current);if(n=t.type,null!==e&&null!=t.stateNode)zs(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Ks(t),null}if(e=Ji(Yi.current),pi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[ma]=t,r[fa]=o,e=0!==(1&t.mode),n){case"dialog":Wr("cancel",r),Wr("close",r);break;case"iframe":case"object":case"embed":Wr("load",r);break;case"video":case"audio":for(a=0;a<Ir.length;a++)Wr(Ir[a],r);break;case"source":Wr("error",r);break;case"img":case"image":case"link":Wr("error",r),Wr("load",r);break;case"details":Wr("toggle",r);break;case"input":J(r,o),Wr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Wr("invalid",r);break;case"textarea":ae(r,o),Wr("invalid",r)}for(var l in ye(n,o),a=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&ea(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&ea(r.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Wr("scroll",r)}switch(n){case"input":V(r),Z(r,o,!0);break;case"textarea":V(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=ta)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[ma]=t,e[fa]=r,Ns(e,t,!1,!1),t.stateNode=e;e:{switch(l=xe(n,r),n){case"dialog":Wr("cancel",e),Wr("close",e),a=r;break;case"iframe":case"object":case"embed":Wr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Ir.length;a++)Wr(Ir[a],e);a=r;break;case"source":Wr("error",e),a=r;break;case"img":case"image":case"link":Wr("error",e),Wr("load",e),a=r;break;case"details":Wr("toggle",e),a=r;break;case"input":J(e,r),a=X(e,r),Wr("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=I({},r,{value:void 0}),Wr("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Wr("invalid",e)}for(o in ye(n,a),c=a)if(c.hasOwnProperty(o)){var d=c[o];"style"===o?fe(e,d):"dangerouslySetInnerHTML"===o?null!=(d=d?d.__html:void 0)&&de(e,d):"children"===o?"string"===typeof d?("textarea"!==n||""!==d)&&ue(e,d):"number"===typeof d&&ue(e,""+d):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=d&&"onScroll"===o&&Wr("scroll",e):null!=d&&v(e,o,d,l))}switch(n){case"input":V(e),Z(e,r,!1);break;case"textarea":V(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+G(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=ta)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ks(t),null;case 6:if(e&&null!=t.stateNode)Ls(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=Ji(Xi.current),Ji(Yi.current),pi(t)){if(r=t.stateNode,n=t.memoizedProps,r[ma]=t,(o=r.nodeValue!==n)&&null!==(e=ai))switch(e.tag){case 3:ea(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&ea(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[ma]=t,t.stateNode=r}return Ks(t),null;case 13:if(Ta(to),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(oi&&null!==ii&&0!==(1&t.mode)&&0===(128&t.flags))mi(),fi(),t.flags|=98560,o=!1;else if(o=pi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[ma]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ks(t),o=!1}else null!==si&&(lc(si),si=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&to.current)?0===Ll&&(Ll=3):yc())),null!==t.updateQueue&&(t.flags|=4),Ks(t),null);case 4:return $i(),Bs(e,t),null===e&&Gr(t.stateNode.containerInfo),Ks(t),null;case 10:return Ei(t.type._context),Ks(t),null;case 19:if(Ta(to),null===(o=t.memoizedState))return Ks(t),null;if(r=0!==(128&t.flags),null===(l=o.rendering))if(r)Ys(o,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=no(e))){for(t.flags|=128,Ys(o,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Aa(to,1&to.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Gl&&(t.flags|=128,r=!0,Ys(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=no(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Ys(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!oi)return Ks(t),null}else 2*Je()-o.renderingStartTime>Gl&&1073741824!==n&&(t.flags|=128,r=!0,Ys(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=o.last)?n.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,n=to.current,Aa(to,r?1&n|2:1&n),t):(Ks(t),null);case 22:case 23:return pc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Bl)&&(Ks(t),6&t.subtreeFlags&&(t.flags|=8192)):Ks(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Js(e,t){switch(ri(t),t.tag){case 1:return Ba(t.type)&&za(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return $i(),Ta(Ra),Ta(Pa),ao(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return eo(t),null;case 13:if(Ta(to),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ta(to),null;case 4:return $i(),null;case 10:return Ei(t.type._context),null;case 22:case 23:return pc(),null;default:return null}}Ns=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Bs=function(){},zs=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Ji(Yi.current);var i,o=null;switch(n){case"input":a=X(e,a),r=X(e,r),o=[];break;case"select":a=I({},a,{value:void 0}),r=I({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=ta)}for(d in ye(n,r),n=null,a)if(!r.hasOwnProperty(d)&&a.hasOwnProperty(d)&&null!=a[d])if("style"===d){var l=a[d];for(i in l)l.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(s.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var c=r[d];if(l=null!=a?a[d]:void 0,r.hasOwnProperty(d)&&c!==l&&(null!=c||null!=l))if("style"===d)if(l){for(i in l)!l.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&l[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(s.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Wr("scroll",e),o||l===c||(o=[])):(o=o||[]).push(d,c))}n&&(o=o||[]).push("style",n);var d=o;(t.updateQueue=d)&&(t.flags|=4)}},Ls=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qs=!1,$s=!1,Zs="function"===typeof WeakSet?WeakSet:Set,el=null;function tl(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Mc(e,t,r)}else n.current=null}function nl(e,t,n){try{n()}catch(r){Mc(e,t,r)}}var rl=!1;function al(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&nl(t,n,i)}a=a.next}while(a!==r)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[ma],delete t[fa],delete t[ya],delete t[xa],delete t[va])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ll(e){return 5===e.tag||3===e.tag||4===e.tag}function cl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ll(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function dl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=ta));else if(4!==r&&null!==(e=e.child))for(dl(e,t,n),e=e.sibling;null!==e;)dl(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var hl=null,pl=!1;function ml(e,t,n){for(n=n.child;null!==n;)fl(e,t,n),n=n.sibling}function fl(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(rt,n)}catch(s){}switch(n.tag){case 5:$s||tl(n,t);case 6:var r=hl,a=pl;hl=null,ml(e,t,n),pl=a,null!==(hl=r)&&(pl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(pl?(e=hl,n=n.stateNode,8===e.nodeType?da(e.parentNode,n):1===e.nodeType&&da(e,n),Wt(e)):da(hl,n.stateNode));break;case 4:r=hl,a=pl,hl=n.stateNode.containerInfo,pl=!0,ml(e,t,n),hl=r,pl=a;break;case 0:case 11:case 14:case 15:if(!$s&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&nl(n,t,o),a=a.next}while(a!==r)}ml(e,t,n);break;case 1:if(!$s&&(tl(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Mc(n,t,s)}ml(e,t,n);break;case 21:ml(e,t,n);break;case 22:1&n.mode?($s=(r=$s)||null!==n.memoizedState,ml(e,t,n),$s=r):ml(e,t,n);break;default:ml(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zs),t.forEach(function(t){var r=Pc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}}function yl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,pl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,pl=!0;break e}l=l.return}if(null===hl)throw Error(i(160));fl(o,s,a),hl=null,pl=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(Ln){Mc(a,t,Ln)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)xl(t,e),t=t.sibling}function xl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(yl(t,e),vl(e),4&r){try{al(3,e,e.return),il(3,e)}catch(g){Mc(e,e.return,g)}try{al(5,e,e.return)}catch(g){Mc(e,e.return,g)}}break;case 1:yl(t,e),vl(e),512&r&&null!==n&&tl(n,n.return);break;case 5:if(yl(t,e),vl(e),512&r&&null!==n&&tl(n,n.return),32&e.flags){var a=e.stateNode;try{ue(a,"")}catch(g){Mc(e,e.return,g)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&Q(a,o),xe(l,s);var d=xe(l,o);for(s=0;s<c.length;s+=2){var u=c[s],h=c[s+1];"style"===u?fe(a,h):"dangerouslySetInnerHTML"===u?de(a,h):"children"===u?ue(a,h):v(a,u,h,d)}switch(l){case"input":$(a,o);break;case"textarea":ie(a,o);break;case"select":var p=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var m=o.value;null!=m?ne(a,!!o.multiple,m,!1):p!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[fa]=o}catch(g){Mc(e,e.return,g)}}break;case 6:if(yl(t,e),vl(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(g){Mc(e,e.return,g)}}break;case 3:if(yl(t,e),vl(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(g){Mc(e,e.return,g)}break;case 4:default:yl(t,e),vl(e);break;case 13:yl(t,e),vl(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Fl=Je())),4&r&&gl(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?($s=(d=$s)||u,yl(t,e),$s=d):yl(t,e),vl(e),8192&r){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(el=e,u=e.child;null!==u;){for(h=el=u;null!==el;){switch(m=(p=el).child,p.tag){case 0:case 11:case 14:case 15:al(4,p,p.return);break;case 1:tl(p,p.return);var f=p.stateNode;if("function"===typeof f.componentWillUnmount){r=p,n=p.return;try{t=r,f.props=t.memoizedProps,f.state=t.memoizedState,f.componentWillUnmount()}catch(g){Mc(r,n,g)}}break;case 5:tl(p,p.return);break;case 22:if(null!==p.memoizedState){Sl(h);continue}}null!==m?(m.return=p,el=m):Sl(h)}u=u.sibling}e:for(u=null,h=e;;){if(5===h.tag){if(null===u){u=h;try{a=h.stateNode,d?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=h.stateNode,s=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",s))}catch(g){Mc(e,e.return,g)}}}else if(6===h.tag){if(null===u)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(g){Mc(e,e.return,g)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:yl(t,e),vl(e),4&r&&gl(e);case 21:}}function vl(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ll(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(ue(a,""),r.flags&=-33),ul(e,cl(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;dl(e,cl(e),o);break;default:throw Error(i(161))}}catch(s){Mc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bl(e,t,n){el=e,wl(e,t,n)}function wl(e,t,n){for(var r=0!==(1&e.mode);null!==el;){var a=el,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Qs;if(!o){var s=a.alternate,l=null!==s&&null!==s.memoizedState||$s;s=Qs;var c=$s;if(Qs=o,($s=l)&&!c)for(el=a;null!==el;)l=(o=el).child,22===o.tag&&null!==o.memoizedState?jl(a):null!==l?(l.return=o,el=l):jl(a);for(;null!==i;)el=i,wl(i,t,n),i=i.sibling;el=a,Qs=s,$s=c}kl(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,el=i):kl(e)}}function kl(e){for(;null!==el;){var t=el;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:$s||il(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!$s)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:as(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Ui(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ui(t,s,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var h=u.dehydrated;null!==h&&Wt(h)}}}break;default:throw Error(i(163))}$s||512&t.flags&&ol(t)}catch(p){Mc(t,t.return,p)}}if(t===e){el=null;break}if(null!==(n=t.sibling)){n.return=t.return,el=n;break}el=t.return}}function Sl(e){for(;null!==el;){var t=el;if(t===e){el=null;break}var n=t.sibling;if(null!==n){n.return=t.return,el=n;break}el=t.return}}function jl(e){for(;null!==el;){var t=el;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){Mc(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(l){Mc(t,a,l)}}var i=t.return;try{ol(t)}catch(l){Mc(t,i,l)}break;case 5:var o=t.return;try{ol(t)}catch(l){Mc(t,o,l)}}}catch(l){Mc(t,t.return,l)}if(t===e){el=null;break}var s=t.sibling;if(null!==s){s.return=t.return,el=s;break}el=t.return}}var Cl,Ml=Math.ceil,Tl=b.ReactCurrentDispatcher,Al=b.ReactCurrentOwner,El=b.ReactCurrentBatchConfig,Pl=0,Rl=null,_l=null,Nl=0,Bl=0,zl=Ma(0),Ll=0,Il=null,ql=0,Dl=0,Ol=0,Wl=null,Hl=null,Fl=0,Gl=1/0,Ul=null,Vl=!1,Yl=null,Kl=null,Xl=!1,Jl=null,Ql=0,$l=0,Zl=null,ec=-1,tc=0;function nc(){return 0!==(6&Pl)?Je():-1!==ec?ec:ec=Je()}function rc(e){return 0===(1&e.mode)?1:0!==(2&Pl)&&0!==Nl?Nl&-Nl:null!==yi.transition?(0===tc&&(tc=mt()),tc):0!==(e=xt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function ac(e,t,n,r){if(50<$l)throw $l=0,Zl=null,Error(i(185));gt(e,n,r),0!==(2&Pl)&&e===Rl||(e===Rl&&(0===(2&Pl)&&(Dl|=n),4===Ll&&cc(e,Nl)),ic(e,r),1===n&&0===Pl&&0===(1&t.mode)&&(Gl=Je()+500,Wa&&Ga()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-it(i),s=1<<o,l=a[o];-1===l?0!==(s&n)&&0===(s&r)||(a[o]=ht(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=ut(e,e===Rl?Nl:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Wa=!0,Fa(e)}(dc.bind(null,e)):Fa(dc.bind(null,e)),la(function(){0===(6&Pl)&&Ga()}),n=null;else{switch(vt(r)){case 1:n=$e;break;case 4:n=Ze;break;case 16:default:n=et;break;case 536870912:n=nt}n=Rc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(ec=-1,tc=0,0!==(6&Pl))throw Error(i(327));var n=e.callbackNode;if(jc()&&e.callbackNode!==n)return null;var r=ut(e,e===Rl?Nl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=xc(e,r);else{t=r;var a=Pl;Pl|=2;var o=gc();for(Rl===e&&Nl===t||(Ul=null,Gl=Je()+500,mc(e,t));;)try{bc();break}catch(l){fc(e,l)}Ai(),Tl.current=o,Pl=a,null!==_l?t=0:(Rl=null,Nl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=sc(e,a))),1===t)throw n=Il,mc(e,0),cc(e,r),ic(e,Je()),n;if(6===t)cc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!lr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=xc(e,r))&&(0!==(o=pt(e))&&(r=o,t=sc(e,o))),1===t))throw n=Il,mc(e,0),cc(e,r),ic(e,Je()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:Sc(e,Hl,Ul);break;case 3:if(cc(e,r),(130023424&r)===r&&10<(t=Fl+500-Je())){if(0!==ut(e,0))break;if(((a=e.suspendedLanes)&r)!==r){nc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ia(Sc.bind(null,e,Hl,Ul),t);break}Sc(e,Hl,Ul);break;case 4:if(cc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-it(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Ml(r/1960))-r)){e.timeoutHandle=ia(Sc.bind(null,e,Hl,Ul),r);break}Sc(e,Hl,Ul);break;default:throw Error(i(329))}}}return ic(e,Je()),e.callbackNode===n?oc.bind(null,e):null}function sc(e,t){var n=Wl;return e.current.memoizedState.isDehydrated&&(mc(e,t).flags|=256),2!==(e=xc(e,t))&&(t=Hl,Hl=n,null!==t&&lc(t)),e}function lc(e){null===Hl?Hl=e:Hl.push.apply(Hl,e)}function cc(e,t){for(t&=~Ol,t&=~Dl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-it(t),r=1<<n;e[n]=-1,t&=~r}}function dc(e){if(0!==(6&Pl))throw Error(i(327));jc();var t=ut(e,0);if(0===(1&t))return ic(e,Je()),null;var n=xc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=sc(e,r))}if(1===n)throw n=Il,mc(e,0),cc(e,t),ic(e,Je()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Sc(e,Hl,Ul),ic(e,Je()),null}function uc(e,t){var n=Pl;Pl|=1;try{return e(t)}finally{0===(Pl=n)&&(Gl=Je()+500,Wa&&Ga())}}function hc(e){null!==Jl&&0===Jl.tag&&0===(6&Pl)&&jc();var t=Pl;Pl|=1;var n=El.transition,r=xt;try{if(El.transition=null,xt=1,e)return e()}finally{xt=r,El.transition=n,0===(6&(Pl=t))&&Ga()}}function pc(){Bl=zl.current,Ta(zl)}function mc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,oa(n)),null!==_l)for(n=_l.return;null!==n;){var r=n;switch(ri(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&za();break;case 3:$i(),Ta(Ra),Ta(Pa),ao();break;case 5:eo(r);break;case 4:$i();break;case 13:case 19:Ta(to);break;case 10:Ei(r.type._context);break;case 22:case 23:pc()}n=n.return}if(Rl=e,_l=e=zc(e.current,null),Nl=Bl=t,Ll=0,Il=null,Ol=Dl=ql=0,Hl=Wl=null,null!==Ni){for(t=0;t<Ni.length;t++)if(null!==(r=(n=Ni[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ni=null}return e}function fc(e,t){for(;;){var n=_l;try{if(Ai(),io.current=es,ho){for(var r=lo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}ho=!1}if(so=0,uo=co=lo=null,po=!1,mo=0,Al.current=null,null===n||null===n.return){Ll=1,Il=t,_l=null;break}e:{var o=e,s=n.return,l=n,c=t;if(t=Nl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=l,h=u.tag;if(0===(1&u.mode)&&(0===h||11===h||15===h)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=xs(s);if(null!==m){m.flags&=-257,vs(m,s,l,0,t),1&m.mode&&ys(o,d,t),c=d;var f=(t=m).updateQueue;if(null===f){var g=new Set;g.add(c),t.updateQueue=g}else f.add(c);break e}if(0===(1&t)){ys(o,d,t),yc();break e}c=Error(i(426))}else if(oi&&1&l.mode){var y=xs(s);if(null!==y){0===(65536&y.flags)&&(y.flags|=256),vs(y,s,l,0,t),gi(us(c,l));break e}}o=c=us(c,l),4!==Ll&&(Ll=2),null===Wl?Wl=[o]:Wl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Fi(o,fs(0,c,t));break e;case 1:l=c;var x=o.type,v=o.stateNode;if(0===(128&o.flags)&&("function"===typeof x.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Kl||!Kl.has(v)))){o.flags|=65536,t&=-t,o.lanes|=t,Fi(o,gs(o,l,t));break e}}o=o.return}while(null!==o)}kc(n)}catch(b){t=b,_l===n&&null!==n&&(_l=n=n.return);continue}break}}function gc(){var e=Tl.current;return Tl.current=es,null===e?es:e}function yc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===Rl||0===(268435455&ql)&&0===(268435455&Dl)||cc(Rl,Nl)}function xc(e,t){var n=Pl;Pl|=2;var r=gc();for(Rl===e&&Nl===t||(Ul=null,mc(e,t));;)try{vc();break}catch(a){fc(e,a)}if(Ai(),Pl=n,Tl.current=r,null!==_l)throw Error(i(261));return Rl=null,Nl=0,Ll}function vc(){for(;null!==_l;)wc(_l)}function bc(){for(;null!==_l&&!Ke();)wc(_l)}function wc(e){var t=Cl(e.alternate,e,Bl);e.memoizedProps=e.pendingProps,null===t?kc(e):_l=t,Al.current=null}function kc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,Bl)))return void(_l=n)}else{if(null!==(n=Js(n,t)))return n.flags&=32767,void(_l=n);if(null===e)return Ll=6,void(_l=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(_l=t);_l=t=e}while(null!==t);0===Ll&&(Ll=5)}function Sc(e,t,n){var r=xt,a=El.transition;try{El.transition=null,xt=1,function(e,t,n,r){do{jc()}while(null!==Jl);if(0!==(6&Pl))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-it(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===Rl&&(_l=Rl=null,Nl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xl||(Xl=!0,Rc(et,function(){return jc(),null})),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=El.transition,El.transition=null;var s=xt;xt=1;var l=Pl;Pl|=4,Al.current=null,function(e,t){if(na=Ft,fr(e=mr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(w){n=null;break e}var s=0,l=-1,c=-1,d=0,u=0,h=e,p=null;t:for(;;){for(var m;h!==n||0!==a&&3!==h.nodeType||(l=s+a),h!==o||0!==r&&3!==h.nodeType||(c=s+r),3===h.nodeType&&(s+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===n&&++d===a&&(l=s),p===o&&++u===r&&(c=s),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ra={focusedElem:e,selectionRange:n},Ft=!1,el=t;null!==el;)if(e=(t=el).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,el=e;else for(;null!==el;){t=el;try{var f=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==f){var g=f.memoizedProps,y=f.memoizedState,x=t.stateNode,v=x.getSnapshotBeforeUpdate(t.elementType===t.type?g:as(t.type,g),y);x.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(i(163))}}catch(w){Mc(t,t.return,w)}if(null!==(e=t.sibling)){e.return=t.return,el=e;break}el=t.return}f=rl,rl=!1}(e,n),xl(n,e),gr(ra),Ft=!!na,ra=na=null,e.current=n,bl(n,e,a),Xe(),Pl=l,xt=s,El.transition=o}else e.current=n;if(Xl&&(Xl=!1,Jl=e,Ql=a),o=e.pendingLanes,0===o&&(Kl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Vl)throw Vl=!1,e=Yl,Yl=null,e;0!==(1&Ql)&&0!==e.tag&&jc(),o=e.pendingLanes,0!==(1&o)?e===Zl?$l++:($l=0,Zl=e):$l=0,Ga()}(e,t,n,r)}finally{El.transition=a,xt=r}return null}function jc(){if(null!==Jl){var e=vt(Ql),t=El.transition,n=xt;try{if(El.transition=null,xt=16>e?16:e,null===Jl)var r=!1;else{if(e=Jl,Jl=null,Ql=0,0!==(6&Pl))throw Error(i(331));var a=Pl;for(Pl|=4,el=e.current;null!==el;){var o=el,s=o.child;if(0!==(16&el.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var d=l[c];for(el=d;null!==el;){var u=el;switch(u.tag){case 0:case 11:case 15:al(8,u,o)}var h=u.child;if(null!==h)h.return=u,el=h;else for(;null!==el;){var p=(u=el).sibling,m=u.return;if(sl(u),u===d){el=null;break}if(null!==p){p.return=m,el=p;break}el=m}}}var f=o.alternate;if(null!==f){var g=f.child;if(null!==g){f.child=null;do{var y=g.sibling;g.sibling=null,g=y}while(null!==g)}}el=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,el=s;else e:for(;null!==el;){if(0!==(2048&(o=el).flags))switch(o.tag){case 0:case 11:case 15:al(9,o,o.return)}var x=o.sibling;if(null!==x){x.return=o.return,el=x;break e}el=o.return}}var v=e.current;for(el=v;null!==el;){var b=(s=el).child;if(0!==(2064&s.subtreeFlags)&&null!==b)b.return=s,el=b;else e:for(s=v;null!==el;){if(0!==(2048&(l=el).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(k){Mc(l,l.return,k)}if(l===s){el=null;break e}var w=l.sibling;if(null!==w){w.return=l.return,el=w;break e}el=l.return}}if(Pl=a,Ga(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(rt,e)}catch(k){}r=!0}return r}finally{xt=n,El.transition=t}}return!1}function Cc(e,t,n){e=Wi(e,t=fs(0,t=us(n,t),1),1),t=nc(),null!==e&&(gt(e,1,t),ic(e,t))}function Mc(e,t,n){if(3===e.tag)Cc(e,e,n);else for(;null!==t;){if(3===t.tag){Cc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Kl||!Kl.has(r))){t=Wi(t,e=gs(t,e=us(n,e),1),1),e=nc(),null!==t&&(gt(t,1,e),ic(t,e));break}}t=t.return}}function Tc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=nc(),e.pingedLanes|=e.suspendedLanes&n,Rl===e&&(Nl&n)===n&&(4===Ll||3===Ll&&(130023424&Nl)===Nl&&500>Je()-Fl?mc(e,0):Ol|=n),ic(e,t)}function Ac(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ct,0===(130023424&(ct<<=1))&&(ct=4194304)));var n=nc();null!==(e=Li(e,t))&&(gt(e,t,n),ic(e,n))}function Ec(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Ac(e,n)}function Pc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Ac(e,n)}function Rc(e,t){return Ve(e,t)}function _c(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,n,r){return new _c(e,t,n,r)}function Bc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function zc(e,t){var n=e.alternate;return null===n?((n=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lc(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Bc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Ic(n.children,a,o,t);case j:s=8,a|=8;break;case C:return(e=Nc(12,n,t,2|a)).elementType=C,e.lanes=o,e;case E:return(e=Nc(13,n,t,a)).elementType=E,e.lanes=o,e;case P:return(e=Nc(19,n,t,a)).elementType=P,e.lanes=o,e;case N:return qc(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case M:s=10;break e;case T:s=9;break e;case A:s=11;break e;case R:s=14;break e;case _:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Nc(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Ic(e,t,n,r){return(e=Nc(7,e,r,t)).lanes=n,e}function qc(e,t,n,r){return(e=Nc(22,e,r,t)).elementType=N,e.lanes=n,e.stateNode={isHidden:!1},e}function Dc(e,t,n){return(e=Nc(6,e,null,t)).lanes=n,e}function Oc(e,t,n){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Wc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ft(0),this.expirationTimes=ft(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ft(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Hc(e,t,n,r,a,i,o,s,l){return e=new Wc(e,t,n,s,l),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Nc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},qi(i),e}function Fc(e){if(!e)return Ea;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ba(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Ba(n))return Ia(e,n,t)}return t}function Gc(e,t,n,r,a,i,o,s,l){return(e=Hc(n,r,!0,e,0,i,0,s,l)).context=Fc(null),n=e.current,(i=Oi(r=nc(),a=rc(n))).callback=void 0!==t&&null!==t?t:null,Wi(n,i,a),e.current.lanes=a,gt(e,a,r),ic(e,r),e}function Uc(e,t,n,r){var a=t.current,i=nc(),o=rc(a);return n=Fc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Oi(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Wi(a,t,o))&&(ac(e,a,o,i),Hi(e,a,o)),o}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Yc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kc(e,t){Yc(e,t),(e=e.alternate)&&Yc(e,t)}Cl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ra.current)ws=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ws=!1,function(e,t,n){switch(t.tag){case 3:Rs(t),fi();break;case 5:Zi(t);break;case 1:Ba(t.type)&&qa(t);break;case 4:Qi(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Aa(ji,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Aa(to,1&to.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ds(e,t,n):(Aa(to,1&to.current),null!==(e=Vs(e,t,n))?e.sibling:null);Aa(to,1&to.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Gs(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Aa(to,to.current),r)break;return null;case 22:case 23:return t.lanes=0,Ms(e,t,n)}return Vs(e,t,n)}(e,t,n);ws=0!==(131072&e.flags)}else ws=!1,oi&&0!==(1048576&t.flags)&&ti(t,Ka,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Us(e,t),e=t.pendingProps;var a=Na(t,Pa.current);Ri(t,n),a=xo(null,t,r,e,a,n);var o=vo();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ba(r)?(o=!0,qa(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,qi(t),a.updater=os,t.stateNode=a,a._reactInternals=t,ds(t,r,e,n),t=Ps(null,t,r,!0,o,n)):(t.tag=0,oi&&o&&ni(t),ks(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Us(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Bc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===R)return 14}return 2}(r),e=as(r,e),a){case 0:t=As(null,t,r,e,n);break e;case 1:t=Es(null,t,r,e,n);break e;case 11:t=Ss(null,t,r,e,n);break e;case 14:t=js(null,t,r,as(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,As(e,t,r,a=t.elementType===r?a:as(r,a),n);case 1:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:as(r,a),n);case 3:e:{if(Rs(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Di(e,t),Gi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=_s(e,t,r,n,a=us(Error(i(423)),t));break e}if(r!==a){t=_s(e,t,r,n,a=us(Error(i(424)),t));break e}for(ii=ua(t.stateNode.containerInfo.firstChild),ai=t,oi=!0,si=null,n=Si(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),r===a){t=Vs(e,t,n);break e}ks(e,t,r,n)}t=t.child}return t;case 5:return Zi(t),null===e&&ui(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,aa(r,a)?s=null:null!==o&&aa(r,o)&&(t.flags|=32),Ts(e,t),ks(e,t,s,n),t.child;case 6:return null===e&&ui(t),null;case 13:return Ds(e,t,n);case 4:return Qi(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ki(t,null,r,n):ks(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,Ss(e,t,r,a=t.elementType===r?a:as(r,a),n);case 7:return ks(e,t,t.pendingProps,n),t.child;case 8:case 12:return ks(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Aa(ji,r._currentValue),r._currentValue=s,null!==o)if(lr(o.value,s)){if(o.children===a.children&&!Ra.current){t=Vs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Oi(-1,n&-n)).tag=2;var d=o.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Pi(o.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(l=s.alternate)&&(l.lanes|=n),Pi(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ks(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ri(t,n),r=r(a=_i(a)),t.flags|=1,ks(e,t,r,n),t.child;case 14:return a=as(r=t.type,t.pendingProps),js(e,t,r,a=as(r.type,a),n);case 15:return Cs(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:as(r,a),Us(e,t),t.tag=1,Ba(r)?(e=!0,qa(t)):e=!1,Ri(t,n),ls(t,r,a),ds(t,r,a,n),Ps(null,t,r,!0,e,n);case 19:return Gs(e,t,n);case 22:return Ms(e,t,n)}throw Error(i(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Jc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ed(){}function td(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=Vc(o);s.call(e)}}Uc(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=Vc(o);i.call(e)}}var o=Gc(t,r,e,0,null,!1,0,"",ed);return e._reactRootContainer=o,e[ga]=o.current,Gr(8===e.nodeType?e.parentNode:e),hc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=Vc(l);s.call(e)}}var l=Hc(e,0,!1,null,0,!1,0,"",ed);return e._reactRootContainer=l,e[ga]=l.current,Gr(8===e.nodeType?e.parentNode:e),hc(function(){Uc(t,l,n,r)}),l}(n,t,e,a,r);return Vc(o)}Qc.prototype.render=Jc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Uc(e,t,null,null)},Qc.prototype.unmount=Jc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc(function(){Uc(null,e,null,null)}),t[ga]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<_t.length&&0!==t&&t<_t[n].priority;n++);_t.splice(n,0,e),0===n&&Lt(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=dt(t.pendingLanes);0!==n&&(yt(t,1|n),ic(t,Je()),0===(6&Pl)&&(Gl=Je()+500,Ga()))}break;case 13:hc(function(){var t=Li(e,1);if(null!==t){var n=nc();ac(t,e,1,n)}}),Kc(e,1)}},wt=function(e){if(13===e.tag){var t=Li(e,134217728);if(null!==t)ac(t,e,134217728,nc());Kc(e,134217728)}},kt=function(e){if(13===e.tag){var t=rc(e),n=Li(e,t);if(null!==n)ac(n,e,t,nc());Kc(e,t)}},St=function(){return xt},jt=function(e,t){var n=xt;try{return xt=e,t()}finally{xt=n}},we=function(e,t,n){switch(t){case"input":if($(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=Sa(r);if(!a)throw Error(i(90));Y(r),$(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=uc,Ae=hc;var nd={usingClientEntryPoint:!1,Events:[wa,ka,Sa,Ce,Me,uc]},rd={findFiberByHostInstance:ba,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ad={bundleType:rd.bundleType,version:rd.version,rendererPackageName:rd.rendererPackageName,rendererConfig:rd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:rd.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var id=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!id.isDisabled&&id.supportsFiber)try{rt=id.inject(ad),at=id}catch(ir){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nd,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!$c(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:k,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!$c(e))throw Error(i(299));var n=!1,r="",a=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Hc(e,1,!1,null,0,n,0,r,a),e[ga]=t.current,Gr(8===e.nodeType?e.parentNode:e),new Jc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,n){if(!Zc(t))throw Error(i(200));return td(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!$c(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,a,0,o,s),e[ga]=t.current,Gr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Qc(t)},t.render=function(e,t,n){if(!Zc(t))throw Error(i(200));return td(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Zc(e))throw Error(i(40));return!!e._reactRootContainer&&(hc(function(){td(null,null,e,!1,function(){e._reactRootContainer=null,e[ga]=null})}),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Zc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return td(e,t,n,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},348:(e,t,n)=>{n.d(t,{d7:()=>i,lQ:()=>r});const r={basic_slash:{id:"basic_slash",name:"Slash",type:"skill",apCost:1,range:1,damage:{amount:8,type:"physical"},shape:"single",cooldown:0},basic_shot:{id:"basic_shot",name:"Bow Shot",type:"skill",apCost:1,range:5,damage:{amount:7,type:"physical"},shape:"single",cooldown:0},fireball:{id:"fireball",name:"Fireball",type:"spell",apCost:1,range:6,damage:{amount:12,type:"fire"},shape:"blast1",aoeRadius:1,cooldown:2,description:"Hurls a blazing orb that explodes on impact"},lightning_bolt:{id:"lightning_bolt",name:"Lightning Bolt",type:"spell",apCost:1,range:8,damage:{amount:10,type:"lightning"},shape:"line",cooldown:1,description:"Strikes enemies in a straight line"},frost_nova:{id:"frost_nova",name:"Frost Nova",type:"spell",apCost:1,range:0,damage:{amount:6,type:"frost"},shape:"blast2",aoeRadius:2,cooldown:3,description:"Freezes all nearby enemies"},heal:{id:"heal",name:"Heal",type:"spell",apCost:1,range:4,healing:10,shape:"ally",cooldown:1,description:"Restores health to an ally"},entangle:{id:"entangle",name:"Entangle",type:"spell",apCost:1,range:5,shape:"single",cooldown:2,description:"Magical vines root an enemy in place"},teleport:{id:"teleport",name:"Teleport",type:"spell",apCost:1,range:6,shape:"self",cooldown:4,description:"Instantly move to target location"},rally:{id:"rally",name:"Rally",type:"command",apCost:0,range:0,shape:"ally",cooldown:3,description:"Inspire all allies with increased speed and defense"},meteor_strike:{id:"meteor_strike",name:"Meteor Strike",type:"command",apCost:0,range:8,shape:"blast2",aoeRadius:2,cooldown:5,damage:{amount:20,type:"fire"},description:"Call down a devastating meteor from the heavens"},tactical_advance:{id:"tactical_advance",name:"Tactical Advance",type:"command",apCost:0,range:0,shape:"ally",cooldown:4,description:"Grant all allies an extra move action this turn"},inspiring_presence:{id:"inspiring_presence",name:"Inspiring Presence",type:"command",apCost:0,range:0,shape:"ally",cooldown:2,healing:5,description:"Restore morale and health to all allies"}},a={greenwarden:["entangle","heal","basic_slash"],thornknight:["basic_slash","rally"],beastcaller:["basic_shot","heal"],elementalist:["fireball","lightning_bolt"],verdant_scholar:["heal","teleport"],sylvan_archer:["basic_shot","entangle"],grove_protector:["basic_slash","heal"],nature_spirit:["heal","entangle","frost_nova"],ashblade:["basic_slash","fireball"],voidcaller:["lightning_bolt","teleport"],cindermage:["fireball","frost_nova"],shadow_hunter:["basic_shot","teleport"],ember_knight:["basic_slash","fireball"],storm_rider:["lightning_bolt","basic_shot"],void_scholar:["teleport","lightning_bolt"],flame_warden:["fireball","heal"],stormbreaker:["lightning_bolt","basic_slash"],crystalguard:["basic_slash","heal"],wind_dancer:["basic_shot","teleport"],sky_mage:["lightning_bolt","frost_nova"],thunder_knight:["basic_slash","lightning_bolt"],crystal_sage:["heal","frost_nova"],aerial_scout:["basic_shot","teleport"],storm_caller:["lightning_bolt","fireball"],warrior:["basic_slash"],archer:["basic_shot"],mage:["fireball","heal"],cleric:["heal","basic_slash"],rogue:["basic_slash","teleport"],ranger:["basic_shot","entangle"]};function i(e){const t=e.toLowerCase().replace(/\s+/g,"");return a[t]||a.warrior}},352:(e,t,n)=>{var r=n(119);t.H=r.createRoot,r.hydrateRoot},355:(e,t,n)=>{n.d(t,{tN:()=>s});const r={Grass:{name:"Grasslands",terrainTypes:[{type:"Grass",weight:70,passable:!0},{type:"Forest",weight:20,passable:!0,cover:.3},{type:"Mountain",weight:10,passable:!1}],elevationVariance:1,roadChance:.1},Forest:{name:"Deep Forest",terrainTypes:[{type:"Forest",weight:60,passable:!0,cover:.5},{type:"Grass",weight:30,passable:!0},{type:"Water",weight:10,passable:!1}],elevationVariance:2,roadChance:.05},Desert:{name:"Arid Desert",terrainTypes:[{type:"Desert",weight:80,passable:!0},{type:"Mountain",weight:15,passable:!1},{type:"Water",weight:5,passable:!1}],elevationVariance:3,roadChance:.08},Mountain:{name:"Rocky Peaks",terrainTypes:[{type:"Mountain",weight:50,passable:!1},{type:"Grass",weight:30,passable:!0},{type:"Forest",weight:20,passable:!0,cover:.2}],elevationVariance:5,roadChance:.03},Swamp:{name:"Fetid Marshland",terrainTypes:[{type:"Swamp",weight:60,passable:!0},{type:"Water",weight:25,passable:!1},{type:"Grass",weight:15,passable:!0}],elevationVariance:1,roadChance:.02},Settlement:{name:"Village Outskirts",terrainTypes:[{type:"Grass",weight:60,passable:!0},{type:"Forest",weight:25,passable:!0,cover:.2},{type:"Mountain",weight:15,passable:!1}],elevationVariance:1,roadChance:.25}};class a{constructor(e){this.seed=void 0,this.seed=this.hashString(e)}hashString(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return Math.abs(t)}next(){return this.seed=(9301*this.seed+49297)%233280,this.seed/233280}nextInt(e){return Math.floor(this.next()*e)}choice(e){return e[this.nextInt(e.length)]}}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:14;const i=new a(e.seed),s=r[e.biome]||r.Grass,l=[];Math.floor(t/2),Math.floor(n/2);for(let r=0;r<n;r++)for(let e=0;e<t;e++){const t=i.next();let n=0,a=s.terrainTypes[0];for(const e of s.terrainTypes)if(n+=e.weight/100,t<=n){a=e;break}const o=Math.floor(i.next()*s.elevationVariance);l.push({q:e,r:r,terrain:a.type,elevation:o,passable:a.passable,cover:a.cover||0})}"settlement"===e.site?function(e,t,n,r){const a=new Set,i=Math.floor(n/2);for(let o=0;o<t;o+=2)a.add("".concat(o,",").concat(i));for(let o=0;o<e.length;o++){const t=e[o],n="".concat(t.q,",").concat(t.r);a.has(n)&&(t.terrain="Grass",t.passable=!0,t.cover=0),r.next()<.05&&(t.terrain="Mountain",t.passable=!1,t.elevation=2)}}(l,t,n,i):"dungeon"===e.site&&function(e,t,n,r){for(let i=0;i<e.length;i++){const t=e[i];r.next()<.7?(t.terrain="Mountain",t.passable=!1):(t.terrain="Grass",t.passable=!0,t.cover=0)}const a=Math.floor(n/2);for(let i=1;i<t-1;i++){const t=e.find(e=>e.q===i&&e.r===a);t&&(t.terrain="Grass",t.passable=!0)}}(l,t,n,i);return{grid:{width:t,height:n,tiles:l},friendlyDeployment:o("Player",t,n,.2),enemyDeployment:o("Enemy",t,n,.8)}}function o(e,t,n,r){const a=[],i=Math.floor(t*r);for(let o=Math.max(0,i-1);o<=Math.min(t-1,i+1);o++)for(let e=1;e<n-1;e+=2)a.push({q:o,r:e});return{hexes:a,faction:e}}function s(e,t,n){const r=t+n,a=Math.max(12,Math.ceil(3*Math.sqrt(r)));return i(e,a+4,a)}},364:(e,t,n)=>{n.r(t),n.d(t,{buildBattle:()=>u,calculateRevivalCost:()=>h,characterToBattleStats:()=>o,characterToUnit:()=>s,createCommander:()=>l,createTestBattle:()=>m,generateEnemies:()=>c,getCasualties:()=>p});var r=n(645),a=n(355),i=n(348);function o(e){var t;const n=20+3*(e.level||1),r=e.stats||{};return{hp:n,maxHp:n,atk:6+(r.str||2),def:4+(r.con||2),mag:6+(r.int||2),res:4+(r.wis||2),spd:6+(r.dex||2),rng:null!==(t=e.archetype)&&void 0!==t&&t.toLowerCase().includes("ranger")?5:1,move:4}}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Player",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const a=o(e),s=(0,i.d7)(e.archetype||"warrior");return{id:e.id||"unit_".concat(Date.now(),"_").concat(r.Sh.next()),name:e.name||"Unknown",kind:n?"HeroCommander":"Mercenary",faction:t,race:e.race||"Human",archetype:e.archetype||"Warrior",level:e.level||1,stats:a,statuses:[],skills:n?[]:s,isCommander:n,isDead:!1,gear:{gearScore:e.gearScore||0}}}function l(e){return{unitId:s(e,"Player",!0).id,aura:{name:"Heroic Presence",stats:{spd:1,def:1,atk:1}},abilities:[{id:"rally",name:"Rally",type:"command",apCost:0,range:0,shape:"ally",cooldown:3,description:"Inspire all allies"},{id:"meteor_strike",name:"Meteor Strike",type:"command",apCost:0,range:8,shape:"blast2",aoeRadius:2,cooldown:5,damage:{amount:20,type:"fire"},description:"Call down a devastating meteor"},{id:"tactical_advance",name:"Tactical Advance",type:"command",apCost:0,range:0,shape:"ally",cooldown:4,description:"Grant allies extra movement"}],runtime:{cooldowns:{},actionPoints:3}}}function c(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>r.Sh.next();const i=[],o=Math.max(2,t-1+Math.floor(3*a())),s=function(e){const t={Grass:[{name:"Bandit",race:"Human",archetype:"warrior",statBonus:{atk:1}},{name:"Wolf",race:"Beast",archetype:"ranger",statBonus:{spd:2}},{name:"Orc Raider",race:"Orc",archetype:"warrior",statBonus:{atk:2,def:1}}],Forest:[{name:"Forest Spider",race:"Beast",archetype:"rogue",statBonus:{spd:1}},{name:"Dryad",race:"Fey",archetype:"mage",statBonus:{mag:2}},{name:"Owlbear",race:"Beast",archetype:"warrior",statBonus:{atk:2,def:2}}],Desert:[{name:"Desert Nomad",race:"Human",archetype:"ranger",statBonus:{spd:1}},{name:"Sand Viper",race:"Beast",archetype:"rogue",statBonus:{spd:2,atk:1}},{name:"Fire Elemental",race:"Elemental",archetype:"mage",statBonus:{mag:3}}],Mountain:[{name:"Stone Giant",race:"Giant",archetype:"warrior",statBonus:{def:3,atk:1}},{name:"Dwarf Outcast",race:"Dwarf",archetype:"warrior",statBonus:{def:2}},{name:"Mountain Lion",race:"Beast",archetype:"ranger",statBonus:{spd:2,atk:1}}],Swamp:[{name:"Lizardfolk",race:"Reptilian",archetype:"warrior",statBonus:{def:1}},{name:"Bog Witch",race:"Human",archetype:"mage",statBonus:{mag:2}},{name:"Giant Frog",race:"Beast",archetype:"warrior",statBonus:{atk:1}}],Settlement:[{name:"Town Guard",race:"Human",archetype:"warrior",statBonus:{def:1}},{name:"Corrupt Official",race:"Human",archetype:"mage",statBonus:{mag:1}},{name:"Hired Thug",race:"Human",archetype:"rogue",statBonus:{atk:1}}]};return t[e]||t.Grass}(n);for(let r=0;r<o;r++){const t=s[Math.floor(a()*s.length)],n=Math.floor(3*a())-1,o=Math.max(1,e+n);i.push({id:"enemy_".concat(r),name:"".concat(t.name," ").concat(r+1),race:t.race,archetype:t.archetype,level:o,stats:d(o,t.statBonus)})}return i}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n={str:2+Math.floor(e/2),con:2+Math.floor(e/2),int:2+Math.floor(e/3),wis:2+Math.floor(e/3),dex:2+Math.floor(e/2)};for(const[r,a]of Object.entries(t))n.hasOwnProperty(r)&&(n[r]+=a);return n}function u(e,t,n,r){const i=t.length,o=t.reduce((e,t)=>e+(t.level||1),0)/i||1;r||(r=c(o,i,n.biome));const d=(0,a.tN)(n,i,r.length),u=s(e,"Player",!0),h=l(e);u.id=h.unitId;const p=t.map(e=>s(e,"Player",!1)),m=r.map(e=>s(e,"Enemy",!1));p.forEach((e,t)=>{t<d.friendlyDeployment.hexes.length&&(e.pos=d.friendlyDeployment.hexes[t])}),m.forEach((e,t)=>{t<d.enemyDeployment.hexes.length&&(e.pos=d.enemyDeployment.hexes[t])});return{id:"battle_".concat(Date.now()),turn:0,phase:"Setup",grid:d.grid,context:n,commander:h,units:[u,...p,...m],initiative:[],friendlyDeployment:d.friendlyDeployment,enemyDeployment:d.enemyDeployment,log:["Battle preparations complete. Deploy your forces!"],turnLimit:void 0}}function h(e){var t;return 50+25*e.level+10*((null===(t=e.gear)||void 0===t?void 0:t.gearScore)||0)}function p(e){return e.units.filter(e=>e.isDead&&"Player"===e.faction&&!e.isCommander)}function m(){return u({id:"test_hero",name:"Test Hero",race:"Human",archetype:"Greenwarden",level:3,stats:{str:4,con:3,int:3,wis:4,dex:3}},[{id:"merc1",name:"Warrior",race:"Human",archetype:"Thorn Knight",level:2,stats:{str:4,con:4,int:2,wis:2,dex:2}},{id:"merc2",name:"Archer",race:"Sylvanborn",archetype:"Sylvan Archer",level:2,stats:{str:2,con:2,int:2,wis:3,dex:4}}],{seed:"test_battle_123",biome:"Forest",site:"wilds"})}},379:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(705);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){(0,r.A)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}},414:(e,t,n)=>{e.exports=n(654)},571:(e,t,n)=>{function r(e){let t=e>>>0;const n=()=>{t=t+2654435769>>>0;let e=t;return e=(e^e>>>16)>>>0,e=Math.imul(e,569420461),e=(e^e>>>15)>>>0,e=Math.imul(e,1935289751),e=(e^e>>>15)>>>0,e/4294967296};return{next:n,pick:e=>{if(0===e.length)throw new Error("Cannot pick from empty array");return e[Math.floor(n()*e.length)]},range:(e,t)=>Math.floor(n()*(t-e+1))+e,bool:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return n()<e},get seed(){return t}}}n.d(t,{sW:()=>r,xD:()=>a});function a(e,t,n){return function(e,t){const n="string"===typeof t?function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t>>>0}(t):t;return r((e.seed^n)>>>0)}(r(e),"chunk:".concat(t,",").concat(n))}},645:(e,t,n)=>{n.d(t,{Sh:()=>i});const r=new class{next(){return Math.random()}nextFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e+this.next()*(t-e)}nextInt(e,t){if(t<e)throw new Error("RandomSource.nextInt requires max >= min");return Math.floor(this.nextFloat(e,t+1))}pick(e){if(0===e.length)throw new Error("Cannot pick from an empty collection");return e[this.nextInt(0,e.length-1)]}};let a=r;const i={next:()=>a.next(),float(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return a.nextFloat(e,t)},int:(e,t)=>a.nextInt(e,t),pick:e=>a.pick(e),bool(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return!(e<=0)&&(e>=1||a.next()<e)},id(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rand";const t=a.next().toString(36).slice(2,10),n=Date.now().toString(36);return"".concat(e,"_").concat(n,"_").concat(t)}}},654:(e,t,n)=>{var r=n(950),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,d=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:d,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},705:(e,t,n)=>{function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function i(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{A:()=>i})},761:(e,t)=>{function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,d=e[c];if(0>i(l,n))c<a&&0>i(d,l)?(e[r]=d,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<a&&0>i(d,n)))break e;e[r]=d,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],d=[],u=1,h=null,p=3,m=!1,f=!1,g=!1,y="function"===typeof setTimeout?setTimeout:null,x="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(d);null!==t;){if(null===t.callback)a(d);else{if(!(t.startTime<=e))break;a(d),t.sortIndex=t.expirationTime,n(c,t)}t=r(d)}}function w(e){if(g=!1,b(e),!f)if(null!==r(c))f=!0,N(k);else{var t=r(d);null!==t&&B(w,t.startTime-e)}}function k(e,n){f=!1,g&&(g=!1,x(M),M=-1),m=!0;var i=p;try{for(b(n),h=r(c);null!==h&&(!(h.expirationTime>n)||e&&!E());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var s=o(h.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?h.callback=s:h===r(c)&&a(c),b(n)}else a(c);h=r(c)}if(null!==h)var l=!0;else{var u=r(d);null!==u&&B(w,u.startTime-n),l=!1}return l}finally{h=null,p=i,m=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,j=!1,C=null,M=-1,T=5,A=-1;function E(){return!(t.unstable_now()-A<T)}function P(){if(null!==C){var e=t.unstable_now();A=e;var n=!0;try{n=C(!0,e)}finally{n?S():(j=!1,C=null)}}else j=!1}if("function"===typeof v)S=function(){v(P)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,_=R.port2;R.port1.onmessage=P,S=function(){_.postMessage(null)}}else S=function(){y(P,0)};function N(e){C=e,j||(j=!0,S())}function B(e,n){M=y(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){f||m||(f=!0,N(k))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var n=p;p=t;try{return e()}finally{p=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=p;p=e;try{return t()}finally{p=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(d,e),null===r(c)&&e===r(d)&&(g?(x(M),M=-1):g=!0,B(w,i-o))):(e.sortIndex=s,n(c,e),f||m||(f=!0,N(k))),e},t.unstable_shouldYield=E,t.unstable_wrapCallback=function(e){var t=p;return function(){var n=p;p=t;try{return e.apply(this,arguments)}finally{p=n}}}},950:(e,t,n)=>{e.exports=n(49)},986:(e,t,n)=>{n.d(t,{O2:()=>i});const r=[{id:"deep_ocean",name:"Deep Ocean",height:[0,.25],temp:[0,1],moisture:[0,1],baseTile:"water",color:"#0066cc",movementCost:99,defensiveBonus:0},{id:"shallow_ocean",name:"Shallow Ocean",height:[.25,.28],temp:[0,1],moisture:[0,1],baseTile:"shallows",color:"#3399ff",movementCost:3,defensiveBonus:-.1},{id:"beach",name:"Beach",height:[.28,.32],temp:[.2,1],moisture:[0,.6],baseTile:"sand",color:"#ffeb9c",movementCost:1.2,defensiveBonus:-.2},{id:"plains",name:"Plains",height:[.32,.55],temp:[.3,.8],moisture:[.2,.7],baseTile:"grass",overlays:[{tile:"forest",chance:.1,minSpacing:5}],color:"#90ee90",movementCost:1,defensiveBonus:0},{id:"steppe",name:"Steppe",height:[.32,.5],temp:[.2,.7],moisture:[0,.3],baseTile:"grass",color:"#daa520",movementCost:1,defensiveBonus:0},{id:"temperate_forest",name:"Temperate Forest",height:[.35,.7],temp:[.3,.7],moisture:[.5,.9],baseTile:"forest",color:"#228b22",movementCost:1.5,defensiveBonus:.2},{id:"boreal_forest",name:"Boreal Forest",height:[.35,.65],temp:[.1,.4],moisture:[.4,.8],baseTile:"forest",color:"#006400",movementCost:1.8,defensiveBonus:.3},{id:"swamp",name:"Swamp",height:[.28,.45],temp:[.4,.9],moisture:[.8,1],baseTile:"swamp",color:"#556b2f",movementCost:2.5,defensiveBonus:-.1},{id:"hot_desert",name:"Hot Desert",height:[.32,.6],temp:[.7,1],moisture:[0,.2],baseTile:"desert",color:"#f4a460",movementCost:1.8,defensiveBonus:-.1},{id:"cold_desert",name:"Cold Desert",height:[.4,.65],temp:[0,.3],moisture:[0,.2],baseTile:"tundra",color:"#d2b48c",movementCost:1.6,defensiveBonus:0},{id:"foothills",name:"Foothills",height:[.55,.7],temp:[.2,.8],moisture:[0,1],baseTile:"rock",overlays:[{tile:"forest",chance:.3,minSpacing:3}],color:"#708090",movementCost:2,defensiveBonus:.3},{id:"mountains",name:"Mountains",height:[.7,.85],temp:[0,.6],moisture:[0,1],baseTile:"rock",color:"#696969",movementCost:3,defensiveBonus:.5},{id:"peaks",name:"High Peaks",height:[.85,1],temp:[0,.4],moisture:[0,1],baseTile:"snow",color:"#fffafa",movementCost:5,defensiveBonus:.4},{id:"tundra",name:"Tundra",height:[.32,.55],temp:[0,.2],moisture:[.2,.8],baseTile:"tundra",color:"#e0e0e0",movementCost:1.4,defensiveBonus:.1}];function a(e){return 1/(e.height[1]-e.height[0]+(e.temp[1]-e.temp[0])+(e.moisture[1]-e.moisture[0]))}function i(e,t,n,i){const o=function(e,t,n){const i=Math.max(0,Math.min(1,(e+1)/2)),o=Math.max(0,Math.min(1,(t+1)/2)),s=Math.max(0,Math.min(1,(n+1)/2)),l=r.filter(e=>i>=e.height[0]&&i<=e.height[1]&&o>=e.temp[0]&&o<=e.temp[1]&&s>=e.moisture[0]&&s<=e.moisture[1]);return 0===l.length?r.find(e=>"plains"===e.id):1===l.length?l[0]:l.reduce((e,t)=>{const n=a(e);return a(t)>n?t:e})}(e,t,n);let s=o.baseTile;if(o.overlays)for(const r of o.overlays)if(i.next()<r.chance){s=r.tile;break}return{tile:s,biome:o}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(379),a=n(950),i=n(645),o=n(352);class s{constructor(){this.store=new Map}getItem(e){return this.store.has(e)?this.store.get(e):null}setItem(e,t){this.store.set(e,t)}removeItem(e){this.store.delete(e)}clear(){this.store.clear()}}class l{constructor(e){this.storage=e}resolveStorage(){var e;return"undefined"===typeof window?null:null!==(e=this.storage)&&void 0!==e?e:null}getItem(e){const t=this.resolveStorage();if(!t)return null;try{return t.getItem(e)}catch(n){return console.warn("Storage getItem failed",{key:e,error:n}),null}}setItem(e,t){const n=this.resolveStorage();if(n)try{n.setItem(e,t)}catch(r){console.warn("Storage setItem failed",{key:e,error:r})}}removeItem(e){const t=this.resolveStorage();if(t)try{t.removeItem(e)}catch(n){console.warn("Storage removeItem failed",{key:e,error:n})}}clear(){const e=this.resolveStorage();if(e)try{e.clear()}catch(t){console.warn("Storage clear failed",{error:t})}}}const c={local:"undefined"!==typeof window&&"undefined"!==typeof window.localStorage?new l(window.localStorage):new s,session:"undefined"!==typeof window&&"undefined"!==typeof window.sessionStorage?new l(window.sessionStorage):new s};let d=c;const u={get local(){return d.local},get session(){return d.session}};const h={Knight:{name:"Knight",description:"Elite warriors trained in heavy combat, combining the skills of thorn knights, ashblades, and sky knights.",statModifiers:{strength:4,constitution:3,wisdom:1,intelligence:1,dexterity:2,charisma:3},primaryStats:["Strength","Constitution"],abilities:["Heavy Strike","Shield Wall","Warrior's Resolve"],equipment:["Forged Blade","Heavy Armor","War Shield"],faction:"Warrior Orders"},Ranger:{name:"Ranger",description:"Skilled scouts and survivalists who know the secrets of wilderness, wasteland, and sky.",statModifiers:{strength:2,constitution:3,wisdom:3,intelligence:2,dexterity:4,charisma:1},primaryStats:["Dexterity","Wisdom"],abilities:["Track","Survival Instinct","Precise Shot"],equipment:["Ranger Bow","Travel Gear","Camouflage Cloak"],faction:"Scout Guilds"},Chanter:{name:"Chanter",description:"Priests and singers who channel power through voice, bone, and ancient rites.",statModifiers:{strength:1,constitution:2,wisdom:3,intelligence:3,dexterity:1,charisma:4},primaryStats:["Charisma","Wisdom"],abilities:["Sacred Song","Ritual Magic","Divine Word"],equipment:["Sacred Focus","Ritual Robes","Prayer Beads"],faction:"Religious Orders"},Mystic:{name:"Mystic",description:"Powerful spellcasters who master fire, storm, nature, and elemental forces.",statModifiers:{strength:1,constitution:2,wisdom:4,intelligence:4,dexterity:2,charisma:1},primaryStats:["Intelligence","Wisdom"],abilities:["Elemental Bolt","Magic Shield","Arcane Sight"],equipment:["Mystic Staff","Enchanted Robes","Spell Focus"],faction:"Mage Circles"},Guardian:{name:"Guardian",description:"Protectors and healers who commune with nature, plants, and life forces.",statModifiers:{strength:2,constitution:3,wisdom:4,intelligence:2,dexterity:1,charisma:2},primaryStats:["Wisdom","Constitution"],abilities:["Nature's Blessing","Healing Touch","Life Ward"],equipment:["Living Staff","Natural Armor","Herb Pouch"],faction:"Druidic Circles"},Corsair:{name:"Corsair",description:"Agile fighters and void-touched raiders who master sky combat and shadow magic.",statModifiers:{strength:3,constitution:2,wisdom:1,intelligence:2,dexterity:4,charisma:2},primaryStats:["Dexterity","Strength"],abilities:["Void Step","Shadow Strike","Evasion"],equipment:["Curved Blade","Light Armor","Grappling Hook"],faction:"Pirate Crews"}},p=[{name:"Verdance",seed:"verdance-seed-001",description:"A lush frontier of spirit plants, deep roots, and hidden sects.",factions:["Druidic Circles","Warrior Orders","Scout Guilds"],classes:["Guardian","Knight","Ranger"],lore:"In the heart of the Verdance, ancient spirit plants pulse with ethereal light, their roots forming vast networks beneath the forest floor that whisper secrets across continents. The Druidic Circles have learned to walk between shadow and root, using nature magic to commune with the deepest, oldest growths."},{name:"Ashenreach",seed:"ashenreach-seed-002",description:"A scorched expanse of ash dunes, ember cults, and bone singers.",factions:["Religious Orders","Warrior Orders","Scout Guilds"],classes:["Chanter","Knight","Ranger"],lore:"The Ashenreach was not always a wasteland. Once, it was the Golden Empire of Solmere, a realm of crystal spires and sun-blessed fields. But the Great Burning came without warning\u2014whether by dragon fire, fallen star, or the Empire's own hubris, none can say for certain."},{name:"Skyvault",seed:"skyvault-seed-003",description:"Floating citadels and shattered islands drifting in endless skies.",factions:["Mage Circles","Pirate Crews","Warrior Orders"],classes:["Mystic","Corsair","Knight"],lore:"When the ancient world shattered in the Sundering, entire continents were cast into the sky, held aloft by veins of raw aetheric force. Now the Skyvault stretches across three layers of heaven."}],m={Knight:"male",Ranger:"male",Chanter:"male",Mystic:"female",Guardian:"female",Corsair:"female"},f={human:{Knight:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/human-knight-male.png",description:"Human warrior with heavy armor and weapons"},Ranger:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/human-ranger-male.png",description:"Human scout and wasteland survivor"},Chanter:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/human-chanter-male.png",description:"Human priest and bone singer"},Mystic:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/human-mystic-female.png",description:"Human spellcaster with elemental magic"},Guardian:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/human-guardian-female.png",description:"Human nature protector and healer"},Corsair:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/human-corsair-female.png",description:"Human sky pirate and void warrior"}},sylvanborn:{Knight:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/sylvanborn-knight-male.png",description:"Sylvanborn warrior-druid with natural armor"},Ranger:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/sylvanborn-ranger-male.png",description:"Sylvanborn forest wanderer and tracker"},Chanter:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/sylvanborn-chanter-male.png",description:"Sylvanborn sage and ancient singer"},Mystic:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/sylvanborn-mystic-female.png",description:"Sylvanborn nature mage with plant magic"},Guardian:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/sylvanborn-guardian-female.png",description:"Sylvanborn grove protector and life keeper"},Corsair:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/sylvanborn-corsair-female.png",description:"Sylvanborn shadow dancer and void walker"}},nightborn:{Knight:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/nightborn-knight-male.png",description:"Nightborn shadow warrior with dark armor"},Ranger:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/nightborn-ranger-male.png",description:"Nightborn shadow scout and stalker"},Chanter:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/nightborn-chanter-male.png",description:"Nightborn death priest and void singer"},Mystic:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/nightborn-mystic-female.png",description:"Nightborn shadow mage with void magic"},Guardian:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/nightborn-guardian-female.png",description:"Nightborn dark protector and shadow healer"},Corsair:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/nightborn-corsair-female.png",description:"Nightborn void pirate and darkness master"}},stormcaller:{Knight:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/stormcaller-knight-male.png",description:"Stormcaller sky warrior with storm weapons"},Ranger:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/stormcaller-ranger-male.png",description:"Stormcaller wind rider and weather tracker"},Chanter:{genderLocked:"male",imagePath:"/World-Engine/assets/portraits-realistic/stormcaller-chanter-male.png",description:"Stormcaller storm priest and wind singer"},Mystic:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/stormcaller-mystic-female.png",description:"Stormcaller lightning mage with storm magic"},Guardian:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/stormcaller-guardian-female.png",description:"Stormcaller sky protector and storm keeper"},Corsair:{genderLocked:"female",imagePath:"/World-Engine/assets/portraits-realistic/stormcaller-corsair-female.png",description:"Stormcaller tempest pirate and void storm master"}}};function g(e,t){let n=m[t];if(!n){const e=Object.keys(m).find(e=>e.toLowerCase()===t.toLowerCase());e&&(n=m[e])}if(n)return n;const r=f[e.toLowerCase()];if(!r)return null;let a=r[t];if(!a){const e=Object.keys(r).find(e=>e.toLowerCase()===t.toLowerCase());e&&(a=r[e])}return a&&a.genderLocked||null}function y(e,t,n){return n.filter(n=>function(e,t,n){const r=g(e,t);return null===r||r===n}(e,n,t))}function x(e,t,n){const r=document.createElement("canvas");r.width=200,r.height=250;const a=r.getContext("2d");if(!a)return"";const o=a.createRadialGradient(70,60,10,100,125,180);o.addColorStop(0,"#1a1612"),o.addColorStop(.2,"#0f0e0a"),o.addColorStop(.5,"#080706"),o.addColorStop(.8,"#040403"),o.addColorStop(1,"#000000"),a.fillStyle=o,a.fillRect(0,0,200,250),a.fillStyle="#0a0908",a.globalAlpha=.3;for(let l=0;l<200;l+=4)for(let e=0;e<250;e+=4)i.Sh.next()>.7&&a.fillRect(l,e,1,1);a.globalAlpha=1;const s={human:{skinBase:"#8b7355",skinMid:"#6b5535",skinShadow:"#3d2f1f",armorBase:"#4a453f",armorMid:"#2f2a24",armorShadow:"#1a1612",metalBase:"#5a524a",metalHighlight:"#7a6e62",accent:"#3d2f1f"},sylvanborn:{skinBase:"#7a8b70",skinMid:"#5a6b50",skinShadow:"#3a4b30",armorBase:"#3f453a",armorMid:"#242a1f",armorShadow:"#161612",metalBase:"#4a524a",metalHighlight:"#6a726a",accent:"#2f4f2f"},draketh:{skinBase:"#8b6055",skinMid:"#6b4035",skinShadow:"#4b201f",armorBase:"#4a3f3f",armorMid:"#2f2424",armorShadow:"#1a1212",metalBase:"#5a4a4a",metalHighlight:"#7a6a6a",accent:"#6b2f1f"}};return function(e,t,n){const r=100,a=120,o=60,s=50;(function(e,t,n,r,a,i,o){const s=Math.sqrt((t-i)**2+(n-o)**2),l=Math.max(.2,1-s/150),c=e.createRadialGradient(i,o,20,t,n,60);c.addColorStop(0,r.skinBase),c.addColorStop(.3,r.skinMid),c.addColorStop(.7,r.skinShadow),c.addColorStop(1,"#1a1612"),e.fillStyle=c,e.beginPath(),e.ellipse(t,n,22,28,0,0,2*Math.PI),e.fill(),e.fillStyle=r.skinShadow,e.globalAlpha=.4,e.beginPath(),e.ellipse(t-12,n+5,8,12,-.3,0,Math.PI),e.fill(),e.beginPath(),e.ellipse(t+12,n+5,8,12,.3,0,Math.PI),e.fill(),e.beginPath(),e.ellipse(t,n+18,18,8,0,0,Math.PI),e.fill(),e.globalAlpha=1,function(e,t,n,r,a){e.fillStyle="#1a1612",e.globalAlpha=.8,e.beginPath(),e.ellipse(t-10,n,6,4,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(t+10,n,6,4,0,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.fillStyle="#f5f5dc",e.beginPath(),e.ellipse(t-10,n,4,3,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(t+10,n,4,3,0,0,2*Math.PI),e.fill(),e.fillStyle="#3d2f1f",e.beginPath(),e.arc(t-10,n,2,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(t+10,n,2,0,2*Math.PI),e.fill(),e.fillStyle="#000000",e.beginPath(),e.arc(t-10,n,1,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(t+10,n,1,0,2*Math.PI),e.fill(),a>.5&&(e.fillStyle="#ffffff",e.globalAlpha=a,e.beginPath(),e.arc(t-11,n-1,.5,0,2*Math.PI),e.fill(),e.beginPath(),e.arc(t+9,n-1,.5,0,2*Math.PI),e.fill(),e.globalAlpha=1);e.strokeStyle=r.skinShadow,e.lineWidth=2,e.globalAlpha=.7,e.beginPath(),e.moveTo(t-16,n-8),e.quadraticCurveTo(t-10,n-12,t-4,n-8),e.stroke(),e.beginPath(),e.moveTo(t+4,n-8),e.quadraticCurveTo(t+10,n-12,t+16,n-8),e.stroke(),e.lineWidth=1,e.beginPath(),e.moveTo(t-16,n-2),e.lineTo(t-18,n-4),e.moveTo(t-16,n+1),e.lineTo(t-18,n+2),e.stroke(),e.beginPath(),e.moveTo(t+16,n-2),e.lineTo(t+18,n-4),e.moveTo(t+16,n+1),e.lineTo(t+18,n+2),e.stroke(),e.globalAlpha=1}(e,t,n-5,r,l),function(e,t,n,r,a){e.fillStyle=r.skinShadow,e.globalAlpha=.6,e.beginPath(),e.ellipse(t,n,2,8,0,0,2*Math.PI),e.fill(),e.fillStyle="#1a1612",e.globalAlpha=.8,e.beginPath(),e.ellipse(t-3,n+4,1.5,2,0,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(t+3,n+4,1.5,2,0,0,2*Math.PI),e.fill(),a>.4&&(e.fillStyle=r.skinBase,e.globalAlpha=.5*a,e.beginPath(),e.ellipse(t-1,n-2,1,4,0,0,2*Math.PI),e.fill());e.globalAlpha=1}(e,t,n+2,r,l),function(e,t,n,r){e.strokeStyle=r.skinShadow,e.lineWidth=2,e.beginPath(),e.moveTo(t-8,n),e.quadraticCurveTo(t,n-1,t+8,n),e.stroke(),e.fillStyle=r.skinShadow,e.globalAlpha=.3,e.beginPath(),e.ellipse(t,n+3,7,2,0,0,Math.PI),e.fill(),e.globalAlpha=1}(e,t,n+12,r),function(e,t,n,r){e.strokeStyle=r.skinShadow,e.lineWidth=1,e.globalAlpha=.7,e.beginPath(),e.moveTo(t-15,n-20),e.quadraticCurveTo(t,n-22,t+15,n-20),e.moveTo(t-12,n-16),e.quadraticCurveTo(t,n-18,t+12,n-16),e.stroke(),e.beginPath(),e.moveTo(t-8,n-2),e.quadraticCurveTo(t-12,n+5,t-10,n+12),e.moveTo(t+8,n-2),e.quadraticCurveTo(t+12,n+5,t+10,n+12),e.stroke(),e.strokeStyle="#2a1f1a",e.lineWidth=1.5,e.globalAlpha=.8,e.beginPath(),e.moveTo(t-12,n-8),e.lineTo(t+8,n+6),e.stroke(),e.lineWidth=1,e.globalAlpha=.5,e.beginPath(),e.moveTo(t+10,n-15),e.lineTo(t+14,n-12),e.moveTo(t-6,n+15),e.lineTo(t-3,n+18),e.stroke(),e.globalAlpha=1}(e,t,n,r)})(e,r,a-40,t,0,o,s),function(e,t,n,r,a,o,s){const l=Math.sqrt((t-o)**2+(n-s)**2),c=(Math.max(.1,1-l/200),e.createRadialGradient(o,s,30,t,n,80));c.addColorStop(0,r.metalHighlight),c.addColorStop(.3,r.armorBase),c.addColorStop(.7,r.armorMid),c.addColorStop(1,r.armorShadow),e.fillStyle=c,e.beginPath(),e.moveTo(t-25,n-10),e.quadraticCurveTo(t-35,n+10,t-30,n+40),e.lineTo(t+30,n+40),e.quadraticCurveTo(t+35,n+10,t+25,n-10),e.closePath(),e.fill(),e.fillStyle=r.metalBase,e.globalAlpha=.8,e.fillRect(t-20,n-5,40,3),e.fillRect(t-18,n+10,36,2),e.fillRect(t-16,n+25,32,2),e.fillStyle=r.armorShadow,e.globalAlpha=1;for(let d=-15;d<=15;d+=10)e.beginPath(),e.arc(t+d,n+5,1,0,2*Math.PI),e.fill(),i.Sh.next()>.6&&(e.beginPath(),e.arc(t+d+2,n+15+10*i.Sh.next(),.5,0,2*Math.PI),e.fill());e.fillStyle=c,e.beginPath(),e.ellipse(t-35,n-5,12,18,-.3,0,2*Math.PI),e.fill(),e.beginPath(),e.ellipse(t+35,n-5,12,18,.3,0,2*Math.PI),e.fill(),e.globalAlpha=1}(e,r,a,t,0,o,s),function(e,t,n,r,a){switch(r.toLowerCase()){case"ashblade":case"thorn knight":!function(e,t,n,r){const a=e.createLinearGradient(t,n,t+8,n);a.addColorStop(0,r.metalHighlight),a.addColorStop(.3,r.metalBase),a.addColorStop(.7,"#3a3530"),a.addColorStop(1,"#1a1612"),e.fillStyle=a,e.beginPath(),e.moveTo(t,n-35),e.lineTo(t+2,n-37),e.lineTo(t+4,n+25),e.lineTo(t,n+30),e.lineTo(t-4,n+25),e.lineTo(t-2,n-37),e.closePath(),e.fill(),e.fillStyle="#2a1f1a",e.globalAlpha=.8,e.fillRect(t-1,n-30,2,50),e.globalAlpha=1,e.fillStyle=r.metalBase,e.fillRect(t-12,n+25,24,4),e.fillStyle="#3d2f1f",e.fillRect(t-3,n+29,6,20),e.strokeStyle="#2a1f1a",e.lineWidth=1;for(let i=0;i<4;i++)e.beginPath(),e.moveTo(t-3,n+31+4*i),e.lineTo(t+3,n+31+4*i),e.stroke();e.fillStyle=r.metalBase,e.beginPath(),e.arc(t,n+52,4,0,2*Math.PI),e.fill(),e.strokeStyle="#1a1612",e.lineWidth=1,e.globalAlpha=.7;for(let o=0;o<5;o++)e.beginPath(),e.moveTo(t+2+2*i.Sh.next(),n-25+8*o),e.lineTo(t+1+2*i.Sh.next(),n-23+8*o),e.stroke();e.globalAlpha=1}(e,t-50,n-20,a);break;case"greenwarden":!function(e,t,n,r){e.strokeStyle="#3d2f1f",e.lineWidth=4,e.beginPath(),e.moveTo(t,n),e.quadraticCurveTo(t+3,n+30,t-2,n+60),e.stroke(),e.strokeStyle="#2a1f1a",e.lineWidth=1,e.globalAlpha=.6;for(let a=0;a<6;a++)e.beginPath(),e.moveTo(t-1,n+10*a),e.lineTo(t+1,n+2+10*a),e.stroke();e.globalAlpha=1,e.fillStyle=r.accent,e.globalAlpha=.8,e.beginPath(),e.arc(t,n-5,6,0,2*Math.PI),e.fill(),e.fillStyle="#4a4a3a",e.globalAlpha=.6,e.beginPath(),e.arc(t,n-5,3,0,2*Math.PI),e.fill(),e.globalAlpha=1}(e,t+45,n-30,a)}}(e,r,a,n,t)}(a,s[e.toLowerCase()]||s.human,t),function(e){e.fillStyle="#4a453f",e.globalAlpha=.2;for(let t=0;t<8;t++){const t=60+80*i.Sh.next(),n=50+120*i.Sh.next();e.beginPath(),e.arc(t,n,.5,0,2*Math.PI),e.fill()}e.globalAlpha=1}(a),function(e){e.strokeStyle="#2a2520",e.lineWidth=4,e.strokeRect(2,2,196,246),e.strokeStyle="#1a1612",e.lineWidth=2,e.strokeRect(6,6,188,238)}(a),function(e,t,n,r){e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(8,218,184,27),e.fillStyle="#6b5535",e.font="bold 10px serif",e.textAlign="center",e.fillText("".concat(t.toUpperCase()," ").concat(n.toUpperCase()),100,232),e.fillStyle="#4a453f",e.font="8px serif",e.fillText("".concat(r.charAt(0).toUpperCase()+r.slice(1)),100,242)}(a,e,t,n),console.log("Generated grimdark portrait: ".concat(n," ").concat(e," ").concat(t)),r.toDataURL("image/png")}async function v(e){try{const{gender:n,species:r,archetype:a}=e;console.log("Generating portrait: ".concat(n," ").concat(r," ").concat(a));const i=function(e,t,n){const r=f[e.toLowerCase()];if(!r)return null;let a=r[t];if(!a){const e=Object.keys(r).find(e=>e.toLowerCase()===t.toLowerCase());e&&(a=r[e])}if(!a)return null;const i=g(e,t);return i&&i!==n?null:a.imagePath||null}(r,a,n);if(console.log("Portrait lookup: species=".concat(r,", archetype=").concat(a,", gender=").concat(n)),console.log("Image path result: ".concat(i)),i){console.log("Using realistic image: ".concat(i));try{const e=await async function(e){return new Promise(t=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{try{const e=document.createElement("canvas");e.width=200,e.height=250;const r=e.getContext("2d");if(!r)return void t(null);r.drawImage(n,0,0,200,250);const a=e.toDataURL("image/jpeg",.9);t(a)}catch(e){console.error("Error converting image to canvas:",e),t(null)}},n.onerror=()=>{console.warn("Failed to load image: ".concat(e)),t(null)},n.src=e,setTimeout(()=>{t(null)},5e3)})}(i);if(console.log("\ud83d\uddbc\ufe0f Image load result: ".concat(e?"SUCCESS":"FAILED")),e)return{success:!0,layers:[{type:"realistic",src:e,zIndex:1}],dataUrl:e,isRealisticImage:!0}}catch(t){console.warn("\ud83d\uddbc\ufe0f Failed to load realistic image ".concat(i,", falling back to placeholder"),t)}}else console.log("\ud83d\udeab No realistic image path found for: ".concat(n," ").concat(r," ").concat(a));console.log("\ud83c\udfad Generating placeholder portrait: ".concat(n," ").concat(r," ").concat(a));const o=x(r,a,n);return{success:!0,layers:[{type:"base",src:o,zIndex:1}],dataUrl:o,isRealisticImage:!1}}catch(n){return console.error("\ud83c\udfad Portrait generation error:",n),{success:!1,layers:[],error:n instanceof Error?n.message:"Unknown error"}}}const b=new Map;var w=n(414);const k={small:{width:120,height:152},medium:{width:200,height:253},large:{width:300,height:380}},S=e=>{let{gender:t,species:n,archetype:r,decorations:i=[],size:o="medium",className:s="",showDebug:l=!1}=e;const[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(!1),f=k[o],g=(0,a.useCallback)(async()=>{h(!0);const e={gender:t,species:n,archetype:r,decorations:i,size:f},a=function(e){const t=JSON.stringify(e);return b.get(t)||null}(e);var o;if(a)return console.log("\ud83c\udfad Using cached portrait with",(null===(o=a.layers)||void 0===o?void 0:o.length)||0,"layers"),d(a),void h(!1);try{const t=await v(e);t.success&&t.dataUrl&&function(e,t){const n=JSON.stringify(e);b.set(n,t)}(e,t),d(t)}catch(s){console.error("\ud83c\udfad Portrait generation error:",s),d({success:!1,layers:[],error:s instanceof Error?s.message:"Unknown error"})}finally{h(!1)}},[t,n,r,i,f]);(0,a.useEffect)(()=>{g()},[g]);return(0,w.jsxs)("div",{className:"relative inline-block ".concat(s),children:[u?(0,w.jsx)("div",{className:"flex items-center justify-center bg-gray-200 rounded",style:{width:f.width,height:f.height},children:(0,w.jsx)("div",{className:"text-gray-500",children:"Loading..."})}):c&&c.success&&c.dataUrl?(0,w.jsx)("img",{src:c.dataUrl,alt:"".concat(n," ").concat(r," portrait"),className:"rounded border border-gray-300",style:{width:f.width,height:f.height},onError:e=>{console.error("\ud83c\udfad Portrait image failed to display")}}):(0,w.jsx)("div",{className:"flex items-center justify-center bg-gray-200 rounded border-2 border-dashed border-gray-400",style:{width:f.width,height:f.height},children:(0,w.jsxs)("div",{className:"text-gray-500 text-center p-2",children:[(0,w.jsx)("div",{children:"Portrait Failed"}),(null===c||void 0===c?void 0:c.error)&&(0,w.jsx)("div",{className:"text-xs mt-1",children:c.error})]})}),l&&(0,w.jsx)("button",{onClick:()=>{m(!p)},className:"absolute top-1 right-1 w-6 h-6 bg-blue-500 text-white rounded-full text-xs hover:bg-blue-600 transition-colors",title:"Toggle debug info",children:"\ud83d\udc1e"}),p&&c?(0,w.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full bg-black bg-opacity-75 text-white text-xs p-2 overflow-auto",children:[(0,w.jsx)("div",{className:"font-bold mb-2",children:"\ud83d\udc1e Portrait Debug"}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Status:"})," ",c.success?"\u2705 Success":"\u274c Failed"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Gender:"})," ",t]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Species:"})," ",n]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Archetype:"})," ",r]}),i.length>0&&(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Decorations:"})," ",i.join(", ")]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Size:"})," ",f.width,"\xd7",f.height]}),c.success&&c.layers&&(0,w.jsxs)("div",{className:"mt-2",children:[(0,w.jsxs)("strong",{children:["Layers (",c.layers.length,"):"]}),c.layers.map((e,t)=>(0,w.jsxs)("div",{className:"ml-2 text-xs",children:["\u2022 ",e.type," (z:",e.zIndex,")"]},t))]}),c.error&&(0,w.jsxs)("div",{className:"mt-2 text-red-300",children:[(0,w.jsx)("strong",{children:"Error:"})," ",c.error]})]}):null]})},j=()=>{const e=C.getAvailableSpecies(),t=C.getAvailableArchetypes();return(0,w.jsxs)("div",{className:"p-8 max-w-6xl mx-auto",children:[(0,w.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Simple Portrait System Test"}),(0,w.jsxs)("div",{className:"mb-8",children:[(0,w.jsx)("button",{onClick:async()=>{console.log("\ud83c\udfad Testing simple portrait system...");const e=await M.testSimplePortrait();console.log("Test result:",e)},className:"bg-blue-500 text-white px-4 py-2 rounded mr-4 hover:bg-blue-600",children:"Test Single Portrait"}),(0,w.jsx)("button",{onClick:async()=>{console.log("\ud83c\udfad Testing multiple combinations...");const e=await M.testMultipleCombinations();console.log("All results:",e)},className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"Test Multiple Combinations"})]}),(0,w.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[{gender:"male",species:"human",archetype:"greenwarden"},{gender:"female",species:"sylvanborn",archetype:"thornknight"},{gender:"male",species:"draketh",archetype:"ashblade"},{gender:"female",species:"voidkin",archetype:"voidwing"},{gender:"male",species:"crystalborn",archetype:"skyknight"},{gender:"female",species:"alloy",archetype:"cindermystic"}].map((e,t)=>(0,w.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,w.jsxs)("h3",{className:"font-semibold mb-2 capitalize",children:[e.gender," ",e.species," ",e.archetype]}),(0,w.jsx)(S,{gender:e.gender,species:e.species,archetype:e.archetype,size:"medium",showDebug:!0})]},t))}),(0,w.jsxs)("div",{className:"mt-8 grid grid-cols-2 gap-8",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Available Species"}),(0,w.jsx)("ul",{className:"list-disc list-inside space-y-1",children:e.map(e=>(0,w.jsx)("li",{className:"capitalize",children:e},e))})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Available Archetypes"}),(0,w.jsx)("ul",{className:"list-disc list-inside space-y-1",children:t.map(e=>(0,w.jsx)("li",{className:"capitalize",children:e},e))})]})]})]})},C={convertToSimpleOptions:e=>({gender:e.gender||"male",species:e.species.toLowerCase(),archetype:e.archetype.toLowerCase()}),getAvailableSpecies:()=>["human","sylvanborn","alloy","draketh","voidkin","crystalborn","stormcaller_species"],getAvailableArchetypes:()=>["greenwarden","thornknight","saplingadept","bloomcaller","ashblade","cindermystic","dustranger","bonechanter","stormcaller_class","voidwing","skyknight","windsage"],getArchetypesByWorld:()=>({Verdance:["greenwarden","thornknight","saplingadept","bloomcaller"],Ashenreach:["ashblade","cindermystic","dustranger","bonechanter"],Skyvault:["stormcaller_class","voidwing","skyknight","windsage"]})},M={testSimplePortrait:async()=>(console.log("\ud83c\udfad Testing simple portrait generation..."),v({gender:"male",species:"human",archetype:"greenwarden"})),testMultipleCombinations:async()=>{const e=C.getAvailableSpecies(),t=C.getAvailableArchetypes(),n=["male","female"];console.log("\ud83c\udfad Testing ".concat(e.length,"\xd7").concat(t.length,"\xd7").concat(n.length," combinations..."));const r=[];for(const a of e.slice(0,2))for(const e of t.slice(0,2))for(const t of n){const n=await v({gender:t,species:a,archetype:e});r.push({species:a,archetype:e,gender:t,success:n.success})}return console.log("\ud83c\udfad Test results:",r),r}};function T(e){let{onNewCampaign:t,onLoadCampaign:n,onNameGenerator:i,onSpellGenerator:o,onSpellAssignment:s,onHealingSystem:l,onCharacterCreate:c,onClassicCharacterCreate:d,onPortraitTest:h,onAutoUpdater:p,onBattleSystem:m,onBattlePage:f,onMinimalBattle:g,onEnhancedMap:y,onSimpleMap:x,onProcedural:v}=e;const[b,k]=(0,a.useState)([]),[j,C]=(0,a.useState)([]),[M,T]=(0,a.useState)("campaigns"),[A,E]=(0,a.useState)(null);(0,a.useEffect)(()=>{P(),_()},[]);const P=()=>{try{let e=R();k(e);const t=u.local.getItem("world-engine-campaigns"),n=u.local.getItem("world-engine-campaigns-backup");!t&&n&&e.length>0&&alert("Warning: Primary save was missing, but your campaigns were recovered from backup!")}catch(e){console.error("Error loading campaigns:",e),k([])}},R=()=>{try{let e=JSON.parse(u.local.getItem("world-engine-campaigns")||"[]");if(0===e.length){const t=JSON.parse(u.local.getItem("world-engine-campaigns-backup")||"{}");t.campaigns&&t.campaigns.length>0&&(e=t.campaigns,u.local.setItem("world-engine-campaigns",JSON.stringify(e)),console.log("Recovered campaigns from backup storage"))}if(0===e.length){const t=JSON.parse(u.session.getItem("world-engine-campaigns-session")||"[]");t.length>0&&(e=t,u.local.setItem("world-engine-campaigns",JSON.stringify(e)),console.log("Recovered campaigns from session storage"))}return e}catch(e){return console.error("Error recovering campaigns:",e),[]}},_=()=>{try{const e=u.local.getItem("world-engine-characters");e&&C(JSON.parse(e))}catch(e){console.error("Error loading characters:",e)}},N=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=e=>({padding:"12px 24px",background:"none",border:"none",color:e?"#3b82f6":"#94a3b8",fontSize:"1.1rem",fontWeight:e?"600":"400",cursor:"pointer",borderBottom:e?"2px solid #3b82f6":"2px solid transparent",transition:"all 0.2s ease"}),z={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"20px",marginBottom:"30px"},L={background:"#1e293b",border:"1px solid #334155",borderRadius:"12px",padding:"20px",transition:"all 0.2s ease",cursor:"pointer"},I=(0,r.A)((0,r.A)({},L),{},{background:"linear-gradient(135deg, #059669 0%, #047857 100%)",border:"1px solid #10b981",textAlign:"center",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"120px"}),q={background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",padding:"8px 16px",cursor:"pointer",fontSize:"0.9rem",transition:"background 0.2s ease"},D=(0,r.A)((0,r.A)({},q),{},{background:"#dc2626",marginLeft:"8px"}),O=e=>{var t,n,a,i;let{character:o,onClose:s}=e;const l={background:"#0f172a",padding:"12px",borderRadius:"8px",textAlign:"center",border:"1px solid #334155"};return(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,padding:"20px"},onClick:s,children:(0,w.jsxs)("div",{style:{background:"#1e293b",border:"1px solid #334155",borderRadius:"12px",padding:"30px",maxWidth:"600px",maxHeight:"80vh",width:"100%",overflowY:"auto",color:"#f8fafc"},onClick:e=>e.stopPropagation(),children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[(0,w.jsx)("h2",{style:{margin:0,color:"#3b82f6"},children:o.name}),(0,w.jsx)("button",{onClick:s,style:{background:"#374151",color:"#f8fafc",border:"none",borderRadius:"6px",padding:"8px 12px",cursor:"pointer",fontSize:"16px"},children:"\u2715"})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"20px",marginBottom:"20px"},children:[null!==(t=o.data)&&void 0!==t&&t.name&&null!==(n=o.data)&&void 0!==n&&n.species&&null!==(a=o.data)&&void 0!==a&&a.archetype&&null!==(i=o.data)&&void 0!==i&&i.gender?(0,w.jsx)(S,{gender:o.data.gender.toLowerCase(),species:o.data.species.toLowerCase(),archetype:o.data.archetype.toLowerCase(),size:"small"}):(0,w.jsx)("div",{style:{width:120,height:120,background:"#374151",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af",fontSize:"24px",flexShrink:0},children:"\ud83d\udc64"}),(0,w.jsxs)("div",{style:{flex:1},children:[(0,w.jsx)("p",{style:{margin:"5px 0",fontSize:"18px"},children:(0,w.jsxs)("strong",{children:[o.race," ",o.characterClass]})}),(0,w.jsxs)("p",{style:{margin:"5px 0",color:"#94a3b8"},children:["Level ",o.level]}),(0,w.jsxs)("p",{style:{margin:"5px 0",color:"#64748b",fontSize:"14px"},children:["Created: ",N(o.createdAt)]})]})]}),o.data&&(0,w.jsxs)(w.Fragment,{children:[o.data.gender&&(0,w.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 8px 0",color:"#8b5cf6"},children:"Gender"}),(0,w.jsx)("p",{style:{margin:0,color:"#e2e8f0"},children:o.data.gender})]}),o.data.background&&(0,w.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 8px 0",color:"#8b5cf6"},children:"Background"}),(0,w.jsx)("p",{style:{margin:0,color:"#e2e8f0"},children:o.data.background})]}),o.data.stats&&(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#8b5cf6"},children:"Ability Scores"}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"15px",margin:"20px 0"},children:Object.entries(o.data.stats).map(e=>{let[t,n]=e;const r=Number(n);return(0,w.jsxs)("div",{style:l,children:[(0,w.jsx)("div",{style:{fontWeight:"bold",fontSize:"14px",color:"#94a3b8",marginBottom:"4px"},children:t.toUpperCase()}),(0,w.jsx)("div",{style:{fontSize:"20px",fontWeight:"bold",color:"#f1f5f9"},children:r}),(0,w.jsxs)("div",{style:{fontSize:"12px",color:"#64748b"},children:[r>=10?"+":"",Math.floor((r-10)/2)]})]},t)})})]}),o.data.traits&&o.data.traits.length>0&&(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#8b5cf6"},children:"Traits"}),(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:o.data.traits.map((e,t)=>(0,w.jsx)("span",{style:{background:"#0f172a",color:"#e2e8f0",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",border:"1px solid #334155"},children:e},t))})]}),(o.data.knownCantrips&&o.data.knownCantrips.length>0||o.data.knownSpells&&o.data.knownSpells.length>0)&&(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#8b5cf6"},children:"Spells & Magic"}),o.data.level&&(0,w.jsxs)("p",{style:{margin:"0 0 8px 0",color:"#94a3b8",fontSize:"14px"},children:["Level ",o.data.level," Character"]}),o.data.knownCantrips&&o.data.knownCantrips.length>0&&(0,w.jsxs)("div",{style:{marginBottom:"12px"},children:[(0,w.jsx)("h5",{style:{margin:"0 0 6px 0",color:"#ec4899"},children:"Known Cantrips:"}),(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:o.data.knownCantrips.map((e,t)=>(0,w.jsx)("span",{style:{background:"#ec4899",color:"white",padding:"3px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"bold"},children:e},t))})]}),o.data.knownSpells&&o.data.knownSpells.length>0&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{margin:"0 0 6px 0",color:"#3b82f6"},children:"Known Spells:"}),(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"6px"},children:o.data.knownSpells.map((e,t)=>(0,w.jsx)("span",{style:{background:"#3b82f6",color:"white",padding:"3px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"bold"},children:e},t))})]})]}),o.data.mode&&(0,w.jsxs)("div",{style:{marginBottom:"15px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 8px 0",color:"#8b5cf6"},children:"Creation Method"}),(0,w.jsx)("p",{style:{margin:0,color:"#e2e8f0"},children:"POINT_BUY"===o.data.mode?"Point Buy System":"Dice Roll"})]})]}),(0,w.jsx)("div",{style:{marginTop:"20px",textAlign:"center"},children:(0,w.jsx)("button",{onClick:s,style:(0,r.A)((0,r.A)({},q),{},{background:"#059669",padding:"10px 20px",fontSize:"16px"}),children:"Close"})})]})})};return(0,w.jsxs)("div",{style:{background:"linear-gradient(135deg, #0c1426 0%, #1e293b 100%)",minHeight:"100vh",color:"#f8fafc",fontFamily:"system-ui, -apple-system, sans-serif"},children:[(0,w.jsxs)("div",{style:{textAlign:"center",padding:"40px 20px",borderBottom:"1px solid #334155"},children:[(0,w.jsx)("h1",{style:{fontSize:"3rem",fontWeight:"bold",margin:"0 0 10px 0",background:"linear-gradient(45deg, #3b82f6, #8b5cf6)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text"},children:"World Engine"}),(0,w.jsx)("p",{style:{fontSize:"1.2rem",color:"#94a3b8",margin:0},children:"Campaign & Character Management"}),(0,w.jsxs)("div",{style:{marginTop:"20px",display:"flex",gap:"12px",justifyContent:"center",flexWrap:"wrap"},children:[(0,w.jsx)("button",{onClick:()=>{try{const e={campaigns:b,characters:j,exportDate:(new Date).toISOString(),version:"2.0",worldEngineVersion:"v1.0.0"},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download="world-engine-backup-".concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),alert("Backup downloaded successfully!")}catch(e){console.error("Error downloading backup:",e),alert("Failed to download backup")}},style:(0,r.A)((0,r.A)({},q),{},{background:"#059669",display:"flex",alignItems:"center",gap:"6px"}),children:"\ud83d\udcbe Download Backup"}),(0,w.jsxs)("label",{style:(0,r.A)((0,r.A)({},q),{},{background:"#7c3aed",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"}),children:["\ud83d\udcc2 Import Backup",(0,w.jsx)("input",{type:"file",accept:".json",onChange:e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const r=new FileReader;r.onload=e=>{try{var t,n,r;const a=JSON.parse(null===(t=e.target)||void 0===t?void 0:t.result);a.campaigns&&Array.isArray(a.campaigns)&&(u.local.setItem("world-engine-campaigns",JSON.stringify(a.campaigns)),u.local.setItem("world-engine-campaigns-backup",JSON.stringify(a)),k(a.campaigns)),a.characters&&Array.isArray(a.characters)&&(u.local.setItem("world-engine-characters",JSON.stringify(a.characters)),u.local.setItem("world-engine-characters-backup",JSON.stringify(a.characters)),C(a.characters)),alert("Backup imported successfully!\nCampaigns: ".concat((null===(n=a.campaigns)||void 0===n?void 0:n.length)||0,"\nCharacters: ").concat((null===(r=a.characters)||void 0===r?void 0:r.length)||0))}catch(a){console.error("Error importing backup:",a),alert("Invalid backup file format")}},r.readAsText(n),e.target.value=""},style:{display:"none"}})]}),(0,w.jsx)("button",{onClick:()=>{try{const e=R();k(e);const t=u.local.getItem("world-engine-characters-backup");if(t){const e=JSON.parse(t);Array.isArray(e)&&(u.local.setItem("world-engine-characters",JSON.stringify(e)),C(e))}alert("Recovery attempt completed!\nRecovered ".concat(e.length," campaigns"))}catch(e){console.error("Error during recovery:",e),alert("Recovery failed")}},style:(0,r.A)((0,r.A)({},q),{},{background:"#dc2626",display:"flex",alignItems:"center",gap:"6px"}),children:"\ud83d\udd04 Force Recovery"})]}),(0,w.jsx)("p",{style:{fontSize:"0.85rem",color:"#64748b",marginTop:"12px",fontStyle:"italic"},children:"\ud83d\udca1 Auto-saves every 10 campaign saves \u2022 Backup before major changes"})]}),(0,w.jsxs)("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"40px 20px"},children:[(0,w.jsxs)("div",{style:{display:"flex",marginBottom:"30px",borderBottom:"1px solid #334155"},children:[(0,w.jsx)("button",{style:B("campaigns"===M),onClick:()=>T("campaigns"),children:"Campaigns"}),(0,w.jsx)("button",{style:B("characters"===M),onClick:()=>T("characters"),children:"Character Library"})]}),"campaigns"===M&&(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{style:z,children:[(0,w.jsxs)("div",{style:I,onClick:t,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"+"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"New Campaign"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Start a new adventure"})]}),b.map(e=>(0,w.jsxs)("div",{style:L,children:[(0,w.jsx)("h3",{style:{margin:"0 0 10px 0",color:"#f1f5f9"},children:e.name}),(0,w.jsxs)("p",{style:{margin:"0 0 5px 0",color:"#94a3b8",fontSize:"0.9rem"},children:["World: ",e.worldPreset||"Custom"]}),(0,w.jsxs)("p",{style:{margin:"0 0 5px 0",color:"#94a3b8",fontSize:"0.9rem"},children:["Seed: ",e.seed.substring(0,20),"..."]}),(0,w.jsxs)("p",{style:{margin:"0 0 15px 0",color:"#64748b",fontSize:"0.8rem"},children:["Last played: ",N(e.lastPlayed)]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("button",{style:q,onClick:()=>n(e),children:"Load Campaign"}),(0,w.jsx)("button",{style:D,onClick:t=>{t.stopPropagation(),confirm("Delete this campaign?")&&(e=>{const t=b.filter(t=>t.id!==e);k(t),u.local.setItem("world-engine-campaigns",JSON.stringify(t))})(e.id)},children:"Delete"})]})]},e.id))]}),0===b.length&&(0,w.jsx)("div",{style:{textAlign:"center",color:"#64748b",fontSize:"1.1rem",marginTop:"60px"},children:(0,w.jsx)("p",{children:"No campaigns yet. Create your first campaign to begin!"})})]}),"characters"===M&&(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{style:z,children:[(0,w.jsxs)("div",{style:I,onClick:c,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\u2694\ufe0f"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Character Creator"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Create new characters"})]}),d&&(0,w.jsxs)("div",{style:I,onClick:d,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83c\udff0"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Classic Creator"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"M&M 1-2 style creator"})]}),(0,w.jsxs)("div",{style:I,onClick:i,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83d\udcdc"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Name Generator"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Generate fantasy names"})]}),(0,w.jsxs)("div",{style:I,onClick:o,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\u2728"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Spell Generator"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Create custom spells"})]}),(0,w.jsxs)("div",{style:I,onClick:s,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83d\udcdc"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Assign Spells"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Give spells to characters"})]}),(0,w.jsxs)("div",{style:I,onClick:l,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\u2695\ufe0f"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Healing System"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Manage party health & healing"})]}),(0,w.jsxs)("div",{style:I,onClick:m,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\u2694\ufe0f"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Battle System"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Tactical hex-grid combat"})]}),(0,w.jsxs)("div",{style:I,onClick:f,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83c\udfaf"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Battle Arena"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Clean tactical battle interface"})]}),(0,w.jsxs)("div",{style:I,onClick:g,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\u26a1"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Minimal Battle"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Simple tactical combat engine"})]}),(0,w.jsxs)("div",{style:I,onClick:h,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83c\udfad"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Portrait Test"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Test all portrait combinations"})]}),(0,w.jsxs)("div",{style:I,onClick:p,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83d\udd04"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Auto-Updater Test"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Test desktop app auto-updater"})]}),(0,w.jsxs)("div",{style:I,onClick:y,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83d\uddfa\ufe0f"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Strategic Map"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Enhanced world map with factions"})]}),(0,w.jsxs)("div",{style:I,onClick:x,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83c\udf0d"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Exploration Map"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Simple campaign world map"})]}),(0,w.jsxs)("div",{style:I,onClick:v,children:[(0,w.jsx)("div",{style:{fontSize:"3rem",marginBottom:"10px"},children:"\ud83d\uddfa\ufe0f"}),(0,w.jsx)("h3",{style:{margin:"0 0 5px 0"},children:"Procedural Gen"}),(0,w.jsx)("p",{style:{margin:0,opacity:.9},children:"Dev tools for world generation"})]}),j.map(e=>{var t,n,r,a;return(0,w.jsxs)("div",{style:L,children:[(0,w.jsxs)("div",{style:{display:"flex",gap:"12px",marginBottom:"12px"},children:[null!==(t=e.data)&&void 0!==t&&t.name&&null!==(n=e.data)&&void 0!==n&&n.species&&null!==(r=e.data)&&void 0!==r&&r.archetype&&null!==(a=e.data)&&void 0!==a&&a.gender?(0,w.jsx)(S,{gender:e.data.gender.toLowerCase(),species:e.data.species.toLowerCase(),archetype:e.data.archetype.toLowerCase(),size:"small"}):(0,w.jsx)("div",{style:{width:60,height:60,background:"#374151",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",color:"#9ca3af",fontSize:"16px",flexShrink:0},children:"\ud83d\udc64"}),(0,w.jsxs)("div",{style:{flex:1},children:[(0,w.jsx)("h3",{style:{margin:"0 0 8px 0",color:"#f1f5f9"},children:e.name}),(0,w.jsxs)("p",{style:{margin:"0 0 4px 0",color:"#94a3b8",fontSize:"0.9rem"},children:[e.race," ",e.characterClass]}),(0,w.jsxs)("p",{style:{margin:"0",color:"#94a3b8",fontSize:"0.9rem"},children:["Level ",e.level]})]})]}),(0,w.jsxs)("p",{style:{margin:"0 0 15px 0",color:"#64748b",fontSize:"0.8rem"},children:["Created: ",N(e.createdAt)]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("button",{style:q,onClick:()=>E(e),children:"View Character"}),(0,w.jsx)("button",{style:D,onClick:t=>{t.stopPropagation(),confirm("Delete this character?")&&(e=>{const t=j.filter(t=>t.id!==e);C(t),u.local.setItem("world-engine-characters",JSON.stringify(t))})(e.id)},children:"Delete"})]})]},e.id)})]}),0===j.length&&(0,w.jsx)("div",{style:{textAlign:"center",color:"#64748b",fontSize:"1.1rem",marginTop:"60px"},children:(0,w.jsx)("p",{children:"No saved characters yet. Create your first character!"})})]})]}),A&&(0,w.jsx)(O,{character:A,onClose:()=>E(null)})]})}const A=["Human","Sylvanborn","Nightborn","Stormcaller"],E=["Female","Male"],P={Human:{automatic:[],forbidden:[],preferred:["Brave","Clever","Silver Tongue"],description:"Adaptable and versatile, humans can develop any traits through experience."},Sylvanborn:{automatic:["Nature's Friend"],forbidden:["Cunning"],preferred:["Observant","Keen Senses","Patient"],description:"Forest dwellers with an innate connection to nature."},Nightborn:{automatic:["Observant"],forbidden:["Nature's Friend"],preferred:["Clever","Iron Will","Cunning"],description:"Shadow-touched beings with enhanced perception but unnatural aura."},Stormcaller:{automatic:["Swift"],forbidden:["Patient"],preferred:["Brave","Observant","Silver Tongue"],description:"Sky-born people infused with elemental storm energy."}},R={Brave:{name:"Brave",description:"Resistant to fear and intimidation effects. +2 bonus to courage-based checks.",mechanicalEffect:"fear_resistance",bonus:{type:"courage",value:2}},Clever:{name:"Clever",description:"Quick thinking in complex situations. +2 bonus to puzzle-solving and investigation.",mechanicalEffect:"intelligence_bonus",bonus:{type:"investigation",value:2}},Cunning:{name:"Cunning",description:"Skilled at deception and misdirection. +2 bonus to stealth and deception checks.",mechanicalEffect:"deception_bonus",bonus:{type:"stealth",value:2}},Empathic:{name:"Empathic",description:"Deeply understands others' emotions. +2 bonus to persuasion and healing checks.",mechanicalEffect:"social_bonus",bonus:{type:"persuasion",value:2}},Stoic:{name:"Stoic",description:"Unshaken by pain or hardship. +2 bonus to endurance and resistance checks.",mechanicalEffect:"endurance_bonus",bonus:{type:"endurance",value:2}},Lucky:{name:"Lucky",description:"Fortune favors you. Once per encounter, reroll any failed check.",mechanicalEffect:"reroll_ability",bonus:{type:"reroll",value:1}},Observant:{name:"Observant",description:"Notice details others miss. +2 bonus to perception and awareness checks.",mechanicalEffect:"perception_bonus",bonus:{type:"perception",value:2}},"Silver Tongue":{name:"Silver Tongue",description:"Naturally persuasive speaker. +2 bonus to all social interaction checks.",mechanicalEffect:"social_master",bonus:{type:"social",value:2}},"Iron Will":{name:"Iron Will",description:"Mental fortitude against magical effects. +2 bonus to resist mental magic.",mechanicalEffect:"mental_resistance",bonus:{type:"mental_defense",value:2}},Swift:{name:"Swift",description:"Faster movement and reflexes. +2 bonus to speed and reaction checks.",mechanicalEffect:"speed_bonus",bonus:{type:"speed",value:2}},"Nature's Friend":{name:"Nature's Friend",description:"Animals and plants respond favorably. +2 bonus to nature-based interactions.",mechanicalEffect:"nature_bonus",bonus:{type:"nature",value:2}},"Keen Senses":{name:"Keen Senses",description:"Enhanced sensory perception. +2 bonus to detect hidden things or dangers.",mechanicalEffect:"detection_bonus",bonus:{type:"detection",value:2}},Patient:{name:"Patient",description:"Calm and methodical approach. +2 bonus to sustained concentration tasks.",mechanicalEffect:"concentration_bonus",bonus:{type:"concentration",value:2}},Resilient:{name:"Resilient",description:"Exceptionally tough constitution. +2 HP per level beyond normal.",mechanicalEffect:"hp_bonus",bonus:{type:"hp_per_level",value:2}},Hardy:{name:"Hardy",description:"Natural toughness and endurance. +1 HP per level beyond normal.",mechanicalEffect:"hp_bonus_small",bonus:{type:"hp_per_level",value:1}},Frail:{name:"Frail",description:"Delicate constitution, but often comes with other gifts. -2 HP per level.",mechanicalEffect:"hp_penalty",bonus:{type:"hp_per_level",value:-2}}},_=Object.keys(R);function N(e){let t=0;for(let n=9;n<=e;n++)t+=n<=14?1:n<=16?2:3;return t}function B(e){return Math.floor((e-10)/2)}function z(e,t,n,r,a){const i=r,o=q(e.STR,"STR",t,n),s=q(e.CON,"CON",t,n),l=q(e.DEX,"DEX",t,n),c=8+B(s),d=1+Math.max(0,B(s));let u=0;u="Thorn Knight"===n||"Ashblade"===n||"Ironclad"===n||"Stormbreaker"===n||"Voidhunter"===n||"Crystal Guardian"===n?3:"Greenwarden"===n||"Guardian"===n||"Warrior"===n?2:"Ranger"===n||"Rogue"===n||"Artificer"===n?1:0;let h=0;"Alloy"===t||"Draketh"===t?h=2:"Crystalborn"===t||"Human"===t?h=1:"Voidkin"===t?h=0:"Sylvanborn"===t?h=-1:"Stormcaller"===t&&(h=0);let p=0;a.includes("Resilient")&&(p+=2),a.includes("Hardy")&&(p+=1),a.includes("Frail")&&(p-=2);const m=Math.max(1,d+u+h+p),f=c+m*(i-1);let g=0;i>=16?g+=2:i>=8&&(g+=1),"Thorn Knight"===n||"Ashblade"===n||"Ironclad"===n||"Stormbreaker"===n||"Voidhunter"===n||"Crystal Guardian"===n?i>=15?g+=2:i>=7&&(g+=1):"Greenwarden"===n||"Guardian"===n||"Warrior"===n?i>=10&&(g+=1):"Ranger"!==n&&"Rogue"!==n&&"Artificer"!==n||i>=15&&(g+=1),"Alloy"===t?i>=12&&(g+=1):"Draketh"===t?i>=15&&(g+=1):"Crystalborn"===t&&i>=15&&(g+=1),g=Math.min(g,5);return{level:i,hp:f,ac:10+B(l)+g,carry:15*o,naturalACBonus:g,totalHPPerLevel:m,classHPBonus:u,raceHPBonus:h,traitHPBonus:p}}const L={Human:{STR:1,CHA:1,CON:-1,WIS:-1},Sylvanborn:{DEX:2,WIS:1,STR:-2,CON:-1},Alloy:{CON:2,INT:1,DEX:-2,CHA:-1},Draketh:{STR:2,CHA:1,DEX:-1,WIS:-2},Voidkin:{INT:2,WIS:1,STR:-1,CHA:-2},Crystalborn:{CON:1,INT:2,DEX:-1,CHA:-2},Stormcaller:{DEX:1,CHA:2,CON:-1,STR:-2}},I={};function q(e,t,n,r){var a,i;let o=e;o+=(null===(a=L[n])||void 0===a?void 0:a[t])||0;return o+=(null===(i=I[r])||void 0===i?void 0:i[t])||0,Math.max(3,Math.min(o,22))}Object.entries(h).forEach(e=>{let[t,n]=e;I[t]={STR:n.statModifiers.strength||0,DEX:n.statModifiers.dexterity||0,CON:n.statModifiers.constitution||0,INT:n.statModifiers.intelligence||0,WIS:n.statModifiers.wisdom||0,CHA:n.statModifiers.charisma||0}});const D=Object.keys(h),O=["Commoner","Noble","Soldier","Scholar","Merchant","Artisan","Criminal","Folk Hero","Hermit","Entertainer"];function W(e){let{engine:t,isVisible:n,onClose:r,showGrid:i,onToggleGrid:o,cameraLocked:s,onToggleCameraLock:l,onRefresh:c,stats:d}=e;const[h,p]=(0,a.useState)("stats"),[m,f]=(0,a.useState)(null);return n?(0,w.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.95)",color:"#f9fafb",padding:"0",borderRadius:"12px",border:"2px solid #374151",width:"80vw",maxWidth:"900px",height:"80vh",maxHeight:"700px",zIndex:300,boxShadow:"0 12px 48px rgba(0, 0, 0, 0.8)",display:"flex",flexDirection:"column"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"20px 24px",borderBottom:"2px solid #374151"},children:[(0,w.jsx)("h2",{style:{margin:0,color:"#f1f5f9",fontSize:"24px"},children:"\ud83c\udfae Game Menu"}),(0,w.jsx)("button",{onClick:r,style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:"24px",cursor:"pointer",padding:"0",width:"32px",height:"32px"},children:"\xd7"})]}),(0,w.jsx)("div",{style:{display:"flex",borderBottom:"2px solid #374151",backgroundColor:"rgba(0, 0, 0, 0.3)"},children:[{id:"stats",label:"Character Stats"},{id:"abilities",label:"Physical Abilities"},{id:"spells",label:"Magical Spells"},{id:"creation",label:"Create Character"},{id:"settings",label:"Game Settings"}].map(e=>(0,w.jsx)("button",{onClick:()=>p(e.id),style:{flex:1,padding:"12px 16px",background:h===e.id?"#374151":"transparent",color:h===e.id?"#f9fafb":"#94a3b8",border:"none",borderBottom:h===e.id?"3px solid #3b82f6":"3px solid transparent",cursor:"pointer",fontSize:"14px",fontWeight:h===e.id?"bold":"normal",transition:"all 0.2s"},children:e.label},e.id))}),(0,w.jsxs)("div",{style:{flex:1,padding:"24px",overflowY:"auto",backgroundColor:"rgba(0, 0, 0, 0.2)"},children:["stats"===h&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 20px 0",color:"#3b82f6"},children:"Character Statistics"}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"20px"},children:[(0,w.jsxs)("div",{style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"16px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#60a5fa"},children:"Basic Information"}),(0,w.jsxs)("div",{style:{fontSize:"14px",lineHeight:"1.6"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Level:"})," ",t.state.party.level]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Experience:"})," ",t.state.party.experience,"/",100*t.state.party.level]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Position:"})," (",t.state.party.x,", ",t.state.party.y,")"]})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"8px",padding:"16px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#4ade80"},children:"Health & Resources"}),(0,w.jsxs)("div",{style:{fontSize:"14px",lineHeight:"1.6"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Health:"}),(0,w.jsxs)("span",{style:{color:t.state.party.hitPoints/t.state.party.maxHitPoints>.7?"#4ade80":t.state.party.hitPoints/t.state.party.maxHitPoints>.3?"#eab308":"#ef4444",fontWeight:"bold",marginLeft:"8px"},children:[t.state.party.hitPoints,"/",t.state.party.maxHitPoints]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Stamina:"}),(0,w.jsxs)("span",{style:{color:t.state.party.stamina/t.state.party.maxStamina>.7?"#4ade80":t.state.party.stamina/t.state.party.maxStamina>.3?"#eab308":"#ef4444",fontWeight:"bold",marginLeft:"8px"},children:[t.state.party.stamina,"/",t.state.party.maxStamina]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Ether:"}),(0,w.jsxs)("span",{style:{color:t.state.party.ether/t.state.party.maxEther>.7?"#4ade80":t.state.party.ether/t.state.party.maxEther>.3?"#eab308":"#ef4444",fontWeight:"bold",marginLeft:"8px"},children:[t.state.party.ether,"/",t.state.party.maxEther]})]})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(168, 85, 247, 0.1)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:"8px",padding:"16px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#a855f7"},children:"Attributes"}),(0,w.jsxs)("div",{style:{fontSize:"14px",lineHeight:"1.6",display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"STR:"})," ",t.state.party.stats.strength]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"DEX:"})," ",t.state.party.stats.dexterity]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"CON:"})," ",t.state.party.stats.constitution]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"INT:"})," ",t.state.party.stats.intelligence]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"WIS:"})," ",t.state.party.stats.wisdom]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"CHA:"})," ",t.state.party.stats.charisma]})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(234, 179, 8, 0.1)",border:"1px solid rgba(234, 179, 8, 0.3)",borderRadius:"8px",padding:"16px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#eab308"},children:"Equipment"}),(0,w.jsx)("div",{style:{fontSize:"14px",lineHeight:"1.6"},children:t.state.party.equipment.length>0?t.state.party.equipment.map((e,t)=>(0,w.jsx)("div",{style:{color:"#4ade80"},children:e.replace(/_/g," ")},t)):(0,w.jsx)("div",{style:{color:"#94a3b8",fontStyle:"italic"},children:"No equipment"})})]})]})]}),"abilities"===h&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 20px 0",color:"#4ade80"},children:"Physical Abilities"}),(0,w.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#22c55e"},children:"Known Abilities"}),t.state.party.knownAbilities.length>0?(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"8px"},children:t.state.party.knownAbilities.map((e,t)=>(0,w.jsx)("div",{style:{padding:"8px 12px",background:"rgba(34, 197, 94, 0.2)",borderRadius:"6px",border:"1px solid #22c55e",fontSize:"13px"},children:e},t))}):(0,w.jsx)("div",{style:{fontSize:"14px",color:"#94a3b8",fontStyle:"italic"},children:"No physical abilities learned yet."})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#eab308"},children:"Available to Learn by School"}),(0,w.jsx)(H,{engine:t,selectedCharacterId:m,onSelectCharacter:f}),m&&(0,w.jsx)(F,{engine:t,characterId:m})]})]}),"spells"===h&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 20px 0",color:"#8b5cf6"},children:"Magical Spells"}),(0,w.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#a855f7"},children:"Known Spells"}),t.state.party.knownSpells.length>0?(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"8px"},children:t.state.party.knownSpells.map((e,t)=>(0,w.jsx)("div",{style:{padding:"8px 12px",background:"rgba(139, 92, 246, 0.2)",borderRadius:"6px",border:"1px solid #8b5cf6",fontSize:"13px"},children:e},t))}):(0,w.jsx)("div",{style:{fontSize:"14px",color:"#94a3b8",fontStyle:"italic"},children:"No spells learned yet."})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#06b6d4"},children:"Available to Learn by School"}),(0,w.jsx)(H,{engine:t,selectedCharacterId:m,onSelectCharacter:f}),m&&(0,w.jsx)(G,{engine:t,characterId:m})]})]}),"creation"===h&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 20px 0",color:"#f59e0b"},children:"Create Character"}),(0,w.jsx)(U,{engine:t})]}),"settings"===h&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 20px 0",color:"#6b7280"},children:"Game Settings"}),(0,w.jsxs)("div",{style:{display:"grid",gap:"20px"},children:[(0,w.jsxs)("div",{style:{background:"rgba(107, 114, 128, 0.1)",border:"1px solid rgba(107, 114, 128, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 16px 0",color:"#9ca3af"},children:"Display Settings"}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[(0,w.jsx)("label",{style:{fontSize:"14px",color:"#e2e8f0"},children:"Show Grid"}),(0,w.jsx)("button",{onClick:o,style:{padding:"6px 12px",background:i?"#059669":"#374151",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px"},children:i?"ON":"OFF"})]}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"12px"},children:[(0,w.jsx)("label",{style:{fontSize:"14px",color:"#e2e8f0"},children:"Camera Lock"}),(0,w.jsx)("button",{onClick:l,style:{padding:"6px 12px",background:s?"#059669":"#374151",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px"},children:s?"LOCKED":"FREE"})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(107, 114, 128, 0.1)",border:"1px solid rgba(107, 114, 128, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 16px 0",color:"#9ca3af"},children:"Game Information"}),(0,w.jsxs)("div",{style:{fontSize:"13px",lineHeight:"1.6",color:"#cbd5e1"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Time:"})," ",d.gameTime]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Weather:"})," ",t.state.weather.type," (",Math.round(100*t.state.weather.intensity),"%)"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Chunks Loaded:"})," ",d.chunks.loaded||0]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Discovered Tiles:"})," ",d.discovered]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Encounter Risk:"}),(0,w.jsxs)("span",{style:{color:t.state.encounterClock.riskLevel>.7?"#ef4444":t.state.encounterClock.riskLevel>.4?"#eab308":"#4ade80",fontWeight:"bold",marginLeft:"8px"},children:[Math.round(100*t.state.encounterClock.riskLevel),"%"]})]})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 16px 0",color:"#60a5fa"},children:"\ud83d\udcbe Save & Load"}),(0,w.jsxs)("div",{style:{display:"grid",gap:"12px"},children:[(0,w.jsx)("div",{style:{fontSize:"12px",color:"#cbd5e1",marginBottom:"8px"},children:"Your game is automatically saved when you move, create characters, or learn abilities."}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"8px"},children:[(0,w.jsx)("button",{onClick:()=>{try{const e=t.save(),n=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download="world-engine-save-".concat((new Date).toISOString().split("T")[0],".json"),a.click(),URL.revokeObjectURL(r),alert("Game saved to file!")}catch(e){alert("Failed to save game: "+e)}},style:{padding:"8px 12px",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"\ud83d\udce5 Export Save"}),(0,w.jsx)("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{var n;const r=null===(n=e.target.files)||void 0===n?void 0:n[0];if(r){const e=new FileReader;e.onload=e=>{try{var n;const r=null===(n=e.target)||void 0===n?void 0:n.result;t.load(r)?(null===c||void 0===c||c(),alert("Game loaded successfully! Your characters and progress have been restored.")):alert("Failed to load save file. Please check the file format.")}catch(r){alert("Failed to load game: "+r)}},e.readAsText(r)}},e.click()},style:{padding:"8px 12px",background:"#059669",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"\ud83d\udce4 Import Save"}),(0,w.jsx)("button",{onClick:()=>{confirm("Are you sure you want to start a new game? This will delete your current progress.")&&(u.local.removeItem("world-engine-save"),alert("Save data cleared! Refresh the page to start a new game."))},style:{padding:"8px 12px",background:"#dc2626",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"\ud83d\uddd1\ufe0f New Game"})]}),(0,w.jsxs)("div",{style:{fontSize:"11px",color:"#94a3b8",marginTop:"8px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Seed:"})," ",t.state.seed]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Characters:"})," ",t.state.characters.length]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Last Save:"})," Auto-saved to browser"]})]})]})]})]})]})]})]}):null}function H(e){var t;let{engine:n,selectedCharacterId:r,onSelectCharacter:a}=e;const i=n.getPartyCharacters();return 0===i.length?(0,w.jsx)("div",{style:{padding:"16px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",marginBottom:"16px",fontSize:"14px",color:"#fca5a5"},children:"\u26a0\ufe0f No characters in party. Add characters to assign abilities and spells."}):(0,w.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,w.jsx)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:i.map(e=>(0,w.jsxs)("button",{onClick:()=>a(r===e.id?null:e.id),style:{padding:"8px 16px",background:r===e.id?"#3b82f6":"rgba(59, 130, 246, 0.2)",border:r===e.id?"2px solid #60a5fa":"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"6px",color:r===e.id?"#f9fafb":"#94a3b8",cursor:"pointer",fontSize:"14px",fontWeight:r===e.id?"bold":"normal",transition:"all 0.2s"},children:["\ud83d\udc64 ",e.name," (Lv.",e.level,")"]},e.id))}),r&&(0,w.jsxs)("div",{style:{marginTop:"12px",padding:"12px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"6px",fontSize:"13px",color:"#cbd5e1"},children:["Selected: ",(0,w.jsx)("strong",{children:null===(t=i.find(e=>e.id===r))||void 0===t?void 0:t.name})]})]})}function F(e){let{engine:t,characterId:n}=e;const[r,i]=(0,a.useState)(new Set),o=t.getCharacter(n),s=(0,a.useMemo)(()=>{if(!o)return{};try{const e=t.getAvailablePhysicalAbilitiesForCharacter(n).filter(e=>!o.knownAbilities.includes(e.name)),r={};return e.forEach(e=>{r[e.school]||(r[e.school]=[]),r[e.school].push(e)}),r}catch(e){return console.error("Error loading abilities:",e),{}}},[null===o||void 0===o?void 0:o.level,JSON.stringify(null===o||void 0===o?void 0:o.stats),JSON.stringify(null===o||void 0===o?void 0:o.knownAbilities),n]);if(!o)return(0,w.jsx)("div",{style:{fontSize:"14px",color:"#ef4444"},children:"Character not found."});const l=Object.keys(s).sort();return 0===l.length?(0,w.jsx)("div",{style:{fontSize:"14px",color:"#94a3b8",fontStyle:"italic"},children:"No new physical abilities available."}):(0,w.jsx)("div",{style:{display:"grid",gap:"8px"},children:l.map(e=>(0,w.jsxs)("div",{style:{border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"8px",background:"rgba(34, 197, 94, 0.1)"},children:[(0,w.jsxs)("button",{onClick:()=>(e=>{const t=new Set(r);t.has(e)?t.delete(e):t.add(e),i(t)})(e),style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#4ade80",fontSize:"14px",fontWeight:"bold",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("span",{children:["\u2694\ufe0f ",e," (",s[e].length,")"]}),(0,w.jsx)("span",{style:{fontSize:"18px"},children:r.has(e)?"\u25bc":"\u25b6"})]}),r.has(e)&&(0,w.jsx)("div",{style:{padding:"0 16px 16px 16px",display:"grid",gap:"12px"},children:s[e].map((e,r)=>(0,w.jsx)("div",{style:{padding:"16px",background:"rgba(234, 179, 8, 0.2)",borderRadius:"8px",border:"1px solid #eab308"},children:(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,w.jsxs)("div",{style:{flex:1},children:[(0,w.jsx)("div",{style:{fontWeight:"bold",color:"#fbbf24",fontSize:"16px"},children:e.name}),(0,w.jsxs)("div",{style:{fontSize:"12px",color:"#e2e8f0",marginTop:"4px"},children:[e.school," \u2022 ",e.tier," \u2022 Stamina: ",e.staminaCost]}),(0,w.jsx)("div",{style:{fontSize:"13px",color:"#cbd5e1",marginTop:"8px"},children:e.description})]}),(0,w.jsx)("button",{onClick:()=>{t.learnPhysicalAbilityForCharacter(n,e.name)&&console.log("".concat(o.name," learned ").concat(e.name,"!"))},style:{marginLeft:"12px",padding:"8px 16px",background:"#059669",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"Learn"})]})},r))})]},e))})}function G(e){let{engine:t,characterId:n}=e;const[r,i]=(0,a.useState)(new Set),o=t.getCharacter(n),s=(0,a.useMemo)(()=>{if(!o)return{};try{const e=t.getAvailableMagicalSpellsForCharacter(n).filter(e=>!o.knownSpells.includes(e.name)),r={};return e.forEach(e=>{r[e.school]||(r[e.school]=[]),r[e.school].push(e)}),r}catch(e){return console.error("Error loading spells:",e),{}}},[null===o||void 0===o?void 0:o.level,JSON.stringify(null===o||void 0===o?void 0:o.stats),JSON.stringify(null===o||void 0===o?void 0:o.knownSpells),n]);if(!o)return(0,w.jsx)("div",{style:{fontSize:"14px",color:"#ef4444"},children:"Character not found."});return 0===Object.keys(s).sort().length?(0,w.jsx)("div",{style:{fontSize:"14px",color:"#94a3b8",fontStyle:"italic"},children:"No new magical spells available."}):(0,w.jsx)("div",{style:{display:"grid",gap:"8px"}})}function U(e){let{engine:t}=e;const[n,i]=(0,a.useState)({name:"",gender:"Female",species:"Human",archetype:"Greenwarden",background:"Commoner",level:1,stats:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},traits:[]}),[o,s]=(0,a.useState)(27),[l,c]=(0,a.useState)([]),d=P[n.species],u=(e,t)=>{const a=n.stats[e],l=N(t)-N(a);o-l>=0&&t>=8&&t<=20&&(i(n=>(0,r.A)((0,r.A)({},n),{},{stats:(0,r.A)((0,r.A)({},n.stats),{},{[e]:t})})),s(e=>e-l))},h=e=>N(e);return(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"24px"},children:[(0,w.jsxs)("div",{style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 16px 0",color:"#60a5fa",borderBottom:"2px solid #60a5fa",paddingBottom:"8px"},children:"\ud83d\udccb Basic Information"}),(0,w.jsxs)("div",{style:{display:"grid",gap:"12px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",fontSize:"12px",color:"#cbd5e1",marginBottom:"4px"},children:"Character Name *"}),(0,w.jsx)("input",{type:"text",value:n.name,onChange:e=>i(t=>(0,r.A)((0,r.A)({},t),{},{name:e.target.value})),placeholder:"Enter character name...",style:{width:"100%",padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid #374151",borderRadius:"6px",color:"#f9fafb",fontSize:"14px"}})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",fontSize:"12px",color:"#cbd5e1",marginBottom:"4px"},children:"Gender"}),(0,w.jsx)("select",{value:n.gender,onChange:e=>i(t=>(0,r.A)((0,r.A)({},t),{},{gender:e.target.value})),style:{width:"100%",padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid #374151",borderRadius:"6px",color:"#f9fafb",fontSize:"14px"},children:E.map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",fontSize:"12px",color:"#cbd5e1",marginBottom:"4px"},children:"Level"}),(0,w.jsx)("input",{type:"number",min:"1",max:"20",value:n.level,onChange:e=>i(t=>(0,r.A)((0,r.A)({},t),{},{level:parseInt(e.target.value)||1})),style:{width:"100%",padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid #374151",borderRadius:"6px",color:"#f9fafb",fontSize:"14px"}})]})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",fontSize:"12px",color:"#cbd5e1",marginBottom:"4px"},children:"Species"}),(0,w.jsx)("select",{value:n.species,onChange:e=>i(t=>(0,r.A)((0,r.A)({},t),{},{species:e.target.value})),style:{width:"100%",padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid #374151",borderRadius:"6px",color:"#f9fafb",fontSize:"14px"},children:A.map(e=>(0,w.jsx)("option",{value:e,children:e},e))}),n.species&&L[n.species]&&(0,w.jsxs)("div",{style:{fontSize:"11px",color:"#94a3b8",marginTop:"4px"},children:["Racial modifiers: ",Object.entries(L[n.species]).map(e=>{let[t,n]=e;return"".concat(t," ").concat(n>0?"+":"").concat(n)}).join(", ")]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",fontSize:"12px",color:"#cbd5e1",marginBottom:"4px"},children:"Class"}),(0,w.jsx)("select",{value:n.archetype,onChange:e=>i(t=>(0,r.A)((0,r.A)({},t),{},{archetype:e.target.value})),style:{width:"100%",padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid #374151",borderRadius:"6px",color:"#f9fafb",fontSize:"14px"},children:D.map(e=>(0,w.jsx)("option",{value:e,children:e},e))}),n.archetype&&I[n.archetype]&&(0,w.jsxs)("div",{style:{fontSize:"11px",color:"#94a3b8",marginTop:"4px"},children:["Class modifiers: ",Object.entries(I[n.archetype]).map(e=>{let[t,n]=e;return"".concat(t," ").concat(n>0?"+":"").concat(n)}).filter(e=>!e.includes(" 0")).join(", ")||"None"]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",fontSize:"12px",color:"#cbd5e1",marginBottom:"4px"},children:"Background"}),(0,w.jsx)("select",{value:n.background,onChange:e=>i(t=>(0,r.A)((0,r.A)({},t),{},{background:e.target.value})),style:{width:"100%",padding:"8px 12px",background:"rgba(0, 0, 0, 0.3)",border:"1px solid #374151",borderRadius:"6px",color:"#f9fafb",fontSize:"14px"},children:O.map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]})]})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 16px 0",color:"#4ade80",borderBottom:"2px solid #4ade80",paddingBottom:"8px"},children:"\u26a1 Ability Scores"}),(0,w.jsxs)("div",{style:{marginBottom:"16px",fontSize:"12px",color:"#cbd5e1"},children:["Points Available: ",(0,w.jsx)("strong",{style:{color:o>0?"#4ade80":"#ef4444"},children:o})]}),(0,w.jsxs)("div",{style:{marginBottom:"12px",fontSize:"11px",color:"#94a3b8",lineHeight:"1.4"},children:[(0,w.jsx)("strong",{children:"Point Cost:"})," 8-14 (1 point each), 15-16 (2 points each), 17-20 (3 points each)"]}),(0,w.jsx)("div",{style:{display:"grid",gap:"8px"},children:Object.entries(n.stats).map(e=>{let[t,r]=e;return(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[(0,w.jsx)("div",{style:{width:"80px",fontSize:"13px",color:"#e2e8f0",textTransform:"capitalize"},children:t.slice(0,3).toUpperCase()}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)("button",{onClick:()=>u(t,r-1),disabled:r<=8,style:{width:"24px",height:"24px",background:r>8?"#374151":"#1f2937",color:r>8?"#f9fafb":"#6b7280",border:"none",borderRadius:"4px",cursor:r>8?"pointer":"not-allowed",fontSize:"14px"},children:"\u2212"}),(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",minWidth:"60px"},children:[(0,w.jsx)("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#f9fafb"},children:r}),(()=>{const e=q(r,t,n.species,n.archetype),a=B(e);return e!==r?(0,w.jsxs)("div",{style:{fontSize:"12px",color:e>r?"#4ade80":"#f87171"},children:[e," (",a>=0?"+":"",a,")"]}):(0,w.jsxs)("div",{style:{fontSize:"12px",color:"#94a3b8"},children:["(",a>=0?"+":"",a,")"]})})()]}),(0,w.jsx)("button",{onClick:()=>u(t,r+1),disabled:r>=20||o-(h(r+1)-h(r))<0,style:{width:"24px",height:"24px",background:r<20&&o-(h(r+1)-h(r))>=0?"#374151":"#1f2937",color:r<20&&o-(h(r+1)-h(r))>=0?"#f9fafb":"#6b7280",border:"none",borderRadius:"4px",cursor:r<20&&o-(h(r+1)-h(r))>=0?"pointer":"not-allowed",fontSize:"14px"},children:"+"})]}),(0,w.jsxs)("div",{style:{fontSize:"11px",color:"#94a3b8",display:"flex",flexDirection:"column",alignItems:"center",gap:"2px"},children:[(0,w.jsxs)("div",{children:["Cost: ",h(r)]}),(()=>{const e=function(e,t,n){var r,a;const i=(null===(r=L[t])||void 0===r?void 0:r[e])||0,o=(null===(a=I[n])||void 0===a?void 0:a[e])||0;let s="";return i>0?s+=" +".concat(i," racial"):i<0&&(s+=" ".concat(i," racial")),o>0?s+=" +".concat(o," class"):o<0&&(s+=" ".concat(o," class")),s.trim()}({strength:"STR",dexterity:"DEX",constitution:"CON",intelligence:"INT",wisdom:"WIS",charisma:"CHA"}[t],n.species,n.archetype);return e?(0,w.jsx)("div",{style:{fontSize:"10px",color:"#6b7280"},children:e}):null})()]})]},t)})})]}),(0,w.jsxs)("div",{style:{marginBottom:"20px",padding:"15px",background:"rgba(55, 65, 81, 0.3)",borderRadius:"8px",border:"1px solid #374151"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 15px 0",color:"#f9fafb",fontSize:"16px",borderBottom:"2px solid #374151",paddingBottom:"8px"},children:"\ud83c\udfad Character Preview"}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"15px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{margin:"0 0 10px 0",color:"#d1d5db",fontSize:"14px",fontWeight:"bold"},children:"Final Stats"}),Object.entries(n.stats).map(e=>{let[t,r]=e;const a={strength:"STR",dexterity:"DEX",constitution:"CON",intelligence:"INT",wisdom:"WIS",charisma:"CHA"}[t],i=q(r,a,n.species,n.archetype),o=B(i);return(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#d1d5db",marginBottom:"2px"},children:[(0,w.jsx)("span",{children:a}),(0,w.jsxs)("span",{style:{color:i!==r?"#4ade80":"#f9fafb"},children:[i," (",o>=0?"+":"",o,")"]})]},t)})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{margin:"0 0 10px 0",color:"#d1d5db",fontSize:"14px",fontWeight:"bold"},children:"Combat Stats"}),(()=>{const e={STR:n.stats.strength,DEX:n.stats.dexterity,CON:n.stats.constitution,INT:n.stats.intelligence,WIS:n.stats.wisdom,CHA:n.stats.charisma},t=[...(null===d||void 0===d?void 0:d.automatic)||[],...l],{hp:r,ac:a}=z(e,n.species,n.archetype,n.level,t),i=B(q(n.stats.constitution,"CON",n.species,n.archetype)),o=B(q(n.stats.dexterity,"DEX",n.species,n.archetype));return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#d1d5db",marginBottom:"2px"},children:[(0,w.jsx)("span",{children:"HP"}),(0,w.jsx)("span",{style:{color:"#ef4444"},children:r})]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#9ca3af",marginLeft:"10px",marginBottom:"4px"},children:[(0,w.jsx)("span",{children:"Base: 10 + CON mod"}),(0,w.jsxs)("span",{children:["10 + ",i>=0?"+":"",i]})]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#d1d5db",marginBottom:"2px"},children:[(0,w.jsx)("span",{children:"AC"}),(0,w.jsx)("span",{style:{color:"#3b82f6"},children:a})]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",color:"#9ca3af",marginLeft:"10px"},children:[(0,w.jsx)("span",{children:"Base: 10 + DEX mod"}),(0,w.jsxs)("span",{children:["10 + ",o>=0?"+":"",o]})]})]})})()]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{margin:"0 0 10px 0",color:"#d1d5db",fontSize:"14px",fontWeight:"bold"},children:"Point Buy"}),(()=>{const e=Object.values(n.stats).reduce((e,t)=>e+h(t),0);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:0===o?"#4ade80":o>0?"#fbbf24":"#ef4444",marginBottom:"2px"},children:[(0,w.jsx)("span",{children:"Available"}),(0,w.jsx)("span",{children:o})]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"12px",color:"#d1d5db"},children:[(0,w.jsx)("span",{children:"Used"}),(0,w.jsx)("span",{children:e})]})]})})()]})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(168, 85, 247, 0.1)",border:"1px solid rgba(168, 85, 247, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsxs)("h4",{style:{margin:"0 0 16px 0",color:"#a855f7",borderBottom:"2px solid #a855f7",paddingBottom:"8px"},children:["\u2728 Character Traits ",(0,w.jsxs)("small",{style:{opacity:.7,fontSize:"12px"},children:["(choose up to ",2,")"]})]}),d&&(0,w.jsxs)("div",{style:{marginBottom:"16px"},children:[d.automatic.length>0&&(0,w.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,w.jsx)("span",{style:{fontSize:"12px",color:"#10b981",fontWeight:"bold"},children:"Automatic Traits: "}),d.automatic.join(", ")]}),d.forbidden.length>0&&(0,w.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,w.jsx)("span",{style:{fontSize:"12px",color:"#ef4444",fontWeight:"bold"},children:"Forbidden Traits: "}),d.forbidden.join(", ")]})]}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"8px",maxHeight:"200px",overflowY:"auto"},children:_.map(e=>{const t=R[e],n=l.includes(e),r=null===d||void 0===d?void 0:d.automatic.includes(e),a=null===d||void 0===d?void 0:d.forbidden.includes(e),i=null===d||void 0===d?void 0:d.preferred.includes(e),o=!n&&l.length>=2||a;return(0,w.jsxs)("div",{onClick:()=>{r||a||o||(n?c(t=>t.filter(t=>t!==e)):l.length<2&&c(t=>[...t,e]))},style:{padding:"8px",borderRadius:"6px",cursor:r||a||o?"not-allowed":"pointer",border:"1px solid",borderColor:r?"#10b981":a?"#ef4444":n?"#a855f7":i?"#06b6d4":"#4b5563",background:r?"rgba(16, 185, 129, 0.2)":a?"rgba(239, 68, 68, 0.2)":n?"rgba(168, 85, 247, 0.2)":i?"rgba(6, 182, 212, 0.1)":"rgba(75, 85, 99, 0.1)",opacity:a||o?.5:1},children:[(0,w.jsxs)("div",{style:{fontSize:"14px",fontWeight:"bold",color:r?"#10b981":a?"#ef4444":n?"#a855f7":"#e2e8f0",marginBottom:"4px"},children:[e,r&&" (Auto)",a&&" (Forbidden)",i&&" (Preferred)"]}),(0,w.jsx)("div",{style:{fontSize:"12px",color:"#94a3b8",lineHeight:"1.3"},children:t.description})]},e)})}),(0,w.jsx)("div",{style:{marginTop:"16px"},children:(0,w.jsxs)("div",{style:{fontSize:"14px",color:"#e2e8f0",marginBottom:"8px"},children:["Selected Traits (",l.length,"/",2,"): ",[...(null===d||void 0===d?void 0:d.automatic)||[],...l].join(", ")||"None"]})})]}),n.name&&(0,w.jsxs)("div",{style:{gridColumn:"1 / -1",background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 16px 0",color:"#10b981",borderBottom:"2px solid #10b981",paddingBottom:"8px"},children:"\ud83c\udf1f Character Preview"}),(()=>{const e={STR:n.stats.strength,DEX:n.stats.dexterity,CON:n.stats.constitution,INT:n.stats.intelligence,WIS:n.stats.wisdom,CHA:n.stats.charisma},t=[...(null===d||void 0===d?void 0:d.automatic)||[],...l],r=z(e,n.species,n.archetype,n.level,t);return(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{color:"#e2e8f0",marginBottom:"12px"},children:"Basic Info"}),(0,w.jsxs)("div",{style:{fontSize:"14px",color:"#cbd5e1",lineHeight:"1.6"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:n.name})," (",n.gender,")"]}),(0,w.jsxs)("div",{children:[n.species," ",n.archetype]}),(0,w.jsxs)("div",{children:["Level ",n.level," ",n.background]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{color:"#e2e8f0",marginBottom:"12px"},children:"Combat Stats"}),(0,w.jsxs)("div",{style:{fontSize:"14px",color:"#cbd5e1",lineHeight:"1.6"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Hit Points:"})," ",r.hp]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Armor Class:"})," ",r.ac]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Carrying Capacity:"})," ",r.carry," lbs"]}),r.naturalACBonus>0&&(0,w.jsxs)("div",{style:{fontSize:"12px",opacity:.7},children:["+",r.naturalACBonus," natural AC bonus"]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{color:"#e2e8f0",marginBottom:"12px"},children:"Ability Scores"}),(0,w.jsxs)("div",{style:{fontSize:"14px",color:"#cbd5e1",lineHeight:"1.6",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"4px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"STR:"})," ",e.STR," (",B(e.STR)>=0?"+":"",B(e.STR),")"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"DEX:"})," ",e.DEX," (",B(e.DEX)>=0?"+":"",B(e.DEX),")"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"CON:"})," ",e.CON," (",B(e.CON)>=0?"+":"",B(e.CON),")"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"INT:"})," ",e.INT," (",B(e.INT)>=0?"+":"",B(e.INT),")"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"WIS:"})," ",e.WIS," (",B(e.WIS)>=0?"+":"",B(e.WIS),")"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"CHA:"})," ",e.CHA," (",B(e.CHA)>=0?"+":"",B(e.CHA),")"]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h5",{style:{color:"#e2e8f0",marginBottom:"12px"},children:"Traits"}),(0,w.jsx)("div",{style:{fontSize:"14px",color:"#cbd5e1",lineHeight:"1.6"},children:t.length>0?t.join(", "):"None"}),(0,w.jsxs)("div",{style:{fontSize:"12px",marginTop:"8px"},children:[(0,w.jsxs)("div",{style:{color:"#10b981"},children:["HP per level: +",r.totalHPPerLevel]}),(0,w.jsxs)("div",{style:{color:"#94a3b8"},children:["(Base: +",1+Math.max(0,B(e.CON)),", Class: +",r.classHPBonus,", Race: ",r.raceHPBonus>=0?"+":"",r.raceHPBonus,", Traits: ",r.traitHPBonus>=0?"+":"",r.traitHPBonus,")"]})]})]})]})})()]}),(0,w.jsx)("div",{style:{gridColumn:"1 / -1",display:"flex",justifyContent:"center",marginTop:"20px"},children:(0,w.jsxs)("button",{onClick:()=>{if(!n.name.trim())return void alert("Please enter a character name.");const e=t.addCharacter({name:n.name.trim(),gender:n.gender,species:n.species,archetype:n.archetype,background:n.background,level:n.level,experience:0,stats:n.stats,traits:n.traits});alert("".concat(e.name," has been added to your party!")),i({name:"",gender:"Female",species:"Human",archetype:"Fighter",background:"Commoner",level:1,stats:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},traits:[]}),s(27)},disabled:!n.name.trim(),style:{padding:"16px 32px",background:n.name.trim()?"#059669":"#374151",color:"#f9fafb",border:"none",borderRadius:"8px",cursor:n.name.trim()?"pointer":"not-allowed",fontSize:"16px",fontWeight:"bold",transition:"all 0.2s"},children:["\ud83c\udf89 Create Character ",o>0?"(".concat(o," points remaining)"):""]})})]})}function V(e){let{engine:t,stats:n,onBack:r,cameraLocked:a,onCenterParty:i}=e;return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:{position:"absolute",top:"10px",left:"10px",zIndex:100,display:"flex",flexDirection:"column",gap:"10px"},children:[(0,w.jsx)("button",{onClick:r,style:{padding:"10px 16px",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"\u2190 Back to Menu"}),!a&&(0,w.jsx)("button",{onClick:i,style:{padding:"8px 12px",background:"#059669",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"12px"},children:"\ud83d\udccd Recenter on Party"})]}),(0,w.jsxs)("div",{style:{position:"absolute",bottom:"10px",left:"10px",background:"rgba(0, 0, 0, 0.8)",color:"#f9fafb",padding:"12px",borderRadius:"6px",fontSize:"12px",lineHeight:"1.4",zIndex:100},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Movement:"})," Arrow keys or WASD"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Rest:"})," Space (1 hour, restores HP/Stamina/Ether)"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"View:"})," Mouse drag, scroll to zoom"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Grid:"})," G key"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Center:"})," C key"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Game Menu:"})," M key (Stats, Abilities, Spells, Creation)"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Close Menu:"})," ESC or M key"]}),(0,w.jsxs)("div",{style:{marginTop:"8px"},children:[(0,w.jsxs)("div",{children:["Position: (",t.state.party.x,", ",t.state.party.y,")"]}),(0,w.jsxs)("div",{children:["Health:",(0,w.jsxs)("span",{style:{color:t.state.party.hitPoints/t.state.party.maxHitPoints>.7?"#4ade80":t.state.party.hitPoints/t.state.party.maxHitPoints>.3?"#eab308":"#ef4444",fontWeight:"bold"},children:[t.state.party.hitPoints,"/",t.state.party.maxHitPoints]})]}),(0,w.jsxs)("div",{children:["Stamina:",(0,w.jsxs)("span",{style:{color:t.state.party.stamina/t.state.party.maxStamina>.7?"#4ade80":t.state.party.stamina/t.state.party.maxStamina>.3?"#eab308":"#ef4444",fontWeight:"bold"},children:[t.state.party.stamina,"/",t.state.party.maxStamina]})]}),(0,w.jsxs)("div",{children:["Ether:",(0,w.jsxs)("span",{style:{color:t.state.party.ether/t.state.party.maxEther>.7?"#4ade80":t.state.party.ether/t.state.party.maxEther>.3?"#eab308":"#ef4444",fontWeight:"bold"},children:[t.state.party.ether,"/",t.state.party.maxEther]})]}),(0,w.jsxs)("div",{children:["Level: ",t.state.party.level," (XP: ",t.state.party.experience,")"]}),(0,w.jsxs)("div",{children:["Weather: ",t.state.weather.type," (",Math.round(100*t.state.weather.intensity),"%)"]}),(0,w.jsxs)("div",{children:["Time: ",n.gameTime]}),(0,w.jsxs)("div",{children:["Encounter Risk:",(0,w.jsxs)("span",{style:{color:t.state.encounterClock.riskLevel>.7?"#ef4444":t.state.encounterClock.riskLevel>.4?"#eab308":"#4ade80",fontWeight:"bold"},children:[Math.round(100*t.state.encounterClock.riskLevel),"%"]})]})]})]})]})}function Y(e){let{engine:t,showWorldGenModal:n,onCloseWorldGenModal:r,onWorldGenSubmit:a,showEncounterModal:i,onCloseEncounterModal:o,onEncounterAction:s,showCharacterModal:l,onCloseCharacterModal:c}=e;const d=t.getActiveEncounter();return(0,w.jsxs)(w.Fragment,{children:[n&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,w.jsxs)("div",{style:{backgroundColor:"#1f2937",color:"#f9fafb",padding:"32px",borderRadius:"12px",border:"2px solid #374151",maxWidth:"600px",width:"90%",maxHeight:"80vh",overflowY:"auto"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[(0,w.jsx)("h2",{style:{margin:0,color:"#3b82f6"},children:"\ud83c\udf0d World Generation Settings"}),(0,w.jsx)("button",{onClick:r,style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:"24px",cursor:"pointer"},children:"\xd7"})]}),(0,w.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,w.jsx)("p",{style:{color:"#cbd5e1",marginBottom:"16px"},children:"Customize your world generation parameters. Changes will regenerate the entire world."}),(0,w.jsxs)("div",{style:{display:"grid",gap:"16px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#e2e8f0"},children:"Sea Level (0.0 = No Ocean, 1.0 = All Ocean)"}),(0,w.jsx)("input",{type:"range",min:"0",max:"1",step:"0.1",defaultValue:t.state.config.world.seaLevel,style:{width:"100%"}})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#e2e8f0"},children:"Continent Frequency (Lower = Larger Continents)"}),(0,w.jsx)("input",{type:"range",min:"0.0001",max:"0.01",step:"0.0001",defaultValue:t.state.config.world.continentFreq,style:{width:"100%"}})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"8px",color:"#e2e8f0"},children:"Feature Frequency (Lower = Larger Features)"}),(0,w.jsx)("input",{type:"range",min:"0.001",max:"0.1",step:"0.001",defaultValue:t.state.config.world.featureFreq,style:{width:"100%"}})]})]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[(0,w.jsx)("button",{onClick:r,style:{padding:"12px 24px",background:"#6b7280",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Cancel"}),(0,w.jsx)("button",{onClick:()=>{a({}),r()},style:{padding:"12px 24px",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Apply Changes"})]})]})}),i&&d&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,w.jsxs)("div",{style:{backgroundColor:"#1f2937",color:"#f9fafb",padding:"32px",borderRadius:"12px",border:"3px solid ".concat("extreme"===d.danger?"#dc2626":"high"===d.danger?"#ea580c":"medium"===d.danger?"#eab308":"low"===d.danger?"#65a30d":"#059669"),maxWidth:"700px",width:"90%",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.8)"},children:[(0,w.jsxs)("div",{style:{textAlign:"center",marginBottom:"24px"},children:[(0,w.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px",filter:"drop-shadow(0 4px 8px rgba(0, 0, 0, 0.8))"},children:"combat"===d.type?"\u2694\ufe0f":"discovery"===d.type?"\ud83d\uddfa\ufe0f":"trader"===d.type?"\ud83c\udfea":"event"===d.type?"\ud83d\udcdc":"\u2753"}),(0,w.jsx)("h2",{style:{margin:"0 0 8px 0",color:"#f1f5f9",fontSize:"28px",textShadow:"2px 2px 4px rgba(0, 0, 0, 0.8)"},children:d.name}),(0,w.jsxs)("div",{style:{display:"inline-block",padding:"4px 12px",borderRadius:"20px",fontSize:"12px",fontWeight:"bold",backgroundColor:"extreme"===d.danger?"rgba(220, 38, 38, 0.3)":"high"===d.danger?"rgba(234, 88, 12, 0.3)":"medium"===d.danger?"rgba(234, 179, 8, 0.3)":"low"===d.danger?"rgba(101, 163, 13, 0.3)":"rgba(5, 150, 105, 0.3)",color:"extreme"===d.danger?"#fca5a5":"high"===d.danger?"#fdba74":"medium"===d.danger?"#fde047":"low"===d.danger?"#a3e635":"#6ee7b7",border:"1px solid ".concat("extreme"===d.danger?"#dc2626":"high"===d.danger?"#ea580c":"medium"===d.danger?"#eab308":"low"===d.danger?"#65a30d":"#059669")},children:[d.danger.toUpperCase()," RISK"]})]}),(0,w.jsx)("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.3)",padding:"20px",borderRadius:"8px",marginBottom:"24px",border:"1px solid rgba(75, 85, 99, 0.5)"},children:(0,w.jsx)("p",{style:{margin:0,fontSize:"16px",lineHeight:"1.6",color:"#e2e8f0"},children:d.description})}),d.rewards&&(0,w.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 12px 0",color:"#fbbf24"},children:"\ud83d\udcb0 Potential Rewards"}),(0,w.jsxs)("div",{style:{fontSize:"14px",color:"#cbd5e1",backgroundColor:"rgba(251, 191, 36, 0.1)",padding:"12px",borderRadius:"6px",border:"1px solid rgba(251, 191, 36, 0.3)"},children:[d.rewards.experience&&(0,w.jsxs)("div",{children:["\ud83c\udf93 Experience: ",d.rewards.experience]}),d.rewards.gold&&(0,w.jsxs)("div",{children:["\ud83d\udcb0 Gold: ",d.rewards.gold]}),d.rewards.items&&d.rewards.items.length>0&&(0,w.jsxs)("div",{children:["\ud83c\udf92 Items: ",d.rewards.items.join(", ")]})]})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(120px, 1fr))",gap:"12px"},children:["combat"===d.type&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("button",{onClick:()=>s("fight"),style:{padding:"12px 16px",background:"linear-gradient(135deg, #dc2626 0%, #991b1b 100%)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",boxShadow:"0 4px 8px rgba(220, 38, 38, 0.3)"},children:"\u2694\ufe0f Fight"}),(0,w.jsx)("button",{onClick:()=>s("flee"),style:{padding:"12px 16px",background:"linear-gradient(135deg, #eab308 0%, #ca8a04 100%)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",boxShadow:"0 4px 8px rgba(234, 179, 8, 0.3)"},children:"\ud83c\udfc3 Flee"})]}),("trader"===d.type||"event"===d.type)&&(0,w.jsx)("button",{onClick:()=>s("negotiate"),style:{padding:"12px 16px",background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",boxShadow:"0 4px 8px rgba(59, 130, 246, 0.3)"},children:"\ud83d\udcac Interact"}),"discovery"===d.type&&(0,w.jsx)("button",{onClick:()=>s("explore"),style:{padding:"12px 16px",background:"linear-gradient(135deg, #059669 0%, #047857 100%)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",boxShadow:"0 4px 8px rgba(5, 150, 105, 0.3)"},children:"\ud83d\udd0d Explore"}),(0,w.jsx)("button",{onClick:o,style:{padding:"12px 16px",background:"linear-gradient(135deg, #6b7280 0%, #4b5563 100%)",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px",fontWeight:"bold",boxShadow:"0 4px 8px rgba(107, 114, 128, 0.3)"},children:"\ud83d\udeaa Dismiss"})]})]})}),l&&(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,w.jsxs)("div",{style:{backgroundColor:"#1f2937",color:"#f9fafb",padding:"32px",borderRadius:"12px",border:"2px solid #374151",maxWidth:"900px",width:"95%",maxHeight:"85vh",overflowY:"auto"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[(0,w.jsx)("h2",{style:{margin:0,color:"#3b82f6"},children:"Party Characters"}),(0,w.jsx)("button",{onClick:c,style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:"24px",cursor:"pointer"},children:"\xd7"})]}),(0,w.jsx)(K,{engine:t})]})})]})}function K(e){let{engine:t}=e;const n=t.getPartyCharacters();return 0===n.length?(0,w.jsxs)("div",{style:{padding:"32px",textAlign:"center",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#fca5a5"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 16px 0"},children:"\u26a0\ufe0f No Characters in Party"}),(0,w.jsx)("p",{style:{margin:0,fontSize:"14px"},children:"Add characters to your party to view their information and manage their abilities."})]}):(0,w.jsx)("div",{style:{display:"grid",gap:"20px"},children:n.map((e,t)=>(0,w.jsxs)("div",{style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"8px",padding:"20px"},children:[(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr auto",gap:"20px",alignItems:"start"},children:[(0,w.jsx)("div",{style:{width:"64px",height:"64px",background:"rgba(99, 102, 241, 0.2)",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"32px"},children:"\ud83d\udc64"}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 8px 0",color:"#60a5fa"},children:e.name}),(0,w.jsxs)("div",{style:{fontSize:"14px",color:"#cbd5e1",marginBottom:"12px"},children:["Level ",e.level," ",e.species," ",e.archetype," \u2022 ",e.gender]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginBottom:"16px"},children:[(0,w.jsxs)("div",{style:{fontSize:"12px"},children:[(0,w.jsx)("div",{style:{color:"#94a3b8"},children:"Health"}),(0,w.jsxs)("div",{style:{color:"#4ade80",fontWeight:"bold"},children:[e.hitPoints,"/",e.maxHitPoints]})]}),(0,w.jsxs)("div",{style:{fontSize:"12px"},children:[(0,w.jsx)("div",{style:{color:"#94a3b8"},children:"Stamina"}),(0,w.jsxs)("div",{style:{color:"#facc15",fontWeight:"bold"},children:[e.stamina,"/",e.maxStamina]})]}),(0,w.jsxs)("div",{style:{fontSize:"12px"},children:[(0,w.jsx)("div",{style:{color:"#94a3b8"},children:"Ether"}),(0,w.jsxs)("div",{style:{color:"#8b5cf6",fontWeight:"bold"},children:[e.ether,"/",e.maxEther]})]})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:"8px",fontSize:"11px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#94a3b8"},children:"STR:"})," ",e.stats.strength]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#94a3b8"},children:"DEX:"})," ",e.stats.dexterity]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#94a3b8"},children:"CON:"})," ",e.stats.constitution]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#94a3b8"},children:"INT:"})," ",e.stats.intelligence]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#94a3b8"},children:"WIS:"})," ",e.stats.wisdom]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#94a3b8"},children:"CHA:"})," ",e.stats.charisma]})]})]}),(0,w.jsxs)("div",{style:{minWidth:"120px"},children:[(0,w.jsxs)("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"4px"},children:["XP: ",e.experience]}),(0,w.jsx)("div",{style:{width:"100%",height:"8px",background:"rgba(75, 85, 99, 0.5)",borderRadius:"4px",overflow:"hidden"},children:(0,w.jsx)("div",{style:{width:"".concat(e.experience%100,"%"),height:"100%",background:"linear-gradient(90deg, #3b82f6, #60a5fa)",borderRadius:"4px"}})})]})]}),(0,w.jsxs)("div",{style:{marginTop:"16px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("h4",{style:{margin:"0 0 8px 0",color:"#4ade80",fontSize:"14px"},children:["\u2694\ufe0f Abilities (",e.knownAbilities.length,")"]}),(0,w.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[e.knownAbilities.length>0?e.knownAbilities.slice(0,3).map((e,t)=>(0,w.jsx)("div",{style:{padding:"2px 6px",background:"rgba(34, 197, 94, 0.2)",borderRadius:"4px",fontSize:"10px",color:"#4ade80"},children:e},t)):(0,w.jsx)("div",{style:{fontSize:"10px",color:"#6b7280",fontStyle:"italic"},children:"None learned"}),e.knownAbilities.length>3&&(0,w.jsxs)("div",{style:{fontSize:"10px",color:"#6b7280"},children:["+",e.knownAbilities.length-3," more"]})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("h4",{style:{margin:"0 0 8px 0",color:"#8b5cf6",fontSize:"14px"},children:["\u2728 Spells (",e.knownSpells.length,")"]}),(0,w.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px"},children:[e.knownSpells.length>0?e.knownSpells.slice(0,3).map((e,t)=>(0,w.jsx)("div",{style:{padding:"2px 6px",background:"rgba(139, 92, 246, 0.2)",borderRadius:"4px",fontSize:"10px",color:"#8b5cf6"},children:e},t)):(0,w.jsx)("div",{style:{fontSize:"10px",color:"#6b7280",fontStyle:"italic"},children:"None learned"}),e.knownSpells.length>3&&(0,w.jsxs)("div",{style:{fontSize:"10px",color:"#6b7280"},children:["+",e.knownSpells.length-3," more"]})]})]})]})]},e.id))})}a.Component;class X{constructor(e){this.seed=void 0,this.seed="string"===typeof e?this.hash(e):e}hash(e){let t=2166136261;for(let n=0;n<e.length;n++)t^=e.charCodeAt(n),t=Math.imul(t,16777619);return t>>>0}next(){let e=this.seed+2654435769;return e^=e<<13,e^=e>>>17,e^=e<<5,this.seed=e>>>0,(this.seed>>>0)/4294967296}nextFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e+this.next()*(t-e)}nextInt(e,t){return Math.floor(this.nextFloat(e,t+1))}pick(e){return e[this.nextInt(0,e.length-1)]}}class J{constructor(e){this.permTable=void 0,this.gradients=void 0;const t=new X(e);this.permTable=Array.from({length:512},(e,t)=>t%256);for(let n=this.permTable.length-1;n>0;n--){const e=t.nextInt(0,n);[this.permTable[n],this.permTable[e]]=[this.permTable[e],this.permTable[n]]}for(let n=0;n<256;n++)this.permTable[256+n]=this.permTable[n];this.gradients=[];for(let n=0;n<256;n++){const e=t.nextFloat(0,2*Math.PI);this.gradients.push({x:Math.cos(e),y:Math.sin(e)})}}fade(e){return e*e*e*(e*(6*e-15)+10)}lerp(e,t,n){return e+n*(t-e)}grad(e,t,n){const r=this.gradients[255&e];return r.x*t+r.y*n}noise(e,t){const n=255&Math.floor(e),r=255&Math.floor(t);e-=Math.floor(e),t-=Math.floor(t);const a=this.fade(e),i=this.fade(t),o=this.permTable[n]+r,s=this.permTable[n+1]+r;return this.lerp(this.lerp(this.grad(this.permTable[o],e,t),this.grad(this.permTable[s],e-1,t),a),this.lerp(this.grad(this.permTable[o+1],e,t-1),this.grad(this.permTable[s+1],e-1,t-1),a),i)}fbm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=0,o=1,s=1,l=0;for(let c=0;c<n;c++)i+=this.noise(e*s,t*s)*o,l+=o,o*=r,s*=a;return i/l}ridge(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,i=0,o=1,s=1,l=0;for(let c=0;c<n;c++){i+=(1-Math.abs(this.noise(e*s,t*s)))*o,l+=o,o*=r,s*=a}return i/l}}class Q{constructor(e){this.noiseX=void 0,this.noiseY=void 0,this.noiseX=new J("".concat(e,"_warpX")),this.noiseY=new J("".concat(e,"_warpY"))}warp(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return{x:e+this.noiseX.fbm(.01*e,.01*t,4)*n,y:t+this.noiseY.fbm(.01*e,.01*t,4)*n}}}class ${constructor(e){this.seed=e,this.elevation=void 0,this.temperature=void 0,this.moisture=void 0,this.warp=void 0,this.elevation=new J("".concat(e,"_elev")),this.temperature=new J("".concat(e,"_temp")),this.moisture=new J("".concat(e,"_moist")),this.warp=new Q("".concat(e,"_warp"))}getElevation(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/1024,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:700;const a=this.warp.warp(e,t,r);return this.elevation.fbm(a.x*n,a.y*n,6,.6,2)}getTemperature(e,t,n,r){const a=1-Math.abs(t-r/2)/(r/2),i=.8*Math.max(0,n-.3),o=.2*this.temperature.fbm(.005*e,.005*t,3,.3,2);return Math.max(0,Math.min(1,a-i+o))}getMoisture(e,t,n){const r=this.moisture.fbm(.003*e,.003*t,4,.5,2),a=n>.4?.3*Math.max(0,this.elevation.noise(.01*e,.01*t)):0;return Math.max(0,Math.min(1,(r+1)/2+a))}}const Z=32;class ee{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.seed=e,this.chunks=new Map,this.noise=void 0,this.config=void 0,this.noise=new $(e),this.config=(0,r.A)({seaLevel:0,continentFreq:1/1024,featureFreq:1/128,warpStrength:700,mapWidth:2048,mapHeight:2048},t)}worldToChunk(e,t){return{chunkX:Math.floor(e/Z),chunkY:Math.floor(t/Z)}}chunkKey(e,t){return"".concat(e,",").concat(t)}tileKey(e,t){return"".concat(e,",").concat(t)}ensureRadius(e,t,n){const r=this.worldToChunk(e,t),a=Math.ceil(n/Z)+1;for(let i=-a;i<=a;i++)for(let o=-a;o<=a;o++){const a=r.chunkX+i,s=r.chunkY+o,l=a*Z+16,c=s*Z+16;Math.sqrt(Math.pow(l-e,2)+Math.pow(c-t,2))<=n+Z&&this.ensureChunk(a,s)}}ensureChunk(e,t){const n=this.chunkKey(e,t);let r=this.chunks.get(n);return r||(r=this.createChunk(e,t),this.chunks.set(n,r)),r.generated||this.generateChunk(r),r.lastAccessed=Date.now(),r}createChunk(e,t){return{coord:{chunkX:e,chunkY:t},tiles:new Map,generated:!1,lastAccessed:Date.now()}}generateChunk(e){const t=e.coord.chunkX*Z,n=e.coord.chunkY*Z;for(let r=0;r<Z;r++)for(let a=0;a<Z;a++){const i=t+r,o=n+a,s=this.generateTile(i,o);e.tiles.set(this.tileKey(i,o),s)}e.generated=!0}generateTile(e,t){const n=this.noise.getElevation(e,t,this.config.continentFreq,this.config.warpStrength),r=this.noise.getTemperature(e,t,n,this.config.mapHeight),a=this.noise.getMoisture(e,t,n);return{x:e,y:t,biome:this.determineBiome(n,r,a),elevation:n,temperature:r,moisture:a,river:!1,road:!1,discovered:!1}}determineBiome(e,t,n){const{seaLevel:r}=this.config;return e<r-.02?"Ocean":e<r+.02?"Coast":e>.7?t<.2?"Snow":"Mountain":t<.15?n>.3?"Tundra":"Snow":t<.35?n>.6?"Taiga":"Tundra":t<.65?n>.7?"Forest":n>.4?"Grass":n>.2?"Savanna":"Desert":n>.8?"Jungle":n>.6?"Forest":n>.4?"Savanna":n>.2?"Grass":e<.5&&n>.6?"Swamp":"Desert"}getTile(e,t){const n=this.worldToChunk(e,t);return this.ensureChunk(n.chunkX,n.chunkY).tiles.get(this.tileKey(e,t))}hasTile(e,t){const n=this.worldToChunk(e,t),r=this.chunkKey(n.chunkX,n.chunkY),a=this.chunks.get(r);return(null===a||void 0===a?void 0:a.generated)&&a.tiles.has(this.tileKey(e,t))||!1}unloadBeyond(e,t,n){let r=0;const a=this.worldToChunk(e,t),i=Math.ceil(n/Z)+2,o=[];return this.chunks.forEach((e,t)=>{const n=e.coord.chunkX-a.chunkX,r=e.coord.chunkY-a.chunkY;Math.sqrt(n*n+r*r)>i&&o.push(t)}),o.forEach(e=>{this.chunks.delete(e),r++}),r}getStats(){let e=0,t=0;this.chunks.forEach(n=>{n.generated&&(e++,t+=n.tiles.size)});const n=200*t/1048576;return{totalChunks:this.chunks.size,generatedChunks:e,totalTiles:t,memoryEstimateMB:n}}updateConfig(e){this.config=(0,r.A)((0,r.A)({},this.config),e)}invalidateAll(){this.chunks.forEach(e=>{e.generated=!1,e.tiles.clear()})}}class te{constructor(e){this.rng=void 0,this.rng=new X(e)}generateAbility(e,t){const n=te.ABILITY_TEMPLATES[e][t];if(!n||0===n.length)throw new Error("No templates found for ".concat(e," ").concat(t));const a=this.rng.pick(n),i=this.generateAbilityName(e,t);return(0,r.A)({name:i,school:e,tier:t},a)}generateAbilityName(e,t){const n=this.rng.pick({Novice:["Basic","Simple","Student's","Apprentice","Training"],Adept:["Skilled","Practiced","Advanced","Refined","Improved"],Expert:["Master","Superior","Perfect","Elite","Exceptional"],Master:["Grand","Supreme","Ultimate","Legendary","Transcendent"],Legendary:["Mythical","Divine","Eternal","Cosmic","Godlike"]}[t]),r=this.rng.pick({Weaponmastery:["Strike","Slash","Thrust","Cut","Blade Dance","Steel Song","Edge Mastery"],Combat:["Fist","Punch","Grapple","Throw","Counter","Fighting Form","Combat Style"],Athletics:["Leap","Sprint","Climb","Jump","Dash","Athletic Form","Body Control"],Tactics:["Strategy","Formation","Command","Leadership","Battle Plan","War Art"],Survival:["Track","Hunt","Navigate","Forage","Wilderness Way","Nature Bond"],Stealth:["Shadow","Sneak","Hide","Infiltrate","Silent Step","Phantom Move"],Defense:["Block","Guard","Shield","Protect","Aegis","Fortress Stance"],Berserker:["Rage","Fury","Wrath","Frenzy","Berserker","Primal Scream"]}[e]);return"".concat(n," ").concat(r)}getAvailableAbilities(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=[];for(const i of Object.keys(te.ABILITY_TEMPLATES))for(const o of Object.keys(te.ABILITY_TEMPLATES[i])){const s=te.ABILITY_TEMPLATES[i][o];for(const l of s){if(e<l.requirements.minLevel)continue;let s=!0;for(const[e,n]of Object.entries(l.requirements.requiredStats||{}))if((t[e]||0)<n){s=!1;break}if(!s)continue;if(l.requirements.requiredEquipment){if(!l.requirements.requiredEquipment.every(e=>n.some(t=>t.toLowerCase().includes(e.toLowerCase()))))continue}if(l.requirements.prerequisiteAbilities){if(!l.requirements.prerequisiteAbilities.every(e=>r.includes(e)))continue}const c=this.generateAbility(i,o);a.push(c)}}return a}generateAbilityScroll(e){const t=e>=9?"Legendary":e>=7?"Master":e>=5?"Expert":e>=3?"Adept":"Novice",n=Object.keys(te.ABILITY_TEMPLATES),r=this.rng.pick(n),a=this.generateAbilityName(r,t);return{name:"".concat(a," Manual"),description:"A training manual that teaches the ".concat(a," technique from the ").concat(r," discipline.")}}}te.ABILITY_TEMPLATES={Weaponmastery:{Novice:[{description:"A basic sword technique that strikes with improved accuracy.",requirements:{minLevel:1,requiredStats:{strength:12},requiredEquipment:["sword"]},effects:{damage:{min:2,max:6,type:"slashing"}},staminaCost:2,range:"touch"},{description:"Precise bow shot that rarely misses its target.",requirements:{minLevel:1,requiredStats:{dexterity:12},requiredEquipment:["bow"]},effects:{damage:{min:3,max:5,type:"piercing"}},staminaCost:1,range:"far"},{description:"Quick flourish that intimidates opponents.",requirements:{minLevel:2,requiredStats:{dexterity:10,charisma:10}},effects:{special:["intimidate","initiative_bonus"]},staminaCost:1,range:"near"}],Adept:[{description:"A spinning attack that strikes multiple nearby enemies.",requirements:{minLevel:4,requiredStats:{strength:14,dexterity:12}},effects:{damage:{min:4,max:8,type:"slashing"},special:["cleave"]},staminaCost:4,range:"near"},{description:"Twin-strike technique for dual-wielding weapons.",requirements:{minLevel:5,requiredStats:{dexterity:15},prerequisiteAbilities:["Basic Strike"]},effects:{damage:{min:3,max:6},special:["double_attack"]},staminaCost:5,range:"touch"}],Expert:[{description:"Devastating overhead strike that can cleave through armor.",requirements:{minLevel:8,requiredStats:{strength:16}},effects:{damage:{min:8,max:15,type:"slashing"},special:["armor_pierce"]},staminaCost:8,cooldown:3,range:"touch"}],Master:[{description:"Legendary sword technique that can cut through multiple foes in a single motion.",requirements:{minLevel:12,requiredStats:{strength:18,dexterity:16}},effects:{damage:{min:12,max:20,type:"slashing"},special:["chain_attack","armor_pierce"]},staminaCost:12,cooldown:5,range:"near"}],Legendary:[{description:"The ultimate expression of weapon mastery, a technique that transcends mortal limits.",requirements:{minLevel:18,requiredStats:{strength:20,dexterity:18}},effects:{damage:{min:20,max:35,type:"slashing"},special:["perfect_strike","ignore_armor","cleave_all"]},staminaCost:20,cooldown:10,range:"far"}]},Combat:{Novice:[{description:"Basic unarmed strike enhanced by training.",requirements:{minLevel:1,requiredStats:{strength:10}},effects:{damage:{min:1,max:4,type:"bludgeoning"}},staminaCost:1,range:"touch"},{description:"Simple grappling technique to restrain opponents.",requirements:{minLevel:2,requiredStats:{strength:12,dexterity:10}},effects:{special:["grapple","restrain"]},staminaCost:3,range:"touch"}],Adept:[{description:"Stunning blow that can daze enemies.",requirements:{minLevel:4,requiredStats:{strength:13,constitution:12}},effects:{damage:{min:3,max:6,type:"bludgeoning"},special:["stun"]},staminaCost:4,range:"touch"},{description:"Counter-attack that triggers when enemies miss.",requirements:{minLevel:5,requiredStats:{dexterity:14,wisdom:12}},effects:{damage:{min:2,max:5},special:["counter","reactive"]},staminaCost:0,range:"touch"}],Expert:[{description:"Devastating combination of strikes that builds momentum.",requirements:{minLevel:8,requiredStats:{strength:15,dexterity:15}},effects:{damage:{min:6,max:12,type:"bludgeoning"},special:["combo","momentum"]},staminaCost:7,range:"touch"}],Master:[{description:"Perfect martial arts technique that flows like water.",requirements:{minLevel:12,requiredStats:{strength:16,dexterity:18,wisdom:15}},effects:{damage:{min:10,max:18,type:"force"},special:["flowing_strike","unblockable"]},staminaCost:10,cooldown:4,range:"touch"}],Legendary:[{description:"Transcendent fighting technique that channels inner power.",requirements:{minLevel:18,requiredStats:{strength:18,dexterity:20,wisdom:18}},effects:{damage:{min:18,max:30,type:"force"},special:["ki_strike","ignore_armor","heal_self"]},staminaCost:15,cooldown:8,range:"near"}]},Athletics:{Novice:[{description:"Enhanced climbing ability for scaling walls and cliffs.",requirements:{minLevel:1,requiredStats:{strength:10,dexterity:10}},effects:{special:["climb_speed","sure_grip"]},staminaCost:2,range:"self"},{description:"Improved jumping distance and height.",requirements:{minLevel:1,requiredStats:{strength:11}},effects:{special:["long_jump","high_jump"]},staminaCost:1,range:"self"}],Adept:[{description:"Parkour techniques for rapid urban movement.",requirements:{minLevel:4,requiredStats:{dexterity:14,constitution:12}},effects:{special:["wall_run","fast_movement","obstacle_ignore"]},staminaCost:3,range:"self"},{description:"Enhanced endurance for long-distance activities.",requirements:{minLevel:3,requiredStats:{constitution:14}},effects:{buff:{stat:"stamina_regen",modifier:2}},staminaCost:0,range:"self"}],Expert:[{description:"Acrobatic maneuvers that help avoid attacks.",requirements:{minLevel:7,requiredStats:{dexterity:16,constitution:13}},effects:{special:["evasion_boost","acrobatic_dodge","fall_immunity"]},staminaCost:5,range:"self"}],Master:[{description:"Superhuman athletic ability that defies normal limits.",requirements:{minLevel:11,requiredStats:{strength:16,dexterity:17,constitution:16}},effects:{special:["perfect_balance","superhuman_speed","tireless"]},staminaCost:8,range:"self"}],Legendary:[{description:"Legendary athletic prowess that approaches the mythical.",requirements:{minLevel:16,requiredStats:{strength:18,dexterity:20,constitution:18}},effects:{special:["legendary_speed","physics_defying","unstoppable_momentum"]},staminaCost:12,cooldown:6,range:"self"}]},Tactics:{Novice:[{description:"Basic leadership that inspires nearby allies.",requirements:{minLevel:2,requiredStats:{intelligence:12,charisma:11}},effects:{buff:{stat:"morale",modifier:1},special:["inspire"]},staminaCost:2,range:"near"},{description:"Tactical assessment of battlefield conditions.",requirements:{minLevel:1,requiredStats:{intelligence:13,wisdom:10}},effects:{special:["battle_awareness","enemy_analysis"]},staminaCost:1,range:"far"}],Adept:[{description:"Coordinated attack with allies for increased effectiveness.",requirements:{minLevel:5,requiredStats:{intelligence:14,charisma:12}},effects:{damage:{min:0,max:0},special:["coordinated_attack","ally_bonus"]},staminaCost:4,range:"near"},{description:"Defensive formation that protects the group.",requirements:{minLevel:4,requiredStats:{intelligence:13,constitution:12}},effects:{special:["formation_defense","damage_reduction"]},staminaCost:3,range:"near"}],Expert:[{description:"Advanced battlefield strategy that confuses enemies.",requirements:{minLevel:8,requiredStats:{intelligence:16,wisdom:14}},effects:{special:["strategic_advantage","enemy_confusion","initiative_control"]},staminaCost:6,range:"far"}],Master:[{description:"Masterful tactical command that turns the tide of battle.",requirements:{minLevel:12,requiredStats:{intelligence:18,charisma:16,wisdom:15}},effects:{special:["battle_mastery","ally_coordination","enemy_disruption"]},staminaCost:10,cooldown:5,range:"far"}],Legendary:[{description:"Legendary generalship that can win battles against impossible odds.",requirements:{minLevel:17,requiredStats:{intelligence:20,charisma:18,wisdom:17}},effects:{special:["legendary_tactics","army_inspiration","victory_inevitable"]},staminaCost:15,cooldown:10,range:"far"}]},Survival:{Novice:[{description:"Basic tracking skills for following creatures and people.",requirements:{minLevel:1,requiredStats:{wisdom:12,intelligence:10}},effects:{special:["track","identify_creatures"]},staminaCost:1,range:"far"},{description:"Foraging ability to find food and water in the wilderness.",requirements:{minLevel:1,requiredStats:{wisdom:13,constitution:10}},effects:{special:["forage","identify_plants"]},staminaCost:2,range:"near"}],Adept:[{description:"Advanced wilderness navigation that prevents getting lost.",requirements:{minLevel:4,requiredStats:{wisdom:14,intelligence:12}},effects:{special:["never_lost","weather_prediction","shortcut_finding"]},staminaCost:2,range:"self"},{description:"Animal communication for basic interaction with beasts.",requirements:{minLevel:5,requiredStats:{wisdom:15,charisma:12}},effects:{special:["animal_speech","beast_friendship","mount_training"]},staminaCost:3,range:"near"}],Expert:[{description:"Master tracker who can follow days-old trails.",requirements:{minLevel:8,requiredStats:{wisdom:16,constitution:13}},effects:{special:["master_tracking","scent_trail","predict_movement"]},staminaCost:4,range:"far"}],Master:[{description:"Legendary survival skills that allow thriving in any environment.",requirements:{minLevel:12,requiredStats:{wisdom:18,constitution:16,intelligence:14}},effects:{special:["environmental_adaptation","weather_immunity","resource_mastery"]},staminaCost:6,range:"self"}],Legendary:[{description:"Mythical connection to nature that grants supernatural survival abilities.",requirements:{minLevel:16,requiredStats:{wisdom:20,constitution:18,charisma:16}},effects:{special:["nature_bond","elemental_resistance","wilderness_mastery"]},staminaCost:10,cooldown:8,range:"far"}]},Stealth:{Novice:[{description:"Basic stealth techniques for moving unseen.",requirements:{minLevel:1,requiredStats:{dexterity:12}},effects:{special:["hide","move_silently"]},staminaCost:2,range:"self"},{description:"Simple lockpicking for basic locks and traps.",requirements:{minLevel:2,requiredStats:{dexterity:13,intelligence:10}},effects:{special:["lockpick","disable_trap"]},staminaCost:1,range:"touch"}],Adept:[{description:"Advanced stealth that works even in broad daylight.",requirements:{minLevel:4,requiredStats:{dexterity:15,wisdom:12}},effects:{special:["invisibility","shadow_step","crowd_blend"]},staminaCost:4,range:"self"},{description:"Sneak attack that deals extra damage from hiding.",requirements:{minLevel:5,requiredStats:{dexterity:14,strength:11}},effects:{damage:{min:6,max:12,type:"piercing"},special:["sneak_attack"]},staminaCost:3,range:"touch"}],Expert:[{description:"Master infiltration techniques for bypassing security.",requirements:{minLevel:8,requiredStats:{dexterity:17,intelligence:14}},effects:{special:["master_infiltration","security_bypass","disguise"]},staminaCost:6,range:"self"}],Master:[{description:"Legendary stealth that approaches true invisibility.",requirements:{minLevel:12,requiredStats:{dexterity:19,wisdom:15,intelligence:14}},effects:{special:["perfect_stealth","phase_walk","memory_erase"]},staminaCost:10,cooldown:4,range:"self"}],Legendary:[{description:"Mythical assassination technique that can kill with a single touch.",requirements:{minLevel:17,requiredStats:{dexterity:20,wisdom:17,intelligence:16}},effects:{damage:{min:50,max:100,type:"death"},special:["death_strike","untraceable","shadow_mastery"]},staminaCost:20,cooldown:15,range:"touch"}]},Defense:{Novice:[{description:"Basic shield blocking technique.",requirements:{minLevel:1,requiredStats:{strength:11,constitution:10},requiredEquipment:["shield"]},effects:{special:["block","damage_reduction_2"]},staminaCost:1,range:"self"},{description:"Defensive stance that reduces incoming damage.",requirements:{minLevel:2,requiredStats:{constitution:12}},effects:{special:["defensive_stance","damage_reduction_3"]},staminaCost:2,range:"self"}],Adept:[{description:"Shield bash that can stun opponents while defending.",requirements:{minLevel:4,requiredStats:{strength:13,constitution:12},requiredEquipment:["shield"]},effects:{damage:{min:2,max:5,type:"bludgeoning"},special:["stun","knockback"]},staminaCost:3,range:"touch"},{description:"Armor expertise that improves protection effectiveness.",requirements:{minLevel:5,requiredStats:{constitution:14,intelligence:11}},effects:{special:["armor_mastery","damage_reduction_5"]},staminaCost:0,range:"self"}],Expert:[{description:"Perfect parry that reflects attacks back at enemies.",requirements:{minLevel:8,requiredStats:{dexterity:16,constitution:14}},effects:{special:["perfect_parry","reflect_damage","counter_attack"]},staminaCost:5,range:"self"}],Master:[{description:"Legendary defense that makes the user nearly invulnerable.",requirements:{minLevel:12,requiredStats:{constitution:18,strength:15,dexterity:15}},effects:{special:["legendary_defense","damage_immunity","aegis_aura"]},staminaCost:12,cooldown:6,range:"self"}],Legendary:[{description:"Mythical protection that extends to allies and can turn the tide of battle.",requirements:{minLevel:16,requiredStats:{constitution:20,strength:17,charisma:16}},effects:{special:["divine_protection","ally_immunity","battlefield_aegis"]},staminaCost:18,cooldown:12,range:"far"}]},Berserker:{Novice:[{description:"Basic rage that increases damage but reduces defense.",requirements:{minLevel:2,requiredStats:{strength:12,constitution:11}},effects:{buff:{stat:"damage",modifier:3},special:["rage","defense_penalty"]},staminaCost:3,range:"self"},{description:"Intimidating roar that frightens nearby enemies.",requirements:{minLevel:1,requiredStats:{strength:11,charisma:10}},effects:{special:["fear","intimidate","morale_damage"]},staminaCost:2,range:"near"}],Adept:[{description:"Berserker frenzy that allows multiple attacks.",requirements:{minLevel:5,requiredStats:{strength:14,constitution:13}},effects:{damage:{min:4,max:8},special:["frenzy","extra_attacks","pain_ignore"]},staminaCost:6,range:"self"},{description:"Unstoppable charge that breaks through enemy lines.",requirements:{minLevel:4,requiredStats:{strength:13,constitution:12}},effects:{damage:{min:6,max:10,type:"bludgeoning"},special:["charge","knockdown","breakthrough"]},staminaCost:4,range:"near"}],Expert:[{description:"Primal fury that grows stronger as health decreases.",requirements:{minLevel:8,requiredStats:{strength:16,constitution:15}},effects:{special:["primal_fury","escalating_rage","death_resistance"]},staminaCost:8,range:"self"}],Master:[{description:"Legendary berserker state that makes one nearly unstoppable.",requirements:{minLevel:12,requiredStats:{strength:18,constitution:17}},effects:{damage:{min:15,max:25},special:["legendary_rage","unstoppable","fear_immunity"]},staminaCost:15,cooldown:8,range:"self"}],Legendary:[{description:"Mythical warrior state that channels primal forces of destruction.",requirements:{minLevel:17,requiredStats:{strength:20,constitution:19}},effects:{damage:{min:25,max:40},special:["apocalyptic_rage","area_destruction","immortal_fury"]},staminaCost:25,cooldown:15,range:"far"}]}};class ne{constructor(e){this.rng=void 0,this.rng=new X(e)}generateSpell(e,t){const n=ne.SPELL_TEMPLATES[e][t];if(!n||0===n.length)throw new Error("No templates found for ".concat(e," ").concat(t));const a=this.rng.pick(n),i=this.generateSpellName(e,t);return(0,r.A)({name:i,school:e,tier:t},a)}generateSpellName(e,t){const n=this.rng.pick({Cantrip:["Minor","Lesser","Simple","Basic","Apprentice"],Apprentice:["Improved","Enhanced","Refined","Focused","Practiced"],Adept:["Greater","Superior","Advanced","Powerful","Mastered"],Master:["Grand","Supreme","Ultimate","Perfect","Transcendent"],Archmage:["Divine","Cosmic","Reality","Omnipotent","Godlike"]}[t]),r=this.rng.pick({Evocation:["Bolt","Blast","Storm","Fury","Inferno","Lightning","Elemental Force"],Enchantment:["Blessing","Enhancement","Charm","Empowerment","Inspiration","Might"],Transmutation:["Transformation","Shaping","Alteration","Metamorphosis","Change","Form"],Divination:["Sight","Vision","Revelation","Knowledge","Truth","Perception","Awareness"],Conjuration:["Summoning","Creation","Manifestation","Portal","Gateway","Calling"],Necromancy:["Drain","Death","Decay","Soul","Undeath","Corruption","Life Steal"],Illusion:["Phantasm","Deception","Mirage","Dream","Shadow","Glamour","Trickery"],Abjuration:["Ward","Shield","Barrier","Protection","Defense","Sanctuary","Aegis"]}[e]);return"".concat(n," ").concat(r)}getAvailableSpells(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const a=[];for(const i of Object.keys(ne.SPELL_TEMPLATES))for(const o of Object.keys(ne.SPELL_TEMPLATES[i])){const s=ne.SPELL_TEMPLATES[i][o];for(const l of s){if(e<l.requirements.minLevel)continue;let s=!0;for(const[e,n]of Object.entries(l.requirements.requiredStats||{}))if((t[e]||0)<n){s=!1;break}if(!s)continue;if(l.requirements.requiredComponents){if(!l.requirements.requiredComponents.every(e=>n.some(t=>t.toLowerCase().includes(e.toLowerCase()))))continue}if(l.requirements.prerequisiteSpells){if(!l.requirements.prerequisiteSpells.every(e=>r.includes(e)))continue}const c=this.generateSpell(i,o);a.push(c)}}return a}generateSpellScroll(e){const t=e>=9?"Archmage":e>=7?"Master":e>=5?"Adept":e>=3?"Apprentice":"Cantrip",n=Object.keys(ne.SPELL_TEMPLATES),r=this.rng.pick(n),a=this.generateSpellName(r,t);return{name:"".concat(a," Scroll"),description:"A magical scroll containing the ".concat(a," spell from the ").concat(r," school of magic.")}}}ne.SPELL_TEMPLATES={Evocation:{Cantrip:[{description:"A small spark of flame that can light candles or deal minor damage.",requirements:{minLevel:1,requiredStats:{intelligence:10}},effects:{damage:{min:1,max:3,type:"fire"}},etherCost:1,range:"near"},{description:"A minor jolt of electricity that can shock enemies or power devices.",requirements:{minLevel:1,requiredStats:{intelligence:11}},effects:{damage:{min:1,max:4,type:"lightning"}},etherCost:1,range:"touch"}],Apprentice:[{description:"A bolt of searing flame that burns enemies.",requirements:{minLevel:3,requiredStats:{intelligence:13}},effects:{damage:{min:4,max:8,type:"fire"}},etherCost:3,range:"far"},{description:"Shards of ice that pierce through armor.",requirements:{minLevel:3,requiredStats:{intelligence:12,wisdom:11}},effects:{damage:{min:3,max:7,type:"ice"},special:["armor_pierce"]},etherCost:3,range:"far"}],Adept:[{description:"A devastating explosion of elemental energy.",requirements:{minLevel:6,requiredStats:{intelligence:15}},effects:{damage:{min:8,max:15,type:"elemental"},special:["area_effect"]},etherCost:6,range:"far"}],Master:[{description:"A storm of pure elemental fury that devastates the battlefield.",requirements:{minLevel:10,requiredStats:{intelligence:17,wisdom:14}},effects:{damage:{min:15,max:25,type:"elemental"},special:["area_effect","multi_element"]},etherCost:12,range:"sight"}],Archmage:[{description:"The ultimate expression of destructive magic, reshaping reality itself.",requirements:{minLevel:15,requiredStats:{intelligence:20,wisdom:16}},effects:{damage:{min:25,max:40,type:"reality"},special:["reality_warp","unstoppable"]},etherCost:20,range:"sight"}]},Enchantment:{Cantrip:[{description:"Enhances the caster's natural abilities temporarily.",requirements:{minLevel:1,requiredStats:{charisma:11}},effects:{buff:{stat:"all_stats",modifier:1,duration:10}},etherCost:1,range:"self"}],Apprentice:[{description:"Grants supernatural strength to the target.",requirements:{minLevel:3,requiredStats:{charisma:13,intelligence:11}},effects:{buff:{stat:"strength",modifier:3,duration:30}},etherCost:3,range:"touch"},{description:"Enhances the target's reflexes and agility.",requirements:{minLevel:3,requiredStats:{charisma:12,dexterity:12}},effects:{buff:{stat:"dexterity",modifier:3,duration:30}},etherCost:3,range:"touch"}],Adept:[{description:"Provides comprehensive enhancement to all physical capabilities.",requirements:{minLevel:6,requiredStats:{charisma:15,intelligence:13}},effects:{buff:{stat:"all_stats",modifier:2,duration:60}},etherCost:6,range:"near"}],Master:[{description:"Grants legendary abilities that transcend normal limitations.",requirements:{minLevel:10,requiredStats:{charisma:17,intelligence:15}},effects:{special:["legendary_enhancement","stat_transcendence"]},etherCost:12,duration:120,range:"near"}],Archmage:[{description:"Elevates the target to godlike levels of capability.",requirements:{minLevel:15,requiredStats:{charisma:20,intelligence:18}},effects:{special:["divine_enhancement","reality_transcendence"]},etherCost:20,duration:180,range:"sight"}]},Transmutation:{Cantrip:[{description:"Changes the basic properties of small objects.",requirements:{minLevel:1,requiredStats:{intelligence:12}},effects:{special:["minor_transmutation"]},etherCost:1,range:"touch"}],Apprentice:[{description:"Transforms basic materials into more valuable substances.",requirements:{minLevel:4,requiredStats:{intelligence:14,wisdom:12}},effects:{special:["material_transformation"]},etherCost:4,range:"touch"}],Adept:[{description:"Alters the fundamental structure of objects and beings.",requirements:{minLevel:7,requiredStats:{intelligence:16,wisdom:14}},effects:{special:["structural_alteration","living_transmutation"]},etherCost:7,range:"near"}],Master:[{description:"Completely reshapes matter according to the caster's will.",requirements:{minLevel:11,requiredStats:{intelligence:18,wisdom:16}},effects:{special:["matter_mastery","form_transcendence"]},etherCost:15,range:"far"}],Archmage:[{description:"Controls the fundamental forces that shape reality itself.",requirements:{minLevel:16,requiredStats:{intelligence:20,wisdom:19}},effects:{special:["reality_shaping","universal_transmutation"]},etherCost:25,range:"sight"}]},Divination:{Cantrip:[{description:"Reveals basic information about objects and creatures.",requirements:{minLevel:1,requiredStats:{wisdom:12}},effects:{special:["basic_detection"]},etherCost:1,range:"near"}],Apprentice:[{description:"Senses the presence of hidden things and creatures.",requirements:{minLevel:3,requiredStats:{wisdom:14,intelligence:11}},effects:{special:["true_sight","hidden_detection"]},etherCost:3,range:"far"}],Adept:[{description:"Peer into the past and future to gain knowledge.",requirements:{minLevel:6,requiredStats:{wisdom:16,intelligence:13}},effects:{special:["temporal_sight","knowledge_revelation"]},etherCost:6,range:"sight"}],Master:[{description:"Comprehends the deepest mysteries of existence.",requirements:{minLevel:10,requiredStats:{wisdom:18,intelligence:16}},effects:{special:["cosmic_awareness","universal_knowledge"]},etherCost:12,range:"sight"}],Archmage:[{description:"Achieves perfect understanding of all things across all realities.",requirements:{minLevel:15,requiredStats:{wisdom:20,intelligence:19}},effects:{special:["omniscience","reality_comprehension"]},etherCost:20,range:"sight"}]},Conjuration:{Cantrip:[{description:"Creates small objects from thin air.",requirements:{minLevel:1,requiredStats:{intelligence:11,charisma:10}},effects:{special:["minor_creation"]},etherCost:1,range:"near"}],Apprentice:[{description:"Summons helpful creatures to aid in battle.",requirements:{minLevel:3,requiredStats:{intelligence:13,charisma:12}},effects:{special:["summon_ally"]},etherCost:4,range:"near",duration:60}],Adept:[{description:"Opens portals to distant locations for rapid travel.",requirements:{minLevel:6,requiredStats:{intelligence:15,wisdom:13}},effects:{special:["teleportation","portal_creation"]},etherCost:8,range:"sight"}],Master:[{description:"Brings forth powerful entities from other planes.",requirements:{minLevel:10,requiredStats:{intelligence:17,charisma:16}},effects:{special:["planar_summoning","entity_binding"]},etherCost:15,range:"far",duration:120}],Archmage:[{description:"Commands the fundamental forces of creation itself.",requirements:{minLevel:15,requiredStats:{intelligence:19,charisma:18,wisdom:16}},effects:{special:["cosmic_creation","reality_summoning"]},etherCost:25,range:"sight",duration:240}]},Necromancy:{Cantrip:[{description:"Drains a small amount of life force from enemies.",requirements:{minLevel:1,requiredStats:{intelligence:11,constitution:10}},effects:{damage:{min:1,max:2,type:"necrotic"},healing:{min:1,max:2}},etherCost:1,range:"touch"}],Apprentice:[{description:"Animate the dead to serve as temporary minions.",requirements:{minLevel:4,requiredStats:{intelligence:13,constitution:12}},effects:{special:["animate_dead"]},etherCost:5,range:"near",duration:60}],Adept:[{description:"Steal years of life from enemies to extend your own.",requirements:{minLevel:7,requiredStats:{intelligence:15,constitution:14}},effects:{damage:{min:8,max:12,type:"life_drain"},healing:{min:4,max:6}},etherCost:8,range:"far"}],Master:[{description:"Command over death itself, raising powerful undead servants.",requirements:{minLevel:11,requiredStats:{intelligence:17,constitution:16}},effects:{special:["death_mastery","undead_legion"]},etherCost:15,range:"far",duration:240}],Archmage:[{description:"Transcend the boundary between life and death.",requirements:{minLevel:16,requiredStats:{intelligence:19,constitution:18}},effects:{special:["lichdom","death_transcendence","soul_mastery"]},etherCost:30,range:"sight"}]},Illusion:{Cantrip:[{description:"Create minor visual or auditory illusions.",requirements:{minLevel:1,requiredStats:{intelligence:10,charisma:11}},effects:{special:["minor_illusion"]},etherCost:1,range:"near"}],Apprentice:[{description:"Become invisible to most forms of detection.",requirements:{minLevel:3,requiredStats:{intelligence:12,dexterity:13}},effects:{special:["invisibility"]},etherCost:4,range:"self",duration:30}],Adept:[{description:"Create complex illusions that can fool multiple senses.",requirements:{minLevel:6,requiredStats:{intelligence:15,charisma:14}},effects:{special:["complex_illusion","mass_deception"]},etherCost:7,range:"far",duration:60}],Master:[{description:"Bend reality to create illusions indistinguishable from truth.",requirements:{minLevel:10,requiredStats:{intelligence:17,charisma:16,wisdom:14}},effects:{special:["reality_illusion","truth_deception"]},etherCost:12,range:"sight",duration:120}],Archmage:[{description:"Make illusions so perfect they become reality.",requirements:{minLevel:15,requiredStats:{intelligence:19,charisma:18,wisdom:17}},effects:{special:["illusion_reality","dream_manifestation"]},etherCost:20,range:"sight",duration:300}]},Abjuration:{Cantrip:[{description:"Creates a small protective barrier against harm.",requirements:{minLevel:1,requiredStats:{wisdom:11,constitution:10}},effects:{special:["minor_protection"]},etherCost:1,range:"self",duration:10}],Apprentice:[{description:"Dispels hostile magical effects and enchantments.",requirements:{minLevel:3,requiredStats:{wisdom:13,intelligence:11}},effects:{special:["dispel_magic"]},etherCost:3,range:"near"}],Adept:[{description:"Creates powerful wards that protect against multiple threats.",requirements:{minLevel:6,requiredStats:{wisdom:15,constitution:13}},effects:{special:["greater_ward","multi_protection"]},etherCost:6,range:"near",duration:120}],Master:[{description:"Establishes ultimate magical defenses that repel all harm.",requirements:{minLevel:10,requiredStats:{wisdom:17,constitution:16,intelligence:14}},effects:{special:["absolute_protection","harm_immunity"]},etherCost:12,range:"far",duration:180}],Archmage:[{description:"Becomes untouchable by mortal means through perfect magical defense.",requirements:{minLevel:15,requiredStats:{wisdom:20,constitution:18,intelligence:17}},effects:{special:["divine_protection","reality_shield"]},etherCost:20,range:"sight",duration:360}]}};class re{constructor(e,t,n,r,a){this.noise=void 0,this.rng=void 0,this.physicalAbilities=void 0,this.magicalSpells=void 0,this.chokepoints=new Map,this.regions=[],this.mapWidth=void 0,this.mapHeight=void 0,this.startX=void 0,this.startY=void 0;try{console.log("Initializing ChokepointManager with:",{seed:e,mapWidth:t,mapHeight:n,startX:r,startY:a}),this.noise=new $(e),this.rng=new X("".concat(e,"_chokepoints")),this.physicalAbilities=new te("".concat(e,"_abilities")),this.magicalSpells=new ne("".concat(e,"_spells")),this.mapWidth=t,this.mapHeight=n,this.startX=r,this.startY=a,console.log("Generating regions..."),this.generateRegions(),console.log("Identifying chokepoints..."),this.identifyChokepoints(),console.log("Placing fortifications..."),this.placeFortifications(),console.log("ChokepointManager initialized with ".concat(this.regions.length," regions and ").concat(this.chokepoints.size," chokepoints"))}catch(i){console.error("Error in ChokepointManager constructor:",i),this.noise=new $(e),this.rng=new X("".concat(e,"_chokepoints")),this.mapWidth=t,this.mapHeight=n,this.startX=r,this.startY=a,this.regions=[],this.chokepoints=new Map}}generateRegions(){try{this.rng.nextInt(6,12);const t=Math.min(this.mapWidth,this.mapHeight)/4;this.regions.push({centerX:this.startX,centerY:this.startY,radius:.6*t,difficultyLevel:1,biomePreference:["Grass","Forest","Coast"],name:"The Heartlands",description:"Peaceful starting region with friendly settlements and basic resources."});const n=[{distance:1.2*t,level:2,count:3},{distance:1.8*t,level:4,count:4},{distance:2.5*t,level:6,count:3},{distance:3.2*t,level:8,count:2}];for(const r of n)for(let n=0;n<r.count;n++)try{const e=2*Math.PI*n/r.count+this.rng.nextFloat(-.3,.3),a=r.distance*this.rng.nextFloat(.8,1.2),i=this.startX+Math.cos(e)*a,o=this.startY+Math.sin(e)*a,s=100,l=Math.max(s,Math.min(this.mapWidth-s,i)),c=Math.max(s,Math.min(this.mapHeight-s,o));this.regions.push({centerX:l,centerY:c,radius:.4*t,difficultyLevel:r.level,biomePreference:this.getBiomesForDifficulty(r.level),name:this.generateRegionName(r.level),description:this.generateRegionDescription(r.level)})}catch(e){console.warn("Error generating region in ring:",r,e)}console.log("Generated ".concat(this.regions.length," regions"))}catch(e){console.error("Error in generateRegions:",e),0===this.regions.length&&this.regions.push({centerX:this.startX,centerY:this.startY,radius:500,difficultyLevel:1,biomePreference:["Grass","Forest"],name:"The Starting Lands",description:"A safe region for new adventurers."})}}getBiomesForDifficulty(e){return e<=2?["Grass","Forest","Coast","Savanna"]:e<=4?["Forest","Taiga","Swamp","Mountain"]:e<=6?["Mountain","Desert","Tundra","Jungle"]:["Mountain","Snow","Desert","Tundra"]}generateRegionName(e){const t={2:["The Borderlands","Merchant's Rest","The Greenwood","Pilgrim's Path"],4:["The Wildlands","Thornmarch","The Disputed Lands","Ravenwood"],6:["The Bleaklands","Dragonspine Mountains","The Cursed Marsh","Doomheath"],8:["The Shattered Realms","The Bone Wastes","Hellfire Peaks","The Dread Expanse"],10:["The Void Touched","World's End","The Final Dark","Apocalypse Gate"]},n=t[e]||t[8];return this.rng.pick(n)}generateRegionDescription(e){const t={2:"A frontier region with scattered settlements and minor dangers.",4:"Dangerous wilderness requiring caution and proper preparation.",6:"Hostile territory where only experienced adventurers survive.",8:"A realm of nightmares where death lurks behind every shadow.",10:"The ultimate challenge - where legends are born or die."};return t[e]||t[8]}identifyChokepoints(){try{console.log("Starting chokepoint identification...");let t=0;for(let n=0;n<this.regions.length;n++)for(let r=n+1;r<this.regions.length;r++)try{const e=this.regions[n],a=this.regions[r],i=Math.abs(e.difficultyLevel-a.difficultyLevel);if(i<=1&&i>0){t+=this.findChokepointsBetweenRegions(e,a)}}catch(e){console.warn("Error finding chokepoints between regions:",n,r,e)}console.log("Found ".concat(t," chokepoints between ").concat(this.regions.length," regions"))}catch(e){console.error("Error in identifyChokepoints:",e)}}findChokepointsBetweenRegions(e,t){try{const r=t.centerX-e.centerX,a=t.centerY-e.centerY,i=Math.sqrt(r*r+a*a),o=Math.max(5,Math.min(20,Math.floor(i/20)));let s=0;for(let l=1;l<o;l++)try{const n=l/o,i=Math.floor(e.centerX+r*n),c=Math.floor(e.centerY+a*n);if(i>=0&&i<this.mapWidth&&c>=0&&c<this.mapHeight&&this.isNaturalChokepoint(i,c)){const e=this.determineChokepointType(i,c),n={x:i,y:c,type:e,width:this.calculateChokepointWidth(i,c,e),fortified:!1,controlsAccess:[t.name],fortification:void 0};this.chokepoints.set("".concat(i,",").concat(c),n),s++}}catch(n){console.warn("Error processing chokepoint sample:",l,n)}return s}catch(n){return console.error("Error in findChokepointsBetweenRegions:",n),0}}isNaturalChokepoint(e,t){try{const n=this.noise.getElevation(e,t),r=this.noise.getMoisture(e,t,n);if(isNaN(n)||isNaN(r))return!1;const a=[];for(let o=-3;o<=3;o++)for(let n=-3;n<=3;n++){if(0===o&&0===n)continue;const r=e+o,i=t+n;if(r>=0&&r<this.mapWidth&&i>=0&&i<this.mapHeight){const e=this.noise.getElevation(r,i);isNaN(e)||a.push(e)}}if(0===a.length)return!1;const i=a.reduce((e,t)=>e+t,0)/a.length;if(n>.6&&i<n-.2)return!0;if(n>.35&&n<.5&&r>.7){const n=Math.abs(this.getElevationSafe(e-2,t)-this.getElevationSafe(e+2,t)),r=Math.abs(this.getElevationSafe(e,t-2)-this.getElevationSafe(e,t+2));if(Math.max(n,r)>.1)return!0}if(n>.32&&n<.42){let n=0;for(let r=-2;r<=2;r++)for(let a=-2;a<=2;a++)this.getElevationSafe(e+r,t+a)<.35&&n++;if(n>15)return!0}return!1}catch(n){return console.warn("Error checking natural chokepoint at",e,t,":",n),!1}}getElevationSafe(e,t){if(e<0||e>=this.mapWidth||t<0||t>=this.mapHeight)return.5;try{return this.noise.getElevation(e,t)}catch(n){return.5}}determineChokepointType(e,t){const n=this.noise.getElevation(e,t),r=this.noise.getMoisture(e,t,n);return n>.6?"pass":n<.4&&r>.7?"bridge":n<.42?"strait":n>.5&&r<.3?"canyon":this.rng.pick(["bridge","pass","canyon"])}calculateChokepointWidth(e,t,n){return{bridge:2,pass:4,strait:3,canyon:3,tunnel:2,gate:5}[n]+this.rng.nextInt(-1,2)}placeFortifications(){try{console.log("Starting fortification placement...");const t=Array.from(this.chokepoints.values()).sort((e,t)=>this.getDistanceFromStart(e.x,e.y)-this.getDistanceFromStart(t.x,t.y));let n=0;const r=Math.min(8,t.length);for(const a of t){if(n>=r)break;try{const e=this.getDistanceFromStart(a.x,a.y);if(this.shouldPlaceFortification(a,e)){const t=this.calculateFortificationDifficulty(e);a.fortified=!0,a.fortification=this.createFortification(a,t),n++}}catch(e){console.warn("Error placing fortification at chokepoint:",a,e)}}console.log("Placed ".concat(n," fortifications out of ").concat(t.length," chokepoints"))}catch(e){console.error("Error in placeFortifications:",e)}}getDistanceFromStart(e,t){const n=e-this.startX,r=t-this.startY;return Math.sqrt(n*n+r*r)}shouldPlaceFortification(e,t){if(t<Math.min(this.mapWidth,this.mapHeight)/8)return!1;if(e.width<=2)return!0;const n=this.calculateStrategicValue(e);return this.rng.nextFloat()<n}calculateStrategicValue(e){let t=.3;return t+=.1*(5-e.width),"pass"!==e.type&&"bridge"!==e.type||(t+=.3),t+=.2*e.controlsAccess.length,Math.min(.9,t)}calculateFortificationDifficulty(e){const t=e/(Math.sqrt(this.mapWidth*this.mapWidth+this.mapHeight*this.mapHeight)/2);return Math.max(1,Math.min(10,Math.floor(8*t)+1))}createFortification(e,t){const n=t>=8?"citadel":t>=6?"keep":t>=4?"wall":t>=2?"watchtower":"barricade",r=this.generateFortificationNames(n,t),a=this.rng.pick(r);return{name:a,level:t,type:n,garrison:10*t+this.rng.nextInt(5,15),requiredLevel:Math.max(1,t-1),requiredGear:this.getRequiredGear(e,t),rewards:this.generateRewards(t),cleared:!1,description:this.generateFortificationDescription(a,n,e)}}generateFortificationNames(e,t){const n=t>=6?["Dread","Death","Shadow","Doom","Blood","Iron","Dark"]:["Stone","Iron","Grey","Old","High","White","Red"],r={keep:["Keep","Hold","Fort","Stronghold"],watchtower:["Tower","Spire","Watch","Beacon"],wall:["Wall","Gate","Barrier","Passage"],barricade:["Barricade","Block","Obstruction"],outpost:["Outpost","Station","Checkpoint"],citadel:["Citadel","Fortress","Bastion","Stronghold"]}[e],a=[];for(const i of n.slice(0,3))for(const e of r)a.push("".concat(i," ").concat(e));return a}getRequiredGear(e,t){const n=[];return"bridge"!==e.type&&"strait"!==e.type||(t>=3&&n.push("rope"),t>=5&&n.push("boat")),"pass"!==e.type&&"canyon"!==e.type||(t>=2&&n.push("climbing_gear"),t>=6&&n.push("cold_weather_gear")),t>=4&&n.push("siege_equipment"),t>=7&&n.push("magical_weapons"),n}generateRewards(e){const t=[];if(t.push({type:"gold",name:"Garrison Treasury",value:100*e+this.rng.nextInt(50,150),description:"Gold looted from the defeated garrison."}),e>=3&&t.push({type:"equipment",name:this.generateEquipmentName(e),value:e,description:"High-quality equipment from the fortress armory."}),e>=5){const n=this.magicalSpells.generateSpellScroll(e);t.push({type:"spell",name:n.name,value:e,description:n.description})}if(e>=4){const n=this.physicalAbilities.generateAbilityScroll(e);t.push({type:"spell",name:n.name,value:e,description:n.description})}return e>=4&&t.push({type:"key",name:"Key to the ".concat(this.rng.pick(["Eastern","Northern","Western","Southern"])," Passage"),value:1,description:"Opens access to previously blocked routes."}),t}generateEquipmentName(e){const t=e>=6?["Legendary","Mythic","Divine","Runic"]:["Fine","Masterwork","Enchanted","Superior"];return"".concat(this.rng.pick(t)," ").concat(this.rng.pick(["Sword","Shield","Armor","Bow","Staff","Hammer","Axe"]))}generateSpellName(e){return"".concat(e>=8?"Greater":e>=6?"Major":"Lesser"," ").concat(this.rng.pick(["Fireball","Lightning Bolt","Ice Storm","Healing","Barrier","Teleport"]))}generateFortificationDescription(e,t,n){return"".concat({keep:"A massive stone fortress",watchtower:"A tall defensive tower",wall:"A fortified wall with iron gates",barricade:"A sturdy wooden barrier",outpost:"A military checkpoint",citadel:"An impregnable fortress complex"}[t]," ").concat({bridge:"guarding the only safe river crossing",pass:"controlling the mountain pass",strait:"watching over the narrow strait",canyon:"blocking the canyon passage",tunnel:"sealing the underground route",gate:"barring the ancient gateway"}[n.type],". The ").concat(e," has stood for centuries, its garrison ensuring that only the worthy may pass.")}getChokepoints(){return Array.from(this.chokepoints.values())}getChokepointAt(e,t){return this.chokepoints.get("".concat(e,",").concat(t))}getRegions(){return this.regions}getRegionAt(e,t){for(const n of this.regions){const r=e-n.centerX,a=t-n.centerY;if(Math.sqrt(r*r+a*a)<=n.radius)return n}}isRouteBlocked(e,t,n,r){const a=[],i=n-e,o=r-t,s=Math.sqrt(i*i+o*o),l=Math.floor(s);for(let d=0;d<=l;d++){var c;const n=d/l,r=Math.floor(e+i*n),s=Math.floor(t+o*n),u=this.getChokepointAt(r,s);null===u||void 0===u||!u.fortified||null!==(c=u.fortification)&&void 0!==c&&c.cleared||a.push(u)}return a}clearFortification(e,t){const n=this.getChokepointAt(e,t);return!(null===n||void 0===n||!n.fortification||n.fortification.cleared)&&(n.fortification.cleared=!0,!0)}}class ae{constructor(e,t){this.chunkManager=void 0,this.chokepointManager=null,this.physicalAbilities=void 0,this.magicalSpells=void 0,this.rng=void 0,this.state=void 0,this.loadedFromSave=!1;const n=u.local.getItem("world-engine-save");if(n)try{console.log("Found existing save, loading from storage.local...");if(this.loadFromStorage(n))return console.log("Successfully loaded existing game!"),void(this.loadedFromSave=!0)}catch(r){console.warn("Failed to load existing save, creating new game:",r),u.local.removeItem("world-engine-save")}console.log("Creating new game..."),this.loadedFromSave=!1,this.createNewGame(e,t)}createNewGame(e,t){const n=e||this.generateSeed();this.rng=new X("".concat(n,"_engine"));const a={seaLevel:0,continentFreq:1/1024,featureFreq:1/128,warpStrength:700,mapWidth:2048,mapHeight:2048},i={movementCostPerTile:15,encounterBaseChance:.15,weatherChangeDays:3,fogOfWarRadius:8,chunkLoadRadius:32,chunkUnloadRadius:64},o={world:(0,r.A)((0,r.A)({},a),null===t||void 0===t?void 0:t.world),gameplay:(0,r.A)((0,r.A)({},i),null===t||void 0===t?void 0:t.gameplay)};this.chunkManager=new ee(n,o.world),this.physicalAbilities=new te(n),this.magicalSpells=new ne(n);try{console.log("Initializing chokepoint system..."),this.chokepointManager=new re(n,o.world.mapWidth,o.world.mapHeight,o.world.mapWidth/2,o.world.mapHeight/2),console.log("Chokepoint system initialized successfully")}catch(d){console.error("Failed to initialize chokepoint system:",d),this.chokepointManager=null}const s=this.findLandSpawnLocation(o.world.mapWidth,o.world.mapHeight,o.world.seaLevel),l=this.chunkManager.getTile(s.x,s.y),c=!l||"Ocean"===l.biome;console.log("Final spawn location:",s.x,s.y),console.log("Spawn tile biome:",(null===l||void 0===l?void 0:l.biome)||"null"),console.log("Needs boat:",c||s.needsBoat),this.state={seed:n,party:{x:s.x,y:s.y,members:[],supplies:{food:100,water:100,gold:50},equipment:c||s.needsBoat?["boat"]:[],speed:1,hitPoints:100,maxHitPoints:100,level:1,experience:0,knownAbilities:[],knownSpells:[],stats:{strength:12,dexterity:12,constitution:12,intelligence:12,wisdom:12,charisma:12},stamina:20,maxStamina:20,ether:15,maxEther:15},characters:[],time:{minutes:480,day:1,season:"Spring",year:1},weather:this.generateWeather(s.x,s.y,n,1),encounterClock:{riskLevel:0,lastEncounter:0,encounterChance:o.gameplay.encounterBaseChance},activeEncounter:null,completedEncounters:new Set,discovered:new Set,config:o,version:"1.0.0"},this.discoverRadius(this.state.party.x,this.state.party.y,3),this.createMainCity(this.state.party.x,this.state.party.y),this.autoSave()}loadFromStorage(e){try{const n=JSON.parse(e);this.chunkManager=new ee(n.seed,n.config.world),this.physicalAbilities=new te(n.seed),this.magicalSpells=new ne(n.seed),this.rng=new X("".concat(n.seed,"_engine"));try{this.chokepointManager=new re(n.seed,n.config.world.mapWidth,n.config.world.mapHeight,n.config.world.mapWidth/2,n.config.world.mapHeight/2)}catch(t){console.error("Failed to recreate chokepoint manager during load:",t),this.chokepointManager=null}return this.state=(0,r.A)((0,r.A)({},n),{},{discovered:new Set(n.discovered)}),console.log("Game loaded successfully! Seed: ".concat(this.state.seed,", Characters: ").concat(this.state.characters.length)),!0}catch(t){return console.error("Failed to load game state:",t),!1}}autoSave(){try{const e=this.save();u.local.setItem("world-engine-save",e),console.log("Game auto-saved to storage.local")}catch(e){console.error("Failed to auto-save game:",e)}}findLandSpawnLocation(e,t,n){console.log("Finding suitable spawn location...");const r=[{x:Math.floor(.25*e),y:Math.floor(.25*t)},{x:Math.floor(.75*e),y:Math.floor(.75*t)},{x:Math.floor(.25*e),y:Math.floor(.75*t)},{x:Math.floor(.75*e),y:Math.floor(.25*t)},{x:Math.floor(.4*e),y:Math.floor(.3*t)},{x:Math.floor(.6*e),y:Math.floor(.7*t)},{x:Math.floor(.3*e),y:Math.floor(.6*e)},{x:Math.floor(.7*e),y:Math.floor(.4*e)},{x:Math.floor(.5*e),y:Math.floor(.3*t)},{x:Math.floor(.3*e),y:Math.floor(.5*t)}];console.log("Trying strategic land candidates with sea level",n,"...");for(const i of r){console.log("Testing candidate:",i.x,i.y),this.chunkManager.ensureRadius(i.x,i.y,3);const e=this.chunkManager.getTile(i.x,i.y);if(console.log("Candidate tile details:"),console.log("  Position:",i.x,i.y),console.log("  Biome:",(null===e||void 0===e?void 0:e.biome)||"null"),console.log("  Elevation:",(null===e||void 0===e?void 0:e.elevation)||"null"),console.log("  Temperature:",(null===e||void 0===e?void 0:e.temperature)||"null"),console.log("  Moisture:",(null===e||void 0===e?void 0:e.moisture)||"null"),console.log("  Sea level config:",n),e&&"Ocean"!==e.biome)return console.log("\u2713 Found land spawn at:",i.x,i.y,"Biome:",e.biome),{x:i.x,y:i.y,needsBoat:!1}}const a=r[0];return console.log("All land searches failed, spawning with boat at:",a.x,a.y),{x:a.x,y:a.y,needsBoat:!0}}generateSeed(){return i.Sh.next().toString(36).substring(2,15)}tickTravel(e,t){const n=Math.round(this.state.party.x+e),r=Math.round(this.state.party.y+t);if(n<0||n>=this.state.config.world.mapWidth||r<0||r>=this.state.config.world.mapHeight)return!1;const a=this.chunkManager.getTile(n,r);if(!a)return!1;if("Ocean"===a.biome&&!this.hasBoat())return!1;const i=this.state.config.gameplay.movementCostPerTile,o=this.getTerrainMovementModifier(a),s=this.state.weather.movementModifier,l=Math.round(i*o*s/this.state.party.speed);return this.state.party.x=n,this.state.party.y=r,this.advanceTime(l),this.discoverRadius(n,r,this.state.config.gameplay.fogOfWarRadius),this.ensureRadius(this.state.config.gameplay.chunkLoadRadius),this.updateEncounterRisk(a,l),this.checkForEncounter(a),this.updateWeather(),this.autoSave(),!0}hasBoat(){return this.state.party.equipment.includes("boat")||this.state.party.equipment.includes("ship")}getTerrainMovementModifier(e){let t={Ocean:.3,Coast:.8,Grass:1,Forest:.7,Jungle:.5,Savanna:1.1,Desert:.6,Taiga:.8,Tundra:.7,Swamp:.4,Mountain:.3,Snow:.5}[e.biome]||1;return e.road&&(t*=1.5),e.river&&!e.road&&(t*=.8),t}advanceTime(e){for(this.state.time.minutes+=e;this.state.time.minutes>=1440;)if(this.state.time.minutes-=1440,this.state.time.day++,this.state.time.day>90){this.state.time.day=1;const e=["Spring","Summer","Autumn","Winter"],t=e.indexOf(this.state.time.season);3===t?(this.state.time.season="Spring",this.state.time.year++):this.state.time.season=e[t+1]}}discoverRadius(e,t,n){const r=this.state.weather.visibility,a=Math.floor(n*r);for(let i=-a;i<=a;i++)for(let n=-a;n<=a;n++){if(Math.sqrt(i*i+n*n)<=a){const r=e+i,a=t+n;r>=0&&r<this.state.config.world.mapWidth&&a>=0&&a<this.state.config.world.mapHeight&&this.state.discovered.add("".concat(r,",").concat(a))}}}ensureRadius(e){this.chunkManager.ensureRadius(this.state.party.x,this.state.party.y,e),this.chunkManager.unloadBeyond(this.state.party.x,this.state.party.y,this.state.config.gameplay.chunkUnloadRadius)}updateEncounterRisk(e,t){let n=t/60*.02*({Ocean:.2,Coast:.5,Grass:1,Forest:1.3,Jungle:1.5,Savanna:1.1,Desert:.8,Taiga:1.2,Tundra:.7,Swamp:1.4,Mountain:1.6,Snow:.6}[e.biome]||1);e.road&&(n*=.5),e.settlement&&(n=0),this.state.encounterClock.riskLevel=Math.min(1,this.state.encounterClock.riskLevel+n)}generateWeather(e,t,n,a){var i,o,s,l,c,d,u,h,p,m,f;const g=null!==(i=null!==e&&void 0!==e?e:null===(o=this.state)||void 0===o||null===(s=o.party)||void 0===s?void 0:s.x)&&void 0!==i?i:1024,y=null!==(l=null!==t&&void 0!==t?t:null===(c=this.state)||void 0===c||null===(d=c.party)||void 0===d?void 0:d.y)&&void 0!==l?l:1024,x=null!==(u=null!==n&&void 0!==n?n:null===(h=this.state)||void 0===h?void 0:h.seed)&&void 0!==u?u:"default",v=null!==(p=null!==a&&void 0!==a?a:null===(m=this.state)||void 0===m||null===(f=m.time)||void 0===f?void 0:f.day)&&void 0!==p?p:1,b=this.chunkManager.getTile(g,y);if(!b)return{type:"Clear",intensity:0,duration:480,visibility:1,movementModifier:1};const w=new X("".concat(x,"_weather_").concat(v)),k=this.getBiomeWeatherChances(b.biome),S=w.nextFloat();let j="Clear",C=0;for(const[r,A]of Object.entries(k))if(C+=A,S<=C){j=r;break}const M=w.nextFloat(.3,1),T=w.nextInt(240,720);return(0,r.A)({type:j,intensity:M,duration:T},this.getWeatherEffects(j,M))}getBiomeWeatherChances(e){const t={Ocean:{Clear:.5,Rain:.3,Storm:.1,Wind:.1},Coast:{Clear:.6,Rain:.25,Wind:.1,Fog:.05},Grass:{Clear:.7,Rain:.2,Wind:.1},Forest:{Clear:.6,Rain:.3,Fog:.1},Jungle:{Clear:.4,Rain:.5,Storm:.1},Desert:{Clear:.8,Wind:.15,Storm:.05},Mountain:{Clear:.5,Snow:.2,Wind:.2,Storm:.1},Snow:{Clear:.4,Snow:.4,Wind:.2},Tundra:{Clear:.5,Snow:.3,Wind:.2},Taiga:{Clear:.6,Snow:.2,Rain:.1,Wind:.1},Swamp:{Clear:.4,Rain:.3,Fog:.3},Savanna:{Clear:.7,Rain:.2,Wind:.1}};return t[e]||t.Grass}getWeatherEffects(e,t){const n={Clear:{visibility:1,movementModifier:1},Rain:{visibility:.8,movementModifier:.8},Snow:{visibility:.6,movementModifier:.6},Fog:{visibility:.3,movementModifier:.9},Wind:{visibility:1,movementModifier:.9},Storm:{visibility:.4,movementModifier:.5}}[e];return{visibility:Math.max(.1,n.visibility-.2*(1-t)),movementModifier:Math.max(.3,n.movementModifier-.2*(t-.5))}}updateWeather(){this.state.weather.duration--,this.state.weather.duration<=0&&(this.state.weather=this.generateWeather())}rest(e){this.advanceTime(60*e),this.state.encounterClock.riskLevel=Math.max(0,this.state.encounterClock.riskLevel-.3);const t=10*e;this.state.party.hitPoints=Math.min(this.state.party.maxHitPoints,this.state.party.hitPoints+t);const n=5*e;this.state.party.stamina=Math.min(this.state.party.maxStamina,this.state.party.stamina+n);const r=3*e;this.state.party.ether=Math.min(this.state.party.maxEther,this.state.party.ether+r);for(let a=0;a<e;a++)this.updateWeather()}takeDamage(e){return this.state.party.hitPoints=Math.max(0,this.state.party.hitPoints-e),this.state.party.hitPoints>0}heal(e){this.state.party.hitPoints=Math.min(this.state.party.maxHitPoints,this.state.party.hitPoints+e)}getTile(e,t){return this.chunkManager.getTile(e,t)}isDiscovered(e,t){return this.state.discovered.has("".concat(e,",").concat(t))}getTimeOfDay(){return this.state.time.minutes%1440/1440}getStats(){const e=Math.floor(this.state.time.minutes/60)%24,t=this.state.time.minutes%60;return{chunks:this.chunkManager.getStats(),discovered:this.state.discovered.size,timeOfDay:this.getTimeOfDay(),gameTime:"Day ".concat(this.state.time.day,", ").concat(this.state.time.season," Year ").concat(this.state.time.year," - ").concat(e.toString().padStart(2,"0"),":").concat(t.toString().padStart(2,"0"))}}wasLoadedFromSave(){return this.loadedFromSave}save(){const e=(0,r.A)((0,r.A)({},this.state),{},{discovered:Array.from(this.state.discovered)});return JSON.stringify(e,null,2)}load(e){try{const n=JSON.parse(e);this.chunkManager=new ee(n.seed,n.config.world);try{this.chokepointManager=new re(n.seed,n.config.world.mapWidth,n.config.world.mapHeight,n.config.world.mapWidth/2,n.config.world.mapHeight/2)}catch(t){console.error("Failed to recreate chokepoint manager during load:",t),this.chokepointManager=null}return this.rng=new X("".concat(n.seed,"_engine")),this.state=(0,r.A)((0,r.A)({},n),{},{discovered:new Set(n.discovered)}),this.ensureRadius(this.state.config.gameplay.chunkLoadRadius),this.loadedFromSave=!0,!0}catch(t){return console.error("Failed to load save data:",t),!1}}updateWorldConfig(e){this.state.config.world=(0,r.A)((0,r.A)({},this.state.config.world),e),this.chunkManager.updateConfig(this.state.config.world),this.chunkManager.invalidateAll();try{this.chokepointManager=new re(this.state.seed,this.state.config.world.mapWidth,this.state.config.world.mapHeight,this.state.config.world.mapWidth/2,this.state.config.world.mapHeight/2)}catch(t){console.error("Failed to recreate chokepoint manager:",t),this.chokepointManager=null}this.state.discovered.clear(),this.discoverRadius(this.state.party.x,this.state.party.y,this.state.config.gameplay.fogOfWarRadius)}getChokepoints(){var e;return(null===(e=this.chokepointManager)||void 0===e?void 0:e.getChokepoints())||[]}getChokepointAt(e,t){var n;return null===(n=this.chokepointManager)||void 0===n?void 0:n.getChokepointAt(e,t)}getRegions(){var e;return(null===(e=this.chokepointManager)||void 0===e?void 0:e.getRegions())||[]}getRegionAt(e,t){var n;return null===(n=this.chokepointManager)||void 0===n?void 0:n.getRegionAt(e,t)}checkTravelBlockage(e,t){var n;return(null===(n=this.chokepointManager)||void 0===n?void 0:n.isRouteBlocked(this.state.party.x,this.state.party.y,e,t))||[]}attemptFortificationClear(e,t){const n=this.getChokepointAt(e,t);if(null===n||void 0===n||!n.fortification||n.fortification.cleared)return{success:!1};const r=n.fortification,a=Math.max(1,Math.floor(this.state.time.day/30)),i=r.requiredGear.every(e=>this.state.party.equipment.includes(e));if(a>=r.requiredLevel&&i){var o;if(null===(o=this.chokepointManager)||void 0===o?void 0:o.clearFortification(e,t)){for(const e of r.rewards)"gold"===e.type?this.state.party.supplies.gold+=e.value:"equipment"===e.type&&this.state.party.equipment.push(e.name);return{success:!0,fortification:r,rewards:r.rewards}}}return{success:!1,fortification:r}}getCurrentRegion(){return this.getRegionAt(this.state.party.x,this.state.party.y)}canTravelTo(e,t){const n=this.checkTravelBlockage(e,t);if(0===n.length)return{canTravel:!0,blockedBy:[]};const r=n.filter(e=>e.fortified&&e.fortification&&!e.fortification.cleared);if(r.length>0){const e=r.map(e=>{var t;return null===(t=e.fortification)||void 0===t?void 0:t.name}).filter(Boolean).join(", ");return{canTravel:!1,blockedBy:r,reason:"Path blocked by fortification(s): ".concat(e)}}return{canTravel:!0,blockedBy:[]}}createMainCity(e,t){const n=this.chunkManager.getTile(e,t);if(n){n.settlement={name:this.generateCityName(),population:this.rng.nextInt(5e3,15e3),size:"city",faction:"Capital"};for(let n=-1;n<=1;n++)for(let r=-1;r<=1;r++){const a=this.chunkManager.getTile(e+n,t+r);a&&"Ocean"===a.biome&&(a.biome="Coast")}}}generateCityName(){const e=["Haven","Storm","River","Gold","Stone","Iron","Silver","White","Black","Red"],t=["port","hold","burg","haven","ford","gate","fall","ridge","vale","watch"],n=e[this.rng.nextInt(0,e.length-1)],r=t[this.rng.nextInt(0,t.length-1)];return"".concat(n).concat(r)}checkForEncounter(e){var t;if("city"===(null===(t=e.settlement)||void 0===t?void 0:t.size))return;const n=this.getFixedEncounterAt(this.state.party.x,this.state.party.y);if(n&&!this.state.completedEncounters.has(n.id))return void(this.state.activeEncounter=n);if(this.rng.nextFloat()<=this.state.encounterClock.riskLevel*this.state.encounterClock.encounterChance){const t=this.generateRandomEncounter(e);t&&(this.state.activeEncounter=t,this.state.encounterClock.riskLevel=Math.max(0,this.state.encounterClock.riskLevel-.5),this.state.encounterClock.lastEncounter=this.state.time.minutes)}}generateRandomEncounter(e){const t=[];switch(e.biome){case"Forest":t.push({name:"Forest Bandits",type:"combat",danger:"medium",description:"A group of bandits emerges from the trees, demanding your coin.",biome:"Forest",rewards:{gold:50,experience:75}},{name:"Lost Traveler",type:"event",danger:"safe",description:"A confused traveler asks for directions to the nearest town.",biome:"Forest",rewards:{experience:25}},{name:"Ancient Grove",type:"discovery",danger:"safe",description:"You discover an ancient grove with mystical properties.",biome:"Forest",rewards:{experience:100}});break;case"Grass":t.push({name:"Wild Wolves",type:"combat",danger:"low",description:"A pack of hungry wolves blocks your path.",biome:"Grass",rewards:{experience:50}},{name:"Merchant Caravan",type:"trader",danger:"safe",description:"A friendly merchant offers to trade goods.",biome:"Grass",rewards:{experience:25}});break;case"Mountain":t.push({name:"Mountain Trolls",type:"combat",danger:"high",description:"Massive trolls emerge from rocky caves, brandishing crude weapons.",biome:"Mountain",rewards:{gold:100,experience:150}},{name:"Hidden Cave",type:"discovery",danger:"medium",description:"You discover a cave that might contain treasure... or danger.",biome:"Mountain",rewards:{gold:75,experience:100}});break;case"Desert":t.push({name:"Desert Nomads",type:"event",danger:"safe",description:"Desert nomads offer to share their water and knowledge.",biome:"Desert",rewards:{experience:50}},{name:"Sandstorm Mirage",type:"discovery",danger:"low",description:"A mirage reveals the location of an oasis.",biome:"Desert",rewards:{experience:75}});break;case"Swamp":t.push({name:"Swamp Wraiths",type:"combat",danger:"high",description:"Ghostly figures rise from the murky waters.",biome:"Swamp",rewards:{experience:125,items:["Spirit Essence"]}});break;default:t.push({name:"Strange Weather",type:"event",danger:"safe",description:"Unusual weather patterns create an interesting phenomenon.",rewards:{experience:30}})}if(0===t.length)return null;const n=t[this.rng.nextInt(0,t.length-1)];return(0,r.A)({id:"random_".concat(this.state.party.x,"_").concat(this.state.party.y,"_").concat(this.state.time.day,"_").concat(Date.now()),x:this.state.party.x,y:this.state.party.y,isFixed:!1,isActive:!0},n)}getFixedEncounterAt(e,t){return[{id:"dragon_lair_1000_1000",name:"Ancient Dragon Lair",type:"combat",danger:"extreme",description:"An ancient red dragon guards a massive hoard in this mountain cave.",x:1e3,y:1e3,isFixed:!0,isActive:!0,rewards:{gold:5e3,experience:1e3,items:["Dragon Scale Armor","Flame Sword"],reputation:[{faction:"Dragon Slayers",amount:100}]}}].find(n=>n.x===e&&n.y===t)||null}getActiveEncounter(){return this.state.activeEncounter}completeEncounter(e,t){if(!this.state.activeEncounter)return;const n=this.state.activeEncounter;if("combat"===n.type)if(e){const e=Math.floor(5*i.Sh.next());e>0&&(this.takeDamage(e),console.log("Combat won with minor injuries: ".concat(e," damage taken.")))}else{let e=0;switch(n.danger){case"low":e=10+Math.floor(10*i.Sh.next());break;case"medium":e=20+Math.floor(15*i.Sh.next());break;case"high":e=30+Math.floor(20*i.Sh.next());break;default:e=15+Math.floor(10*i.Sh.next())}this.takeDamage(e),console.log("Combat failed! Party takes ".concat(e," damage. HP: ").concat(this.state.party.hitPoints,"/").concat(this.state.party.maxHitPoints))}if(e&&(this.state.completedEncounters.add(n.id),n.rewards)){const e=n.rewards;if(e.gold&&(this.state.party.supplies.gold+=e.gold),e.items&&this.state.party.equipment.push(...e.items),e.experience){this.gainExperience(e.experience)?console.log("Party gained ".concat(e.experience," XP and leveled up! Now level ").concat(this.state.party.level)):console.log("Party gained ".concat(e.experience," XP"))}}this.state.activeEncounter=null}dismissEncounter(){this.state.activeEncounter=null}getAvailableMagicalSpells(){return this.magicalSpells.getAvailableSpells(this.state.party.level,this.state.party.stats,this.state.party.equipment,this.state.party.knownSpells)}learnMagicalSpell(e){return!(!this.getAvailableMagicalSpells().find(t=>t.name===e)||this.state.party.knownSpells.includes(e))&&(this.state.party.knownSpells.push(e),!0)}castMagicalSpell(e){if(!this.state.party.knownSpells.includes(e))return{success:!1,message:"Spell not known"};const t=this.getAvailableMagicalSpells().find(t=>t.name===e);if(!t)return{success:!1,message:"Spell no longer available (requirements not met)"};if(this.state.party.ether<t.etherCost)return{success:!1,message:"Not enough ether"};this.state.party.ether-=t.etherCost;let n="Cast ".concat(e,"!");if(t.effects.healing){const e=Math.floor(i.Sh.next()*(t.effects.healing.max-t.effects.healing.min+1))+t.effects.healing.min;this.heal(e),n+=" Healed ".concat(e," HP.")}if(t.effects.damage){const e=Math.floor(i.Sh.next()*(t.effects.damage.max-t.effects.damage.min+1))+t.effects.damage.min;n+=" Dealt ".concat(e," ").concat(t.effects.damage.type||"magical"," damage.")}return{success:!0,message:n}}getAvailablePhysicalAbilities(){return this.physicalAbilities.getAvailableAbilities(this.state.party.level,this.state.party.stats,this.state.party.equipment,this.state.party.knownAbilities)}learnPhysicalAbility(e){const t=this.getAvailablePhysicalAbilities().find(t=>t.name===e);return!(!t||this.state.party.knownAbilities.includes(e))&&(this.state.party.knownAbilities.push(e),!0)}usePhysicalAbility(e){if(!this.state.party.knownAbilities.includes(e))return{success:!1,message:"Ability not known"};const t=this.getAvailablePhysicalAbilities().find(t=>t.name===e);if(!t)return{success:!1,message:"Ability no longer available (requirements not met)"};if(this.state.party.stamina<t.staminaCost)return{success:!1,message:"Not enough stamina"};this.state.party.stamina-=t.staminaCost;let n="Used ".concat(e,"!");if(t.effects.healing){const e=Math.floor(i.Sh.next()*(t.effects.healing.max-t.effects.healing.min+1))+t.effects.healing.min;this.heal(e),n+=" Healed ".concat(e," HP.")}if(t.effects.damage){const e=Math.floor(i.Sh.next()*(t.effects.damage.max-t.effects.damage.min+1))+t.effects.damage.min;n+=" Dealt ".concat(e," ").concat(t.effects.damage.type||"damage",".")}return{success:!0,message:n}}restoreStamina(e){this.state.party.stamina=Math.min(this.state.party.maxStamina,this.state.party.stamina+e)}restoreEther(e){this.state.party.ether=Math.min(this.state.party.maxEther,this.state.party.ether+e)}useEther(e){return this.state.party.ether>=e&&(this.state.party.ether-=e,!0)}gainExperience(e){this.state.party.experience+=e;const t=100*this.state.party.level;if(this.state.party.experience>=t){this.state.party.level++,this.state.party.experience-=t;const e=Object.keys(this.state.party.stats),n=this.rng.pick(e);return this.state.party.stats[n]++,this.state.party.maxStamina+=2,this.state.party.stamina=this.state.party.maxStamina,this.state.party.maxEther+=1,this.state.party.ether=this.state.party.maxEther,!0}return!1}addCharacter(e){const t=(0,r.A)((0,r.A)({},e),{},{id:"char_".concat(Date.now(),"_").concat(i.Sh.next().toString(36).substr(2,9)),hitPoints:this.calculateMaxHitPoints(e.stats.constitution,e.level),maxHitPoints:this.calculateMaxHitPoints(e.stats.constitution,e.level),stamina:this.calculateMaxStamina(e.stats.constitution,e.level),maxStamina:this.calculateMaxStamina(e.stats.constitution,e.level),ether:this.calculateMaxEther(e.stats.intelligence,e.stats.wisdom,e.level),maxEther:this.calculateMaxEther(e.stats.intelligence,e.stats.wisdom,e.level),knownAbilities:[],knownSpells:[],knownCantrips:[],equipment:[]});return this.state.characters.push(t),this.state.party.members.push(t.id),this.autoSave(),t}getCharacter(e){return this.state.characters.find(t=>t.id===e)}getPartyCharacters(){return this.state.party.members.map(e=>this.getCharacter(e)).filter(e=>void 0!==e)}learnPhysicalAbilityForCharacter(e,t){const n=this.getCharacter(e);if(!n)return!1;const r=this.getAvailablePhysicalAbilitiesForCharacter(e).find(e=>e.name===t);return!(!r||n.knownAbilities.includes(t))&&(n.knownAbilities.push(t),this.autoSave(),!0)}learnMagicalSpellForCharacter(e,t){const n=this.getCharacter(e);if(!n)return!1;return!(!this.getAvailableMagicalSpellsForCharacter(e).find(e=>e.name===t)||n.knownSpells.includes(t))&&(n.knownSpells.push(t),this.autoSave(),!0)}getAvailablePhysicalAbilitiesForCharacter(e){const t=this.getCharacter(e);return t?this.physicalAbilities.getAvailableAbilities(t.level,t.stats,t.equipment,t.knownAbilities):[]}getAvailableMagicalSpellsForCharacter(e){const t=this.getCharacter(e);return t?this.magicalSpells.getAvailableSpells(t.level,t.stats,t.equipment,t.knownSpells):[]}calculateMaxHitPoints(e,t){const n=Math.floor((e-10)/2),r=5*(t-1);return Math.max(1,20+n+r)}calculateMaxStamina(e,t){const n=Math.floor((e-10)/2),r=3*(t-1);return Math.max(1,10+n+r)}calculateMaxEther(e,t,n){const r=Math.floor((e-10)/2),a=Math.floor((t-10)/2),i=2*(n-1);return Math.max(0,5+r+a+i)}}const ie=()=>{const e={version:{NODE_ENV:"production",PUBLIC_URL:"/World-Engine",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_VERSION||"1.0.6",platform:navigator.platform,userAgent:navigator.userAgent};return(0,w.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:(0,w.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 max-w-md",children:[(0,w.jsxs)("div",{className:"mb-4",children:[(0,w.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:"World Engine"}),(0,w.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,w.jsxs)("div",{className:"flex justify-between items-center",children:[(0,w.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Version:"}),(0,w.jsx)("span",{className:"text-gray-900 dark:text-white",children:e.version})]}),(0,w.jsxs)("div",{className:"flex justify-between items-center",children:[(0,w.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Platform:"}),(0,w.jsx)("span",{className:"text-gray-900 dark:text-white",children:e.platform})]}),(0,w.jsxs)("div",{className:"flex justify-between items-center",children:[(0,w.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Environment:"}),(0,w.jsx)("span",{className:"text-gray-900 dark:text-white",children:"Web"})]})]})]}),(0,w.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[(0,w.jsx)("p",{children:"Web-first strategic RPG"}),(0,w.jsxs)("p",{children:["Build: ","production"]})]})]})})};function oe(e){var t,n,r,o,s;let{eng:l,onNext:c}=e;const[d,u]=(0,a.useState)([]),[h,p]=(0,a.useState)(""),[m,f]=(0,a.useState)(""),[g,y]=(0,a.useState)((null===l||void 0===l||null===(t=l.state)||void 0===t||null===(n=t.meta)||void 0===n?void 0:n.seed)||"");console.log("WorldSetupScreen render:",{presets:d,chosen:h}),(0,a.useEffect)(()=>{!async function(){try{var e,t,n,r;console.log("Loading presets..."),await(null===l||void 0===l||null===(e=l.loadWorldPresets)||void 0===e?void 0:e.call(l));const a=(null===l||void 0===l||null===(t=l.state)||void 0===t||null===(n=t.meta)||void 0===n||null===(r=n.presets)||void 0===r?void 0:r.list)||[];u(a),console.log("Loaded presets:",a)}catch(a){console.error("Failed to load presets",a),f("Could not load world presets.")}}()},[l]),(0,a.useEffect)(()=>{var e,t;const n=(null===l||void 0===l||null===(e=l.state)||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.seed)||"";n&&n!==g&&y(n)},[null===l||void 0===l||null===(r=l.state)||void 0===r||null===(o=r.meta)||void 0===o?void 0:o.seed]),(0,a.useEffect)(()=>{var e;const t=null===(e=d.find(e=>e.name===h))||void 0===e?void 0:e.seed;var n;!g&&t&&(y(t),null===l||void 0===l||null===(n=l.setSeed)||void 0===n||n.call(l,t))},[h,d]);const x=(0,a.useMemo)(()=>()=>{var e;const t=Date.now().toString(36),n=i.Sh.next().toString(36).slice(2,8),r="".concat(t,"-").concat(n);y(r),null===l||void 0===l||null===(e=l.setSeed)||void 0===e||e.call(l,r)},[l]),v=d.find(e=>(null===e||void 0===e?void 0:e.name)===h);return(0,w.jsxs)("div",{children:[(0,w.jsx)("h2",{children:"World Setup"}),m&&(0,w.jsx)("div",{style:{color:"red"},children:m}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{children:"Choose a preset world: "}),(0,w.jsxs)("select",{value:h,onChange:e=>{var t;const n=e.target.value;p(n),null===l||void 0===l||null===(t=l.applyPresetByName)||void 0===t||t.call(l,n)},children:[(0,w.jsx)("option",{value:"",children:"-- none --"}),d.map(e=>(0,w.jsx)("option",{value:e.name,children:e.name},e.name))]}),(0,w.jsxs)("div",{style:{marginTop:12},children:[(0,w.jsx)("label",{htmlFor:"seed",children:"World seed: "}),(0,w.jsx)("input",{id:"seed",type:"text",value:g,onChange:e=>{var t;y(e.target.value),null===l||void 0===l||null===(t=l.setSeed)||void 0===t||t.call(l,e.target.value)},placeholder:"random-seed",style:{width:260}}),(0,w.jsx)("button",{type:"button",style:{marginLeft:8},onClick:x,children:"Randomize"})]}),(null===v||void 0===v?void 0:v.description)&&(0,w.jsx)("p",{style:{marginTop:8,opacity:.8},children:v.description}),null!==v&&void 0!==v&&null!==(s=v.factions)&&void 0!==s&&s.length?(0,w.jsxs)("div",{style:{marginTop:6,fontSize:12},children:["Factions: ",v.factions.join(" \u2022 ")]}):null]}),(0,w.jsx)("button",{onClick:c,disabled:!h&&!g,children:"Next: Create Characters"})]})}function se(e){let t=0;for(let n=9;n<=e;n++)t+=n<=14?1:n<=16?2:3;return t}const le={STR:8,DEX:8,CON:8,INT:8,WIS:8,CHA:8};function ce(e,t,n){const r=Math.floor(e/2)+1,a=Math.floor((Math.max(t,n)-10)/2);return Math.max(1,r+Math.max(0,a))}function de(e,t,n){if(e<2)return 0;const r=Math.max(0,e-1),a=Math.floor((Math.max(t,n)-12)/2);return Math.max(0,r+Math.max(0,a))}function ue(e){return e<2?0:e<4?1:e<6?2:e<8?3:e<10?4:e<12?5:e<14?6:e<16?7:e<18?8:9}function he(e){return["wizard","sorcerer","warlock"].includes(e.toLowerCase())?"wizard":["cleric","druid","ranger","paladin"].includes(e.toLowerCase())?"cleric":["bard"].includes(e.toLowerCase())?"mixed":"none"}const pe={Brave:{name:"Brave",description:"Resistant to fear and intimidation effects. +2 bonus to courage-based checks.",mechanicalEffect:"fear_resistance",bonus:{type:"courage",value:2}},Clever:{name:"Clever",description:"Quick thinking in complex situations. +2 bonus to puzzle-solving and investigation.",mechanicalEffect:"intelligence_bonus",bonus:{type:"investigation",value:2}},Cunning:{name:"Cunning",description:"Skilled at deception and misdirection. +2 bonus to stealth and deception checks.",mechanicalEffect:"deception_bonus",bonus:{type:"stealth",value:2}},Empathic:{name:"Empathic",description:"Deeply understands others' emotions. +2 bonus to persuasion and healing checks.",mechanicalEffect:"social_bonus",bonus:{type:"persuasion",value:2}},Stoic:{name:"Stoic",description:"Unshaken by pain or hardship. +2 bonus to endurance and resistance checks.",mechanicalEffect:"endurance_bonus",bonus:{type:"endurance",value:2}},Lucky:{name:"Lucky",description:"Fortune favors you. Once per encounter, reroll any failed check.",mechanicalEffect:"reroll_ability",bonus:{type:"reroll",value:1}},Observant:{name:"Observant",description:"Notice details others miss. +2 bonus to perception and awareness checks.",mechanicalEffect:"perception_bonus",bonus:{type:"perception",value:2}},"Silver Tongue":{name:"Silver Tongue",description:"Naturally persuasive speaker. +2 bonus to all social interaction checks.",mechanicalEffect:"social_master",bonus:{type:"social",value:2}},"Iron Will":{name:"Iron Will",description:"Mental fortitude against magical effects. +2 bonus to resist mental magic.",mechanicalEffect:"mental_resistance",bonus:{type:"mental_defense",value:2}},Swift:{name:"Swift",description:"Faster movement and reflexes. +2 bonus to speed and reaction checks.",mechanicalEffect:"speed_bonus",bonus:{type:"speed",value:2}},"Nature's Friend":{name:"Nature's Friend",description:"Animals and plants respond favorably. +2 bonus to nature-based interactions.",mechanicalEffect:"nature_bonus",bonus:{type:"nature",value:2}},"Keen Senses":{name:"Keen Senses",description:"Enhanced sensory perception. +2 bonus to detect hidden things or dangers.",mechanicalEffect:"detection_bonus",bonus:{type:"detection",value:2}},Patient:{name:"Patient",description:"Calm and methodical approach. +2 bonus to sustained concentration tasks.",mechanicalEffect:"concentration_bonus",bonus:{type:"concentration",value:2}},Resilient:{name:"Resilient",description:"Exceptionally tough constitution. +2 HP per level beyond normal.",mechanicalEffect:"hp_bonus",bonus:{type:"hp_per_level",value:2}},Hardy:{name:"Hardy",description:"Natural toughness and endurance. +1 HP per level beyond normal.",mechanicalEffect:"hp_bonus_small",bonus:{type:"hp_per_level",value:1}},Frail:{name:"Frail",description:"Delicate constitution, but often comes with other gifts. -2 HP per level.",mechanicalEffect:"hp_penalty",bonus:{type:"hp_per_level",value:-2}}},me=Object.keys(pe),fe={Human:{automatic:[],forbidden:[],preferred:["Brave","Clever","Silver Tongue"],description:"Adaptable and versatile, humans can develop any traits through experience."},Sylvanborn:{automatic:["Nature's Friend"],forbidden:["Cunning"],preferred:["Observant","Keen Senses","Patient"],description:"Forest dwellers with an innate connection to nature."},Nightborn:{automatic:["Observant"],forbidden:["Nature's Friend"],preferred:["Clever","Iron Will","Cunning"],description:"Shadow-touched beings with enhanced perception but unnatural aura."},Stormcaller:{automatic:["Swift"],forbidden:["Patient"],preferred:["Brave","Observant","Silver Tongue"],description:"Sky-born people infused with elemental storm energy."}},ge={Greenwarden:{automatic:["Nature's Friend"],forbidden:[],preferred:["Patient","Observant","Empathic"],description:"Nature's guardians with deep environmental connections."},"Thorn Knight":{automatic:["Brave"],forbidden:["Cunning"],preferred:["Stoic","Iron Will","Swift"],description:"Honorable warriors who face threats head-on."},"Sapling Adept":{automatic:["Patient"],forbidden:[],preferred:["Clever","Observant","Nature's Friend"],description:"Scholarly nature mages who study growth and renewal."},"Bloom Caller":{automatic:["Empathic"],forbidden:[],preferred:["Silver Tongue","Nature's Friend","Patient"],description:"Charismatic druids who inspire growth and healing."},"Dust Warden":{automatic:["Stoic"],forbidden:["Empathic"],preferred:["Brave","Iron Will","Observant"],description:"Ash-realm guardians hardened by harsh environments."},Cindermage:{automatic:["Clever"],forbidden:[],preferred:["Iron Will","Patient","Observant"],description:"Fire scholars who manipulate destructive forces."},"Ash Walker":{automatic:["Swift"],forbidden:["Patient"],preferred:["Observant","Cunning","Keen Senses"],description:"Desert scouts who move quickly through dangerous terrain."},"Ember Knight":{automatic:["Brave"],forbidden:["Cunning"],preferred:["Silver Tongue","Stoic","Iron Will"],description:"Noble flame warriors with strong moral codes."},"Storm Herald":{automatic:["Silver Tongue"],forbidden:[],preferred:["Swift","Brave","Observant"],description:"Sky leaders who command through charisma and storm power."},"Wind Sage":{automatic:["Keen Senses"],forbidden:[],preferred:["Clever","Patient","Iron Will"],description:"Aerial mystics with enhanced perception and wisdom."},"Cloud Walker":{automatic:["Swift"],forbidden:["Stoic"],preferred:["Observant","Lucky","Silver Tongue"],description:"Agile sky dancers who embrace freedom and movement."},"Sky Guardian":{automatic:["Brave"],forbidden:[],preferred:["Iron Will","Stoic","Observant"],description:"Stalwart defenders of the aerial realms."}},ye=["Human","Sylvanborn","Nightborn","Stormcaller"],xe=["Female","Male"],ve=Object.keys(h),be={Human:{STR:1,CHA:1,CON:-1,WIS:-1},Sylvanborn:{DEX:2,WIS:1,STR:-2,CON:-1},Nightborn:{DEX:1,INT:2,STR:-1,CHA:-2},Stormcaller:{DEX:1,CHA:2,CON:-1,STR:-2}},we={};Object.entries(h).forEach(e=>{let[t,n]=e;we[t]={STR:n.statModifiers.strength||0,DEX:n.statModifiers.dexterity||0,CON:n.statModifiers.constitution||0,INT:n.statModifiers.intelligence||0,WIS:n.statModifiers.wisdom||0,CHA:n.statModifiers.charisma||0}});const ke=["A former {profession} who left their old life behind after {event}. Now they seek {goal} in the wider world.","Born in {location}, they were raised by {guardian} and learned the ways of {skill}. Their greatest challenge was {challenge}.","Once served as {role} until {tragedy} changed everything. Now they wander, carrying {burden} and seeking {redemption}.","Discovered their {talent} at a young age in {homeland}. After {incident}, they must now {quest}.","A {descriptor} soul from {origin} who {past_action}. Their destiny was forever changed when {turning_point}."],Se={profession:["merchant","soldier","scholar","artisan","noble","farmer","sailor","miner"],event:["a great betrayal","a mystical awakening","a terrible loss","a divine vision","a forbidden discovery"],goal:["redemption","knowledge","vengeance","peace","power","understanding","justice"],location:["the mountains","the deep forests","a bustling city","a remote village","the desert wastes","coastal towns"],guardian:["wise elders","a mysterious mentor","ancient spirits","temple priests","nomadic tribes"],skill:["combat","magic","diplomacy","survival","crafting","healing"],challenge:["surviving in the wilderness","uncovering dark secrets","protecting their community","mastering their abilities"],role:["a royal guard","a temple acolyte","a guild member","a traveling performer","a court advisor"],tragedy:["war came to their lands","a plague struck","they were falsely accused","dark forces emerged"],burden:["ancient knowledge","a family secret","a cursed artifact","the weight of prophecy"],redemption:["to right past wrongs","to prove their worth","to save their people","to break an ancient curse"],talent:["gift for magic","exceptional strength","keen insight","natural charisma","connection to nature"],homeland:["the crystal caves","the floating islands","the shadow realm","the golden plains"],incident:["the great storm","a dragon's attack","political upheaval","a mystical convergence"],quest:["find their true purpose","restore balance","uncover their heritage","save their homeland"],descriptor:["wandering","noble","mysterious","brave","cunning","wise","fierce"],origin:["distant lands","humble beginnings","royal bloodline","ancient lineage","forgotten realms"],past_action:["fought in great battles","studied forbidden lore","communed with spirits","crafted legendary items"],turning_point:["they discovered their true nature","fate intervened","they made a fateful choice","destiny called"]},je=[{name:"Kira Stormwind",gender:"Female",species:"Stormcaller",archetype:"Mystic",background:"A former temple acolyte who left their old life behind after a mystical awakening. Now they seek knowledge in the wider world, wielding storm magic passed down through generations.",stats:{STR:10,DEX:14,CON:12,INT:15,WIS:13,CHA:11},traits:["Observant","Silver Tongue","Swift"],portraitUrl:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=300&h=300&fit=crop&crop=face",mode:"POINT_BUY"}];function Ce(e,t){if(e>=Ne)return!1;const n=e+1,r=se(e);return t>=se(n)-r}const Me={display:"grid",gap:16,gridTemplateColumns:"1fr 420px",padding:24,alignItems:"start"},Te={border:"1px solid #cbd5e1",borderRadius:12,padding:16,background:"#0b0e12",color:"#e5e7eb"},Ae={margin:"8px 0 4px",opacity:.9};function Ee(e,t){return Math.floor(i.Sh.next()*(t-e+1))+e}function Pe(e,t){const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=e,a.click(),URL.revokeObjectURL(r)}function Re(e){return Math.floor((e-8)/2)}function _e(e,t,n,r){var a,i;let o=e;o+=(null===(a=be[n])||void 0===a?void 0:a[t])||0;return o+=(null===(i=we[r])||void 0===i?void 0:i[t])||0,Math.max(3,Math.min(o,22))}const Ne=20;function Be(){var e,t;const[n,o]=(0,a.useState)({name:"",gender:"",species:"",archetype:"",background:"",stats:(0,r.A)({},le),traits:[],portraitUrl:"",mode:"POINT_BUY",level:1,knownSpells:[],knownCantrips:[]}),s=27-(0,a.useMemo)(()=>{let e=0;return Object.keys(n.stats).forEach(t=>{e+=se(n.stats[t])}),e},[n.stats]),l=(0,a.useMemo)(()=>n.gender?n.species?y(n.species,n.gender.toLowerCase(),ve):ve.filter(e=>{const t=g("",e);return null===t||t===n.gender.toLowerCase()}):ve,[n.gender,n.species]),c=(0,a.useMemo)(()=>{if(!n.archetype||!n.gender)return!0;const e=n.species?g(n.species,n.archetype):g("",n.archetype);return null===e||e===n.gender.toLowerCase()},[n.archetype,n.gender,n.species]);function d(e,t){o(n=>(0,r.A)((0,r.A)({},n),{},{[e]:t}))}function h(){const e=new Set;if(n.species){const t=fe[n.species];t&&t.automatic.forEach(t=>e.add(t))}if(n.archetype){const t=ge[n.archetype];t&&t.automatic.forEach(t=>e.add(t))}return Array.from(e)}function p(e){if(n.species){const t=fe[n.species];if(null!==t&&void 0!==t&&t.forbidden&&t.forbidden.includes(e))return!0}if(n.archetype){const t=ge[n.archetype];if(null!==t&&void 0!==t&&t.forbidden&&t.forbidden.includes(e))return!0}return!1}a.useEffect(()=>{n.archetype&&!c&&(console.log("\ud83d\udeab Gender lock: ".concat(n.archetype," not available for ").concat(n.gender," ").concat(n.species,", clearing selection")),d("archetype",""))},[n.archetype,n.gender,n.species,c]),a.useEffect(()=>{const e=h(),t=new Set(n.traits);let a=!1;e.forEach(e=>{t.has(e)||(t.add(e),a=!0)}),Array.from(t).forEach(e=>{p(e)&&(t.delete(e),a=!0)}),a&&o(e=>(0,r.A)((0,r.A)({},e),{},{traits:Array.from(t)}))},[n.species,n.archetype]);const m=(0,a.useMemo)(()=>{const e=n.level||1,t=_e(n.stats.CON,"CON",n.species,n.archetype),r=_e(n.stats.STR,"STR",n.species,n.archetype),a=_e(n.stats.DEX,"DEX",n.species,n.archetype);let i=Re(t),o=0;o="Thorn Knight"===n.archetype||"Crystal Guardian"===n.archetype||"Ironclad"===n.archetype?3:"Ashblade"===n.archetype||"Stormbreaker"===n.archetype||"Voidhunter"===n.archetype||"Greenwarden"===n.archetype||"Guardian"===n.archetype||"Warrior"===n.archetype?2:"Ranger"===n.archetype||"Rogue"===n.archetype||"Artificer"===n.archetype||"Healer"===n.archetype||"Bloomcaller"===n.archetype||"Mystic"===n.archetype?1:0;let s=0;"Human"===n.species?s=1:"Nightborn"===n.species?s=0:"Sylvanborn"===n.species?s=-1:"Stormcaller"===n.species&&(s=0);let l=0;n.traits.includes("Resilient")&&(l+=2),n.traits.includes("Hardy")&&(l+=1),n.traits.includes("Frail")&&(l-=2);const c=Math.max(1,i+o+s+l),d=10+c*(e-1);let u=0;e>=16?u+=2:e>=8&&(u+=1);const h=n.archetype;"Thorn Knight"===h||"Ashblade"===h||"Ironclad"===h||"Stormbreaker"===h||"Voidhunter"===h||"Crystal Guardian"===h?e>=15?u+=2:e>=7&&(u+=1):"Greenwarden"===h||"Guardian"===h||"Warrior"===h?e>=10&&(u+=1):"Ranger"!==h&&"Rogue"!==h&&"Artificer"!==h||e>=15&&(u+=1),u=Math.min(u,5);return{level:e,hp:d,ac:10+Re(a)+u,carry:15*r,naturalACBonus:u,totalHPPerLevel:c,classHPBonus:o,raceHPBonus:s,traitHPBonus:l}},[n.stats,n.species,n.archetype,n.level,n.traits]);return(0,w.jsxs)("div",{style:Me,children:[(0,w.jsxs)("div",{style:{display:"grid",gap:16},children:[(0,w.jsxs)("div",{style:Te,children:[(0,w.jsx)("h2",{style:Ae,children:"Identity"}),(0,w.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,w.jsx)(ze,{label:"Name",value:n.name,onChange:e=>d("name",e)}),(0,w.jsx)(Le,{label:"Gender",value:n.gender,onChange:e=>d("gender",e),options:xe}),(0,w.jsx)(Le,{label:"Species",value:n.species,onChange:e=>d("species",e),options:ye}),n.species&&be[n.species]&&(0,w.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:-4},children:["Racial modifiers: ",Object.entries(be[n.species]).map(e=>{let[t,n]=e;return"".concat(t," ").concat(n>0?"+":"").concat(n)}).join(", ")]}),(0,w.jsx)(Le,{label:"Class",value:n.archetype,onChange:e=>d("archetype",e),options:l}),!c&&n.archetype&&(0,w.jsxs)("div",{style:{fontSize:12,color:"#f87171",marginTop:-4,padding:"4px 8px",background:"rgba(248, 113, 113, 0.1)",borderRadius:"4px",border:"1px solid rgba(248, 113, 113, 0.3)"},children:["\u26a0\ufe0f ",n.archetype," is gender-locked for ","male"===g(n.species,n.archetype)?"male":"female"," characters only"]}),l.length<ve.length&&(0,w.jsxs)("div",{style:{fontSize:12,color:"#60a5fa",marginTop:4,fontStyle:"italic"},children:["\u2139\ufe0f Some classes are gender-locked. ",ve.length-l.length," classes hidden."]}),(0,w.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,w.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,w.jsx)("span",{children:"Level"})}),(0,w.jsx)("input",{type:"number",min:"1",max:"20",value:n.level||1,onChange:e=>d("level",parseInt(e.target.value)||1),style:{padding:"8px",border:"1px solid #374151",borderRadius:"4px",background:"#1f2937",color:"#f9fafb",fontSize:"14px"}})]}),(0,w.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("span",{children:"Background"}),(0,w.jsx)("button",{onClick:()=>d("background",ke[Math.floor(i.Sh.next()*ke.length)].replace(/\{(\w+)\}/g,(e,t)=>{const n=Se[t];return n?n[Math.floor(i.Sh.next()*n.length)]:e})),style:{padding:"4px 8px",fontSize:"12px",background:"#374151",color:"#e5e7eb",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Generate Random"})]}),(0,w.jsx)("textarea",{value:n.background,onChange:e=>d("background",e.target.value),placeholder:"One-paragraph origin story...",rows:4,style:{padding:8,borderRadius:8,border:"1px solid #334155",background:"#0f172a",color:"#e5e7eb",resize:"vertical"}})]}),(0,w.jsxs)("div",{style:{display:"grid",gap:4},children:[(0,w.jsx)("span",{children:"Portrait"}),(0,w.jsxs)("div",{style:{padding:"12px",background:"#1e293b",borderRadius:"8px",border:"1px solid #475569"},children:[(0,w.jsx)("div",{style:{fontSize:"14px",color:"#e5e7eb",fontWeight:"bold",marginBottom:"8px"},children:"Live Portrait Preview"}),(0,w.jsx)("div",{style:{fontSize:"12px",color:"#94a3b8",marginBottom:"8px"},children:"Your character portrait is generated automatically and displayed in the preview panel."}),(0,w.jsx)("div",{style:{fontSize:"11px",color:"#64748b"},children:"Portrait updates live as you change name, species, and class. When you save, a snapshot will be stored with your character."})]})]})]})]}),(0,w.jsxs)("div",{style:Te,children:[(0,w.jsx)("h2",{style:Ae,children:"Abilities"}),(0,w.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:8},children:[(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{type:"radio",checked:"POINT_BUY"===n.mode,onChange:()=>d("mode","POINT_BUY")})," Point Buy"]}),(0,w.jsxs)("label",{children:[(0,w.jsx)("input",{type:"radio",checked:"ROLL"===n.mode,onChange:()=>d("mode","ROLL")})," Roll (4d6 drop lowest)"]}),"ROLL"===n.mode&&(0,w.jsx)("button",{onClick:function(){const e=(0,r.A)({},le);Object.keys(e).forEach(t=>{e[t]=function(){const e=[Ee(1,6),Ee(1,6),Ee(1,6),Ee(1,6)];return e.sort((e,t)=>t-e),e[0]+e[1]+e[2]}()}),o(t=>(0,r.A)((0,r.A)({},t),{},{stats:e}))},style:{marginLeft:"auto"},children:"Roll All"})]}),"POINT_BUY"===n.mode&&(0,w.jsxs)("div",{style:{marginBottom:8,opacity:.9},children:["Points left: ",(0,w.jsx)("strong",{children:s})," (Pool: ",27,", range ",8,"\u2013",Ne,")",(0,w.jsx)("div",{style:{fontSize:12,marginTop:4,opacity:.7},children:"Cost: 8-13 = 1 point each, 14-15 = 2 points each, 16-20 = 3 points each"})]}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8},children:Object.keys(n.stats).map(e=>{const t=n.stats[e],a=_e(t,e,n.species,n.archetype),i=function(e,t,n){var r,a;const i=(null===(r=be[t])||void 0===r?void 0:r[e])||0,o=(null===(a=we[n])||void 0===a?void 0:a[e])||0;let s="";return i>0&&(s+=" +".concat(i," racial")),i<0&&(s+=" ".concat(i," racial")),o>0&&(s+=" +".concat(o," class")),o<0&&(s+=" ".concat(o," class")),s}(e,n.species,n.archetype);return(0,w.jsxs)("div",{style:{border:"1px solid #334155",borderRadius:10,padding:10},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("strong",{children:e}),"POINT_BUY"===n.mode&&(0,w.jsxs)("span",{children:[(0,w.jsx)("button",{onClick:()=>{return t=e,void o(e=>{const n=e.stats[t];return"POINT_BUY"!==e.mode||n<=8?e:(0,r.A)((0,r.A)({},e),{},{stats:(0,r.A)((0,r.A)({},e.stats),{},{[t]:n-1})})});var t},disabled:n.stats[e]<=8,children:"\u2212"}),(0,w.jsx)("button",{onClick:()=>{return t=e,void o(e=>{const n=e.stats[t];return"POINT_BUY"!==e.mode||n>=Ne?e:Ce(n,s)?(0,r.A)((0,r.A)({},e),{},{stats:(0,r.A)((0,r.A)({},e.stats),{},{[t]:n+1})}):e});var t},disabled:n.stats[e]>=Ne||!Ce(n.stats[e],s),style:{marginLeft:6},children:"\uff0b"})]})]}),(0,w.jsx)("div",{style:{fontSize:28,textAlign:"center",marginTop:6},children:a!==t?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("span",{style:{opacity:.6},children:t}),(0,w.jsxs)("span",{style:{color:a>t?"#10b981":"#ef4444",marginLeft:4},children:["\u2192",a]})]}):a}),(0,w.jsxs)("div",{style:{fontSize:12,textAlign:"center",opacity:.8},children:["mod ",Re(a)>=0?"+":"",Re(a)]}),i&&(0,w.jsx)("div",{style:{fontSize:10,textAlign:"center",opacity:.6,marginTop:2},children:i})]},e)})})]}),(0,w.jsxs)("div",{style:Te,children:[(0,w.jsxs)("h2",{style:Ae,children:["Traits ",(0,w.jsxs)("small",{style:{opacity:.7},children:["(choose up to ",2,")"]})]}),(0,w.jsx)("div",{style:{marginBottom:"16px",padding:"12px",background:"rgba(71, 85, 105, 0.1)",border:"1px solid #475569",borderRadius:"8px"},children:(0,w.jsxs)("div",{style:{display:"flex",gap:"24px",fontSize:"0.85em",color:"#94a3b8"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#10b981",fontWeight:"bold"},children:"\u25cf"})," Automatic - Required by your species/class"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#f59e0b",fontWeight:"bold"},children:"\u25cf"})," Recommended - Fits your background well"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("span",{style:{color:"#ef4444",fontWeight:"bold"},children:"\u25cf"})," Forbidden - Conflicts with your nature"]})]})}),(n.species||n.archetype)&&(0,w.jsxs)("div",{style:{marginBottom:"16px",padding:"12px",background:"rgba(30, 41, 59, 0.5)",border:"1px solid #334155",borderRadius:"8px"},children:[n.species&&fe[n.species]&&(0,w.jsxs)("div",{style:{marginBottom:n.archetype?"8px":"0"},children:[(0,w.jsxs)("strong",{style:{color:"#e2e8f0"},children:["Species - ",n.species,":"]}),(0,w.jsx)("div",{style:{color:"#94a3b8",marginLeft:"8px",fontSize:"0.9em",marginTop:"2px"},children:fe[n.species].description})]}),n.archetype&&ge[n.archetype]&&(0,w.jsxs)("div",{children:[(0,w.jsxs)("strong",{style:{color:"#e2e8f0"},children:["Class - ",n.archetype,":"]}),(0,w.jsx)("div",{style:{color:"#94a3b8",marginLeft:"8px",fontSize:"0.9em",marginTop:"2px"},children:ge[n.archetype].description})]})]}),(0,w.jsx)("div",{style:{display:"grid",gap:12},children:me.map(e=>{const t=pe[e],a=n.traits.includes(e),i=h().includes(e),s=p(e),l=function(e){if(n.species){const t=fe[n.species];if(null!==t&&void 0!==t&&t.preferred&&t.preferred.includes(e))return!0}if(n.archetype){const t=ge[n.archetype];if(null!==t&&void 0!==t&&t.preferred&&t.preferred.includes(e))return!0}return!1}(e),c=!a&&n.traits.length>=2||s;let d="#374151",u="rgba(15, 23, 42, 0.5)",m="",f="";return i?(d="#10b981",u="rgba(16, 185, 129, 0.1)",m="AUTOMATIC",f="#10b981"):s?(d="#ef4444",u="rgba(239, 68, 68, 0.1)",m="FORBIDDEN",f="#ef4444"):a?(d="#3b82f6",u="rgba(59, 130, 246, 0.1)"):l&&(d="#f59e0b",u="rgba(245, 158, 11, 0.05)",m="RECOMMENDED",f="#f59e0b"),(0,w.jsxs)("label",{style:{display:"flex",gap:12,alignItems:"flex-start",padding:"12px",border:"2px solid ".concat(d),borderRadius:"8px",background:u,cursor:c&&!i?"not-allowed":"pointer",opacity:c&&!i?.5:1,position:"relative"},children:[(0,w.jsx)("input",{type:"checkbox",checked:a,onChange:()=>!i&&!s&&function(e){o(t=>t.traits.includes(e)?(0,r.A)((0,r.A)({},t),{},{traits:t.traits.filter(t=>t!==e)}):t.traits.length>=2?t:(0,r.A)((0,r.A)({},t),{},{traits:[...t.traits,e]}))}(e),disabled:i||s||!a&&n.traits.length>=2,style:{marginTop:"2px"}}),(0,w.jsxs)("div",{style:{flex:1},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("div",{style:{fontWeight:"bold",color:"#f1f5f9"},children:t.name}),m&&(0,w.jsx)("span",{style:{fontSize:"0.7em",padding:"2px 6px",borderRadius:"4px",backgroundColor:f,color:"white",fontWeight:"bold"},children:m})]}),(0,w.jsx)("div",{style:{fontSize:"0.9em",color:"#94a3b8",marginTop:"4px"},children:t.description})]})]},e)})}),n.traits.length>0&&(0,w.jsxs)("div",{style:{marginTop:"16px",padding:"12px",background:"rgba(16, 185, 129, 0.1)",border:"1px solid #10b981",borderRadius:"8px"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 8px",color:"#10b981",fontSize:"1rem"},children:"Active Trait Benefits:"}),(f=n,f.traits.map(e=>{const t=pe[e];return t?"".concat(t.name,": ").concat(t.description):"".concat(e,": Unknown effect")})).map((e,t)=>(0,w.jsxs)("div",{style:{fontSize:"0.9em",color:"#e5e7eb",marginBottom:"4px"},children:["\u2022 ",e]},t))]})]}),"none"!==he(n.archetype)&&(0,w.jsxs)("div",{style:Te,children:[(0,w.jsx)("h2",{style:Ae,children:"Spells & Cantrips"}),(0,w.jsxs)("div",{style:{marginBottom:"16px",padding:"12px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid #3b82f6",borderRadius:"8px"},children:[(0,w.jsxs)("h3",{style:{margin:"0 0 8px",color:"#3b82f6",fontSize:"1rem"},children:["Spell Capacity (",he(n.archetype)," caster):"]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",fontSize:"0.9em"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Cantrips:"})," ",(null===(e=n.knownCantrips)||void 0===e?void 0:e.length)||0," / ",ce(n.level||1,n.stats.INT,n.stats.WIS)]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Spells:"})," ",(null===(t=n.knownSpells)||void 0===t?void 0:t.length)||0," / ",de(n.level||1,n.stats.INT,n.stats.WIS)]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Max Spell Level:"})," ",ue(n.level||1)]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Primary Ability:"})," ","wizard"===he(n.archetype)?"INT (".concat(n.stats.INT,")"):"cleric"===he(n.archetype)?"WIS (".concat(n.stats.WIS,")"):"INT (".concat(n.stats.INT,") or WIS (").concat(n.stats.WIS,")")]})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 8px",color:"#8b5cf6",fontSize:"1.1rem"},children:"Known Cantrips:"}),(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"8px"},children:(n.knownCantrips||[]).map((e,t)=>{const r=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]").find(t=>t.name===e&&0===t.level);return(0,w.jsxs)("span",{style:{background:"#1e293b",color:"#e2e8f0",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",border:"1px solid #8b5cf6",display:"flex",alignItems:"center",gap:"4px"},children:[(null===r||void 0===r?void 0:r.name)||e,(0,w.jsx)("button",{onClick:()=>{d("knownCantrips",(n.knownCantrips||[]).filter((e,n)=>n!==t))},style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"0",fontSize:"12px"},children:"\u2715"})]},t)})}),(0,w.jsx)("button",{onClick:()=>{const e=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]").filter(e=>0===e.level&&!(n.knownCantrips||[]).includes(e.name));if(0===e.length)return void alert("No saved cantrips available! Create some cantrips in the Spell Generator first.");if((n.knownCantrips||[]).length>=ce(n.level||1,n.stats.INT,n.stats.WIS))return void alert("Maximum cantrips reached! Increase level or ability scores for more.");const t=e[Math.floor(i.Sh.next()*e.length)];d("knownCantrips",[...n.knownCantrips||[],t.name])},disabled:(n.knownCantrips||[]).length>=ce(n.level||1,n.stats.INT,n.stats.WIS),style:{padding:"6px 12px",background:(n.knownCantrips||[]).length>=ce(n.level||1,n.stats.INT,n.stats.WIS)?"#374151":"#8b5cf6",color:"#f9fafb",border:"none",borderRadius:"4px",cursor:(n.knownCantrips||[]).length>=ce(n.level||1,n.stats.INT,n.stats.WIS)?"not-allowed":"pointer",fontSize:"12px"},children:"+ Add Random Cantrip"})]}),de(n.level||1,n.stats.INT,n.stats.WIS)>0&&(0,w.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 8px",color:"#8b5cf6",fontSize:"1.1rem"},children:"Known Spells:"}),(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginBottom:"8px"},children:(n.knownSpells||[]).map((e,t)=>{const r=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]").find(t=>t.name===e&&t.level>0);return(0,w.jsxs)("span",{style:{background:"#1e293b",color:"#e2e8f0",padding:"4px 8px",borderRadius:"4px",fontSize:"12px",border:"1px solid #3b82f6",display:"flex",alignItems:"center",gap:"4px"},children:[(null===r||void 0===r?void 0:r.name)||e," ",r&&"(".concat(r.level,")"),(0,w.jsx)("button",{onClick:()=>{d("knownSpells",(n.knownSpells||[]).filter((e,n)=>n!==t))},style:{background:"none",border:"none",color:"#ef4444",cursor:"pointer",padding:"0",fontSize:"12px"},children:"\u2715"})]},t)})}),(0,w.jsxs)("button",{onClick:()=>{const e=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]"),t=ue(n.level||1),r=e.filter(e=>e.level>0&&e.level<=t&&!(n.knownSpells||[]).includes(e.name));if(0===r.length)return void alert("No saved spells available up to level ".concat(t,"! Create some spells in the Spell Generator first."));if((n.knownSpells||[]).length>=de(n.level||1,n.stats.INT,n.stats.WIS))return void alert("Maximum spells reached! Increase level or ability scores for more.");const a=r[Math.floor(i.Sh.next()*r.length)];d("knownSpells",[...n.knownSpells||[],a.name])},disabled:(n.knownSpells||[]).length>=de(n.level||1,n.stats.INT,n.stats.WIS),style:{padding:"6px 12px",background:(n.knownSpells||[]).length>=de(n.level||1,n.stats.INT,n.stats.WIS)?"#374151":"#3b82f6",color:"#f9fafb",border:"none",borderRadius:"4px",cursor:(n.knownSpells||[]).length>=de(n.level||1,n.stats.INT,n.stats.WIS)?"not-allowed":"pointer",fontSize:"12px"},children:["+ Add Random Spell (max level ",ue(n.level||1),")"]})]}),0===de(n.level||1,n.stats.INT,n.stats.WIS)&&(0,w.jsxs)("div",{style:{padding:"12px",background:"rgba(156, 163, 175, 0.1)",border:"1px solid #6b7280",borderRadius:"8px",textAlign:"center",color:"#9ca3af"},children:["No spells available at level ",n.level||1,". Reach level 2 to learn spells!"]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,w.jsx)("button",{onClick:async function(){if(n.name.trim())try{const e=(0,r.A)((0,r.A)({},n),{},{createdAt:(new Date).toISOString()});u.local.setItem("we:lastCharacter",JSON.stringify(e)),Pe("".concat(n.name.replace(/\s+/g,"_"),".json"),e),console.log("\u2705 Character saved successfully")}catch(e){console.error("Error saving character:",e);const t=(0,r.A)((0,r.A)({},n),{},{createdAt:(new Date).toISOString()});u.local.setItem("we:lastCharacter",JSON.stringify(t)),Pe("".concat(n.name.replace(/\s+/g,"_"),".json"),t)}else alert("Give your character a name before saving.")},children:"Save (JSON + local)"}),(0,w.jsx)("button",{onClick:async function(){if(n.name.trim()){console.log("Saving character to library:",n);try{const e=await(0,r.A)({},n),t=JSON.parse(u.local.getItem("world-engine-characters")||"[]");console.log("Existing characters:",t);const a={id:"char-".concat(Date.now()),name:e.name,race:e.species,characterClass:e.archetype,level:e.level||1,createdAt:(new Date).toISOString(),data:(0,r.A)((0,r.A)({},e),{},{createdAt:(new Date).toISOString()})};console.log("Character data to save:",a),t.push(a),u.local.setItem("world-engine-characters",JSON.stringify(t)),u.local.setItem("world-engine-characters-backup",JSON.stringify(t)),console.log("Saved to localStorage, total characters:",t.length),alert("".concat(n.name," has been saved to your character library!"))}catch(e){console.error("Error saving to library:",e),alert("Error saving character to library.")}}else alert("Give your character a name before saving.")},children:"Save to Library"}),(0,w.jsx)("button",{onClick:function(){const e=u.local.getItem("we:lastCharacter");if(!e)return alert("No saved character found.");try{o(JSON.parse(e))}catch(t){alert("Save file corrupted.")}},children:"Load Last"}),(0,w.jsx)("button",{onClick:function(){o({name:"",gender:"",species:"",archetype:"",background:"",stats:(0,r.A)({},le),traits:[],portraitUrl:"",mode:"POINT_BUY"})},children:"Reset"})]}),(0,w.jsxs)("div",{style:Te,children:[(0,w.jsx)("h2",{style:Ae,children:"Premade Characters"}),(0,w.jsx)("div",{style:{display:"grid",gap:8},children:je.map(e=>(0,w.jsxs)("div",{style:{border:"1px solid #334155",borderRadius:8,padding:12,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{children:(0,w.jsx)("strong",{children:e.name})}),(0,w.jsxs)("div",{style:{fontSize:"12px",opacity:.8},children:[e.species," ",e.archetype," \u2022 ",e.traits.join(", ")]})]}),(0,w.jsx)("button",{onClick:()=>function(e){o((0,r.A)({},e))}(e),style:{padding:"6px 12px",background:"#059669",color:"#f9fafb",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Load"})]},e.name))})]})]}),(0,w.jsxs)("div",{style:Te,children:[(0,w.jsx)("h2",{style:{marginTop:0},children:"Preview"}),(console.log("\ud83e\uddea CharacterCreate: Preview section - checking character data:",{hasName:!!n.name,hasSpecies:!!n.species,hasArchetype:!!n.archetype,name:n.name,species:n.species,archetype:n.archetype,level:n.level}),n.name&&n.species&&n.archetype&&n.gender?(console.log("\u2705 CharacterCreate: Rendering SimplePortraitPreview with full character data"),(0,w.jsx)("div",{style:{width:"100%",borderRadius:12,marginBottom:8},children:(0,w.jsx)(S,{gender:n.gender.toLowerCase(),species:n.species.toLowerCase(),archetype:n.archetype.toLowerCase(),size:"large",showDebug:!0})})):(console.log("\u23f8\ufe0f CharacterCreate: NOT rendering SimplePortraitPreview - missing data"),(0,w.jsx)("div",{style:{border:"1px dashed #334155",borderRadius:12,padding:12,textAlign:"center",marginBottom:8,opacity:.7},children:"Add a name, gender, species, and class to see portrait"}))),(0,w.jsx)("div",{children:(0,w.jsx)("strong",{children:n.name||"Unnamed Adventurer"})}),(0,w.jsx)("div",{style:{opacity:.8,marginBottom:8},children:[n.gender,n.species,n.archetype].filter(Boolean).join(" \u2022 ")}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:6,marginBottom:8},children:Object.keys(n.stats).map(e=>{const t=_e(n.stats[e],e,n.species,n.archetype);return(0,w.jsxs)("div",{style:{background:"#0f172a",border:"1px solid #334155",borderRadius:8,padding:8,textAlign:"center"},children:[(0,w.jsx)("div",{style:{fontSize:12,opacity:.8},children:e}),(0,w.jsx)("div",{style:{fontSize:20},children:t}),(0,w.jsxs)("div",{style:{fontSize:12,opacity:.8},children:["(",Re(t)>=0?"+":"",Re(t),")"]})]},e)})}),(0,w.jsxs)("div",{style:{marginBottom:8},children:[(0,w.jsxs)("div",{children:["HP: ",(0,w.jsx)("strong",{children:m.hp})," \u2022 AC: ",(0,w.jsx)("strong",{children:m.ac})," \u2022 Carry: ",(0,w.jsx)("strong",{children:m.carry})]}),m.naturalACBonus>0&&(0,w.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:2},children:["Natural AC Bonus: +",m.naturalACBonus," (from level/class/race)"]}),(m.classHPBonus>0||0!==m.raceHPBonus||0!==m.traitHPBonus)&&(0,w.jsxs)("div",{style:{fontSize:12,opacity:.7,marginTop:2},children:["HP per level: ",m.totalHPPerLevel," = ",Re(_e(n.stats.CON,"CON",n.species,n.archetype))," (CON)",m.classHPBonus>0&&" + ".concat(m.classHPBonus," (").concat(n.archetype,")"),0!==m.raceHPBonus&&" ".concat(m.raceHPBonus>=0?"+":"").concat(m.raceHPBonus," (").concat(n.species,")"),0!==m.traitHPBonus&&" ".concat(m.traitHPBonus>=0?"+":"").concat(m.traitHPBonus," (traits)")]}),n.traits.length>0&&(0,w.jsxs)("div",{style:{marginTop:6},children:["Traits: ",n.traits.join(", ")]})]}),n.background&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("h3",{style:Ae,children:"Background"}),(0,w.jsx)("p",{style:{whiteSpace:"pre-wrap",lineHeight:1.35},children:n.background})]})]})]});var f}function ze(e){const{label:t,value:n,onChange:r,placeholder:a}=e;return(0,w.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,w.jsx)("span",{children:t}),(0,w.jsx)("input",{value:n,onChange:e=>r(e.target.value),placeholder:a,style:{padding:8,borderRadius:8,border:"1px solid #334155",background:"#0f172a",color:"#e5e7eb"}})]})}function Le(e){const{label:t,value:n,onChange:r,options:a}=e;return(0,w.jsxs)("label",{style:{display:"grid",gap:4},children:[(0,w.jsx)("span",{children:t}),(0,w.jsxs)("select",{value:n,onChange:e=>r(e.target.value),style:{padding:8,borderRadius:8,border:"1px solid #334155",background:"#0f172a",color:"#e5e7eb",cursor:"pointer"},children:[(0,w.jsxs)("option",{value:"",children:["Select ",t,"..."]}),a.map(e=>(0,w.jsx)("option",{value:e,children:e},e))]})]})}const Ie=[{name:"Kira Stormwind",gender:"Female",species:"Stormcaller",archetype:"Storm Herald",background:"A former temple acolyte who left their old life behind after a mystical awakening. Now they seek knowledge in the wider world, wielding storm magic passed down through generations.",stats:{STR:10,DEX:14,CON:12,INT:15,WIS:13,CHA:11},traits:["Observant","Silver Tongue","Swift"],portraitUrl:"https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=300&h=300&fit=crop&crop=face",mode:"POINT_BUY"},{name:"Marcus Ironforge",gender:"Male",species:"Alloy",archetype:"Dust Warden",background:"Born in the crystal caves, they were raised by wise elders and learned the ways of crafting. Their greatest challenge was mastering the fusion of magic and metal that defines their people.",stats:{STR:13,DEX:11,CON:15,INT:14,WIS:12,CHA:8},traits:["Clever","Iron Will","Stoic"],portraitUrl:"https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=300&h=300&fit=crop&crop=face",mode:"POINT_BUY"},{name:"Zara Nightwhisper",gender:"Female",species:"Voidkin",archetype:"Wind Sage",background:"A wandering soul from the shadow realm who fought in great battles against the encroaching darkness. Their destiny was forever changed when they discovered their connection to the void grants them unique abilities.",stats:{STR:9,DEX:15,CON:11,INT:12,WIS:14,CHA:13},traits:["Cunning","Lucky","Observant"],portraitUrl:"https://images.unsplash.com/photo-1494790108755-2616c4b43e69?w=300&h=300&fit=crop&crop=face",mode:"POINT_BUY"},{name:"Theron Greenbough",gender:"Male",species:"Sylvanborn",archetype:"Greenwarden",background:"A guardian of the ancient forests who communes with the spirits of nature. After witnessing the corruption of his homeland, he seeks allies to restore the natural balance.",stats:{STR:12,DEX:13,CON:14,INT:10,WIS:16,CHA:9},traits:["Nature's Friend","Keen Senses","Patient"],portraitUrl:"https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=300&h=300&fit=crop&crop=face",mode:"POINT_BUY"}];const qe=function(e){var t;let{eng:n,party:r,setParty:i,onStart:o,onCreateNew:s}=e;const[l,c]=(0,a.useState)([]),[d,h]=(0,a.useState)("saved"),[p,m]=(0,a.useState)(null);(0,a.useEffect)(()=>{console.log("CharacterLibrary: Loading saved characters...");try{let e=JSON.parse(u.local.getItem("world-engine-characters")||"[]");if(0===e.length){const t=JSON.parse(u.local.getItem("world-engine-characters-backup")||"[]");t.length>0&&(console.log("Restoring from backup:",t.length,"characters"),e=t,u.local.setItem("world-engine-characters",JSON.stringify(e)))}console.log("CharacterLibrary: Loaded characters:",e.length,"total"),c(e),e.length>0&&u.local.setItem("world-engine-characters-backup",JSON.stringify(e))}catch(e){console.error("Error loading saved characters:",e),c([])}},[]);const f=e=>{r.length>=4?alert("Party is full! Maximum 4 characters."):r.some(t=>t.name===e.name)?alert("Character already in party!"):i([...r,e])},g="string"===typeof n.state.meta.presets.loaded?n.state.meta.presets.loaded:null===(t=n.state.meta.presets.loaded)||void 0===t?void 0:t.name,y=e=>{let{character:t,onClose:n}=e;return(0,w.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,w.jsxs)("div",{style:{background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",borderRadius:"12px",padding:"2rem",maxWidth:"600px",width:"90%",maxHeight:"80vh",overflowY:"auto",color:"#e2e8f0",position:"relative"},children:[(0,w.jsx)("button",{onClick:n,style:{position:"absolute",top:"1rem",right:"1rem",background:"transparent",border:"none",color:"#94a3b8",fontSize:"1.5rem",cursor:"pointer",padding:"0.5rem"},children:"\xd7"}),(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h2",{style:{margin:"0 0 0.5rem",color:"#f1f5f9",fontSize:"2rem",fontWeight:"bold"},children:t.name}),(0,w.jsxs)("div",{style:{color:"#94a3b8",fontSize:"1.1rem"},children:[t.data.gender," \u2022 ",t.race," ",t.characterClass]}),(0,w.jsxs)("div",{style:{color:"#64748b",fontSize:"0.9rem",marginTop:"0.5rem"},children:["Created: ",new Date(t.createdAt).toLocaleDateString()]})]}),(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h3",{style:{color:"#e2e8f0",marginBottom:"1rem"},children:"Ability Scores"}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"1rem"},children:Object.entries(t.data.stats).map(e=>{let[t,n]=e;return(0,w.jsxs)("div",{style:{textAlign:"center",padding:"1rem",background:"rgba(15, 23, 42, 0.5)",borderRadius:"8px",border:"1px solid #334155"},children:[(0,w.jsx)("div",{style:{fontSize:"0.9rem",color:"#94a3b8",marginBottom:"0.5rem"},children:t}),(0,w.jsx)("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#f1f5f9"},children:n})]},t)})})]}),t.data.traits&&t.data.traits.length>0&&(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h3",{style:{color:"#e2e8f0",marginBottom:"1rem"},children:"Traits"}),(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:t.data.traits.map((e,t)=>(0,w.jsx)("span",{style:{padding:"0.5rem 1rem",background:"#3b82f6",color:"white",borderRadius:"20px",fontSize:"0.9rem"},children:e},t))})]}),t.data.background&&(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h3",{style:{color:"#e2e8f0",marginBottom:"1rem"},children:"Background"}),(0,w.jsx)("div",{style:{padding:"1rem",background:"rgba(15, 23, 42, 0.5)",borderRadius:"8px",border:"1px solid #334155",color:"#94a3b8",lineHeight:"1.6"},children:t.data.background})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[(0,w.jsx)("button",{onClick:()=>{f(t.data),n()},style:{padding:"0.75rem 1.5rem",background:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:"Add to Party"}),(0,w.jsx)("button",{onClick:()=>{window.confirm("Are you sure you want to delete this character? This cannot be undone.")&&((e=>{if(!window.confirm("Are you sure you want to delete this character? This cannot be undone."))return;const t=l.filter(t=>t.id!==e);c(t),u.local.setItem("world-engine-characters",JSON.stringify(t)),u.local.setItem("world-engine-characters-backup",JSON.stringify(t)),console.log("Deleted character ".concat(e,", remaining:"),t.length)})(t.id),n())},style:{padding:"0.75rem 1.5rem",background:"#ef4444",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:"Delete Character"})]})]})})};return(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",color:"#e2e8f0"},children:[(0,w.jsxs)("div",{style:{padding:"1.5rem",borderBottom:"1px solid #334155",background:"rgba(15, 23, 42, 0.8)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"bold"},children:"Character Library"}),(0,w.jsxs)("p",{style:{margin:"0.5rem 0 0",opacity:.8},children:["Selected World: ",(0,w.jsx)("span",{style:{color:"#60a5fa",fontWeight:"bold"},children:g||"None"})]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[(0,w.jsx)("button",{onClick:()=>{const e=JSON.stringify(l,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="world-engine-characters-".concat((new Date).toISOString().split("T")[0],".json"),r.click(),URL.revokeObjectURL(n)},disabled:0===l.length,style:{padding:"0.5rem 1rem",background:0===l.length?"#374151":"#059669",color:"white",border:"none",borderRadius:"4px",cursor:0===l.length?"not-allowed":"pointer",fontSize:"0.9rem"},children:"Export Characters"}),(0,w.jsxs)("label",{style:{padding:"0.5rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:["Import Characters",(0,w.jsx)("input",{type:"file",accept:".json",onChange:e=>{var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const r=new FileReader;r.onload=e=>{try{var t;const n=JSON.parse(null===(t=e.target)||void 0===t?void 0:t.result);Array.isArray(n)?(c(n),u.local.setItem("world-engine-characters",JSON.stringify(n)),u.local.setItem("world-engine-characters-backup",JSON.stringify(n)),alert("Successfully imported ".concat(n.length," characters!"))):alert("Invalid file format. Please select a valid character export file.")}catch(n){console.error("Import error:",n),alert("Error importing characters. Please check the file format.")}},r.readAsText(n),e.target.value=""},style:{display:"none"}})]})]})]}),(0,w.jsxs)("div",{style:{display:"flex",flex:1},children:[(0,w.jsxs)("div",{style:{flex:2,padding:"1.5rem",borderRight:"1px solid #334155",overflowY:"auto"},children:[(0,w.jsxs)("div",{style:{display:"flex",marginBottom:"1.5rem",borderBottom:"1px solid #334155"},children:[(0,w.jsxs)("button",{onClick:()=>h("saved"),style:{padding:"0.75rem 1.5rem",background:"saved"===d?"#3b82f6":"transparent",color:"saved"===d?"white":"#94a3b8",border:"none",borderBottom:"saved"===d?"2px solid #3b82f6":"2px solid transparent",cursor:"pointer",fontSize:"1rem"},children:["Saved Characters (",l.length,")"]}),(0,w.jsxs)("button",{onClick:()=>h("presets"),style:{padding:"0.75rem 1.5rem",background:"presets"===d?"#3b82f6":"transparent",color:"presets"===d?"white":"#94a3b8",border:"none",borderBottom:"presets"===d?"2px solid #3b82f6":"2px solid transparent",cursor:"pointer",fontSize:"1rem"},children:["Preset Characters (",Ie.length,")"]})]}),(0,w.jsx)("button",{onClick:s,style:{width:"100%",padding:"0.75rem",marginBottom:"1.5rem",background:"#10b981",color:"white",border:"none",borderRadius:"6px",fontSize:"1rem",cursor:"pointer",fontWeight:"bold"},children:"Create New Character"}),(0,w.jsx)("div",{style:{display:"grid",gap:"1rem"},children:"saved"===d?0===l.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b",fontStyle:"italic"},children:"No saved characters yet. Create your first character!"}):l.map(e=>(0,w.jsx)("div",{style:{background:"#1e293b",border:"1px solid #334155",borderRadius:"8px",padding:"1rem"},children:(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 0.5rem",color:"#f1f5f9"},children:e.name}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0",color:"#94a3b8",fontSize:"0.9rem"},children:[e.race," ",e.characterClass]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0",color:"#64748b",fontSize:"0.8rem"},children:["Created: ",new Date(e.createdAt).toLocaleDateString()]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,w.jsx)("button",{onClick:()=>f(e.data),style:{padding:"0.5rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"4px",fontSize:"0.8rem",cursor:"pointer"},children:"Add to Party"}),(0,w.jsx)("button",{onClick:()=>m(e),style:{padding:"0.5rem 1rem",background:"#64748b",color:"white",border:"none",borderRadius:"4px",fontSize:"0.8rem",cursor:"pointer"},children:"View Details"})]})]})},e.id)):Ie.map((e,t)=>(0,w.jsx)("div",{style:{background:"#1e293b",border:"1px solid #334155",borderRadius:"8px",padding:"1rem"},children:(0,w.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e.portraitUrl&&(0,w.jsx)("img",{src:e.portraitUrl,alt:e.name,style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover"}}),(0,w.jsxs)("div",{style:{flex:1},children:[(0,w.jsx)("h3",{style:{margin:"0 0 0.5rem",color:"#f1f5f9"},children:e.name}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0",color:"#94a3b8",fontSize:"0.9rem"},children:[e.species," ",e.archetype]}),(0,w.jsx)("p",{style:{margin:"0.5rem 0 0",color:"#64748b",fontSize:"0.8rem",maxWidth:"300px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.background})]}),(0,w.jsx)("button",{onClick:()=>f(e),style:{padding:"0.5rem 1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"4px",fontSize:"0.8rem",cursor:"pointer"},children:"Add to Party"})]})},t))})]}),(0,w.jsxs)("div",{style:{flex:1,padding:"1.5rem",background:"rgba(15, 23, 42, 0.5)"},children:[(0,w.jsxs)("h2",{style:{marginBottom:"1rem"},children:["Current Party (",r.length,"/4)"]}),0===r.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b",fontStyle:"italic"},children:"No characters in party. Add characters to get started!"}):(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:r.map((e,t)=>(0,w.jsx)("div",{style:{background:"#1e293b",border:"1px solid #334155",borderRadius:"8px",padding:"1rem"},children:(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.25rem",color:"#f1f5f9"},children:e.name}),(0,w.jsxs)("p",{style:{margin:"0",color:"#94a3b8",fontSize:"0.8rem"},children:[e.species," ",e.archetype]})]}),(0,w.jsx)("button",{onClick:()=>(e=>{i(r.filter((t,n)=>n!==e))})(t),style:{padding:"0.25rem 0.5rem",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",fontSize:"0.7rem",cursor:"pointer"},children:"Remove"})]})},t))}),(0,w.jsx)("button",{onClick:o,disabled:0===r.length,style:{width:"100%",padding:"1rem",marginTop:"1.5rem",background:0===r.length?"#374151":"#059669",color:0===r.length?"#6b7280":"white",border:"none",borderRadius:"6px",fontSize:"1.1rem",fontWeight:"bold",cursor:0===r.length?"not-allowed":"pointer"},children:0===r.length?"Add Characters to Start":"Start Adventure"})]})]}),p&&(0,w.jsx)(y,{character:p,onClose:()=>m(null)})]})},De={human:{male:{first:["Aiden","Aldric","Arthur","Bjorn","Caius","Damien","Edmund","Gareth","Hector","Ivan","Jasper","Kai","Leander","Marcus","Nolan","Owen","Pierce","Quinn","Rowan","Soren","Thane","Ulric","Victor","Willem","Xavier","Yorick","Zander"],last:["Blackwood","Brightblade","Stormwind","Ironforge","Goldleaf","Silverstone","Ravencrest","Drakemoor","Thornfield","Ashworth","Redmane","Whitehall","Greycastle","Bluestone","Greenwood"]},female:{first:["Aria","Brenna","Celeste","Diana","Elena","Freya","Gwen","Helena","Iris","Jade","Kira","Luna","Mira","Nora","Olivia","Petra","Quinn","Raven","Sera","Tara","Una","Vera","Willa","Xara","Yara","Zara"],last:["Blackwood","Brightblade","Stormwind","Ironforge","Goldleaf","Silverstone","Ravencrest","Drakemoor","Thornfield","Ashworth","Redmane","Whitehall","Greycastle","Bluestone","Greenwood"]}},elf:{male:{first:["Aelindra","Beiro","Celeborn","Daeron","Elrond","Faelar","Galinndan","Halimath","Ivellios","Jaelynn","Kelvhan","Lamlis","Mindartis","Naal","Otaehryn","Peren","Quarion","Riardon","Silvyr","Thamior","Uldreyin","Vanuath","Wranvyre","Xalvador","Yeshelne","Zoltan"],last:["Amakir","Amakir","Bereris","Cithreth","Enna","Galinndan","Hadarai","Immeral","Ivellios","Korfel","Lamlis","Mindartis","Naal","Nutae","Paelinn","Peren","Riardon","Rolen","Silvyr","Suhnaal","Thamior","Theriatis","Theriapis","Thervan","Uthemar","Vanuath","Varis"]},female:{first:["Adrie","Birel","Caelynn","Dara","Enna","Galinndan","Hadarai","Immeral","Ivellios","Jannalor","Korfel","Lamlis","Mialee","Nutae","Quelenna","Sariel","Shanairra","Shava","Silaqui","Suhnaal","Thamior","Theriatis","Theriapis","Thervan","Uthemar","Vanuath","Varis"],last:["Amakir","Bereris","Cithreth","Enna","Galinndan","Hadarai","Immeral","Ivellios","Korfel","Lamlis","Mindartis","Naal","Nutae","Paelinn","Peren","Riardon","Rolen","Silvyr","Suhnaal","Thamior","Theriatis","Theriapis","Thervan","Uthemar","Vanuath","Varis"]}},dwarf:{male:{first:["Adrik","Baern","Darrak","Eberk","Fargrim","Gardain","Harbek","Kildrak","Morgran","Orsik","Rangrim","Taklinn","Thorek","Ulfgar","Vondal","Balin","Dain","Dwalin","Gloin","Groin","Nain","Ori","Oin","Bifur","Bofur","Bombur","Dori"],last:["Battlehammer","Brawnanvil","Dankil","Fireforge","Frostbeard","Gorunn","Holderhek","Ironfist","Loderr","Lutgehr","Rumnaheim","Strakeln","Torunn","Ungart","Axebreaker","Battlehammer","Brawnanvil","Dankil","Fireforge","Frostbeard","Gorunn","Holderhek","Ironfist","Loderr","Lutgehr","Rumnaheim"]},female:{first:["Amber","Bardryn","Diesa","Eldeth","Gunnloda","Guthkea","Katernin","Liftrasa","Mardred","Riswynn","Sannl","Torbera","Torgga","Vistra","Kathra","Kristryd","Ilde","Liftrasa","Mardred","Riswynn","Sannl","Torbera","Torgga","Vistra","Welby","Darrak","Eberk"],last:["Battlehammer","Brawnanvil","Dankil","Fireforge","Frostbeard","Gorunn","Holderhek","Ironfist","Loderr","Lutgehr","Rumnaheim","Strakeln","Torunn","Ungart","Axebreaker","Battlehammer","Brawnanvil","Dankil","Fireforge","Frostbeard","Gorunn","Holderhek","Ironfist","Loderr","Lutgehr","Rumnaheim"]}},orc:{male:{first:["Grokk","Thokk","Uruk","Grash","Mokk","Drakk","Snagg","Gruul","Krusk","Thrag","Vrokk","Ghash","Brokk","Skarr","Gorthak","Mordak","Ughak","Grommash","Thrall","Garrosh","Durotan","Orgrim","Blackhand","Kilrogg","Kargath","Dentarg","Hurkan"],last:["Skullsplitter","Bloodfang","Ironjaw","Bonecrusher","Flameaxe","Stormrage","Shadowmoon","Frostwolf","Blackrock","Bleeding Hollow","Burning Blade","Dragonmaw","Laughing Skull","Shattered Hand","Twilight's Hammer","Warsong","Thunderlord","Red Walker","Whiteclaw","Redstone","Broken Bone","Burning Eye","Dark Spear","Death's Head","Frozen Rock","Lightning's Blade","Poisoned Spear"]},female:{first:["Baggi","Emen","Engong","Kansif","Myev","Neega","Ovak","Ownka","Shautha","Sutha","Vola","Volen","Yevelda","Grenda","Mokka","Urzul","Shra","Grakia","Vrokka","Thokka","Greshka","Mordka","Ughka","Snaggka","Kruska","Thraka","Vroska"],last:["Skullsplitter","Bloodfang","Ironjaw","Bonecrusher","Flameaxe","Stormrage","Shadowmoon","Frostwolf","Blackrock","Bleeding Hollow","Burning Blade","Dragonmaw","Laughing Skull","Shattered Hand","Twilight's Hammer","Warsong","Thunderlord","Red Walker","Whiteclaw","Redstone","Broken Bone","Burning Eye","Dark Spear","Death's Head","Frozen Rock","Lightning's Blade","Poisoned Spear"]}},places:{cities:["Ravenspire","Goldenhaven","Ironhold","Crystallake","Thornwall","Silverbrook","Dragonrest","Shadowmere","Brightwater","Stormhaven","Millbrook","Oakenford","Rosewood","Blackwater","Whitestone","Redmoor","Greenvale","Bluehaven","Yellowhill","Purplemist"],towns:["Millhaven","Brookshire","Oakheart","Pinewood","Willowdale","Maplegrove","Birchwood","Elmhurst","Cedarfall","Ashwood","Hickory Hill","Walnut Creek","Cherry Blossom","Apple Orchard","Pear Valley","Plum Grove","Peach Hollow","Berry Fields","Vine Ridge","Flower Meadow"],taverns:["The Prancing Pony","The Drunken Dragon","The Golden Griffin","The Silver Stag","The Red Rose","The Blue Moon","The Green Goblin","The Purple Parrot","The Black Swan","The White Wolf","The Rusty Anchor","The Broken Wheel","The Laughing Dwarf","The Singing Bard","The Dancing Bear","The Sleeping Giant","The Weeping Willow","The Howling Wolf","The Roaring Lion","The Soaring Eagle"]}},Oe=["Ae","Al","Am","An","Ar","Ba","Bel","Ber","Bra","Cal","Cel","Cor","Da","Del","Dra","El","Er","Fae","Gal","Gil","Hal","Ith","Kor","Lae","Lor","Mel","Mor","Nal","Nor","Quin","Ral","Sil","Tal","Thal","Val","Vel","Xan","Yor","Zel"],We=["an","ar","as","en","er","eth","ia","iel","in","ion","is","ith","las","len","lin","lon","los","neth","oth","ran","ren","rin","ron","ros","san","sen","sin","son","sus","tan","ten","tin","ton","tus","van","ven","vin","von","vus"],He=["ael","aer","ah","al","an","ar","ath","el","en","er","eth","ia","ial","ian","iel","ien","ier","ies","in","ion","is","ith","las","len","lin","lon","los","neth","oth","ran","ren","rin","ron","ros","us","yn","yr","ys"];function Fe(e){let{onBack:t}=e;const[n,r]=(0,a.useState)("human"),[o,s]=(0,a.useState)("male"),[l,c]=(0,a.useState)("character"),[d,h]=(0,a.useState)([]),[p,m]=(0,a.useState)([]),f=e=>e[Math.floor(i.Sh.next()*e.length)],g=()=>{const e=De[n];if(e&&"object"===typeof e&&"male"in e){const t=e[o];if(t&&"object"===typeof t&&"first"in t){const e=f(t.first),n=f(t.last);return"".concat(e," ").concat(n)}}return"Unknown Name"},y=()=>{const e=De.places[n];return f(e)},x=()=>{const e=i.Sh.next()<.3?2:3;let t="";t+=f(Oe);for(let n=1;n<e-1;n++)t+=f(We);return e>1&&(t+=f(He)),t},v=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;const t=[];for(let n=0;n<e;n++){let e;e="character"===l?g():"place"===l?y():x(),t.includes(e)?n--:t.push(e)}h(t)};return a.useEffect(()=>{try{const e=JSON.parse(u.local.getItem("world-engine-saved-names")||"[]");m(e)}catch(e){console.error("Error loading saved names:",e)}},[]),(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",color:"#e2e8f0"},children:[(0,w.jsxs)("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #334155",background:"rgba(15, 23, 42, 0.8)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{style:{margin:0,fontSize:"2.5rem",fontWeight:"bold"},children:"Name Generator"}),(0,w.jsx)("p",{style:{margin:"0.5rem 0 0",opacity:.8},children:"Generate fantasy names for characters and places"})]}),t&&(0,w.jsx)("button",{onClick:t,style:{padding:"0.75rem 1.5rem",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem"},children:"Back to Menu"})]}),(0,w.jsxs)("div",{style:{display:"flex",height:"calc(100vh - 120px)"},children:[(0,w.jsxs)("div",{style:{flex:1,padding:"2rem",borderRight:"1px solid #334155",overflowY:"auto"},children:[(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h3",{style:{marginBottom:"1rem",color:"#f1f5f9"},children:"Name Type"}),(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:["character","place","fantasy"].map(e=>(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"radio",name:"nameType",value:e,checked:l===e,onChange:e=>c(e.target.value),style:{accentColor:"#3b82f6"}}),(0,w.jsxs)("span",{style:{textTransform:"capitalize"},children:[e," Names"]})]},e))})]}),"character"===l&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h3",{style:{marginBottom:"1rem",color:"#f1f5f9"},children:"Race"}),(0,w.jsxs)("select",{value:n,onChange:e=>r(e.target.value),style:{width:"100%",padding:"0.75rem",background:"#1e293b",border:"1px solid #334155",borderRadius:"4px",color:"#e2e8f0",fontSize:"1rem"},children:[(0,w.jsx)("option",{value:"human",children:"Human"}),(0,w.jsx)("option",{value:"elf",children:"Elf"}),(0,w.jsx)("option",{value:"dwarf",children:"Dwarf"}),(0,w.jsx)("option",{value:"orc",children:"Orc"})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h3",{style:{marginBottom:"1rem",color:"#f1f5f9"},children:"Gender"}),(0,w.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"radio",name:"gender",value:"male",checked:"male"===o,onChange:e=>s(e.target.value),style:{accentColor:"#3b82f6"}}),"Male"]}),(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[(0,w.jsx)("input",{type:"radio",name:"gender",value:"female",checked:"female"===o,onChange:e=>s(e.target.value),style:{accentColor:"#3b82f6"}}),"Female"]})]})]})]}),"place"===l&&(0,w.jsxs)("div",{style:{marginBottom:"2rem"},children:[(0,w.jsx)("h3",{style:{marginBottom:"1rem",color:"#f1f5f9"},children:"Place Type"}),(0,w.jsxs)("select",{value:n,onChange:e=>r(e.target.value),style:{width:"100%",padding:"0.75rem",background:"#1e293b",border:"1px solid #334155",borderRadius:"4px",color:"#e2e8f0",fontSize:"1rem"},children:[(0,w.jsx)("option",{value:"cities",children:"Cities"}),(0,w.jsx)("option",{value:"towns",children:"Towns"}),(0,w.jsx)("option",{value:"taverns",children:"Taverns"})]})]}),(0,w.jsx)("button",{onClick:()=>v(10),style:{width:"100%",padding:"1rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",fontSize:"1.1rem",fontWeight:"bold",cursor:"pointer",marginBottom:"1rem"},children:"Generate Names"}),(0,w.jsx)("button",{onClick:()=>v(25),style:{width:"100%",padding:"0.75rem",background:"#059669",color:"white",border:"none",borderRadius:"6px",fontSize:"1rem",cursor:"pointer"},children:"Generate More (25)"})]}),(0,w.jsxs)("div",{style:{flex:2,padding:"2rem",borderRight:"1px solid #334155"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,w.jsx)("h3",{style:{margin:0,color:"#f1f5f9"},children:"Generated Names"}),d.length>0&&(0,w.jsxs)("span",{style:{color:"#94a3b8",fontSize:"0.9rem"},children:[d.length," names"]})]}),0===d.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:"3rem",color:"#64748b",fontStyle:"italic"},children:'Click "Generate Names" to get started!'}):(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"1rem",maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:d.map((e,t)=>(0,w.jsxs)("div",{style:{padding:"1rem",background:"rgba(15, 23, 42, 0.5)",border:"1px solid #334155",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("span",{style:{fontWeight:"500"},children:e}),(0,w.jsx)("button",{onClick:()=>(e=>{if(!p.includes(e)){const t=[...p,e];m(t),u.local.setItem("world-engine-saved-names",JSON.stringify(t))}})(e),disabled:p.includes(e),style:{padding:"0.25rem 0.5rem",background:p.includes(e)?"#374151":"#059669",color:"white",border:"none",borderRadius:"4px",fontSize:"0.8rem",cursor:p.includes(e)?"not-allowed":"pointer"},children:p.includes(e)?"Saved":"Save"})]},t))})]}),(0,w.jsxs)("div",{style:{flex:1,padding:"2rem"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[(0,w.jsx)("h3",{style:{margin:0,color:"#f1f5f9"},children:"Saved Names"}),p.length>0&&(0,w.jsx)("button",{onClick:()=>{const e=JSON.stringify(p,null,2),t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="world-engine-names-".concat((new Date).toISOString().split("T")[0],".json"),r.click(),URL.revokeObjectURL(n)},style:{padding:"0.5rem",background:"#374151",color:"white",border:"none",borderRadius:"4px",fontSize:"0.8rem",cursor:"pointer"},children:"Export"})]}),0===p.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b",fontStyle:"italic"},children:"Save names you like here!"}):(0,w.jsx)("div",{style:{maxHeight:"calc(100vh - 250px)",overflowY:"auto"},children:p.map((e,t)=>(0,w.jsxs)("div",{style:{padding:"0.75rem",background:"rgba(15, 23, 42, 0.3)",border:"1px solid #334155",borderRadius:"6px",marginBottom:"0.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("span",{children:e}),(0,w.jsx)("button",{onClick:()=>(e=>{const t=p.filter(t=>t!==e);m(t),u.local.setItem("world-engine-saved-names",JSON.stringify(t))})(e),style:{padding:"0.25rem 0.5rem",background:"#ef4444",color:"white",border:"none",borderRadius:"4px",fontSize:"0.7rem",cursor:"pointer"},children:"\xd7"})]},t))})]})]})]})}const Ge=e=>40+4*(e-1),Ue=18,Ve=e=>{let t=0;for(let n=9;n<=e;n++)t+=n<=13?1:n<=15?2:3;return t},Ye={human:{id:"human",name:"Human",description:"Versatile and adaptable, humans excel in leadership and diplomacy.",statModifiers:{cha:1,lck:1},traits:["Adaptable","Ambitious"],culturalBackground:"Diverse settlements and kingdoms",lifespan:"60-80 years",physicalTraits:"Medium build, varied appearance"},sylvanborn:{id:"sylvanborn",name:"Sylvanborn",description:"Nature-touched beings with deep connection to forests and growing things.",statModifiers:{dex:2,wis:1,con:-1},traits:["Nature Affinity","Forest Walker"],resistances:{nature:25,poison:15},culturalBackground:"Ancient groves and tree-cities",lifespan:"120-200 years",physicalTraits:"Tall, graceful, bark-like skin patterns"},nightborn:{id:"nightborn",name:"Nightborn",description:"Shadow-touched people with mastery over darkness and stealth.",statModifiers:{dex:2,int:1,str:-1},traits:["Shadow Step","Darkvision"],resistances:{shadow:25,fear:15},culturalBackground:"Underground cities and twilight realms",lifespan:"80-120 years",physicalTraits:"Pale skin, dark eyes, moves silently"},stormcaller:{id:"stormcaller",name:"Stormcaller",description:"Sky-born people who command wind and lightning.",statModifiers:{spd:2,cha:1,con:-1},traits:["Storm Touched","Wind Walker"],resistances:{air:25,lightning:20},culturalBackground:"Mountain peaks and sky citadels",lifespan:"70-100 years",physicalTraits:"Tall, lean, hair that moves like wind"},crystalborn:{id:"crystalborn",name:"Crystalborn",description:"Gem-touched beings with crystalline growths and earth magic.",statModifiers:{con:2,int:1,spd:-1},traits:["Crystal Resonance","Earth Sense"],resistances:{earth:25,physical:10},culturalBackground:"Crystal caves and mineral sanctuaries",lifespan:"150-300 years",physicalTraits:"Crystalline protrusions, translucent skin"},draketh:{id:"draketh",name:"Draketh",description:"Dragon-blooded warriors with scales and fierce pride.",statModifiers:{str:2,cha:1,wis:-1},traits:["Dragon Blood","Breath Weapon"],resistances:{fire:30,fear:20},culturalBackground:"Clan holds and dragon lairs",lifespan:"100-200 years",physicalTraits:"Scales, reptilian eyes, imposing presence"},alloy:{id:"alloy",name:"Alloy",description:"Constructed beings of metal and magic with analytical minds.",statModifiers:{con:2,int:2,cha:-2},traits:["Construct Nature","Analytical Mind"],resistances:{poison:100,disease:100,mental:25},culturalBackground:"Artificer workshops and mechanical cities",lifespan:"Indefinite (with maintenance)",physicalTraits:"Metallic body, glowing energy cores"},voidkin:{id:"voidkin",name:"Voidkin",description:"Beings touched by the space between stars, wielding alien magic.",statModifiers:{int:2,wis:1,str:-1,cha:-1},traits:["Void Touched","Cosmic Insight"],resistances:{psychic:30,arcane:15},culturalBackground:"Interdimensional enclaves and star-touched sites",lifespan:"Variable (affected by void exposure)",physicalTraits:"Shifting features, star-filled eyes"}},Ke={commoner:{id:"commoner",name:"Commoner",description:"Humble origins with practical skills and hardy constitution.",statModifiers:{con:1,str:1},startingGold:50,bonusEquipment:["work_tools","common_clothes"],socialConnections:["Local Farmers","Village Elders"],knowledgeAreas:["Local Geography","Folk Remedies"]},noble:{id:"noble",name:"Noble",description:"High-born with education, wealth, and social connections.",statModifiers:{cha:2,int:1},startingGold:200,bonusEquipment:["fine_clothes","signet_ring","educated_tome"],socialConnections:["Court Officials","Merchant Guilds","Other Nobles"],knowledgeAreas:["History","Politics","Etiquette"]},outcast:{id:"outcast",name:"Outcast",description:"Rejected by society, developing self-reliance and cunning.",statModifiers:{dex:1,lck:1,cha:-1},startingGold:25,bonusEquipment:["survival_kit","worn_cloak"],socialConnections:["Other Outcasts","Criminal Contacts"],knowledgeAreas:["Survival","Street Wisdom","Hidden Paths"]},acolyte:{id:"acolyte",name:"Acolyte",description:"Trained in religious traditions and divine magic.",statModifiers:{wis:2,int:1},startingGold:75,bonusEquipment:["holy_symbol","prayer_book","ritual_robes"],socialConnections:["Religious Orders","Temple Hierarchy"],knowledgeAreas:["Theology","Ancient Lore","Healing Arts"]},ranger:{id:"ranger",name:"Ranger",description:"Wilderness guide with tracking skills and nature knowledge.",statModifiers:{dex:1,spd:1,wis:1},startingGold:100,bonusEquipment:["hunting_bow","trail_rations","wilderness_gear"],socialConnections:["Hunter Lodges","Wilderness Guides","Druid Circles"],knowledgeAreas:["Animal Behavior","Weather Patterns","Terrain Navigation"]},scholar:{id:"scholar",name:"Scholar",description:"Academic with extensive knowledge and research skills.",statModifiers:{int:2,wis:1,con:-1},startingGold:150,bonusEquipment:["research_tomes","writing_materials","scholar_robes"],socialConnections:["Academic Institutions","Sage Councils","Library Networks"],knowledgeAreas:["Arcane Theory","Historical Records","Linguistic Studies"]},mercenary:{id:"mercenary",name:"Mercenary",description:"Professional soldier with combat experience and practical skills.",statModifiers:{str:1,con:1,dex:1},startingGold:125,bonusEquipment:["mercenary_blade","field_armor","campaign_pack"],socialConnections:["Mercenary Companies","Veterans","Arms Dealers"],knowledgeAreas:["Military Tactics","Equipment Maintenance","Campaign Geography"]},wanderer:{id:"wanderer",name:"Wanderer",description:"Traveled far and wide, gaining diverse experiences and contacts.",statModifiers:{spd:1,lck:1,wis:1},startingGold:75,bonusEquipment:["traveler_pack","road_clothes","navigation_tools"],socialConnections:["Caravan Masters","Innkeepers","Fellow Travelers"],knowledgeAreas:["Foreign Customs","Trade Routes","Cultural Practices"]}},Xe={warrior:{id:"warrior",name:"Warrior",description:"Frontline fighter specializing in melee combat and protection.",combatRole:"melee",primaryStats:["str","con"],defaultEquipment:{weapon:"iron_sword",armor:"leather_armor"},startingAbilities:["power_attack","defensive_stance"],formationPreference:"front"},ranger:{id:"ranger",name:"Ranger",description:"Skilled archer and scout with wilderness expertise.",combatRole:"ranged",primaryStats:["dex","wis"],defaultEquipment:{weapon:"shortbow",armor:"leather_armor"},startingAbilities:["precise_shot","track"],magicTraditions:["Nature","Air"],formationPreference:"back"},mage:{id:"mage",name:"Mage",description:"Arcane spellcaster with mastery over elemental forces.",combatRole:"caster",primaryStats:["int","wis"],defaultEquipment:{weapon:"oak_staff",armor:"cloth_robes"},startingAbilities:["arcane_bolt","mana_shield"],magicTraditions:["Fire","Air","Water","Earth","Arcane"],formationPreference:"back"},priest:{id:"priest",name:"Priest",description:"Divine spellcaster focused on healing and support magic.",combatRole:"support",primaryStats:["wis","cha"],defaultEquipment:{weapon:"ash_wand",armor:"cloth_robes"},startingAbilities:["heal","bless"],magicTraditions:["Divine","Spirit"],formationPreference:"back"},commander:{id:"commander",name:"Commander",description:"Military leader with tactical abilities and inspiring presence.",combatRole:"leader",primaryStats:["cha","int"],defaultEquipment:{weapon:"iron_sword",armor:"brigandine",shield:"round_shield"},startingAbilities:["rally","tactical_strike"],commandCapable:!0,formationPreference:"flexible"},knight:{id:"knight",name:"Knight",description:"Elite heavy warrior with honor-bound code and superior equipment.",combatRole:"melee",primaryStats:["str","cha"],defaultEquipment:{weapon:"knight_sword",armor:"plate_armor",shield:"knight_shield"},startingAbilities:["righteous_strike","armor_mastery"],formationPreference:"front"},mystic:{id:"mystic",name:"Mystic",description:"Advanced spellcaster with deep understanding of magical forces.",combatRole:"caster",primaryStats:["int","wis"],defaultEquipment:{weapon:"mystic_orb",armor:"enchanted_robes"},startingAbilities:["elemental_mastery","arcane_sight"],magicTraditions:["Arcane","Shadow","Spirit"],formationPreference:"back"},guardian:{id:"guardian",name:"Guardian",description:"Protector with defensive abilities and healing magic.",combatRole:"support",primaryStats:["con","wis"],defaultEquipment:{weapon:"guardian_staff",armor:"guardian_mail",shield:"tower_shield"},startingAbilities:["protective_ward","regeneration"],magicTraditions:["Nature","Divine"],formationPreference:"front"},chanter:{id:"chanter",name:"Chanter",description:"Vocal spellcaster using songs and chants to weave magic.",combatRole:"support",primaryStats:["cha","wis"],defaultEquipment:{weapon:"chanter_harp",armor:"performer_garb"},startingAbilities:["inspiring_song","voice_of_power"],magicTraditions:["Spirit","Divine"],formationPreference:"back"},corsair:{id:"corsair",name:"Corsair",description:"Agile fighter specializing in mobility and dual-wielding.",combatRole:"melee",primaryStats:["dex","cha"],defaultEquipment:{weapon:"corsair_blade",armor:"corsair_coat"},startingAbilities:["dual_strike","evasive_maneuvers"],formationPreference:"front"}},Je={1:1,2:4,3:7,4:10},Qe={0:1,1:2,2:4,3:6,4:8,5:10,6:12,7:14,8:16,9:18},$e=3,Ze=12,et=3,tt=5;function nt(e){var t,n;const r=[],a=[];null!==(t=e.name)&&void 0!==t&&t.trim()||r.push("character_name_required"),null!==(n=e.team)&&void 0!==n&&n.trim()||r.push("team_assignment_required"),(e.level<1||e.level>20)&&r.push("invalid_level_range"),Ye[e.species]||r.push("invalid_species"),Ke[e.background]||r.push("invalid_background"),Xe[e.archetype]||r.push("invalid_archetype");const i=function(e,t){const n=[],r=[],a=Ge(t);let i=0;for(const[c,d]of Object.entries(e))d<3&&n.push("stat_".concat(c,"_below_minimum")),d>Ue&&n.push("stat_".concat(c,"_above_maximum")),d>=8&&(i+=Ve(d));i>a?n.push("stat_budget_exceeded"):i<a-5&&r.push("stat_points_remaining");const o=Object.values(e),s=Math.max(...o),l=Math.min(...o);s-l>10&&r.push("extremely_specialized_build");return{ok:0===n.length,reasons:n,warnings:r.length>0?r:void 0}}(e.stats,e.level);i.ok||r.push(...i.reasons),i.warnings&&a.push(...i.warnings);const o=function(e,t,n,r){const a=[],i=[],o=Xe[r];for(const h of e){const e=Je[h.rank];n<e&&a.push("mastery_".concat(h.school,"_rank_").concat(h.rank,"_requires_level_").concat(e)),null!==o&&void 0!==o&&o.magicTraditions&&!o.magicTraditions.includes(h.school)&&i.push("archetype_".concat(r,"_not_traditional_").concat(h.school,"_user"))}const s=new Map(e.map(e=>[e.school,e.rank]));for(const h of t)if(void 0!==h.level){const e=Qe[h.level];if(n<e&&a.push("spell_".concat(h.id,"_level_").concat(h.level,"_requires_character_level_").concat(e)),h.school){const e=s.get(h.school)||0,t=Math.min(4,Math.ceil(h.level/2)+1);e<t&&a.push("spell_".concat(h.id,"_requires_").concat(h.school,"_mastery_rank_").concat(t))}}const l=Math.floor(n/2)+2,c=Math.max(0,n-1),d=t.filter(e=>0===e.level).length,u=t.filter(e=>(e.level||0)>0).length;d>l&&a.push("too_many_cantrips");u>c&&a.push("too_many_spells");(null===o||void 0===o||!o.magicTraditions)&&t.length>2&&i.push("non_caster_with_many_spells");return{ok:0===a.length,reasons:a,warnings:i.length>0?i:void 0}}(e.masteries||[],e.spells||[],e.level,e.archetype);if(o.ok||r.push(...o.reasons),o.warnings&&a.push(...o.warnings),e.wantsCommander){const t=function(e){const t=[],n=[];e.level<$e&&t.push("commander_requires_level_".concat($e));e.stats.cha<Ze&&t.push("commander_requires_charisma_".concat(Ze));const r=Xe[e.archetype];null!==r&&void 0!==r&&r.commandCapable||"commander"===e.archetype||n.push("archetype_not_traditionally_commander");e.commandLoadout&&e.commandLoadout.length>tt&&t.push("too_many_command_abilities");e.auras&&e.auras.length>et&&t.push("too_many_auras");return{ok:0===t.length,reasons:t,warnings:n.length>0?n:void 0}}(e);t.ok||r.push(...t.reasons),t.warnings&&a.push(...t.warnings)}if(e.formation){const t=function(e,t){const n=[],r=[];["front","back"].includes(e.row)||n.push("invalid_formation_row");(e.slot<0||e.slot>5)&&n.push("invalid_formation_slot");void 0!==e.facing&&(e.facing<0||e.facing>5)&&n.push("invalid_formation_facing");const a=Xe[t];null!==a&&void 0!==a&&a.formationPreference&&"flexible"!==a.formationPreference&&e.row!==a.formationPreference&&r.push("archetype_".concat(t,"_prefers_").concat(a.formationPreference,"_row"));return{ok:0===n.length,reasons:n,warnings:r.length>0?r:void 0}}(e.formation,e.archetype);t.ok||r.push(...t.reasons),t.warnings&&a.push(...t.warnings)}return{ok:0===r.length,reasons:r,warnings:a.length>0?a:void 0}}function rt(e,t){const n=Xe[t.archetype];!function(e,t,n){var r,a;if(!e.meta)return;e.meta.equipment={weapon:at(t.defaultEquipment.weapon),armor:at(t.defaultEquipment.armor),shield:t.defaultEquipment.shield?at(t.defaultEquipment.shield):void 0},null!==(r=n.equipment)&&void 0!==r&&r.weaponType&&(e.meta.equipment.weapon=at("".concat(n.equipment.weaponType,"_weapon")));null!==(a=n.equipment)&&void 0!==a&&a.armorType&&(e.meta.equipment.armor=at("".concat(n.equipment.armorType,"_armor")));!function(e){var t;if(null===(t=e.meta)||void 0===t||!t.equipment)return;const n=e.meta.equipment;n.weapon&&(n.weapon.damage&&(e.stats.atk+=Math.floor(n.weapon.damage/2)),n.weapon.magicBonus&&(e.stats.mag+=n.weapon.magicBonus),n.weapon.speedBonus&&(e.stats.spd+=n.weapon.speedBonus),n.weapon.range&&(e.stats.rng=Math.max(e.stats.rng,n.weapon.range)));n.armor&&(n.armor.defense&&(e.stats.def+=n.armor.defense),n.armor.magicResistance&&(e.stats.res+=n.armor.magicResistance),n.armor.speedPenalty&&(e.stats.spd-=n.armor.speedPenalty),n.armor.speedBonus&&(e.stats.spd+=n.armor.speedBonus));n.shield&&(n.shield.defense&&(e.stats.def+=n.shield.defense),n.shield.speedPenalty&&(e.stats.spd-=n.shield.speedPenalty));e.stats.spd=Math.max(0,e.stats.spd)}(e)}(e,n,t),function(e,t){if(!e.meta)return;e.skills=[...t.startingAbilities];const n=Math.floor(e.level/3);for(let r=0;r<n;r++){const t="level_".concat(3*(r+1),"_ability");e.skills.includes(t)||e.skills.push(t)}}(e,n),function(e,t){if(!e.meta||!t.spells)return;const n=t.spells.filter(t=>function(e,t){var n;if(null===(n=e.meta)||void 0===n||!n.magicMasteries||!t.school)return!1;const r=e.meta.magicMasteries[t.school]||0,a=Math.min(4,Math.ceil((t.level||0)/2)+1);return r>=a}(e,t));e.meta.knownSpells=n.map(e=>e.id)}(e,t)}function at(e){return{iron_sword:{id:"iron_sword",name:"Iron Sword",slot:"weapon",type:"sword",damage:6,accuracy:85,properties:["melee"]},shortbow:{id:"shortbow",name:"Short Bow",slot:"weapon",type:"bow",damage:5,accuracy:80,range:4,properties:["ranged"]},oak_staff:{id:"oak_staff",name:"Oak Staff",slot:"weapon",type:"staff",damage:3,accuracy:90,magicBonus:2,properties:["magical","two_handed"]},ash_wand:{id:"ash_wand",name:"Ash Wand",slot:"weapon",type:"wand",damage:2,accuracy:95,magicBonus:3,properties:["magical","divine"]},knight_sword:{id:"knight_sword",name:"Knight's Sword",slot:"weapon",type:"sword",damage:8,accuracy:90,properties:["melee","masterwork"]},mystic_orb:{id:"mystic_orb",name:"Mystic Orb",slot:"weapon",type:"orb",damage:1,accuracy:100,magicBonus:4,properties:["magical","arcane"]},guardian_staff:{id:"guardian_staff",name:"Guardian Staff",slot:"weapon",type:"staff",damage:4,accuracy:85,magicBonus:2,defenseBonus:1,properties:["magical","protective"]},chanter_harp:{id:"chanter_harp",name:"Chanter's Harp",slot:"weapon",type:"instrument",damage:1,accuracy:100,magicBonus:3,properties:["magical","sonic"]},corsair_blade:{id:"corsair_blade",name:"Corsair Blade",slot:"weapon",type:"sword",damage:5,accuracy:90,speedBonus:1,properties:["melee","finesse"]},cloth_robes:{id:"cloth_robes",name:"Cloth Robes",slot:"armor",type:"cloth",defense:1,magicResistance:2,properties:["light"]},leather_armor:{id:"leather_armor",name:"Leather Armor",slot:"armor",type:"leather",defense:3,speedPenalty:0,properties:["medium"]},brigandine:{id:"brigandine",name:"Brigandine",slot:"armor",type:"mail",defense:5,speedPenalty:1,properties:["heavy"]},plate_armor:{id:"plate_armor",name:"Plate Armor",slot:"armor",type:"plate",defense:7,speedPenalty:2,properties:["heavy","masterwork"]},enchanted_robes:{id:"enchanted_robes",name:"Enchanted Robes",slot:"armor",type:"cloth",defense:2,magicResistance:4,magicBonus:1,properties:["light","magical"]},guardian_mail:{id:"guardian_mail",name:"Guardian Mail",slot:"armor",type:"mail",defense:4,magicResistance:2,speedPenalty:1,properties:["medium","protective"]},performer_garb:{id:"performer_garb",name:"Performer's Garb",slot:"armor",type:"cloth",defense:1,charismaBonus:1,properties:["light","stylish"]},corsair_coat:{id:"corsair_coat",name:"Corsair Coat",slot:"armor",type:"leather",defense:2,speedBonus:1,properties:["medium","stylish"]},round_shield:{id:"round_shield",name:"Round Shield",slot:"shield",type:"shield",defense:2,blockChance:15,properties:["defensive"]},knight_shield:{id:"knight_shield",name:"Knight's Shield",slot:"shield",type:"shield",defense:3,blockChance:20,properties:["defensive","masterwork"]},tower_shield:{id:"tower_shield",name:"Tower Shield",slot:"shield",type:"shield",defense:4,blockChance:25,speedPenalty:1,properties:["defensive","heavy"]}}[e]||{id:e,name:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),slot:"weapon",type:"unknown",damage:1,accuracy:70,properties:[]}}function it(e){const t=nt(e);if(!t.ok)return{hero:{},errors:t.reasons.map(e=>{return{character_name_required:"Character name is required.",team_assignment_required:"Team assignment is required.",invalid_level_range:"Character level must be between 1 and 20.",stat_budget_exceeded:"Stat allocation exceeds available points.",commander_requires_level_3:"Commander path requires at least level 3.",commander_requires_charisma_12:"Commander path requires at least 12 Charisma.",too_many_spells:"Too many spells selected for this level.",invalid_mastery_rank:"Invalid mastery rank for character level."}[t=e]||"Error: ".concat(t);var t})};try{var n;const a=function(e){const t=Ye[e.species],n=Ke[e.background],a=(0,r.A)({},e.stats);for(const[r,i]of Object.entries(t.statModifiers))void 0!==a[r]&&void 0!==i&&(a[r]+=i);for(const[r,i]of Object.entries(n.statModifiers))void 0!==a[r]&&void 0!==i&&(a[r]+=i);for(const r of Object.keys(a)){const e=r;a[e]=Math.max(3,Math.min(20,a[e]))}return{hp:1,maxHp:1,atk:Math.floor((a.str-10)/2),def:Math.floor((a.con-10)/2),mag:Math.floor((a.int-10)/2),res:Math.floor((a.wis-10)/2),spd:Math.floor((a.dex-10)/2)+Math.floor((a.spd-10)/2),rng:1,move:3+Math.floor((a.spd-10)/4)}}(e),i=function(e,t){var n;e.archetype;const r={id:ot("HERO"),name:e.name,kind:e.wantsCommander?"HeroCommander":"Mercenary",faction:"Player",team:e.team,race:e.species,archetype:e.archetype,level:e.level,stats:t,statuses:[],skills:[],pos:void 0,isCommander:e.wantsCommander||!1,isDead:!1,facing:(null===(n=e.formation)||void 0===n?void 0:n.facing)||0,hasMoved:!1,hasActed:!1,meta:{isHero:!0,species:e.species,background:e.background,baseStats:e.stats,formation:e.formation,magicMasteries:{},knownSpells:[],traits:e.traits||[],portraitSeed:e.portraitSeed,creationSeed:e.seed}};if(e.masteries&&r.meta)for(const a of e.masteries)r.meta.magicMasteries[a.school]=a.rank;e.spells&&r.meta&&(r.meta.knownSpells=e.spells.map(e=>e.id));return r}(e,a);rt(i,e),function(e){var t,n,r,a,i,o,s,l,c,d;const u=(null===(t=e.meta)||void 0===t||null===(n=t.baseStats)||void 0===n?void 0:n.con)||10,h=(null===(r=e.meta)||void 0===r||null===(a=r.baseStats)||void 0===a?void 0:a.int)||10,p=(null===(i=e.meta)||void 0===i||null===(o=i.baseStats)||void 0===o?void 0:o.wis)||10,m=Math.floor((u-10)/2),f=10+m+e.level*Math.max(1,m+2);e.stats.maxHp=f,e.stats.hp=f;const g=Math.floor((h-10)/2),y=Math.floor((p-10)/2),x=Math.max(g,y);if((null===(s=e.meta)||void 0===s||null===(l=s.knownSpells)||void 0===l?void 0:l.length)>0&&e.meta){const t=Math.max(0,x+e.level);e.meta.maxMp=t,e.meta.mp=t}const v=(null===(c=e.meta)||void 0===c||null===(d=c.baseStats)||void 0===d?void 0:d.spd)||10,b=Math.floor((v-10)/2);e.meta&&(e.meta.maxAp=10+b,e.meta.ap=e.meta.maxAp)}(i),e.wantsCommander&&function(e,t){var n;if(e.isCommander=!0,e.kind="HeroCommander",!e.meta)return;const r=(null===(n=e.meta.baseStats)||void 0===n?void 0:n.cha)||10,a=Math.floor((r-10)/2);e.meta.commandRadius=2+Math.max(0,a),t.auras&&(e.meta.auras=t.auras);t.commandLoadout&&(e.meta.commandAbilities=t.commandLoadout);e.stats.atk+=1,e.stats.def+=1}(i,e);const o=function(e,t){var n,r,a,i;const o=Ye[t.species],s=Ke[t.background],l=Xe[t.archetype];let c="".concat(o.name," ").concat(l.name);e.isCommander&&(c="".concat(c," Commander"));const d="A level ".concat(e.level," ").concat(o.name.toLowerCase()," ").concat(l.name.toLowerCase()," ")+"with a ".concat(s.name.toLowerCase()," background. ").concat(o.description);let u=l.combatRole;e.isCommander&&(u="leader");const h=[];if(null!==(n=e.meta)&&void 0!==n&&n.magicMasteries)for(const[g,y]of Object.entries(e.meta.magicMasteries)){const e=["","Basic","Skilled","Expert","Grandmaster"][y]||"Unknown";h.push("".concat(e," ").concat(g," Magic"))}"ranged"===l.combatRole?h.push("Ranged Combat"):"melee"===l.combatRole&&h.push("Melee Combat");const p=(null===(r=e.meta)||void 0===r?void 0:r.knownSpells)||[],m=[];null!==(a=e.meta)&&void 0!==a&&a.formation&&m.push("Prefers ".concat(e.meta.formation.row," row positioning"));"flexible"!==l.formationPreference&&m.push("".concat(l.name,"s typically fight in the ").concat(l.formationPreference));var f;e.isCommander&&m.push("Commands from within ".concat((null===(f=e.meta)||void 0===f?void 0:f.commandRadius)||2," hex radius"));return{name:e.name,title:c,description:d,combatRole:u,specialization:h,knownSpells:p,commandAbilities:null===(i=e.meta)||void 0===i?void 0:i.commandAbilities,tacticalNotes:m}}(i,e);return{hero:i,summary:o,errors:null===(n=t.warnings)||void 0===n?void 0:n.map(e=>{return{stat_points_remaining:"You have unspent stat points.",extremely_specialized_build:"This is an extremely specialized build.",archetype_not_traditionally_commander:"This archetype is not traditionally suited for command.",non_caster_with_many_spells:"Non-casters typically know fewer spells.",ranged_weapon_on_non_ranged_archetype:"Ranged weapons are unusual for this archetype."}[t=e]||"Warning: ".concat(t);var t})}}catch(a){return{hero:{},errors:["Character creation failed: ".concat(a instanceof Error?a.message:"Unknown error")]}}}function ot(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"UNIT";const t=Date.now().toString(36),n=Math.random().toString(36).substring(2,7);return"".concat(e,"_").concat(t,"_").concat(n)}const st=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;const n=["human","sylvanborn","nightborn","stormcaller","crystalborn","draketh","alloy","voidkin"],r=["commoner","noble","outcast","acolyte","ranger","scholar","mercenary","wanderer"],a=["warrior","ranger","mage","priest","commander","knight","mystic","guardian","chanter","corsair"],i=n[Math.floor(Math.random()*n.length)],o=r[Math.floor(Math.random()*r.length)],s=t||a[Math.floor(Math.random()*a.length)],l=Ge(e),c={str:8,dex:8,con:8,int:8,wis:8,cha:8,spd:8,lck:8},d=Xe[s];let u=l;const h=Object.keys(c);for(;u>0;){const e=h[Math.floor(Math.random()*h.length)];if(c[e]<Ue){const t=Ve(c[e]+1);t<=u&&(c[e]++,u-=t)}if(u<=0)break}return{name:lt(i),team:"Player",species:i,background:o,archetype:s,level:e,stats:c,masteries:ct(s,e),formation:{row:"flexible"===d.formationPreference?Math.random()>.5?"front":"back":d.formationPreference,slot:Math.floor(6*Math.random()),facing:Math.floor(6*Math.random())}}};function lt(e){const t={human:["Marcus","Elena","Thomas","Isabella","William","Catherine","James","Victoria"],sylvanborn:["Lyralei","Silvanos","Mirana","Thessarian","Alleria","Tyrande","Malfurion","Lunara"],nightborn:["Shar","Nyx","Umbra","Raven","Nocturne","Vesper","Shadow","Dusk"],stormcaller:["Tempest","Gale","Thunder","Lightning","Storm","Zephyr","Nimbus","Cyclone"],crystalborn:["Prism","Quartz","Diamond","Ruby","Sapphire","Emerald","Crystal","Gemma"],draketh:["Pyraxis","Ignus","Flameheart","Ember","Cinder","Blaze","Inferno","Scorch"],alloy:["Steelforge","Ironcore","Copper","Chrome","Titanium","Bronze","Silver","Platinum"],voidkin:["Void","Nexus","Cosmos","Stellar","Astral","Nova","Nebula","Quantum"]},n=t[e]||t.human;return n[Math.floor(Math.random()*n.length)]}function ct(e,t){const n=Xe[e];if(!n.magicTraditions)return[];const r=[],a=[...n.magicTraditions],i=t>=5?2:1;for(let o=0;o<i&&a.length>0;o++){const e=Math.floor(Math.random()*a.length),n=a[e];a.splice(e,1);let i=1;t>=10?i=Math.min(4,Math.floor(3*Math.random())+2):t>=7?i=Math.min(3,Math.floor(2*Math.random())+2):t>=4&&(i=Math.min(2,Math.floor(2*Math.random())+1)),r.push({school:n,rank:i})}return r}const dt={human:{name:"Human",bonus:"+1 to all stats"},sylvanborn:{name:"Elf",bonus:"+2 DEX, +1 WIS, -1 CON"},nightborn:{name:"Dark Elf",bonus:"+2 INT, +1 DEX, -1 CON"},stormcaller:{name:"Storm Giant",bonus:"+3 STR, +1 CON, -2 INT"},crystalborn:{name:"Crystal Dwarf",bonus:"+2 CON, +1 WIS, -1 DEX"},draketh:{name:"Dragonkin",bonus:"+2 STR, +1 CHA, -1 WIS"},alloy:{name:"Construct",bonus:"+2 CON, +1 STR, -1 CHA"},voidkin:{name:"Void Walker",bonus:"+2 INT, +1 LCK, -1 STR"}},ut={commoner:{name:"Commoner",benefit:"Hardy constitution"},noble:{name:"Noble",benefit:"Leadership training"},outcast:{name:"Outcast",benefit:"Self-reliance"},acolyte:{name:"Acolyte",benefit:"Divine knowledge"},ranger:{name:"Ranger",benefit:"Nature skills"},scholar:{name:"Scholar",benefit:"Arcane lore"},mercenary:{name:"Mercenary",benefit:"Combat experience"},wanderer:{name:"Wanderer",benefit:"Survival instincts"}},ht={warrior:{name:"Fighter",role:"Melee Combat"},ranger:{name:"Ranger",role:"Ranged Combat"},mage:{name:"Sorcerer",role:"Arcane Magic"},priest:{name:"Cleric",role:"Divine Magic"},commander:{name:"Paladin",role:"Leadership"},knight:{name:"Knight",role:"Heavy Combat"},mystic:{name:"Druid",role:"Nature Magic"},guardian:{name:"Barbarian",role:"Berserker"},chanter:{name:"Bard",role:"Support Magic"},corsair:{name:"Thief",role:"Stealth & Speed"}},pt=["Fire","Air","Water","Earth","Spirit","Shadow","Nature","Arcane","Divine"],mt={Brave:{name:"Brave",description:"Resistant to fear and intimidation effects",bonus:"courage +2"},Clever:{name:"Clever",description:"Quick thinking in complex situations",bonus:"investigation +2"},Cunning:{name:"Cunning",description:"Skilled at deception and misdirection",bonus:"stealth +2"},Empathic:{name:"Empathic",description:"Deeply understands others' emotions",bonus:"persuasion +2"},Stoic:{name:"Stoic",description:"Unshaken by pain or hardship",bonus:"endurance +2"},Lucky:{name:"Lucky",description:"Fortune favors you",bonus:"reroll once per encounter"},Observant:{name:"Observant",description:"Notice details others miss",bonus:"perception +2"},"Silver Tongue":{name:"Silver Tongue",description:"Naturally persuasive speaker",bonus:"social +2"},"Iron Will":{name:"Iron Will",description:"Mental fortitude against magical effects",bonus:"mental defense +2"},Swift:{name:"Swift",description:"Faster movement and reflexes",bonus:"speed +2"},"Nature's Friend":{name:"Nature's Friend",description:"Animals and plants respond favorably",bonus:"nature +2"},"Keen Senses":{name:"Keen Senses",description:"Enhanced sensory perception",bonus:"detection +2"},Patient:{name:"Patient",description:"Calm and methodical approach",bonus:"concentration +2"},Resilient:{name:"Resilient",description:"Exceptionally tough constitution",bonus:"+2 HP per level"},Hardy:{name:"Hardy",description:"Natural toughness and endurance",bonus:"+1 HP per level"},Frail:{name:"Frail",description:"Delicate constitution, but often comes with other gifts",bonus:"-2 HP per level"}};const ft=e=>{let{onCharacterCreated:t,onCancel:n}=e;const[i,o]=(0,a.useState)("identity"),[s,l]=(0,a.useState)({name:"",gender:"male",team:"Player",species:"human",background:"commoner",archetype:"warrior",level:1,stats:{str:8,dex:8,con:8,int:8,wis:8,cha:8,spd:8,lck:8},masteries:[],traits:[],knownSpells:[],knownCantrips:[],formation:{row:"front",slot:0,facing:0}}),c=(0,a.useMemo)(()=>nt(s),[s]),d=Ge(s.level),u=Object.values(s.stats).reduce((e,t)=>{let n=0;for(let r=8;r<t;r++)n+=Ve(r+1);return e+n},0),h=d-u,p=(e,t)=>{const n=s.stats[e]+t;if(n<3||n>Ue)return;const a=(0,r.A)((0,r.A)({},s.stats),{},{[e]:n});Object.values(a).reduce((e,t)=>{let n=0;for(let r=8;r<t;r++)n+=Ve(r+1);return e+n},0)<=d&&l(e=>(0,r.A)((0,r.A)({},e),{},{stats:a}))},m=()=>{const e=st(s.level,s.archetype);l(t=>(0,r.A)((0,r.A)((0,r.A)({},t),e),{},{name:t.name||e.name}))};return(0,w.jsxs)("div",{className:"classic-character-creator",children:[(0,w.jsxs)("div",{className:"creator-header",children:[(0,w.jsx)("h1",{children:"CREATE CHARACTER"}),(0,w.jsxs)("div",{className:"step-indicator",children:["Step ","identity"===i?1:"stats"===i?2:"traits"===i?3:"magic"===i?4:"spells"===i?5:6," of 6"]})]}),(0,w.jsxs)("div",{className:"creator-content",children:["identity"===i&&(0,w.jsxs)("div",{className:"creation-step",children:[(0,w.jsx)("h2",{children:"CHARACTER IDENTITY"}),(0,w.jsxs)("div",{className:"identity-layout",children:[(0,w.jsxs)("div",{className:"identity-left",children:[(0,w.jsxs)("div",{className:"field-row",children:[(0,w.jsx)("label",{children:"Name:"}),(0,w.jsx)("input",{type:"text",value:s.name,onChange:e=>l(t=>(0,r.A)((0,r.A)({},t),{},{name:e.target.value})),placeholder:"Enter character name",className:"text-input"})]}),(0,w.jsxs)("div",{className:"field-row",children:[(0,w.jsx)("label",{children:"Gender:"}),(0,w.jsxs)("select",{value:s.gender,onChange:e=>l(t=>(0,r.A)((0,r.A)({},t),{},{gender:e.target.value})),className:"dropdown",children:[(0,w.jsx)("option",{value:"male",children:"Male"}),(0,w.jsx)("option",{value:"female",children:"Female"})]})]}),(0,w.jsxs)("div",{className:"field-row",children:[(0,w.jsx)("label",{children:"Level:"}),(0,w.jsx)("select",{value:s.level,onChange:e=>l(t=>(0,r.A)((0,r.A)({},t),{},{level:parseInt(e.target.value)})),className:"dropdown",children:[1,2,3,4,5,6,7,8,9,10].map(e=>(0,w.jsxs)("option",{value:e,children:["Level ",e]},e))})]})]}),(0,w.jsx)("div",{className:"identity-right",children:(0,w.jsxs)("div",{className:"portrait-preview",children:[(0,w.jsx)("h3",{children:"PORTRAIT"}),s.name&&s.species&&s.archetype&&(0,w.jsx)(S,{gender:s.gender,species:s.species,archetype:s.archetype,size:"large",showDebug:!1})]})})]}),(0,w.jsxs)("div",{className:"selection-grid",children:[(0,w.jsxs)("div",{className:"selection-column",children:[(0,w.jsx)("h3",{children:"RACE"}),Object.entries(dt).map(e=>{let[t,n]=e;return(0,w.jsxs)("div",{className:"selection-item ".concat(s.species===t?"selected":""),onClick:()=>l(e=>(0,r.A)((0,r.A)({},e),{},{species:t})),children:[(0,w.jsx)("div",{className:"item-name",children:n.name}),(0,w.jsx)("div",{className:"item-bonus",children:n.bonus})]},t)})]}),(0,w.jsxs)("div",{className:"selection-column",children:[(0,w.jsx)("h3",{children:"BACKGROUND"}),Object.entries(ut).map(e=>{let[t,n]=e;return(0,w.jsxs)("div",{className:"selection-item ".concat(s.background===t?"selected":""),onClick:()=>l(e=>(0,r.A)((0,r.A)({},e),{},{background:t})),children:[(0,w.jsx)("div",{className:"item-name",children:n.name}),(0,w.jsx)("div",{className:"item-benefit",children:n.benefit})]},t)})]}),(0,w.jsxs)("div",{className:"selection-column",children:[(0,w.jsx)("h3",{children:"CLASS"}),Object.entries(ht).map(e=>{let[t,n]=e;return(0,w.jsxs)("div",{className:"selection-item ".concat(s.archetype===t?"selected":""),onClick:()=>l(e=>(0,r.A)((0,r.A)({},e),{},{archetype:t})),children:[(0,w.jsx)("div",{className:"item-name",children:n.name}),(0,w.jsx)("div",{className:"item-role",children:n.role})]},t)})]})]})]}),"stats"===i&&(0,w.jsxs)("div",{className:"creation-step",children:[(0,w.jsx)("h2",{children:"ATTRIBUTES"}),(0,w.jsxs)("div",{className:"points-display",children:["Points Remaining: ",(0,w.jsx)("span",{className:"points-value",children:h})]}),(0,w.jsx)("div",{className:"stats-grid",children:Object.entries(s.stats).map(e=>{let[t,n]=e;return(0,w.jsxs)("div",{className:"stat-row",children:[(0,w.jsxs)("label",{className:"stat-label",children:[t.toUpperCase(),":"]}),(0,w.jsx)("button",{className:"stat-button",onClick:()=>p(t,-1),disabled:n<=3,children:"-"}),(0,w.jsx)("span",{className:"stat-value",children:n}),(0,w.jsx)("button",{className:"stat-button",onClick:()=>p(t,1),disabled:n>=Ue||Ve(n+1)>h,children:"+"}),(0,w.jsxs)("span",{className:"stat-cost",children:["(Cost: ",n<Ue?Ve(n+1):"MAX",")"]})]},t)})}),(0,w.jsx)("button",{className:"randomize-button",onClick:m,children:"RANDOMIZE STATS"})]}),"traits"===i&&(0,w.jsxs)("div",{className:"creation-step",children:[(0,w.jsx)("h2",{children:"CHARACTER TRAITS"}),(0,w.jsx)("div",{className:"traits-info",children:"Choose up to 3 personality traits that define your character. These provide both roleplay guidance and mechanical benefits."}),(0,w.jsx)("div",{className:"traits-grid",children:Object.entries(mt).map(e=>{let[t,n]=e;const a=s.traits.includes(t),i=!a&&s.traits.length>=3;return(0,w.jsxs)("div",{className:"trait-item ".concat(a?"selected":""," ").concat(i?"disabled":""),onClick:()=>{a?l(e=>(0,r.A)((0,r.A)({},e),{},{traits:e.traits.filter(e=>e!==t)})):i||l(e=>(0,r.A)((0,r.A)({},e),{},{traits:[...e.traits,t]}))},children:[(0,w.jsx)("div",{className:"trait-name",children:n.name}),(0,w.jsx)("div",{className:"trait-description",children:n.description}),(0,w.jsx)("div",{className:"trait-bonus",children:n.bonus})]},t)})}),(0,w.jsxs)("div",{className:"traits-selected",children:["Selected: ",s.traits.length," / 3"]})]}),"magic"===i&&(0,w.jsxs)("div",{className:"creation-step",children:[(0,w.jsx)("h2",{children:"MAGIC SCHOOLS"}),(0,w.jsx)("div",{className:"magic-info",children:"Select mastery levels in magic schools (if applicable to your class). Higher levels unlock more powerful spells."}),(0,w.jsx)("div",{className:"magic-grid",children:pt.map(e=>{const t=s.masteries.find(t=>t.school===e),n=(null===t||void 0===t?void 0:t.rank)||0;return(0,w.jsxs)("div",{className:"magic-school",children:[(0,w.jsx)("div",{className:"school-name",children:e}),(0,w.jsx)("div",{className:"mastery-buttons",children:[0,1,2,3,4].map(t=>(0,w.jsx)("button",{className:"mastery-button ".concat(n===t?"selected":""),onClick:()=>((e,t)=>{const n=[...s.masteries],a=n.findIndex(t=>t.school===e);a>=0?0===t?n.splice(a,1):n[a].rank=t:t>0&&n.push({school:e,rank:t}),l(e=>(0,r.A)((0,r.A)({},e),{},{masteries:n}))})(e,t),children:0===t?"None":t},t))})]},e)})})]}),"spells"===i&&(()=>{const e=function(e,t,n){const r=Math.floor(e/2)+1,a=Math.floor((Math.max(t,n)-10)/2);return Math.max(1,r+Math.max(0,a))}(s.level,s.stats.int,s.stats.wis),t=function(e,t,n){if(e<2)return 0;const r=Math.max(0,e-1),a=Math.floor((Math.max(t,n)-12)/2);return Math.max(0,r+Math.max(0,a))}(s.level,s.stats.int,s.stats.wis),n=(a=s.level)<2?0:Math.min(9,Math.floor((a+1)/2));var a;return(0,w.jsxs)("div",{className:"creation-step",children:[(0,w.jsx)("h2",{children:"SPELLS & CANTRIPS"}),(0,w.jsxs)("div",{className:"spells-info",children:[(0,w.jsxs)("div",{children:["Cantrips: ",s.knownCantrips.length," / ",e]}),(0,w.jsxs)("div",{children:["Spells: ",s.knownSpells.length," / ",t]}),(0,w.jsxs)("div",{children:["Max Spell Level: ",n]})]}),(0,w.jsx)("div",{className:"spells-note",children:"Spell selection is simplified for this demo. In the full game, you'll choose from your class's spell list. For now, this shows your spellcasting capacity."}),(0,w.jsxs)("div",{className:"spells-actions",children:[(0,w.jsxs)("button",{className:"spell-button",onClick:()=>{s.knownCantrips.length<e&&l(e=>(0,r.A)((0,r.A)({},e),{},{knownCantrips:[...e.knownCantrips,"Cantrip ".concat(e.knownCantrips.length+1)]}))},disabled:s.knownCantrips.length>=e,children:["Add Cantrip (",s.knownCantrips.length,"/",e,")"]}),(0,w.jsxs)("button",{className:"spell-button",onClick:()=>{s.knownSpells.length<t&&s.level>=2&&l(e=>(0,r.A)((0,r.A)({},e),{},{knownSpells:[...e.knownSpells,"Spell ".concat(e.knownSpells.length+1)]}))},disabled:s.knownSpells.length>=t||s.level<2,children:["Add Spell (",s.knownSpells.length,"/",t,")"]})]}),(0,w.jsxs)("div",{className:"known-spells",children:[s.knownCantrips.length>0&&(0,w.jsxs)("div",{className:"spell-list",children:[(0,w.jsx)("h4",{children:"Cantrips:"}),s.knownCantrips.map((e,t)=>(0,w.jsxs)("div",{className:"spell-item",children:[e,(0,w.jsx)("button",{onClick:()=>{l(e=>(0,r.A)((0,r.A)({},e),{},{knownCantrips:e.knownCantrips.filter((e,n)=>n!==t)}))},children:"\xd7"})]},t))]}),s.knownSpells.length>0&&(0,w.jsxs)("div",{className:"spell-list",children:[(0,w.jsx)("h4",{children:"Spells:"}),s.knownSpells.map((e,t)=>(0,w.jsxs)("div",{className:"spell-item",children:[e,(0,w.jsx)("button",{onClick:()=>{l(e=>(0,r.A)((0,r.A)({},e),{},{knownSpells:e.knownSpells.filter((e,n)=>n!==t)}))},children:"\xd7"})]},t))]})]})]})})(),"review"===i&&(0,w.jsxs)("div",{className:"creation-step",children:[(0,w.jsx)("h2",{children:"CHARACTER SUMMARY"}),(0,w.jsxs)("div",{className:"character-summary",children:[(0,w.jsxs)("div",{className:"summary-section",children:[(0,w.jsx)("h3",{children:"Identity"}),(0,w.jsxs)("div",{children:["Name: ",s.name||"Unnamed"]}),(0,w.jsxs)("div",{children:["Gender: ",s.gender]}),(0,w.jsxs)("div",{children:["Race: ",dt[s.species].name]}),(0,w.jsxs)("div",{children:["Background: ",ut[s.background].name]}),(0,w.jsxs)("div",{children:["Class: ",ht[s.archetype].name]}),(0,w.jsxs)("div",{children:["Level: ",s.level]})]}),(0,w.jsxs)("div",{className:"summary-section",children:[(0,w.jsx)("h3",{children:"Attributes"}),Object.entries(s.stats).map(e=>{let[t,n]=e;return(0,w.jsxs)("div",{children:[t.toUpperCase(),": ",n]},t)})]}),(0,w.jsxs)("div",{className:"summary-section",children:[(0,w.jsx)("h3",{children:"Traits"}),s.traits.length>0?s.traits.map(e=>(0,w.jsx)("div",{children:mt[e].name},e)):(0,w.jsx)("div",{children:"No traits selected"})]}),(0,w.jsxs)("div",{className:"summary-section",children:[(0,w.jsx)("h3",{children:"Magic Schools"}),s.masteries.length>0?s.masteries.map(e=>(0,w.jsxs)("div",{children:[e.school,": Level ",e.rank]},e.school)):(0,w.jsx)("div",{children:"No magic training"})]}),(0,w.jsxs)("div",{className:"summary-section",children:[(0,w.jsx)("h3",{children:"Spells"}),(0,w.jsxs)("div",{children:["Cantrips: ",s.knownCantrips.length]}),(0,w.jsxs)("div",{children:["Spells: ",s.knownSpells.length]})]})]}),!c.ok&&(0,w.jsxs)("div",{className:"validation-errors",children:[(0,w.jsx)("h3",{children:"Errors:"}),c.reasons.map((e,t)=>(0,w.jsx)("div",{className:"error-message",children:e},t))]})]})]}),(0,w.jsxs)("div",{className:"creator-footer",children:[(0,w.jsx)("button",{className:"nav-button",onClick:n,children:"CANCEL"}),"identity"!==i&&(0,w.jsx)("button",{className:"nav-button",onClick:()=>{const e=["identity","stats","traits","magic","spells","review"],t=e.indexOf(i);o(e[t-1])},children:"BACK"}),"review"!==i?(0,w.jsx)("button",{className:"nav-button primary",onClick:()=>{const e=["identity","stats","traits","magic","spells","review"],t=e.indexOf(i);o(e[t+1])},children:"NEXT"}):(0,w.jsx)("button",{className:"nav-button primary",onClick:()=>{if(c.ok){const e=it(s);null===t||void 0===t||t(e)}},disabled:!c.ok,children:"CREATE CHARACTER"})]})]})},gt=[{name:"Abjuration",description:"Protective magic",color:"#3b82f6"},{name:"Conjuration",description:"Summoning and creation",color:"#10b981"},{name:"Divination",description:"Information gathering",color:"#f59e0b"},{name:"Enchantment",description:"Mind control and charm",color:"#ec4899"},{name:"Evocation",description:"Destructive energy",color:"#ef4444"},{name:"Healing",description:"Restoration and recovery",color:"#22c55e"},{name:"Illusion",description:"Deception and trickery",color:"#8b5cf6"},{name:"Necromancy",description:"Death and undeath",color:"#6b7280"},{name:"Transmutation",description:"Transformation",color:"#06b6d4"}],yt=["1 action","1 bonus action","1 reaction","2 actions","3 actions","1 full round","2 rounds","3 rounds","1 minute","10 minutes","1 hour"],xt=["Self","Touch","10 feet","30 feet","60 feet","120 feet","300 feet","500 feet","1 mile","Sight","Special"],vt=["Instantaneous","1 round","2 rounds","3 rounds","5 rounds","10 rounds","1 minute (10 rounds)","10 minutes","1 hour","8 hours","24 hours","Until dispelled","Permanent","Concentration, up to 1 round","Concentration, up to 3 rounds","Concentration, up to 10 rounds","Concentration, up to 10 minutes","Concentration, up to 1 hour"],bt={verbal:["Simple word","Quick chant","Whispered phrase","Ancient incantation","Mystical chant","Power word","Arcane phrase","Sacred prayer","Elemental call","Divine invocation"],somatic:["Quick gesture","Simple motion","Finger snap","Hand wave","Precise gestures","Complex hand movements","Ritualistic dance","Finger patterns","Sweeping motions","Sacred signs"],material:["Small focus","Tiny crystal","Bit of string","Drop of water","Crystal focus","Rare herbs","Precious metals","Ancient runes","Elemental essence","Sacred symbols","Diamond dust","Silver wire"]},wt={0:{damage:"1d4 to 1d6",healing:"1d4",effects:"Minor utility, small bonuses (+1), brief duration",limitations:"Single target, short range, minimal impact"},1:{damage:"1d8 to 3d6",healing:"1d8 + modifier",effects:"Basic combat/utility, small area effects, moderate bonuses (+2)",limitations:"Limited targets, moderate range and duration"},2:{damage:"2d8 to 5d6",healing:"2d8 + modifier",effects:"Enhanced effects, larger areas, significant bonuses (+3-4)",limitations:"Multiple targets, good range and duration"},3:{damage:"3d8 to 8d6",healing:"3d8 + modifier",effects:"Powerful effects, condition removal, major bonuses (+4-5)",limitations:"Large areas, long duration, powerful utility"}};function kt(e){let{onBack:t,onSpellCreated:n}=e;const[i,o]=(0,a.useState)({name:"",level:0,school:"Evocation",castingTime:"1 action",range:"60 feet",duration:"Instantaneous",description:"",components:{verbal:!1,somatic:!1,material:!1,verbalDetail:"Ancient incantation",somaticDetail:"Precise gestures",materialDetail:"Crystal focus"}}),[s,l]=(0,a.useState)([]),[c,d]=(0,a.useState)(null),u=()=>{const e=(()=>{const e=[];return i.name.trim()||e.push("Spell name is required"),i.name.length>50&&e.push("Spell name too long (max 50 characters)"),i.description.trim()||e.push("Spell description is required"),i.description.length<20&&e.push("Spell description too short (minimum 20 characters)"),i.description.length>500&&e.push("Spell description too long (max 500 characters)"),i.components.verbal||i.components.somatic||i.components.material||e.push("Spell must have at least one component (Verbal, Somatic, or Material)"),0===i.level&&((i.duration.includes("hour")||i.duration.includes("day"))&&e.push("Cantrips cannot have durations longer than 10 minutes"),"1 mile"!==i.range&&"Sight"!==i.range||e.push("Cantrips should have limited range (max 120 feet)")),e})();if(e.length>0)return l(e),null;l([]);const t=[];i.components.verbal&&t.push("V (".concat(i.components.verbalDetail,")")),i.components.somatic&&t.push("S (".concat(i.components.somaticDetail,")")),i.components.material&&t.push("M (".concat(i.components.materialDetail,")"));const n=gt.find(e=>e.name===i.school)||gt[0];return{name:i.name,level:i.level,school:i.school,castingTime:i.castingTime,range:i.range,components:t,duration:i.duration,description:i.description,color:n.color}},h=()=>gt.find(e=>e.name===i.school)||gt[0],p=()=>wt[i.level]||wt[0];return(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",color:"#e2e8f0",padding:"2rem"},children:[(0,w.jsxs)("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #334155",background:"rgba(15, 23, 42, 0.8)",display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:"8px",marginBottom:"2rem"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{style:{margin:0,fontSize:"2.5rem",fontWeight:"bold"},children:"\u26a1 Custom Spell Creator"}),(0,w.jsx)("p",{style:{margin:"0.5rem 0 0",opacity:.8},children:"Create your own balanced spells with limitations and guidelines"})]}),t&&(0,w.jsx)("button",{onClick:t,style:{padding:"0.75rem 1.5rem",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem"},children:"Back"})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem"},children:[(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1.5rem",border:"1px solid #334155"},children:[(0,w.jsx)("h2",{style:{margin:"0 0 1.5rem",color:"#f1f5f9"},children:"\ud83d\udcdd Spell Details"}),(0,w.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#cbd5e1"},children:"Spell Name"}),(0,w.jsx)("input",{type:"text",value:i.name,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{name:e.target.value})),placeholder:"Enter spell name...",style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",fontSize:"1rem"}})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"1.5rem"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#cbd5e1"},children:"Spell Level"}),(0,w.jsxs)("select",{value:i.level,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{level:parseInt(e.target.value)})),style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",fontSize:"1rem"},children:[(0,w.jsx)("option",{value:0,children:"Cantrip"}),(0,w.jsx)("option",{value:1,children:"1st Level"}),(0,w.jsx)("option",{value:2,children:"2nd Level"}),(0,w.jsx)("option",{value:3,children:"3rd Level"})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#cbd5e1"},children:"School of Magic"}),(0,w.jsx)("select",{value:i.school,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{school:e.target.value})),style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",fontSize:"1rem"},children:gt.map(e=>(0,w.jsx)("option",{value:e.name,children:e.name},e.name))})]})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"1rem",marginBottom:"1.5rem"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#cbd5e1"},children:"Casting Time"}),(0,w.jsx)("select",{value:i.castingTime,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{castingTime:e.target.value})),style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",fontSize:"0.9rem"},children:yt.map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#cbd5e1"},children:"Range"}),(0,w.jsx)("select",{value:i.range,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{range:e.target.value})),style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",fontSize:"0.9rem"},children:xt.map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#cbd5e1"},children:"Duration"}),(0,w.jsx)("select",{value:i.duration,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{duration:e.target.value})),style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",fontSize:"0.9rem"},children:vt.map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.75rem",color:"#cbd5e1"},children:"Components"}),(0,w.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",marginBottom:"0.5rem"},children:[(0,w.jsx)("input",{type:"checkbox",checked:i.components.verbal,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{components:(0,r.A)((0,r.A)({},i.components),{},{verbal:e.target.checked})})),style:{marginRight:"0.5rem"}}),(0,w.jsx)("span",{style:{color:"#f9fafb"},children:"Verbal (V)"})]}),i.components.verbal&&(0,w.jsx)("select",{value:i.components.verbalDetail,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{components:(0,r.A)((0,r.A)({},i.components),{},{verbalDetail:e.target.value})})),style:{width:"100%",padding:"0.5rem",background:"#4b5563",border:"1px solid #6b7280",borderRadius:"4px",color:"#f9fafb",fontSize:"0.9rem"},children:bt.verbal.map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]}),(0,w.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",marginBottom:"0.5rem"},children:[(0,w.jsx)("input",{type:"checkbox",checked:i.components.somatic,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{components:(0,r.A)((0,r.A)({},i.components),{},{somatic:e.target.checked})})),style:{marginRight:"0.5rem"}}),(0,w.jsx)("span",{style:{color:"#f9fafb"},children:"Somatic (S)"})]}),i.components.somatic&&(0,w.jsx)("select",{value:i.components.somaticDetail,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{components:(0,r.A)((0,r.A)({},i.components),{},{somaticDetail:e.target.value})})),style:{width:"100%",padding:"0.5rem",background:"#4b5563",border:"1px solid #6b7280",borderRadius:"4px",color:"#f9fafb",fontSize:"0.9rem"},children:bt.somatic.map(e=>(0,w.jsx)("option",{value:e,children:e},e))})]}),(0,w.jsxs)("div",{children:[(0,w.jsxs)("label",{style:{display:"flex",alignItems:"center",marginBottom:"0.5rem"},children:[(0,w.jsx)("input",{type:"checkbox",checked:i.components.material,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{components:(0,r.A)((0,r.A)({},i.components),{},{material:e.target.checked})})),style:{marginRight:"0.5rem"}}),(0,w.jsx)("span",{style:{color:"#f9fafb"},children:"Material (M)"})]}),i.components.material&&(0,w.jsx)("input",{type:"text",value:i.components.materialDetail,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{components:(0,r.A)((0,r.A)({},i.components),{},{materialDetail:e.target.value})})),placeholder:"Describe material component...",style:{width:"100%",padding:"0.5rem",background:"#4b5563",border:"1px solid #6b7280",borderRadius:"4px",color:"#f9fafb",fontSize:"0.9rem"}})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"1.5rem"},children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",color:"#cbd5e1"},children:"Spell Description"}),(0,w.jsx)("textarea",{value:i.description,onChange:e=>o((0,r.A)((0,r.A)({},i),{},{description:e.target.value})),placeholder:"Describe what the spell does, its effects, damage, bonuses, etc...",rows:4,style:{width:"100%",padding:"0.75rem",background:"#374151",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",fontSize:"1rem",resize:"vertical"}}),(0,w.jsxs)("div",{style:{fontSize:"0.8rem",color:"#94a3b8",marginTop:"0.25rem"},children:[i.description.length,"/500 characters"]})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"1rem"},children:[(0,w.jsx)("button",{onClick:()=>{const e=u();d(e)},style:{flex:1,padding:"0.75rem",background:h().color,color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"\ud83d\udc41\ufe0f Preview Spell"}),(0,w.jsx)("button",{onClick:()=>{const e=u();e&&n&&n(e)},disabled:!c,style:{flex:1,padding:"0.75rem",background:c?"#059669":"#374151",color:"white",border:"none",borderRadius:"6px",cursor:c?"pointer":"not-allowed",fontSize:"1rem",fontWeight:"bold"},children:"\ud83d\udcbe Save Spell"})]}),s.length>0&&(0,w.jsxs)("div",{style:{marginTop:"1rem",padding:"1rem",background:"rgba(220, 38, 38, 0.2)",border:"1px solid #dc2626",borderRadius:"6px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.5rem",color:"#fca5a5"},children:"Validation Errors:"}),(0,w.jsx)("ul",{style:{margin:0,paddingLeft:"1.5rem",color:"#fca5a5"},children:s.map((e,t)=>(0,w.jsx)("li",{children:e},t))})]})]}),(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1.5rem",border:"2px solid ".concat(h().color)},children:[(0,w.jsxs)("h2",{style:{margin:"0 0 1rem",color:h().color},children:["\ud83d\udccb ",h().name," Guidelines"]}),(0,w.jsx)("p",{style:{margin:"0 0 1rem",color:"#cbd5e1",fontStyle:"italic"},children:h().description}),(0,w.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,w.jsxs)("h4",{style:{margin:"0 0 0.5rem",color:"#f1f5f9"},children:["Level ",i.level," ",0===i.level?"Cantrip":""," Limits:"]}),(0,w.jsxs)("div",{style:{fontSize:"0.9rem",color:"#94a3b8"},children:[(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Damage:"})," ",p().damage]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Healing:"})," ",p().healing]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Effects:"})," ",p().effects]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Limitations:"})," ",p().limitations]})]})]}),(0,w.jsxs)("div",{style:{padding:"1rem",background:"rgba(59, 130, 246, 0.1)",borderRadius:"6px",border:"1px solid #3b82f6"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.5rem",color:"#93c5fd"},children:"\ud83d\udca1 Design Tips:"}),(0,w.jsxs)("ul",{style:{margin:0,paddingLeft:"1.5rem",color:"#cbd5e1",fontSize:"0.9rem"},children:[(0,w.jsx)("li",{children:"Be specific about targets, ranges, and effects"}),(0,w.jsx)("li",{children:"Higher level spells should have more complex components"}),(0,w.jsx)("li",{children:"Balance damage with utility - not every spell needs to do damage"}),(0,w.jsx)("li",{children:"Consider what class would use this spell"}),(0,w.jsx)("li",{children:"Make effects interesting but not overpowered"})]})]})]}),c&&(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1.5rem",border:"2px solid ".concat(c.color)},children:[(0,w.jsx)("h2",{style:{margin:"0 0 1rem",color:"#f1f5f9"},children:"\ud83d\udc41\ufe0f Spell Preview"}),(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.8)",borderRadius:"6px",padding:"1.5rem",border:"1px solid ".concat(c.color)},children:[(0,w.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 0.25rem",color:c.color,fontSize:"1.5rem"},children:c.name}),(0,w.jsxs)("p",{style:{margin:0,color:"#94a3b8",fontSize:"0.9rem"},children:[0===c.level?"Cantrip":"".concat(c.level,"st Level")," ",c.school]})]}),(0,w.jsxs)("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Casting Time:"})," ",c.castingTime]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Range:"})," ",c.range]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Components:"})," ",c.components.join(", ")]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Duration:"})," ",c.duration]})]}),(0,w.jsx)("div",{children:(0,w.jsx)("p",{style:{margin:0,color:"#e2e8f0",lineHeight:"1.5"},children:c.description})})]})]})]})]})]})}const St={abjuration:[{name:"Ward",level:0,school:"Abjuration",castingTime:"1 action",range:"Touch",components:["V (protective word)","S (warding gesture)"],duration:"1 round",description:"Creates a shimmering barrier that provides +1 AC against the next attack.",color:"#3b82f6"},{name:"Resist",level:0,school:"Abjuration",castingTime:"1 reaction",range:"Self",components:["V (quick incantation)"],duration:"Instantaneous",description:"Reduces incoming damage by 1d4 points when cast as a reaction.",color:"#3b82f6"},{name:"Shield of Faith",level:1,school:"Abjuration",castingTime:"1 action",range:"60 feet",components:["V (prayer)","S (blessing gesture)","M (holy symbol)"],duration:"5 rounds",description:"Surrounds target with divine energy, granting +2 AC and resistance to the next spell.",color:"#3b82f6"},{name:"Dispel Minor Magic",level:1,school:"Abjuration",castingTime:"1 action",range:"60 feet",components:["V (dispelling word)","S (dismissive gesture)"],duration:"Instantaneous",description:"Ends one cantrip or 1st level spell effect on target creature or object.",color:"#3b82f6"},{name:"Arcane Lock",level:2,school:"Abjuration",castingTime:"2 actions",range:"Touch",components:["V (locking incantation)","S (sealing motions)","M (silver key worth 25 gp)"],duration:"Until dispelled",description:"Magically locks a door, chest, or portal. Only the caster or dispel magic can open it.",color:"#3b82f6"},{name:"Greater Ward",level:3,school:"Abjuration",castingTime:"1 action",range:"30 feet",components:["V (protective chant)","S (complex warding)","M (crystal focus)"],duration:"10 rounds",description:"Creates a 15-foot radius protective dome. Allies inside gain damage resistance and spell immunity.",color:"#3b82f6"}],conjuration:[{name:"Summon Spark",level:0,school:"Conjuration",castingTime:"1 action",range:"60 feet",components:["V (summoning word)","S (beckoning gesture)"],duration:"1 round",description:"Creates a tiny mote of light that can illuminate or distract. Deals 1d4 radiant damage.",color:"#10b981"},{name:"Conjure Weapon",level:1,school:"Conjuration",castingTime:"1 action",range:"Self",components:["V (weapon's name)","S (grasping motion)"],duration:"5 rounds",description:"Creates a simple melee weapon in your hand. Weapon deals 1d6 + spell modifier damage.",color:"#10b981"},{name:"Faithful Hound",level:1,school:"Conjuration",castingTime:"2 actions",range:"30 feet",components:["V (calling howl)","S (summoning ritual)","M (dog whistle)"],duration:"10 rounds",description:"Summons a spectral hound with 15 HP that follows your commands and alerts to enemies.",color:"#10b981"},{name:"Dimensional Door",level:2,school:"Conjuration",castingTime:"1 action",range:"500 feet",components:["V (travel word)","S (stepping motion)"],duration:"Instantaneous",description:"Instantly teleports you and one willing ally to a location you can see within range.",color:"#10b981"}],divination:[{name:"Detect",level:0,school:"Divination",castingTime:"1 action",range:"30 feet",components:["V (inquiry)","S (searching gesture)"],duration:"3 rounds",description:"Reveals the presence of magic, hidden objects, or creatures within range.",color:"#f59e0b"},{name:"True Sight",level:1,school:"Divination",castingTime:"1 action",range:"Self",components:["V (seeing word)","S (eye-opening gesture)","M (crystal lens)"],duration:"10 rounds",description:"See through illusions, detect invisible creatures, and perceive the true form of shapeshifters.",color:"#f59e0b"},{name:"Locate Object",level:1,school:"Divination",castingTime:"2 actions",range:"1 mile",components:["V (object's name)","S (searching motions)","M (lodestone)"],duration:"10 rounds",description:"Sense the direction and distance to a specific object you've seen before.",color:"#f59e0b"}],enchantment:[{name:"Charm",level:0,school:"Enchantment",castingTime:"1 action",range:"30 feet",components:["V (persuasive words)","S (friendly gesture)"],duration:"3 rounds",description:"Target views you as a friendly acquaintance. They won't attack you but aren't controlled.",color:"#ec4899"},{name:"Command",level:1,school:"Enchantment",castingTime:"1 action",range:"60 feet",components:["V (single word command)"],duration:"1 round",description:"Target must obey a one-word command: Approach, Drop, Flee, Grovel, or Halt.",color:"#ec4899"},{name:"Sleep",level:1,school:"Enchantment",castingTime:"1 action",range:"90 feet",components:["V (lullaby)","S (soothing gesture)","M (sand or rose petals)"],duration:"5 rounds",description:"Creatures in 20-foot radius fall unconscious. Affects 5d8 hit points worth of creatures.",color:"#ec4899"}],evocation:[{name:"Magic Missile",level:0,school:"Evocation",castingTime:"1 action",range:"120 feet",components:["V (targeting word)","S (pointing gesture)"],duration:"Instantaneous",description:"Creates 1 dart of pure force that automatically hits for 1d4+1 damage.",color:"#ef4444"},{name:"Spark",level:0,school:"Evocation",castingTime:"1 action",range:"60 feet",components:["V (crackling word)","S (snapping fingers)"],duration:"Instantaneous",description:"Target takes 1d6 lightning damage and must make a Constitution save or be stunned for 1 round.",color:"#ef4444"},{name:"Burning Hands",level:1,school:"Evocation",castingTime:"1 action",range:"15-foot cone",components:["V (fiery incantation)","S (spreading fingers)"],duration:"Instantaneous",description:"Flames shoot from your fingertips. Each creature in area takes 3d6 fire damage.",color:"#ef4444"},{name:"Lightning Bolt",level:1,school:"Evocation",castingTime:"1 action",range:"100 feet",components:["V (thunder word)","S (throwing motion)","M (copper wire)"],duration:"Instantaneous",description:"A bolt of lightning shoots in a line. Creatures in path take 2d8 lightning damage.",color:"#ef4444"}],healing:[{name:"Mend Wounds",level:0,school:"Healing",castingTime:"1 action",range:"Touch",components:["V (healing word)","S (gentle touch)"],duration:"Instantaneous",description:"Restores 1d4 hit points to a living creature. Cannot heal the same target twice per combat.",color:"#22c55e"},{name:"Stabilize",level:0,school:"Healing",castingTime:"1 action",range:"Touch",components:["V (life-binding word)","S (steadying touch)"],duration:"Instantaneous",description:"A dying creature becomes stable and regains 1 hit point.",color:"#22c55e"},{name:"Cure Light Wounds",level:1,school:"Healing",castingTime:"1 action",range:"Touch",components:["V (healing prayer)","S (laying on hands)"],duration:"Instantaneous",description:"Restores 1d8 + spellcasting modifier hit points to target creature.",color:"#22c55e"},{name:"Healing Word",level:1,school:"Healing",castingTime:"1 bonus action",range:"60 feet",components:["V (word of healing)"],duration:"Instantaneous",description:"Restores 1d4 + spellcasting modifier hit points. Can revive unconscious allies.",color:"#22c55e"},{name:"Prayer of Healing",level:2,school:"Healing",castingTime:"3 actions",range:"30-foot radius",components:["V (group prayer)","S (blessing gestures)","M (holy symbol)"],duration:"Instantaneous",description:"Up to 6 creatures regain 2d8 + spellcasting modifier hit points each.",color:"#22c55e"},{name:"Greater Heal",level:3,school:"Healing",castingTime:"1 action",range:"Touch",components:["V (major healing incantation)","S (powerful laying on hands)","M (diamond dust worth 100 gp)"],duration:"Instantaneous",description:"Restores 4d8 + spellcasting modifier hit points and removes one disease or poison.",color:"#22c55e"}],illusion:[{name:"Minor Illusion",level:0,school:"Illusion",castingTime:"1 action",range:"30 feet",components:["S (image-forming gesture)","M (bit of fleece)"],duration:"5 rounds",description:"Creates a sound or image no larger than a 5-foot cube. Can distract or deceive.",color:"#8b5cf6"},{name:"Disguise Self",level:1,school:"Illusion",castingTime:"1 action",range:"Self",components:["V (transformation word)","S (self-shaping gestures)"],duration:"10 rounds",description:"Change your appearance including clothing, armor, weapons, and other equipment.",color:"#8b5cf6"},{name:"Invisibility",level:1,school:"Illusion",castingTime:"1 action",range:"Touch",components:["V (vanishing word)","S (fading gesture)","M (eyelash in gum arabic)"],duration:"10 rounds",description:"Target becomes invisible until they attack, cast a spell, or duration ends.",color:"#8b5cf6"}],necromancy:[{name:"Chill Touch",level:0,school:"Necromancy",castingTime:"1 action",range:"120 feet",components:["V (death whisper)","S (grasping motion)"],duration:"1 round",description:"Spectral hand deals 1d8 necrotic damage and prevents healing until your next turn.",color:"#6b7280"},{name:"Speak with Dead",level:1,school:"Necromancy",castingTime:"3 actions",range:"10 feet",components:["V (death's language)","S (beckoning gesture)","M (burning incense)"],duration:"5 rounds",description:"Ask up to 5 questions of a corpse that died within the last week.",color:"#6b7280"},{name:"Vampiric Touch",level:1,school:"Necromancy",castingTime:"1 action",range:"Touch",components:["V (draining word)","S (life-stealing touch)"],duration:"Instantaneous",description:"Deal 2d6 necrotic damage and regain half as hit points.",color:"#6b7280"}],transmutation:[{name:"Mending",level:0,school:"Transmutation",castingTime:"1 action",range:"Touch",components:["V (repair word)","S (mending gesture)","M (two lodestones)"],duration:"Instantaneous",description:"Repairs a single break or tear in an object no larger than 1 foot.",color:"#06b6d4"},{name:"Alter Self",level:1,school:"Transmutation",castingTime:"1 action",range:"Self",components:["V (change word)","S (self-altering gestures)"],duration:"10 rounds",description:"Change your physical form: grow claws (+1d4 damage), gills (breathe water), or camouflage (+5 stealth).",color:"#06b6d4"},{name:"Enhance Ability",level:1,school:"Transmutation",castingTime:"1 action",range:"Touch",components:["V (empowering word)","S (enhancing touch)","M (hair or fur from a beast)"],duration:"10 rounds",description:"Target gains advantage on one type of ability check and +2 to that ability score.",color:"#06b6d4"}]},jt=()=>Object.values(St).flat(),Ct=e=>St[e.toLowerCase()]||[];function Mt(e){let{onBack:t}=e;const[n,i]=(0,a.useState)([]),[o,s]=(0,a.useState)([]),[l,c]=(0,a.useState)(-1),[d,h]=(0,a.useState)(-1),p=e=>e.class||e.characterClass||"Unknown",m=e=>{var t;return e.level||(null===(t=e.data)||void 0===t?void 0:t.level)||1};(0,a.useEffect)(()=>{try{const e=JSON.parse(u.local.getItem("world-engine-characters")||"[]"),t=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]"),n=[{id:"test-cleric",name:"Elara the Cleric",class:"Cleric",race:"Human",level:3,baseStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},finalStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},hitPoints:28,knownSpells:[],knownCantrips:[]},{id:"test-wizard",name:"Merlin the Wise",class:"Wizard",race:"Elf",level:4,baseStats:{strength:8,constitution:12,wisdom:13,intelligence:17,dexterity:14,charisma:10},finalStats:{strength:8,constitution:12,wisdom:13,intelligence:17,dexterity:14,charisma:10},hitPoints:24,knownSpells:[],knownCantrips:[]},{id:"test-paladin",name:"Sir Roland",class:"Paladin",race:"Human",level:3,baseStats:{strength:16,constitution:14,wisdom:11,intelligence:10,dexterity:10,charisma:15},finalStats:{strength:16,constitution:14,wisdom:11,intelligence:10,dexterity:10,charisma:15},hitPoints:32,knownSpells:[],knownCantrips:[]},{id:"test-sorcerer",name:"Luna Stormcaller",class:"Sorcerer",race:"Dragonborn",level:2,baseStats:{strength:10,constitution:13,wisdom:12,intelligence:11,dexterity:14,charisma:16},finalStats:{strength:10,constitution:13,wisdom:12,intelligence:11,dexterity:14,charisma:16},hitPoints:18,knownSpells:[],knownCantrips:[]},{id:"test-druid",name:"Thorn Earthwalker",class:"Druid",race:"Half-Elf",level:3,baseStats:{strength:11,constitution:14,wisdom:16,intelligence:12,dexterity:13,charisma:14},finalStats:{strength:11,constitution:14,wisdom:16,intelligence:12,dexterity:13,charisma:14},hitPoints:26,knownSpells:[],knownCantrips:[]}],r=[...n];e.forEach(e=>{n.find(t=>t.id===e.id)||r.push(e)}),i(r),s(t),console.log("Loaded characters:",r.length,"characters (",n.length,"test +",e.length,"saved)")}catch(e){console.error("Error loading data:",e),i([{id:"test-cleric",name:"Elara the Cleric",class:"Cleric",race:"Human",level:3,baseStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},finalStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},hitPoints:28,knownSpells:[],knownCantrips:[]},{id:"test-wizard",name:"Merlin the Wise",class:"Wizard",race:"Elf",level:4,baseStats:{strength:8,constitution:12,wisdom:13,intelligence:17,dexterity:14,charisma:10},finalStats:{strength:8,constitution:12,wisdom:13,intelligence:17,dexterity:14,charisma:10},hitPoints:24,knownSpells:[],knownCantrips:[]},{id:"test-paladin",name:"Sir Roland",class:"Paladin",race:"Human",level:3,baseStats:{strength:16,constitution:14,wisdom:11,intelligence:10,dexterity:10,charisma:15},finalStats:{strength:16,constitution:14,wisdom:11,intelligence:10,dexterity:10,charisma:15},hitPoints:32,knownSpells:[],knownCantrips:[]},{id:"test-sorcerer",name:"Luna Stormcaller",class:"Sorcerer",race:"Dragonborn",level:2,baseStats:{strength:10,constitution:13,wisdom:12,intelligence:11,dexterity:14,charisma:16},finalStats:{strength:10,constitution:13,wisdom:12,intelligence:11,dexterity:14,charisma:16},hitPoints:18,knownSpells:[],knownCantrips:[]},{id:"test-druid",name:"Thorn Earthwalker",class:"Druid",race:"Half-Elf",level:3,baseStats:{strength:11,constitution:14,wisdom:16,intelligence:12,dexterity:13,charisma:14},finalStats:{strength:11,constitution:14,wisdom:16,intelligence:12,dexterity:13,charisma:14},hitPoints:26,knownSpells:[],knownCantrips:[]}])}},[]);const f=(e,t)=>{const n=p(e),r=m(e),a={Wizard:{schools:["all"],maxLevel:Math.ceil(r/2)+1,stat:"intelligence"},Sorcerer:{schools:["all"],maxLevel:Math.ceil(r/2)+1,stat:"charisma"},Cleric:{schools:["Abjuration","Divination","Evocation","Healing"],maxLevel:Math.ceil(r/2)+1,stat:"wisdom"},Druid:{schools:["Conjuration","Divination","Evocation","Transmutation","Healing"],maxLevel:Math.ceil(r/2)+1,stat:"wisdom"},Paladin:{schools:["Abjuration","Evocation","Healing"],maxLevel:Math.max(1,Math.ceil((r-1)/4)),stat:"charisma"},Ranger:{schools:["Conjuration","Divination","Transmutation"],maxLevel:Math.max(1,Math.ceil((r-1)/4)),stat:"wisdom"},Bard:{schools:["all"],maxLevel:Math.ceil(r/2)+1,stat:"charisma"},Warlock:{schools:["all"],maxLevel:Math.min(5,Math.ceil(r/2)+1),stat:"charisma"}}[n];return!!a&&(!(t.level>a.maxLevel)&&(!("all"!==a.schools[0]&&!a.schools.includes(t.school))&&(0===t.level?!(null!==(i=e.knownCantrips)&&void 0!==i&&i.includes(t.name)):!(null!==(o=e.knownSpells)&&void 0!==o&&o.includes(t.name)))));var i,o},g=(e,t,a)=>{const o=n.map((n,i)=>{var o,s;return i===e?a?(0,r.A)((0,r.A)({},n),{},{knownCantrips:(null===(o=n.knownCantrips)||void 0===o?void 0:o.filter(e=>e!==t))||[]}):(0,r.A)((0,r.A)({},n),{},{knownSpells:(null===(s=n.knownSpells)||void 0===s?void 0:s.filter(e=>e!==t))||[]}):n});i(o),u.local.setItem("world-engine-characters",JSON.stringify(o))},y=e=>{const t=p(e),n=m(e);return{Wizard:{maxLevel:Math.ceil(n/2)+1,stat:"Intelligence"},Sorcerer:{maxLevel:Math.ceil(n/2)+1,stat:"Charisma"},Cleric:{maxLevel:Math.ceil(n/2)+1,stat:"Wisdom"},Druid:{maxLevel:Math.ceil(n/2)+1,stat:"Wisdom"},Paladin:{maxLevel:Math.max(1,Math.ceil((n-1)/4)),stat:"Charisma"},Ranger:{maxLevel:Math.max(1,Math.ceil((n-1)/4)),stat:"Wisdom"},Bard:{maxLevel:Math.ceil(n/2)+1,stat:"Charisma"},Warlock:{maxLevel:Math.min(5,Math.ceil(n/2)+1),stat:"Charisma"}}[t]};return(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",color:"#e2e8f0",padding:"2rem"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem",padding:"1rem",background:"rgba(15, 23, 42, 0.8)",borderRadius:"8px",border:"1px solid #334155"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"bold"},children:"Spell Assignment"}),(0,w.jsx)("p",{style:{margin:"0.5rem 0 0",opacity:.8},children:"Assign spells to characters based on their class and abilities"})]}),t&&(0,w.jsx)("button",{onClick:t,style:{padding:"0.5rem 1rem",background:"#475569",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Back to Menu"})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem"},children:[(0,w.jsxs)("div",{style:{background:"rgba(30, 41, 59, 0.8)",border:"1px solid #334155",borderRadius:"8px",padding:"1.5rem"},children:[(0,w.jsx)("h2",{style:{margin:"0 0 1rem",color:"#3b82f6"},children:"Assign Spells"}),0===n.length&&(0,w.jsx)("p",{style:{color:"#94a3b8",fontStyle:"italic"},children:"No characters found. Create some characters first!"}),0===o.length&&(0,w.jsx)("p",{style:{color:"#94a3b8",fontStyle:"italic"},children:"No spells available. Generate some spells first!"}),n.length>0&&o.length>0&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:"Select Character:"}),(0,w.jsxs)("select",{value:l,onChange:e=>c(parseInt(e.target.value)),style:{width:"100%",padding:"0.5rem",background:"#1e293b",border:"1px solid #475569",borderRadius:"4px",color:"#e2e8f0"},children:[(0,w.jsx)("option",{value:-1,children:"Choose a character..."}),n.map((e,t)=>{const n=y(e),r=p(e),a=m(e);return(0,w.jsxs)("option",{value:t,children:[e.name," (",r,", Level ",a,n?" - Max Spell Level ".concat(n.maxLevel):" - No Spellcasting",")"]},t)})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,w.jsx)("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"bold"},children:"Select Spell:"}),(0,w.jsxs)("select",{value:d,onChange:e=>h(parseInt(e.target.value)),style:{width:"100%",padding:"0.5rem",background:"#1e293b",border:"1px solid #475569",borderRadius:"4px",color:"#e2e8f0"},children:[(0,w.jsx)("option",{value:-1,children:"Choose a spell..."}),o.map((e,t)=>{const r=!(l>=0)||f(n[l],e);return(0,w.jsxs)("option",{value:t,disabled:!r,style:{color:r?"#e2e8f0":"#6b7280"},children:[e.name," (Level ",e.level,", ",e.school,")",r?"":" - Cannot Learn"]},t)})]})]}),(0,w.jsx)("button",{onClick:()=>{if(-1===l||-1===d)return;const e=n[l],t=o[d];if(!f(e,t))return void alert("".concat(e.name," cannot learn ").concat(t.name,"!"));const a=n.map((e,n)=>n===l?0===t.level?(0,r.A)((0,r.A)({},e),{},{knownCantrips:[...e.knownCantrips||[],t.name]}):(0,r.A)((0,r.A)({},e),{},{knownSpells:[...e.knownSpells||[],t.name]}):e);i(a),u.local.setItem("world-engine-characters",JSON.stringify(a)),c(-1),h(-1)},disabled:-1===l||-1===d,style:{width:"100%",padding:"0.75rem",background:l>=0&&d>=0?"#3b82f6":"#475569",color:"white",border:"none",borderRadius:"6px",fontSize:"1rem",cursor:l>=0&&d>=0?"pointer":"not-allowed",fontWeight:"bold"},children:"Assign Spell"}),l>=0&&d>=0&&(0,w.jsx)("div",{style:{marginTop:"1rem",padding:"1rem",background:f(n[l],o[d])?"rgba(34, 197, 94, 0.1)":"rgba(239, 68, 68, 0.1)",border:"1px solid ".concat(f(n[l],o[d])?"#22c55e":"#ef4444"),borderRadius:"6px"},children:(0,w.jsx)("p",{style:{margin:0,fontSize:"0.9rem"},children:f(n[l],o[d])?"\u2713 ".concat(n[l].name," can learn ").concat(o[d].name,"!"):"\u2717 ".concat(n[l].name," cannot learn ").concat(o[d].name,".")})})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(30, 41, 59, 0.8)",border:"1px solid #334155",borderRadius:"8px",padding:"1.5rem"},children:[(0,w.jsx)("h2",{style:{margin:"0 0 1rem",color:"#22c55e"},children:"Character Spells"}),0===n.length?(0,w.jsx)("p",{style:{color:"#94a3b8",fontStyle:"italic"},children:"No characters to display."}):(0,w.jsx)("div",{style:{maxHeight:"70vh",overflowY:"auto"},children:n.map((e,t)=>{const n=y(e);return(0,w.jsxs)("div",{style:{marginBottom:"1.5rem",padding:"1rem",background:"rgba(15, 23, 42, 0.6)",border:"1px solid #475569",borderRadius:"6px"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("h3",{style:{margin:0,color:"#f8fafc"},children:e.name}),(0,w.jsxs)("span",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:[p(e)," Level ",m(e)]})]}),n?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("p",{style:{margin:"0.5rem 0",fontSize:"0.8rem",color:"#94a3b8"},children:["Spellcasting Stat: ",n.stat," | Max Spell Level: ",n.maxLevel]}),e.knownCantrips&&e.knownCantrips.length>0&&(0,w.jsxs)("div",{style:{marginBottom:"0.5rem"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.25rem",fontSize:"0.9rem",color:"#60a5fa"},children:"Cantrips:"}),e.knownCantrips.map((e,n)=>(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.25rem 0.5rem",background:"rgba(59, 130, 246, 0.1)",border:"1px solid #3b82f6",borderRadius:"4px",margin:"0.25rem 0",fontSize:"0.8rem"},children:[(0,w.jsx)("span",{children:e}),(0,w.jsx)("button",{onClick:()=>g(t,e,!0),style:{background:"#ef4444",color:"white",border:"none",borderRadius:"3px",padding:"0.125rem 0.25rem",fontSize:"0.7rem",cursor:"pointer"},children:"Remove"})]},n))]}),e.knownSpells&&e.knownSpells.length>0&&(0,w.jsxs)("div",{children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.25rem",fontSize:"0.9rem",color:"#34d399"},children:"Spells:"}),e.knownSpells.map((e,n)=>(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"0.25rem 0.5rem",background:"rgba(34, 197, 94, 0.1)",border:"1px solid #22c55e",borderRadius:"4px",margin:"0.25rem 0",fontSize:"0.8rem"},children:[(0,w.jsx)("span",{children:e}),(0,w.jsx)("button",{onClick:()=>g(t,e,!1),style:{background:"#ef4444",color:"white",border:"none",borderRadius:"3px",padding:"0.125rem 0.25rem",fontSize:"0.7rem",cursor:"pointer"},children:"Remove"})]},n))]}),(!e.knownSpells||0===e.knownSpells.length)&&(!e.knownCantrips||0===e.knownCantrips.length)&&(0,w.jsx)("p",{style:{fontSize:"0.8rem",color:"#6b7280",fontStyle:"italic"},children:"No spells learned yet."})]}):(0,w.jsx)("p",{style:{fontSize:"0.8rem",color:"#6b7280",fontStyle:"italic"},children:"This class cannot cast spells."})]},t)})})]})]})]})}const Tt={schools:[{name:"Abjuration",description:"Protective magic",color:"#3b82f6"},{name:"Conjuration",description:"Summoning and creation",color:"#10b981"},{name:"Divination",description:"Information gathering",color:"#f59e0b"},{name:"Enchantment",description:"Mind control and charm",color:"#ec4899"},{name:"Evocation",description:"Destructive energy",color:"#ef4444"},{name:"Healing",description:"Restoration and recovery",color:"#22c55e"},{name:"Illusion",description:"Deception and trickery",color:"#8b5cf6"},{name:"Necromancy",description:"Death and undeath",color:"#6b7280"},{name:"Transmutation",description:"Transformation",color:"#06b6d4"}]};function At(e){var t;let{onBack:n}=e;const[r,i]=(0,a.useState)("menu"),[o,s]=(0,a.useState)("any"),[l,c]=(0,a.useState)([]),[d,h]=(0,a.useState)([]);a.useEffect(()=>{try{const e=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]");h(e)}catch(e){console.error("Error loading saved spells:",e),h([])}},[]);const p=e=>{c(t=>[e,...t]),console.log("\u2728 Created custom spell: ".concat(e.name)),i("menu")},m=e=>{let t=[];e&&"any"!==e?(t=Ct(e),console.log("\ud83d\udcda Loaded ".concat(t.length," premade ").concat(e," spells"))):(t=jt(),console.log("\ud83d\udcda Loaded ".concat(t.length," premade spells from all schools"))),c(t)};return"custom"===r?(0,w.jsx)(kt,{onBack:()=>i("menu"),onSpellCreated:p}):(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",color:"#e2e8f0"},children:[(0,w.jsxs)("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #334155",background:"rgba(15, 23, 42, 0.8)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{style:{margin:0,fontSize:"2.5rem",fontWeight:"bold"},children:"\u26a1 Spell Workshop"}),(0,w.jsx)("p",{style:{margin:"0.5rem 0 0",opacity:.8},children:"menu"===r?"Choose your spell creation method":"premade"===r?"Browse curated spell collections":"Generate random magical spells"})]}),(0,w.jsxs)("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:["menu"!==r&&(0,w.jsx)("button",{onClick:()=>i("menu"),style:{padding:"0.75rem 1.5rem",background:"#6366f1",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem"},children:"\ud83c\udfe0 Main Menu"}),n&&(0,w.jsx)("button",{onClick:n,style:{padding:"0.75rem 1.5rem",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem"},children:"Back to Game"})]})]}),"menu"===r&&(0,w.jsxs)("div",{style:{padding:"3rem 2rem"},children:[(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(350px, 1fr))",gap:"2rem",maxWidth:"1200px",margin:"0 auto"},children:[(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"12px",padding:"2rem",border:"2px solid #10b981",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-4px)",onMouseLeave:e=>e.currentTarget.style.transform="translateY(0px)",onClick:()=>i("premade"),children:[(0,w.jsx)("div",{style:{fontSize:"3rem",textAlign:"center",marginBottom:"1rem"},children:"\ud83d\udcda"}),(0,w.jsx)("h2",{style:{margin:"0 0 1rem",color:"#10b981",textAlign:"center",fontSize:"1.5rem"},children:"Premade Spell Collections"}),(0,w.jsx)("p",{style:{margin:"0 0 1.5rem",color:"#cbd5e1",textAlign:"center",lineHeight:"1.6"},children:"Browse carefully crafted spells for each school of magic. Perfect for quick gameplay and learning spell mechanics."}),(0,w.jsxs)("div",{style:{background:"rgba(16, 185, 129, 0.1)",borderRadius:"6px",padding:"1rem",border:"1px solid #10b981"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.5rem",color:"#6ee7b7"},children:"\u2728 Features:"}),(0,w.jsxs)("ul",{style:{margin:0,paddingLeft:"1.5rem",color:"#d1fae5"},children:[(0,w.jsx)("li",{children:"Balanced and tested spells"}),(0,w.jsx)("li",{children:"Organized by school and level"}),(0,w.jsx)("li",{children:"Rich flavor text and descriptions"}),(0,w.jsx)("li",{children:"Ready to use immediately"})]})]})]}),(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"12px",padding:"2rem",border:"2px solid #ef4444",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-4px)",onMouseLeave:e=>e.currentTarget.style.transform="translateY(0px)",onClick:()=>i("custom"),children:[(0,w.jsx)("div",{style:{fontSize:"3rem",textAlign:"center",marginBottom:"1rem"},children:"\u2692\ufe0f"}),(0,w.jsx)("h2",{style:{margin:"0 0 1rem",color:"#ef4444",textAlign:"center",fontSize:"1.5rem"},children:"Custom Spell Creator"}),(0,w.jsx)("p",{style:{margin:"0 0 1.5rem",color:"#cbd5e1",textAlign:"center",lineHeight:"1.6"},children:"Design your own spells from scratch with built-in balance guidelines. Perfect for experienced players who want full creative control."}),(0,w.jsxs)("div",{style:{background:"rgba(239, 68, 68, 0.1)",borderRadius:"6px",padding:"1rem",border:"1px solid #ef4444"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.5rem",color:"#fca5a5"},children:"\ud83d\udee0\ufe0f Features:"}),(0,w.jsxs)("ul",{style:{margin:0,paddingLeft:"1.5rem",color:"#fee2e2"},children:[(0,w.jsx)("li",{children:"Complete creative freedom"}),(0,w.jsx)("li",{children:"Balance guidelines and validation"}),(0,w.jsx)("li",{children:"Component customization"}),(0,w.jsx)("li",{children:"Real-time spell preview"})]})]}),(0,w.jsx)("div",{style:{background:"rgba(245, 158, 11, 0.1)",borderRadius:"6px",padding:"0.75rem",border:"1px solid #f59e0b",marginTop:"1rem"},children:(0,w.jsx)("div",{style:{color:"#fbbf24",fontSize:"0.9rem",textAlign:"center"},children:"\u26a0\ufe0f For Experienced Players"})})]})]}),(0,w.jsxs)("div",{style:{marginTop:"3rem",textAlign:"center",padding:"2rem",background:"rgba(15, 23, 42, 0.4)",borderRadius:"8px",border:"1px solid #334155"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 1rem",color:"#f1f5f9"},children:"\ud83d\udcca Spell Library Stats"}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",maxWidth:"800px",margin:"0 auto"},children:Tt.schools.map(e=>{const t=Ct(e.name).length;return(0,w.jsxs)("div",{style:{padding:"1rem",background:"rgba(15, 23, 42, 0.6)",borderRadius:"6px",border:"1px solid ".concat(e.color)},children:[(0,w.jsx)("div",{style:{color:e.color,fontWeight:"bold"},children:e.name}),(0,w.jsxs)("div",{style:{color:"#94a3b8",fontSize:"0.9rem"},children:[t," spells"]})]},e.name)})})]})]}),"premade"===r&&(0,w.jsxs)("div",{style:{display:"flex",height:"calc(100vh - 120px)"},children:[(0,w.jsxs)("div",{style:{width:"300px",padding:"2rem",borderRight:"1px solid #334155",overflowY:"auto",background:"rgba(15, 23, 42, 0.4)"},children:[(0,w.jsx)("h3",{style:{marginBottom:"1rem",color:"#f1f5f9"},children:"\ud83d\udcda Browse by School"}),(0,w.jsxs)("button",{onClick:()=>m("any"),style:{width:"100%",padding:"1rem",marginBottom:"0.5rem",background:"any"===o?"#374151":"rgba(15, 23, 42, 0.6)",border:"1px solid #4b5563",borderRadius:"6px",color:"#f9fafb",cursor:"pointer",textAlign:"left",fontSize:"1rem"},children:["\ud83c\udf1f All Schools (",jt().length," spells)"]}),Tt.schools.map(e=>{const t=Ct(e.name).length;return(0,w.jsxs)("button",{onClick:()=>{s(e.name.toLowerCase()),m(e.name)},style:{width:"100%",padding:"1rem",marginBottom:"0.5rem",background:o===e.name.toLowerCase()?e.color:"rgba(15, 23, 42, 0.6)",border:"1px solid ".concat(e.color),borderRadius:"6px",color:o===e.name.toLowerCase()?"#ffffff":e.color,cursor:"pointer",textAlign:"left",fontSize:"0.9rem",transition:"all 0.2s ease"},children:[(0,w.jsx)("div",{style:{fontWeight:"bold"},children:e.name}),(0,w.jsxs)("div",{style:{fontSize:"0.8rem",opacity:.8},children:[e.description," (",t," spells)"]})]},e.name)})]}),(0,w.jsx)("div",{style:{flex:1,padding:"2rem",overflowY:"auto"},children:0===l.length?(0,w.jsxs)("div",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8"},children:[(0,w.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:"\ud83d\udcda"}),(0,w.jsx)("h3",{style:{margin:"0 0 1rem",color:"#cbd5e1"},children:"Select a School"}),(0,w.jsx)("p",{children:"Choose a school of magic from the left panel to browse curated spells."})]}):(0,w.jsxs)("div",{children:[(0,w.jsxs)("h2",{style:{margin:"0 0 1.5rem",color:"#f1f5f9"},children:["any"===o?"All Schools":(null===(t=Tt.schools.find(e=>e.name.toLowerCase()===o))||void 0===t?void 0:t.name)||"Spells",(0,w.jsxs)("span",{style:{color:"#94a3b8",fontSize:"1rem",fontWeight:"normal",marginLeft:"1rem"},children:["(",l.length," spells)"]})]}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(400px, 1fr))",gap:"1.5rem"},children:l.map((e,t)=>(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.8)",borderRadius:"8px",padding:"1.5rem",border:"2px solid ".concat(e.color),transition:"transform 0.2s ease"},children:[(0,w.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 0.25rem",color:e.color,fontSize:"1.3rem"},children:e.name}),(0,w.jsxs)("p",{style:{margin:0,color:"#94a3b8",fontSize:"0.9rem"},children:[0===e.level?"Cantrip":"Level ".concat(e.level)," ",e.school]})]}),(0,w.jsxs)("div",{style:{marginBottom:"1rem",fontSize:"0.9rem",color:"#cbd5e1"},children:[(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Casting Time:"})," ",e.castingTime]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Range:"})," ",e.range]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Components:"})," ",e.components.join(", ")]}),(0,w.jsxs)("p",{style:{margin:"0.25rem 0"},children:[(0,w.jsx)("strong",{children:"Duration:"})," ",e.duration]})]}),(0,w.jsx)("div",{style:{marginBottom:"1.5rem"},children:(0,w.jsx)("p",{style:{margin:0,color:"#e2e8f0",lineHeight:"1.5"},children:e.description})}),(0,w.jsx)("button",{onClick:()=>(e=>{if(d.find(t=>t.name===e.name))return void alert("Spell already saved!");const t=[...d,e];h(t),u.local.setItem("world-engine-saved-spells",JSON.stringify(t)),console.log("Spell saved:",e.name)})(e),style:{width:"100%",padding:"0.75rem",background:"#059669",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem",fontWeight:"bold"},children:"\ud83d\udcbe Save to Spellbook"})]},t))})]})})]}),d.length>0&&(0,w.jsxs)("div",{style:{position:"fixed",bottom:"2rem",right:"2rem",background:"rgba(15, 23, 42, 0.9)",border:"1px solid #334155",borderRadius:"8px",padding:"1rem",color:"#f1f5f9"},children:["\ud83d\udcbe ",d.length," spells saved"]})]})}const Et={shaken:65,wavering:45,routing:25},Pt={shaken:72,wavering:52,routing:32},Rt={min:0,max:100},_t=.5,Nt={leadership:{min:0,max:15},terrain:{min:-10,max:10},casualties:{min:-25,max:0},outnumbered:{min:-20,max:0},effects:{min:-25,max:25}};function Bt(e,t){const n=Nt[e];return Math.max(n.min,Math.min(n.max,t))}var zt=n(348);function Lt(e,t){return{q:e-Math.floor((t-(1&t))/2),r:t}}function It(e,t,n,r){const a=r();switch(n){case"Forest":return a<.6?"Forest":a<.9?"Grass":"Mountain";case"Desert":return a<.8?"Desert":a<.95?"Mountain":"Grass";case"Swamp":return a<.4?"Water":a<.8?"Swamp":"Grass";default:return a<.7?"Grass":a<.85?"Forest":a<.95?"Mountain":"Water"}}function qt(e){const t=e.width||16,n=e.height||12,r=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);t=(t<<5)-t+r,t&=t}return function(){return t=(1664525*t+1013904223)%Math.pow(2,32),t/Math.pow(2,32)+.5}}(e.seed),a=[];for(let l=0;l<n;l++)for(let n=0;n<t;n++){const{q:t,r:i}=Lt(n,l),o=It(0,0,e.biome,r),s={q:t,r:i,terrain:o,elevation:Math.floor(3*r()),passable:"Water"!==o&&"Mountain"!==o,cover:"Forest"===o?2:"Mountain"===o?3:0};a.push(s)}const i={width:t,height:n,tiles:a},o={faction:"Player",hexes:[]},s={faction:"Enemy",hexes:[]};for(const l of a)l.passable&&(l.q>=0&&l.q<=2&&o.hexes.push({q:l.q,r:l.r}),l.q>=t-3&&l.q<t&&s.hexes.push({q:l.q,r:l.r}));return{grid:i,friendly:o,enemy:s}}function Dt(e){const t=e.q,n=e.r;return{x:t,y:-t-n,z:n}}const Ot=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}];function Wt(e){return Ot.map(t=>({q:e.q+t.q,r:e.r+t.r}))}function Ht(e,t){const n=Ot[t%6];return{q:e.q+n.q,r:e.r+n.r}}function Ft(e,t){if(0===t)return[e];const n=[];let a={q:e.q+Ot[4].q*t,r:e.r+Ot[4].r*t};for(let i=0;i<6;i++)for(let e=0;e<t;e++)n.push((0,r.A)({},a)),a=Ht(a,i);return n}function Gt(e,t){return e.tiles.find(e=>e.q===t.q&&e.r===t.r)}function Ut(e){return"".concat(e.q,",").concat(e.r)}function Vt(e,t){return function(e,t){const n=Dt(e),r=Dt(t);return Math.max(Math.abs(n.x-r.x),Math.abs(n.y-r.y),Math.abs(n.z-r.z))}(e,t)}function Yt(e){return e.units.filter(e=>!e.isDead&&e.pos&&!e.isCommander).map(t=>{let n=t.stats.spd;const r=function(e,t){var n;const r=e.units.find(e=>e.id===t);if(!r)return{state:"unknown",value:0,needsAttention:!1};const a=null===(n=r.meta)||void 0===n?void 0:n.morale;return a?{state:a.state,value:a.ema,needsAttention:"wavering"===a.state||"routing"===a.state}:{state:"steady",value:70,needsAttention:!1}}(e,t.id);return r.needsAttention&&("shaken"===r.state?n-=2:"wavering"===r.state?n-=5:"routing"===r.state&&(n-=8)),{unit:t,adjustedSpd:Math.max(1,n)}}).sort((e,t)=>t.adjustedSpd-e.adjustedSpd||e.unit.name.localeCompare(t.unit.name)).map(e=>e.unit.id)}function Kt(e){var t;e.turn=1,e.phase="HeroTurn",e.initiative=Yt(e),function(e){const t=e.units.find(e=>e.isCommander);if(!t||!e.commander.aura)return;for(const n of e.units)if("Player"===n.faction&&!n.isDead&&!n.isCommander)for(const[t,r]of Object.entries(e.commander.aura.stats))"number"===typeof r&&(n.stats[t]+=r)}(e),gn(t=e),pn(t),t.log.push("Morale system initialized."),e.log.push("Battle has begun!")}function Xt(e){"HeroTurn"===e.phase?(e.phase="UnitsTurn",e.selectedUnit=void 0,function(e){pn(e),e.turn%2===0&&gn(e);const t=e.units.filter(e=>{var t;if(e.isDead||e.isCommander)return!1;const n=null===(t=e.meta)||void 0===t?void 0:t.morale;return n&&"routing"===n.state});for(const n of t)Mn(e,n.id)}(e)):"UnitsTurn"===e.phase?(e.phase="EnemyTurn",e.selectedUnit=void 0):"EnemyTurn"===e.phase&&(e.turn+=1,e.initiative=Yt(e),e.phase="HeroTurn",function(e){for(const t of e.units)t.isDead||(t.statuses=t.statuses.filter(n=>(n.duration--,n.effects.hp&&n.effects.hp<0&&(en(t,-n.effects.hp),e.log.push("".concat(t.name," takes ").concat(-n.effects.hp," damage from ").concat(n.name))),n.duration>0)))}(e),function(e){if(e.commander.runtime.cooldowns)for(const[t,n]of Object.entries(e.commander.runtime.cooldowns))n>0&&(e.commander.runtime.cooldowns[t]=n-1)}(e),function(e){!function(e){if(e.commander&&e.commander.runtime.cooldowns){const t=e.commander.runtime.cooldowns;for(const[e,n]of Object.entries(t))"number"===typeof n&&n>0&&(t[e]=n-1)}if(e.enemyCommander&&e.enemyCommander.runtime.cooldowns){const t=e.enemyCommander.runtime.cooldowns;for(const[e,n]of Object.entries(t))"number"===typeof n&&n>0&&(t[e]=n-1)}}(e);const t=Tn(e,"Player"),n=Tn(e,"Enemy");t?(e.phase="Defeat",e.log.push("Player forces have broken and fled the field!")):n&&(e.phase="Victory",e.log.push("Enemy forces have broken and fled the field!"))}(e)),nn(e)}function Jt(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:20;const a=new Map,i=new Map,o=new Map,s=Ut(t),l=Ut(n);for(i.set(s,0),a.set(s,Vt(t,n));a.size>0;){let t="",s=1/0;if(a.forEach((e,n)=>{e<s&&(s=e,t=n)}),t===l){const e=[];let n=t;for(;n;){const[t,r]=n.split(",").map(Number);e.unshift({q:t,r:r}),n=o.get(n)||""}return e}a.delete(t);const[c,d]=t.split(",").map(Number),u={q:c,r:d};for(const l of Wt(u)){const s=Ut(l),c=Gt(e,l);if(!c||!c.passable)continue;if(c.occupied)continue;const d=(i.get(t)||0)+("Mountain"===c.terrain?2:1);if(!(d>r)&&(!i.has(s)||d<(i.get(s)||1/0))){o.set(s,t),i.set(s,d);const e=d+Vt(l,n);a.set(s,e)}}}return null}function Qt(e,t,n,r){var a;if(!t.pos)return!1;if(Vt(t.pos,r)>n.range)return!1;if("spell"===n.type&&!function(e,t,n){const r=Vt(t,n);if(0===r)return!0;for(let a=1;a<r;a++){const i=a/r,o=Gt(e,{q:Math.round(t.q*(1-i)+n.q*i),r:Math.round(t.r*(1-i)+n.r*i)});if(!o||!o.passable||o.elevation>2)return!1}return!0}(e.grid,t.pos,r))return!1;return!(((null===(a=e.commander.runtime.cooldowns)||void 0===a?void 0:a[n.id])||0)>0)}function $t(e,t,n,r){const a=e.units.find(e=>e.id===t),i=zt.lQ[n];if(!a||!i)return!1;if(!Qt(e,a,i,r))return!1;const o=function(e,t,n,r){const a=[];let i=[];switch(t.shape){case"single":case"self":case"line":default:i=[n];break;case"blast1":i=[n,...Wt(n)];break;case"blast2":i=[n,...Ft(n,1),...Ft(n,2)];break;case"ally":return e.units.filter(e=>e.faction===r&&!e.isDead&&e.pos)}for(const o of i){const t=e.units.find(e=>e.pos&&e.pos.q===o.q&&e.pos.r===o.r&&!e.isDead);t&&a.push(t)}return a}(e,i,r,a.faction);if(i.damage)for(const s of o)if(s.faction!==a.faction||"ally"===i.shape){en(s,Zt(a,s,i)),s.stats.hp<=0&&(s.isDead=!0,e.log.push("".concat(s.name," has fallen!")),An(e,s.id))}if(i.healing)for(const s of o)s.faction===a.faction&&tn(s,i.healing);return e.commander.runtime.cooldowns||(e.commander.runtime.cooldowns={}),e.commander.runtime.cooldowns[n]=i.cooldown,e.log.push("".concat(a.name," used ").concat(i.name,"!")),!0}function Zt(e,t,n){if(!n.damage)return 0;const r=n.damage.amount,a="spell"===n.type?e.stats.mag:e.stats.atk,i="spell"===n.type?t.stats.res:t.stats.def;return Math.max(1,r+Math.floor(.25*a)-Math.floor(.2*i))}function en(e,t){e.stats.hp=Math.max(0,e.stats.hp-t)}function tn(e,t){e.stats.hp=Math.min(e.stats.maxHp,e.stats.hp+t)}function nn(e){const t=e.units.filter(e=>"Player"===e.faction&&!e.isDead&&!e.isCommander),n=e.units.filter(e=>"Enemy"===e.faction&&!e.isDead);0===t.length?(e.phase="Defeat",e.log.push("Defeat! All allies have fallen.")):0===n.length&&(e.phase="Victory",e.log.push("Victory! All enemies have been defeated."))}function rn(e,t){const n=e.units.find(e=>e.id===t);if(!n||!n.pos)return 0;const r=function(e,t){if(!t.pos)return null;if(e.commander&&"Player"===t.faction){const n=e.units.find(t=>t.id===e.commander.unitId);if(n&&n.pos&&!n.isDead){const r=Vt(t.pos,n.pos);if(r<=(e.commander.aura.range||3)){return{dist:r,cha:n.stats.mag||10,power:10}}}}if(e.enemyCommander&&"Enemy"===t.faction){const n=e.units.find(t=>t.id===e.enemyCommander.unitId);if(n&&n.pos&&!n.isDead){const r=Vt(t.pos,n.pos);if(r<=(e.enemyCommander.aura.range||3)){return{dist:r,cha:n.stats.mag||10,power:10}}}}return null}(e,n);if(!r)return 0;const{dist:a,cha:i,power:o}=r,s=Math.max(0,(o||10)-3*a),l=Math.min(15,i||0);return Bt("leadership",Math.max(0,s+Math.floor(.5*l)))}function an(e,t){const n=e.units.find(e=>e.id===t);if(!n||!n.pos)return 0;let r=0;const a=function(e,t){const n=e.grid.tiles.find(e=>e.q===t.q&&e.r===t.r);if(!n)return 0;switch(n.terrain){case"Forest":return 5;case"Mountain":return 10;case"Water":return-5;case"Swamp":return-3;default:return 0}}(e,n.pos);r+=a;const i=function(e,t){const n=e.units.find(e=>e.id===t);if(!n||!n.pos)return!1;const r=dn(n.pos);let a=0;for(const i of r){e.units.find(e=>e.pos&&e.pos.q===i.q&&e.pos.r===i.r&&e.faction!==n.faction&&!e.isDead)&&a++}return a>=3}(e,t);return i&&a<=0&&(r-=5),Bt("terrain",r)}function on(e,t){if(!e.units.find(e=>e.id===t))return 0;let n=0;const r=function(e,t){const n=e.units.find(e=>e.id===t);if(!n)return 0;const r=n.stats.hp/n.stats.maxHp;return r<.5?.3:r<.8?.1:0}(e,t);n+=Math.round(20*r);const a=function(e,t,n){const r=e.units.find(e=>e.id===t);if(!r||!r.pos)return 0;let a=0;for(const i of e.units)if(i.faction===r.faction&&i.isDead&&i.pos){Vt(r.pos,i.pos)<=n&&a++}return Math.min(3,a)}(e,t,2);return n+=Math.min(10,5*a),Bt("casualties",-n)}function sn(e,t){const n=function(e,t,n){const r=e.units.find(e=>e.id===t);if(!r||!r.pos)return{allies:1,enemies:1};let a=1,i=0;for(const o of e.units){if(o.id===t||o.isDead||!o.pos)continue;Vt(r.pos,o.pos)<=n&&(o.faction===r.faction?a++:i++)}return{allies:a,enemies:i}}(e,t,2),r=n.enemies/Math.max(1,n.allies);if(r<=1)return 0;let a=Math.min(20,Math.round(10*(r-1)));const i=function(e,t){const n=e.units.find(e=>e.id===t);if(!n||!n.pos)return 0;const r=dn(n.pos);let a=0;for(const i of r){e.units.find(e=>e.pos&&e.pos.q===i.q&&e.pos.r===i.r&&e.faction===n.faction&&!e.isDead)&&a++}return a}(e,t);return Bt("outnumbered",-a+Math.min(9,3*i))}function ln(e,t){const n=e.units.find(e=>e.id===t);if(!n)return 0;let r=0;for(const o of n.statuses){var a;if("morale_up"===o.name)r+=(null===(a=o.payload)||void 0===a?void 0:a.amount)||15;else if("morale_down"===o.name||"fear_aura"===o.name){var i;r+=(null===(i=o.payload)||void 0===i?void 0:i.amount)||-5}}return Bt("effects",r)}function cn(e,t){return{leadership:rn(e,t),terrain:an(e,t),casualties:on(e,t),outnumbered:sn(e,t),effects:ln(e,t)}}function dn(e){return[{q:e.q+1,r:e.r},{q:e.q+1,r:e.r-1},{q:e.q,r:e.r-1},{q:e.q-1,r:e.r},{q:e.q-1,r:e.r+1},{q:e.q,r:e.r+1}]}function un(e,t,n){var r,a;const i=cn(e,t),o=(null!==(r=null===n||void 0===n?void 0:n.ema)&&void 0!==r?r:70)+i.leadership+i.terrain+i.casualties+i.outnumbered+i.effects,s=Math.max(Rt.min,Math.min(Rt.max,o)),l=Math.round((null!==(a=null===n||void 0===n?void 0:n.ema)&&void 0!==a?a:s)*(1-_t)+s*_t),c=hn((null===n||void 0===n?void 0:n.state)||"steady",l),d=((null===n||void 0===n?void 0:n.history)||[]).slice(-2);return d.push(s),{value:s,state:c,ema:l,history:d,lastFactors:i,locked:null===n||void 0===n?void 0:n.locked}}function hn(e,t){const n=Et,r=Pt;switch(e){case"steady":return t<=n.shaken?"shaken":"steady";case"shaken":return t<=n.wavering?"wavering":t>=r.shaken?"steady":"shaken";case"wavering":return t<=n.routing?"routing":t>=r.wavering?"shaken":"wavering";case"routing":return t>=r.routing?"wavering":"routing"}}function pn(e){for(const n of e.units){var t;if(n.isDead||n.isCommander)continue;const r=null===(t=n.meta)||void 0===t?void 0:t.morale,a=un(e,n.id,r);if(n.meta||(n.meta={}),n.meta.morale=a,!r||r.state!==a.state){const t=a.lastFactors,r=e=>e>=0?"+".concat(e):"".concat(e),i="{lead:".concat(r(t.leadership),", terr:").concat(r(t.terrain),", cas:").concat(r(t.casualties),", out:").concat(r(t.outnumbered),", eff:").concat(r(t.effects),"}");e.log.push("MORALE u=".concat(n.name," state=").concat(a.state," ema=").concat(a.ema," f=").concat(i))}}}const mn={baseBonus:8,range:3,falloffRate:3,charismaScaling:.5};function fn(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:mn;const a=Vt(e,t);if(a>r.range)return 0;const i=Math.max(0,r.baseBonus-a*r.falloffRate),o=Math.min(15,n)*r.charismaScaling;return Math.round(i+o)}function gn(e){if(e.commander){const t=e.units.find(t=>t.id===e.commander.unitId);t&&t.pos&&!t.isDead&&yn(e,t,"Player")}if(e.enemyCommander){const t=e.units.find(t=>t.id===e.enemyCommander.unitId);t&&t.pos&&!t.isDead&&yn(e,t,"Enemy")}}function yn(e,t,n){const r=t.stats.mag||10;for(const a of e.units){if(a.faction!==n||a.isDead||a.isCommander||!a.pos)continue;const e=fn(t.pos,a.pos,r);e>0&&xn(a,e,t.name)}}function xn(e,t,n){e.statuses=e.statuses.filter(e=>e.name!=="aura_".concat(n)),e.statuses.push({id:"aura_".concat(n,"_").concat(Date.now()),name:"aura_".concat(n),duration:999,effects:{},payload:{moraleBonus:t}})}function vn(e,t){const n=e.units.find(e=>e.id===t);if(!n||n.isDead||!n.pos)return{moved:!1,damageTaken:0,reason:"Unit not found or invalid"};const r=function(e,t){if(!t.pos)return[];const n=jn(t.pos),r=[];for(const a of n){const n=e.units.find(e=>e.pos&&e.pos.q===a.q&&e.pos.r===a.r&&e.faction!==t.faction&&!e.isDead);n&&r.push(n)}return r}(e,n);if(0===r.length)return bn(e,n);let a=0,i=!1;for(const o of r){if(wn(n,o).success)i=!0;else{const t=kn(o,n);a+=t,e.log.push("".concat(o.name," strikes ").concat(n.name," as they attempt to flee! (").concat(t," damage)"))}}if(i){const t=bn(e,n);return{moved:t.moved,damageTaken:a,newPosition:t.newPosition,reason:a>0?"Fled but took opportunity attacks":"Successfully fled"}}return function(e,t){e.stats.hp=Math.max(0,e.stats.hp-t),e.stats.hp<=0&&(e.isDead=!0)}(n,a),{moved:!1,damageTaken:a,reason:"Failed to break free from enemy zone of control"}}function bn(e,t){if(!t.pos)return{moved:!1,damageTaken:0,reason:"No position"};const n=function(e,t){if(!t.pos)return null;const n=[],r=jn(t.pos);for(const a of r){const r=Gt(e.grid,a);if(!r||!r.passable||Cn(e,a))continue;const i=Sn(e,a,t.faction);n.push({pos:a,safety:i})}return 0===n.length?null:(n.sort((e,t)=>t.safety-e.safety),n[0].pos)}(e,t);if(!n)return{moved:!1,damageTaken:0,reason:"No safe position found"};const r=Jt(e.grid,t.pos,n,1);if(!r||r.length<2)return{moved:!1,damageTaken:0,reason:"Path blocked by terrain"};const a=r[1];return t.pos=a,e.log.push("".concat(t.name," flees to a safer position.")),{moved:!0,damageTaken:0,newPosition:a,reason:"Successfully moved to safety"}}function wn(e,t){const n=e.stats.spd||10,r=t.stats.spd||10,a=n+Math.floor(10*Math.random()),i=r+Math.floor(10*Math.random());return{success:a>i,margin:Math.abs(a-i)}}function kn(e,t){const n=e.stats.atk||0,r=t.stats.def||0;return Math.max(1,Math.floor(.7*(n-.5*r)))}function Sn(e,t,n){let r=0;for(const a of e.units){if(a.faction===n||a.isDead||!a.pos)continue;const e=Vt(t,a.pos);e<=1?r-=10:e<=2?r-=5:r+=1}for(const a of e.units){if(a.faction!==n||a.isDead||!a.pos)continue;Vt(t,a.pos)<=2&&(r+=3)}return Math.min(t.q,t.r,e.grid.width-t.q-1,e.grid.height-t.r-1)<=2&&(r+=5),r}function jn(e){return[{q:e.q+1,r:e.r},{q:e.q+1,r:e.r-1},{q:e.q,r:e.r-1},{q:e.q-1,r:e.r},{q:e.q-1,r:e.r+1},{q:e.q,r:e.r+1}]}function Cn(e,t){return e.units.some(e=>e.pos&&e.pos.q===t.q&&e.pos.r===t.r&&!e.isDead)}function Mn(e,t){var n;const r=e.units.find(e=>e.id===t);if(!r)return!1;const a=null===(n=r.meta)||void 0===n?void 0:n.morale;if(!a||"routing"!==a.state)return!1;e.log.push("".concat(r.name," is routing and must attempt to flee!"));const i=vn(e,t);return i.moved?e.log.push("".concat(r.name," successfully flees to safety.")):e.log.push("".concat(r.name," fails to escape! ").concat(i.reason)),i.moved}function Tn(e,t){const n=e.units.filter(e=>e.faction===t&&!e.isDead&&!e.isCommander);if(0===n.length)return!0;return n.filter(e=>{var t;const n=null===(t=e.meta)||void 0===t?void 0:t.morale;return n&&"routing"===n.state}).length/n.length>=.75&&(e.log.push("".concat(t," army is in full retreat!")),!0)}function An(e,t){const n=e.units.find(e=>e.id===t);if(!n||!n.pos)return;if(n.isCommander){n.faction;!function(e,t){const n=t>=0?"+".concat(t):"".concat(t);e.log.push("Army morale shift: ".concat(n));for(const i of e.units){var a;if(i.isDead||i.isCommander)continue;const e=null===(a=i.meta)||void 0===a?void 0:a.morale;if(e){const n=Math.max(0,Math.min(100,e.value+t)),a=Math.max(0,Math.min(100,e.ema+t)),o=(0,r.A)((0,r.A)({},e),{},{value:n,ema:a,state:hn(e.state,a)});i.meta.morale=o}}}(e,-15),function(e,t){for(const n of e.units)n.statuses=n.statuses.filter(e=>e.name!=="aura_".concat(t));e.log.push("Commander ".concat(t," has fallen! Army morale suffers."))}(e,n.name),e.log.push("Commander ".concat(n.name," has fallen! Army morale plummets."))}const a=e.units.filter(e=>{if(!e.pos||e.isDead||e.faction===n.faction)return!1;return Math.abs(e.pos.q-n.pos.q)+Math.abs(e.pos.r-n.pos.r)<=1});if(a.length>0)for(const r of a){var i;const e=null===(i=r.meta)||void 0===i?void 0:i.morale;e&&(e.value=Math.max(0,e.value-2))}pn(e)}n(355),n(364);new Map;function En(e){let{state:t,onTileClick:n,selectedUnit:r,targetHex:i,showGrid:o=!0,showCoordinates:s=!1}=e;const l=(0,a.useRef)(null),[c,d]=(0,a.useState)(null),u=30;Math.sqrt(3);function h(e,t,n){const{x:r,y:a}=y({q:t.q,r:t.r});if(e.fillStyle={Grass:"#4a7c59",Forest:"#2d5016",Mountain:"#8b7355",Water:"#1e40af",Desert:"#fbbf24",Swamp:"#365314"}[t.terrain]||"#4a7c59",n&&(e.fillStyle="#fbbf24"),t.passable||(e.fillStyle="#991b1b"),g(e,r,a),t.cover&&t.cover>0){e.fillStyle="rgba(139, 69, 19, 0.6)";const n=u*t.cover*.3;e.beginPath(),e.arc(r+18,a-18,n,0,2*Math.PI),e.fill()}}function p(e,t,n){if(!t.pos)return;const{x:r,y:a}=y(t.pos);e.fillStyle={Player:"#22c55e",Enemy:"#ef4444",Neutral:"#6b7280"}[t.faction],n?(e.strokeStyle="#fbbf24",e.lineWidth=3):(e.strokeStyle="#1f2937",e.lineWidth=1);e.beginPath(),e.arc(r,a,21,0,2*Math.PI),e.fill(),e.stroke(),t.isCommander&&(e.fillStyle="#fbbf24",e.beginPath(),e.arc(r,a-12.6,4,0,2*Math.PI),e.fill()),function(e,t,n,r){const a=36,i=4,o=t.stats.hp/t.stats.maxHp;e.fillStyle="#1f2937",e.fillRect(n-a/2,r,a,i),e.fillStyle=o>.5?"#22c55e":o>.25?"#fbbf24":"#ef4444",e.fillRect(n-a/2,r,a*o,i),e.strokeStyle="#374151",e.lineWidth=1,e.strokeRect(n-a/2,r,a,i)}(e,t,r,a+21+5),e.fillStyle="#ffffff",e.font="10px Arial",e.textAlign="center",e.fillText("".concat(t.name),r,a+21+20),e.fillText("Lv".concat(t.level),r,a+21+32)}function m(e,t,n){const{x:r,y:a}=y(t);e.fillStyle=n,g(e,r,a)}function f(e,t,n){e.beginPath();for(let r=0;r<6;r++){const a=Math.PI/3*r,i=t+u*Math.cos(a),o=n+u*Math.sin(a);0===r?e.moveTo(i,o):e.lineTo(i,o)}e.closePath(),e.stroke()}function g(e,t,n){e.beginPath();for(let r=0;r<6;r++){const a=Math.PI/3*r,i=t+u*Math.cos(a),o=n+u*Math.sin(a);0===r?e.moveTo(i,o):e.lineTo(i,o)}e.closePath(),e.fill()}function y(e){return{x:u*(1.5*e.q)+50,y:u*(Math.sqrt(3)/2*e.q+Math.sqrt(3)*e.r)+50}}function x(e,t){t-=50;return function(e){let t=Math.round(e.q),n=Math.round(e.r);const r=Math.round(-e.q-e.r),a=Math.abs(t-e.q),i=Math.abs(n-e.r),o=Math.abs(r-(-e.q-e.r));a>i&&a>o?t=-n-r:i>o&&(n=-t-r);return{q:t,r:n}}({q:2/3*(e-=50)/u,r:(-1/3*e+Math.sqrt(3)/3*t)/u})}(0,a.useEffect)(()=>{const e=l.current;if(!e)return;const n=e.getContext("2d");if(n){n.clearRect(0,0,e.width,e.height),o&&function(e,t){e.strokeStyle="#444",e.lineWidth=1;for(let n=0;n<t.width;n++)for(let r=0;r<t.height;r++){const{x:t,y:a}=y({q:n,r:r});f(e,t,a),s&&(e.fillStyle="#666",e.font="10px monospace",e.textAlign="center",e.fillText("".concat(n,",").concat(r),t,a))}}(n,t.grid);for(const e of t.grid.tiles)h(n,e,!1);"Setup"===t.phase&&function(e,t){e.fillStyle="rgba(34, 197, 94, 0.3)";for(const n of t.friendlyDeployment.hexes){const{x:t,y:r}=y(n);g(e,t,r)}e.fillStyle="rgba(239, 68, 68, 0.3)";for(const n of t.enemyDeployment.hexes){const{x:t,y:r}=y(n);g(e,t,r)}}(n,t);for(const e of t.units)e.pos&&!e.isDead&&p(n,e,e.id===r);c&&m(n,c,"rgba(255, 255, 255, 0.3)"),i&&m(n,i,"rgba(255, 0, 0, 0.5)")}},[t,r,i,c,o,s]);const v=Math.min(1200,Math.max(600,t.grid.width*u*1.5+100)),b=Math.min(800,Math.max(400,t.grid.height*u*1.2+100));return(0,w.jsxs)("div",{className:"relative flex justify-center items-center min-h-full overflow-auto",children:[(0,w.jsx)("canvas",{ref:l,width:v,height:b,onClick:function(e){if(!n)return;const r=l.current;if(!r)return;const a=r.getBoundingClientRect(),i=x(e.clientX-a.left,e.clientY-a.top);i.q>=0&&i.q<t.grid.width&&i.r>=0&&i.r<t.grid.height&&n(i)},onMouseMove:function(e){const n=l.current;if(!n)return;const r=n.getBoundingClientRect(),a=x(e.clientX-r.left,e.clientY-r.top);a.q>=0&&a.q<t.grid.width&&a.r>=0&&a.r<t.grid.height&&((null===c||void 0===c?void 0:c.q)!==a.q||(null===c||void 0===c?void 0:c.r)!==a.r)&&d(a)},onMouseLeave:function(){d(null)},className:"border border-gray-600 bg-gray-800 cursor-pointer max-w-full max-h-full"}),(0,w.jsxs)("div",{className:"absolute top-2 left-2 bg-black bg-opacity-75 text-white p-2 rounded text-sm",children:[(0,w.jsxs)("div",{children:["Turn ",t.turn," - ",t.phase]}),(0,w.jsxs)("div",{children:["Biome: ",t.context.biome]}),c&&(0,w.jsxs)("div",{children:["Hex: (",c.q,", ",c.r,")"]})]}),(0,w.jsxs)("div",{className:"absolute top-2 right-2 space-x-2",children:[(0,w.jsx)("button",{onClick:()=>{},className:"px-2 py-1 bg-gray-700 text-white text-xs rounded hover:bg-gray-600",children:"Grid"}),(0,w.jsx)("button",{onClick:()=>{},className:"px-2 py-1 bg-gray-700 text-white text-xs rounded hover:bg-gray-600",children:"Coords"})]})]})}function Pn(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Rn(e,t,n){Pn(e,t),t.set(e,n)}function _n(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}function Nn(e,t,n){return e.set(_n(e,t),n),n}function Bn(e,t){return e.get(_n(e,t))}var zn=n(705);const Ln=e=>Number.isFinite(e)&&!Number.isNaN(e),In=e=>"object"==typeof e&&null!==e,qn=e=>In(e)&&Ln(e.col)&&Ln(e.row),Dn=e=>Array.isArray(e)&&Ln(e[0])&&Ln(e[1]),On=(e,t)=>t+e*(1&t)>>1;const Wn=(e,t)=>function(e,t){return(e%t+t)%t}(e+t,8),Hn=e=>{let[t,n,r=-t-n]=e;return{q:t,r:n,s:r}};function Fn(e){let{q:t,r:n,s:r}=e;const a=Ln(t),i=Ln(n),o=Ln(r);if(a&&i&&o)return{q:t,r:n,s:r};if(a&&i)return{q:t,r:n,s:-t-n};if(a&&o)return{q:t,r:-t-r,s:r};if(i&&o)return{q:-n-r,r:n,s:r};throw new TypeError("Can't determine three cube coordinates from less than two coordinates. Received: { q: ".concat(t,", r: ").concat(n,", s: ").concat(r," }."))}var Gn=(e=>(e.FLAT="FLAT",e.POINTY="POINTY",e))(Gn||{});function Un(e,t){if((e=>In(e)&&Ln(e.x)&&Ln(e.y))(e))return e;if(!t)throw new TypeError("Supply a bounding box ({ width: number, height: number }). Received: ".concat(JSON.stringify(t)));if("topLeft"===e)return{x:-.5*t.width,y:-.5*t.height};throw new TypeError("Invalid origin: ".concat(JSON.stringify(e),". Origin must be expressed as a Point ({ x: number, y: number }) or the string 'topLeft'."))}class Vn{static get settings(){const{dimensions:e,orientation:t,origin:n,offset:r}=this.prototype;return{dimensions:e,orientation:t,origin:n,offset:r}}get center(){const{width:e,height:t,x:n,y:r}=this;return{x:e/2-n,y:t/2-r}}get col(){return Qn(this).col}get corners(){const{orientation:e,width:t,height:n,x:r,y:a}=this;return e===Gn.POINTY?Kn(t,n,r,a):Xn(t,n,r,a)}get dimensions(){return Yn.dimensions}get height(){const{orientation:e,dimensions:{yRadius:t}}=this;return e===Gn.POINTY?2*t:t*Math.sqrt(3)}get isFlat(){return this.orientation===Gn.FLAT}get isPointy(){return this.orientation===Gn.POINTY}get orientation(){return Yn.orientation}get origin(){return Yn.origin}get offset(){return Yn.offset}get row(){return Qn(this).row}get width(){const{orientation:e,dimensions:{xRadius:t}}=this;return e===Gn.POINTY?t*Math.sqrt(3):2*t}get x(){return $n(this).x}get y(){return $n(this).y}get s(){return-this.q-this.r}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0];(0,zn.A)(this,"q",void 0),(0,zn.A)(this,"r",void 0);const{q:t,r:n}=rr(this,e);this.q=t,this.r=n}clone(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;return new this.constructor(e)}equals(e){return function(e,t){if(qn(e)&&qn(t))return e.col===t.col&&e.row===t.row;if(Object.hasOwn(e,"col")||Object.hasOwn(t,"col"))throw new Error("Can't compare coordinates where one are offset coordinates. Either pass two offset coordinates or two axial/cube coordinates. Received: ".concat(JSON.stringify(e)," and ").concat(JSON.stringify(t)));const n=Dn(e)?Hn(e):e,r=Dn(t)?Hn(t):t;return n.q===r.q&&n.r===r.r}(this,qn(e)?tr(this,e):e)}toString(){return"".concat(this.constructor.name,"(").concat(this.q,",").concat(this.r,")")}translate(e){return function(e,t){const{q:n,r:r,s:a}=Fn(e),{q:i,r:o,s:s}=Fn(t),l={q:n+i,r:r+o,s:a+s};return e instanceof Vn?e.clone(l):l}(this,e)}}const Yn={dimensions:{xRadius:1,yRadius:1},orientation:Gn.POINTY,origin:{x:0,y:0},offset:-1},Kn=(e,t,n,r)=>[{x:n+.5*e,y:r-.25*t},{x:n+.5*e,y:r+.25*t},{x:n,y:r+.5*t},{x:n-.5*e,y:r+.25*t},{x:n-.5*e,y:r-.25*t},{x:n,y:r-.5*t}],Xn=(e,t,n,r)=>[{x:n+.25*e,y:r-.5*t},{x:n+.5*e,y:r},{x:n+.25*e,y:r+.5*t},{x:n-.25*e,y:r+.5*t},{x:n-.5*e,y:r},{x:n-.25*e,y:r-.5*t}];function Jn(e){const{dimensions:t,orientation:n,origin:a,offset:i}=(0,r.A)((0,r.A)({},Yn),e);return class extends Vn{get dimensions(){return function(e,t){if(In(e)&&e.xRadius>0&&e.yRadius>0)return e;if(In(e)&&e.width>0&&e.height>0){const{width:n,height:r}=e;return t===Gn.POINTY?{xRadius:n/Math.sqrt(3),yRadius:r/2}:{xRadius:n/2,yRadius:r/Math.sqrt(3)}}if(e>0)return{xRadius:e,yRadius:e};throw new TypeError("Invalid dimensions: ".concat(JSON.stringify(e),". Dimensions must be expressed as an Ellipse ({ xRadius: number, yRadius: number }), a Rectangle ({ width: number, height: number }) or a number."))}(t,n)}get orientation(){return n}get origin(){return Un(a,this)}get offset(){return i}}}const Qn=e=>{let{q:t,r:n,offset:r,isPointy:a}=e;return a?((e,t,n)=>({col:e+On(n,t),row:t}))(t,n,r):((e,t,n)=>({col:e,row:t+On(n,e)}))(t,n,r)},$n=e=>{let{orientation:t,dimensions:{xRadius:n,yRadius:r},origin:{x:a,y:i},q:o,r:s}=e;return t===Gn.POINTY?{x:n*Math.sqrt(3)*(o+s/2)-a,y:3*r/2*s-i}:{x:3*n/2*o-a,y:r*Math.sqrt(3)*(s+o/2)-i}},Zn=(e,t,n)=>{const r=e-On(n,t);return{q:r,r:t,s:-r-t}},er=(e,t,n)=>{const r=e,a=t-On(n,e);return{q:r,r:a,s:-r-a}},tr=(e,t)=>{let{offset:n,orientation:r}=e,{col:a,row:i}=t;return r===Gn.POINTY?Zn(a,i,n):er(a,i,n)},nr=e=>{const{q:t,r:n,s:r}=Fn(e);let a=Math.round(t),i=Math.round(n),o=Math.round(r);const s=Math.abs(t-a),l=Math.abs(n-i),c=Math.abs(r-o);return s>l&&s>c?a=-i-o:l>c?i=-a-o:o=-a-i,{q:a,r:i,s:o}};function rr(e,t){return Dn(t)?Hn(t):qn(t)?tr(e,t):Fn(t)}function ar(e,t,n){const{q:r,r:a,s:i}=rr(e,t),{q:o,r:s,s:l}=rr(e,n);return Math.max(Math.abs(r-o),Math.abs(a-s),Math.abs(i-l))}var ir=(e=>(e[e.N=0]="N",e[e.NE=1]="NE",e[e.E=2]="E",e[e.SE=3]="SE",e[e.S=4]="S",e[e.SW=5]="SW",e[e.W=6]="W",e[e.NW=7]="NW",e))(ir||{});const or=[null,{q:1,r:-1},{q:1,r:0},{q:0,r:1},null,{q:-1,r:1},{q:-1,r:0},{q:0,r:-1}],sr=[{q:0,r:-1},{q:1,r:-1},null,{q:1,r:0},{q:0,r:1},{q:-1,r:1},null,{q:-1,r:0}],lr=(e,t)=>e.clone(e.isPointy?((e,t)=>{let{offset:n,q:r,r:a,col:i,row:o}=e;if(t===ir.S||t===ir.N){const e=t===ir.S?o+1:o-1;return Zn(i,e,n)}const s=or[t];return{q:r+s.q,r:a+s.r}})(e,t):((e,t)=>{let{offset:n,q:r,r:a,col:i,row:o}=e;if(t===ir.E||t===ir.W){const e=t===ir.E?i+1:i-1;return er(e,o,n)}const s=sr[t];return{q:r+s.q,r:a+s.r}})(e,t));function cr(e){return Array.isArray(e)?function(t,n){const r=[];let a=n;for(const i of e)for(const e of i(t,a))r.push(a=e);return r}:e}function dr(e){return function(e){return e.direction in ir}(e)?function(e){let{start:t,direction:n,length:r}=e;return function(e,a){const i=[];let o=e(null!==t&&void 0!==t?t:a);!t&&a&&(o=lr(o,n));for(let t=0;t<r;t++)i.push(o),o=lr(o,n);return i}}(e):function(e){let{start:t,stop:n}=e;return function(e,r){const a=[],i=e(null!==t&&void 0!==t?t:r),o=function(e,t){return n=>({q:e.q*(1-n)+t.q*n,r:e.r*(1-n)+t.r*n})}(ur(i),ur(rr(i,n))),s=ar(i,i,n),l=1/Math.max(s,1);let c=!t&&r?1:0;for(;c<=s;c++){const t=nr(o(l*c));a.push(e(t))}return a}}(e)}function ur(e){let{q:t,r:n,s:r}=e;return{q:t+1e-6,r:n+1e-6,s:r+-2e-6}}function hr(e,t){let{includeSource:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(r,a){const i=[];for(const o of cr(e)(r,a)){n&&i.push(o);for(const e of cr(t)(r,o))i.push(e)}return i}}function pr(e,t){return function(n,r){var a;const{width:i,height:o,start:s,direction:l=ir.E}=t?function(e,t,n){let{isPointy:r,offset:a}=n;const{col:i,row:o}=mr(e,r,a),{col:s,row:l}=mr(t,r,a),c=i<s?"A":"B",d=o<l?"A":"B",u=c+d,{swapWidthHeight:h,direction:p}=fr[u],m=Math.abs(i-s)+1,f=Math.abs(o-l)+1;return{width:h?f:m,height:h?m:f,start:e,direction:p}}(e,t,n()):e,c=null!==(a=null!==s&&void 0!==s?s:r)&&void 0!==a?a:[0,0],d=hr(dr({start:c,direction:Wn(l,2),length:o}),dr({direction:l,length:i-1}))(n,c);return!s&&r?d.slice(1):d}}function mr(e,t,n){if(qn(e))return e;const{q:r,r:a}=Dn(e)?Hn(e):Fn(e);return Qn({q:r,r:a,isPointy:t,offset:n})}const fr={AA:{swapWidthHeight:!1,direction:ir.E},AB:{swapWidthHeight:!0,direction:ir.N},BA:{swapWidthHeight:!0,direction:ir.S},BB:{swapWidthHeight:!1,direction:ir.W}};var gr=new WeakMap,yr=new WeakMap,xr=new WeakSet;class vr{static fromIterable(e){const t=e[Symbol.iterator]().next().value;if(!t)throw new TypeError("Can't create grid from empty iterable: ".concat(JSON.stringify(e)));return new vr(t.constructor,e)}static fromJSON(e,t){let{hexSettings:n,coordinates:r}=e;if(t){const e=r.map(t),n=e.length>0?e[0].constructor:t({q:0,r:0},0,[{q:0,r:0}]).constructor;return new vr(n,e)}const a=Jn(n);return new vr(a,r.map(e=>new a(e)))}get size(){return Bn(yr,this).size}get pixelWidth(){if(0===this.size)return 0;const{isPointy:e,width:t}=this.hexPrototype,n=this.toArray(),{0:r,length:a,[a-1]:i}=e?n.sort((e,t)=>t.s-e.s||e.q-t.q):n.sort((e,t)=>e.q-t.q);return i.x-r.x+t}get pixelHeight(){if(0===this.size)return 0;const{isPointy:e,height:t}=this.hexPrototype,n=this.toArray(),{0:r,length:a,[a-1]:i}=e?n.sort((e,t)=>e.r-t.r):n.sort((e,t)=>t.s-e.s||e.r-t.r);return i.y-r.y+t}[Symbol.iterator](){return Bn(yr,this).values()}get hexPrototype(){return Bn(gr,this).prototype}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(function(e,t){Pn(e,t),t.add(e)}(this,xr),Rn(this,gr,void 0),Rn(this,yr,new Map),e instanceof vr)return Nn(gr,this,Bn(gr,e)),void this.setHexes(e);Nn(gr,this,e),this.setHexes(_n(xr,this,wr).call(this,t))}createHex(e){return new(Bn(gr,this))(e)}getHex(e){const t=this.createHex(e);return Bn(yr,this).get(t.toString())}hasHex(e){return Bn(yr,this).has(e.toString())}setHexes(e){for(const t of e){const e=t instanceof Vn?t:new(Bn(gr,this))(t);_n(xr,this,br).call(this,e)}return this}filter(e){const t=new vr(Bn(gr,this));for(const n of this)e(n)&&_n(xr,t,br).call(t,n);return t}map(e){const t=new vr(Bn(gr,this));for(const n of this)_n(xr,t,br).call(t,e(n));return t}traverse(e){let{bail:t=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new vr(Bn(gr,this));for(const r of _n(xr,this,wr).call(this,e)){const e=this.getHex(r);if(e)_n(xr,n,br).call(n,e);else if(t)return n}return n}forEach(e){for(const t of this)e(t);return this}reduce(e,t){if(void 0===t){let t,n,r;for(const a of this)n=r,r=a,n&&(t=e(n,r));return t}let n=t;for(const r of this)n=e(n,r);return n}toArray(){return Array.from(this)}toJSON(){const{dimensions:e,orientation:t,origin:n,offset:r}=this.hexPrototype;return{hexSettings:{dimensions:e,orientation:t,origin:n,offset:r},coordinates:this.toArray()}}toString(){return"".concat(this.constructor.name,"(").concat(this.size,")")}pointToHex(e){let{allowOutside:t=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=((e,t)=>{let{dimensions:{xRadius:n,yRadius:r},origin:a,orientation:i}=e,{x:o,y:s}=t;return o+=a.x,s+=a.y,i===Gn.POINTY?nr({q:Math.sqrt(3)*o/(3*n)-s/(3*r),r:2/3*(s/r)}):nr({q:2/3*(o/n),r:Math.sqrt(3)*s/(3*r)-o/(3*n)})})(this.hexPrototype,e),r=this.getHex(n);return t?null!==r&&void 0!==r?r:this.createHex(n):r}distance(e,t){let{allowOutside:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n)return ar(this.hexPrototype,e,t);const r=this.getHex(e),a=this.getHex(t);return r&&a?ar(this.hexPrototype,r,a):void 0}neighborOf(e,t){let{allowOutside:n=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=lr(this.createHex(e),t),a=this.getHex(r);return n?null!==a&&void 0!==a?a:r:a}}function br(e){Bn(yr,this).set(e.toString(),e)}function wr(e){return _n(xr,this,kr).call(this,e)?_n(xr,this,Sr).call(this,e):Array.isArray(e)&&_n(xr,this,kr).call(this,e[0])?_n(xr,this,Sr).call(this,cr(e)):e}function kr(e){return"function"==typeof e}function Sr(e){return e(this.createHex.bind(this))}function jr(e){let{init:t,onRender:n,pan:r,zoom:i,onClick:o,onHover:s,onHoverEnd:l}=e;const c=(0,a.useRef)(null),d=(0,a.useRef)();return(0,a.useEffect)(()=>{const e=c.current,a=e.getContext("2d"),u=()=>{const t=Math.max(1,window.devicePixelRatio||1),n=Math.floor(e.clientWidth*t),r=Math.floor(e.clientHeight*t);e.width===n&&e.height===r||(e.width=n,e.height=r,a.scale(t,t))},h=new ResizeObserver(u);h.observe(e),u(),null===t||void 0===t||t(a,e);const p=e=>{null===n||void 0===n||n(a,e),d.current=requestAnimationFrame(p)};d.current=requestAnimationFrame(p);let m=!1,f=0,g=0;const y=t=>{t.preventDefault(),m=!0,f=t.clientX,g=t.clientY,e.setPointerCapture(t.pointerId),e.style.cursor="grabbing"},x=t=>{if(m){const e=t.clientX-f,n=t.clientY-g;f=t.clientX,g=t.clientY,null===r||void 0===r||r(e,n)}else if(s){const n=e.getBoundingClientRect(),r=t.clientX-n.left,a=t.clientY-n.top;s(r,a)}},v=t=>{if(m){m=!1,e.style.cursor="grab";try{e.releasePointerCapture(t.pointerId)}catch(n){}}else if(o){const n=e.getBoundingClientRect(),r=t.clientX-n.left,a=t.clientY-n.top;o(r,a)}},b=()=>{m||null===l||void 0===l||l()},w=t=>{t.preventDefault();const n=e.getBoundingClientRect(),r=t.clientX-n.left,a=t.clientY-n.top;null===i||void 0===i||i(-t.deltaY,r,a)},k=e=>e.preventDefault(),S=e=>e.preventDefault();return e.addEventListener("pointerdown",y),e.addEventListener("pointermove",x),e.addEventListener("pointerleave",b),window.addEventListener("pointerup",v),e.addEventListener("wheel",w,{passive:!1}),e.addEventListener("auxclick",k),e.addEventListener("contextmenu",S),e.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),()=>{h.disconnect(),cancelAnimationFrame(d.current),e.removeEventListener("pointerdown",y),e.removeEventListener("pointermove",x),e.removeEventListener("pointerleave",b),window.removeEventListener("pointerup",v),e.removeEventListener("wheel",w),e.removeEventListener("auxclick",k),e.removeEventListener("contextmenu",S)}},[t,n,r,i,o,s,l]),(0,w.jsx)("div",{className:"map-root",children:(0,w.jsx)("canvas",{ref:c,className:"map-canvas"})})}const Cr=Jn({dimensions:30,orientation:Gn.POINTY});function Mr(e){let{state:t,onTileClick:n,selectedUnit:r,targetHex:i,showGrid:o=!0}=e;const s=(0,a.useRef)({x:0,y:0,scale:1}),[l,c]=(0,a.useState)(null),[,d]=(0,a.useState)(0),u=(0,a.useMemo)(()=>new vr(Cr,pr({width:t.grid.width,height:t.grid.height})),[t.grid.width,t.grid.height]),h=((0,a.useCallback)(e=>new Cr({col:e.q,row:e.r}),[]),(0,a.useCallback)(e=>({q:e.col,r:e.row}),[])),p=(0,a.useCallback)((e,t,n)=>{const r=s.current,a=n.width/(2*window.devicePixelRatio),i=n.height/(2*window.devicePixelRatio),o=(e-a-r.x)/r.scale,l=(t-i-r.y)/r.scale;return{x:o+u.pixelWidth/2,y:l+u.pixelHeight/2}},[u]),m=(0,a.useCallback)((e,n,r)=>{try{const a=p(e,n,r),i=u.pointToHex({x:a.x,y:a.y});if(i){const e=h(i);if(e.q>=0&&e.q<t.grid.width&&e.r>=0&&e.r<t.grid.height)return e}}catch(a){}return null},[p,u,h,t.grid.width,t.grid.height]),f=(0,a.useCallback)((e,t)=>{const n=s.current;0===n.x&&0===n.y&&1===n.scale&&(n.x=0,n.y=0,n.scale=1)},[]),g=(0,a.useCallback)((e,n)=>{const a=e.canvas,c=s.current;e.clearRect(0,0,a.width,a.height),e.save();const d=a.width/(2*window.devicePixelRatio),h=a.height/(2*window.devicePixelRatio);e.translate(d+c.x,h+c.y),e.scale(c.scale,c.scale);const p=u.pixelWidth,m=u.pixelHeight;if(e.translate(-p/2,-m/2),o&&(e.strokeStyle="#444",e.lineWidth=1/c.scale,u.forEach(t=>{const{x:n,y:r}=t;!function(e,t,n,r){e.beginPath();for(let a=0;a<6;a++){const i=Math.PI/3*a,o=t+r*Math.cos(i),s=n+r*Math.sin(i);0===a?e.moveTo(o,s):e.lineTo(o,s)}e.closePath(),e.stroke()}(e,n,r,t.dimensions.xRadius)})),u.forEach(n=>{const r=n.col,a=n.row,i=t.grid.tiles.find(e=>e.q===r&&e.r===a);if(i){e.fillStyle={Grass:"#4ade80",Forest:"#22c55e",Mountain:"#6b7280",Water:"#3b82f6",Desert:"#fbbf24",Swamp:"#84cc16"}[i.terrain]||"#6b7280";const{x:t,y:r}=n;Tr(e,t,r,n.dimensions.xRadius)}}),"Setup"===t.phase&&(e.fillStyle="rgba(34, 197, 94, 0.3)",t.friendlyDeployment.hexes.forEach(t=>{const n=new Cr({col:t.q,row:t.r}),{x:r,y:a}=n;Tr(e,r,a,n.dimensions.xRadius)}),e.fillStyle="rgba(239, 68, 68, 0.3)",t.enemyDeployment.hexes.forEach(t=>{const n=new Cr({col:t.q,row:t.r}),{x:r,y:a}=n;Tr(e,r,a,n.dimensions.xRadius)})),t.units.forEach(t=>{if(t.pos&&!t.isDead){const n=new Cr({col:t.pos.q,row:t.pos.r}),{x:a,y:i}=n,o=r===t.id;!function(e,t,n,r,a){e.beginPath(),e.arc(t,n,20,0,2*Math.PI),e.fillStyle="Player"===r.faction?"#3b82f6":"#ef4444",e.fill(),a?(e.strokeStyle="#fbbf24",e.lineWidth=3,e.stroke()):(e.strokeStyle="#1f2937",e.lineWidth=2,e.stroke());e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(r.name.substring(0,3),t,n+3);const i=r.stats.hp/r.stats.maxHp,o=24,s=4;e.fillStyle="#1f2937",e.fillRect(t-o/2,n-30,o,s),e.fillStyle=i>.5?"#22c55e":i>.25?"#fbbf24":"#ef4444",e.fillRect(t-o/2,n-30,o*i,s)}(e,a,i,t,o)}}),l){const t=new Cr({col:l.q,row:l.r}),{x:n,y:r}=t;e.fillStyle="rgba(255, 255, 255, 0.2)",Tr(e,n,r,t.dimensions.xRadius)}if(i){const t=new Cr({col:i.q,row:i.r}),{x:n,y:r}=t;e.fillStyle="rgba(239, 68, 68, 0.5)",Tr(e,n,r,t.dimensions.xRadius)}e.restore()},[u,t,r,i,l,o]),y=(0,a.useCallback)((e,t)=>{s.current.x+=e,s.current.y+=t},[]),x=(0,a.useCallback)((e,t,n)=>{const r=s.current,a=Math.exp(-.001*e),i=Math.max(.3,Math.min(3,r.scale*a));if(i!==r.scale){const e=document.querySelector(".map-canvas");if(e){const a=e.width/(2*window.devicePixelRatio),o=e.height/(2*window.devicePixelRatio),s=1/r.scale,l=(t-a-r.x)*s,c=(n-o-r.y)*s;r.scale=i,r.x=t-a-l*r.scale,r.y=n-o-c*r.scale}}},[]),v=(0,a.useCallback)((e,t)=>{const r=document.querySelector(".map-canvas");if(r&&n){const a=m(e,t,r);a&&n(a)}},[m,n]),b=(0,a.useCallback)((e,t)=>{const n=document.querySelector(".map-canvas");if(n){const r=m(e,t,n);l&&r&&l.q===r.q&&l.r===r.r||c(r)}},[m,l]),k=(0,a.useCallback)(()=>{c(null)},[]),S=(0,a.useCallback)(()=>{s.current.x=0,s.current.y=0,s.current.scale=1,d(e=>e+1)},[]);return(0,w.jsxs)("div",{className:"relative w-full h-full bg-gray-900",children:[(0,w.jsx)(jr,{init:f,onRender:g,pan:y,zoom:x,onClick:v,onHover:b,onHoverEnd:k}),(0,w.jsxs)("div",{className:"absolute top-4 left-4 bg-black bg-opacity-75 text-white p-3 rounded text-sm pointer-events-none",children:[(0,w.jsxs)("div",{children:["Turn ",t.turn," - ",t.phase]}),(0,w.jsxs)("div",{children:["Biome: ",t.context.biome]}),l&&(0,w.jsxs)("div",{children:["Hex: (",l.q,", ",l.r,")"]}),(0,w.jsxs)("div",{children:["Zoom: ",Math.round(100*s.current.scale),"%"]})]}),(0,w.jsxs)("div",{className:"absolute top-4 right-4 flex flex-col space-y-2",children:[(0,w.jsx)("button",{onClick:()=>{s.current.scale=Math.min(3,1.1*s.current.scale),d(e=>e+1)},className:"px-3 py-2 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 pointer-events-auto",children:"\ud83d\udd0d+"}),(0,w.jsx)("button",{onClick:()=>{s.current.scale=Math.max(.3,s.current.scale/1.1),d(e=>e+1)},className:"px-3 py-2 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 pointer-events-auto",children:"\ud83d\udd0d-"}),(0,w.jsx)("button",{onClick:S,className:"px-3 py-2 bg-gray-700 text-white text-sm rounded hover:bg-gray-600 pointer-events-auto",children:"\ud83c\udfaf"})]}),(0,w.jsxs)("div",{className:"absolute bottom-4 left-4 bg-black bg-opacity-75 text-white p-2 rounded text-xs pointer-events-none",children:[(0,w.jsx)("div",{children:"\u2022 Drag: Pan \u2022 Scroll: Zoom \u2022 Click: Select \u2022 \ud83c\udfaf: Reset"}),(0,w.jsx)("div",{children:"\u2022 Professional Canvas Wrapper"})]})]})}function Tr(e,t,n,r){e.beginPath();for(let a=0;a<6;a++){const i=Math.PI/3*a,o=t+r*Math.cos(i),s=n+r*Math.sin(i);0===a?e.moveTo(o,s):e.lineTo(o,s)}e.closePath(),e.fill()}function Ar(e){let{state:t,onTileClick:n,selectedUnit:r}=e;const[i,o]=(0,a.useState)("honeycomb");return(0,w.jsxs)("div",{className:"h-screen bg-gray-900 text-white flex flex-col",children:[(0,w.jsxs)("div",{className:"p-4 bg-gray-800 border-b border-gray-700",children:[(0,w.jsxs)("div",{className:"flex items-center justify-between",children:[(0,w.jsx)("h2",{className:"text-xl font-bold",children:"Battle Renderer Test"}),(0,w.jsxs)("div",{className:"flex space-x-2",children:[(0,w.jsx)("button",{onClick:()=>o("original"),className:"px-4 py-2 rounded text-sm transition-colors ".concat("original"===i?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"Original Canvas"}),(0,w.jsx)("button",{onClick:()=>o("honeycomb"),className:"px-4 py-2 rounded text-sm transition-colors ".concat("honeycomb"===i?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"),children:"\ud83c\udf6f Honeycomb Grid"})]})]}),(0,w.jsxs)("div",{className:"mt-2 text-sm text-gray-400",children:["Current: ",(0,w.jsx)("span",{className:"font-medium",children:"original"===i?"Original Custom Canvas":"Honeycomb Grid Library"})]})]}),(0,w.jsx)("div",{className:"flex-1 relative overflow-hidden",children:"original"===i?(0,w.jsx)("div",{className:"w-full h-full overflow-auto flex items-center justify-center",children:(0,w.jsx)(En,{state:t,onTileClick:n,selectedUnit:r,showGrid:!0})}):(0,w.jsx)(Mr,{state:t,onTileClick:n,selectedUnit:r,showGrid:!0})}),(0,w.jsx)("div",{className:"p-4 bg-gray-800 border-t border-gray-700",children:(0,w.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"font-semibold text-blue-400 mb-2",children:"Original Canvas"}),(0,w.jsxs)("ul",{className:"space-y-1 text-gray-300",children:[(0,w.jsx)("li",{children:"\u2022 Custom hex math implementation"}),(0,w.jsx)("li",{children:"\u2022 Manual coordinate conversion"}),(0,w.jsx)("li",{children:"\u2022 Basic centering and scrolling"}),(0,w.jsx)("li",{children:"\u2022 Fixed zoom implementation"})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"font-semibold text-green-400 mb-2",children:"\ud83c\udf6f Honeycomb Grid"}),(0,w.jsxs)("ul",{className:"space-y-1 text-gray-300",children:[(0,w.jsx)("li",{children:"\u2022 Professional hex grid library"}),(0,w.jsx)("li",{children:"\u2022 Built-in coordinate utilities"}),(0,w.jsx)("li",{children:"\u2022 Optimized rendering & interaction"}),(0,w.jsx)("li",{children:"\u2022 TypeScript native, battle-tested"})]})]})]})})]})}const Er={unitId:"hero-1",aura:{name:"Heroic Presence",stats:{atk:1,def:1}},abilities:[{id:"rally",name:"Rally",type:"command",apCost:0,range:0,shape:"ally",healing:3,cooldown:3,description:"Heal and inspire nearby allies"},{id:"fireball",name:"Fireball",type:"spell",apCost:0,range:5,shape:"blast1",damage:{amount:6,type:"fire"},aoeRadius:1,cooldown:2,description:"Launch explosive fireball"},{id:"lightning",name:"Lightning Bolt",type:"spell",apCost:0,range:8,shape:"line",damage:{amount:4,type:"lightning"},cooldown:1,description:"Strike with precise lightning"}],runtime:{cooldowns:{},actionPoints:3}},Pr=[{id:"m1",name:"Sellsword",kind:"Mercenary",faction:"Player",race:"Human",archetype:"Warrior",level:1,stats:{hp:12,maxHp:12,atk:4,def:2,mag:0,res:1,spd:4,rng:1,move:3},statuses:[],skills:[],pos:{q:2,r:4},isDead:!1},{id:"m2",name:"Archer",kind:"Mercenary",faction:"Player",race:"Human",archetype:"Archer",level:1,stats:{hp:8,maxHp:8,atk:3,def:1,mag:0,res:1,spd:5,rng:3,move:3},statuses:[],skills:[],pos:{q:2,r:6},isDead:!1},{id:"m3",name:"Battle Mage",kind:"Mercenary",faction:"Player",race:"Human",archetype:"Mage",level:1,stats:{hp:6,maxHp:6,atk:1,def:0,mag:4,res:2,spd:3,rng:2,move:3},statuses:[],skills:[],pos:{q:1,r:5},isDead:!1}],Rr=[{id:"e1",name:"Goblin Warrior",kind:"Monster",faction:"Enemy",race:"Goblin",archetype:"Grunt",level:1,stats:{hp:6,maxHp:6,atk:2,def:0,mag:0,res:0,spd:4,rng:1,move:3},statuses:[],skills:[],pos:{q:12,r:5},isDead:!1},{id:"e2",name:"Goblin Archer",kind:"Monster",faction:"Enemy",race:"Goblin",archetype:"Archer",level:1,stats:{hp:5,maxHp:5,atk:2,def:0,mag:0,res:0,spd:5,rng:3,move:3},statuses:[],skills:[],pos:{q:12,r:7},isDead:!1},{id:"e3",name:"Goblin Shaman",kind:"Monster",faction:"Enemy",race:"Goblin",archetype:"Shaman",level:2,stats:{hp:8,maxHp:8,atk:1,def:1,mag:3,res:2,spd:3,rng:2,move:3},statuses:[],skills:[],pos:{q:13,r:6},isDead:!1}];function _r(){const{grid:e,friendly:t,enemy:n}=qt({seed:"demo",biome:"Grass"}),r={id:"b1",turn:0,phase:"Setup",grid:e,context:{seed:"demo",biome:"Grass"},commander:Er,units:[...Pr,...Rr],initiative:[],friendlyDeployment:t,enemyDeployment:n,log:[],turnLimit:void 0};return Kt(r),r}function Nr(){const[e,t]=(0,a.useState)(_r()),[n,i]=(0,a.useState)(null),[o,s]=(0,a.useState)(!1),[l,c]=(0,a.useState)("honeycomb");function d(n){console.log("Hex clicked:",n.q,n.r),i({q:n.q,r:n.r});const a=e.units.find(e=>e.pos&&e.pos.q===n.q&&e.pos.r===n.r);a&&"Player"===a.faction?t((0,r.A)((0,r.A)({},e),{},{selectedUnit:a.id})):t((0,r.A)((0,r.A)({},e),{},{selectedUnit:void 0}))}const u=t=>((e.commander.runtime.cooldowns||{})[t]||0)>0,h=t=>{const n=(e.commander.runtime.cooldowns||{})[t]||0;return n>0?" (".concat(n,")"):""};return(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:o?"1fr":"2fr 1fr",gap:16,padding:16,maxWidth:o?"100%":"1200px",margin:"0 auto",height:o?"100vh":"auto"},children:o?(0,w.jsx)(Ar,{state:e,onTileClick:d,selectedUnit:e.selectedUnit}):(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("div",{style:{marginBottom:12},children:[(0,w.jsxs)("h2",{style:{margin:0,color:"#333"},children:["Tactical Battle System","Victory"===e.phase&&" - \ud83c\udf89 VICTORY!","Defeat"===e.phase&&" - \ud83d\udc80 DEFEAT"]}),(0,w.jsx)("p",{style:{margin:"4px 0",color:"#666",fontSize:"14px"},children:"Click hexes to target abilities. Hero commands from off-field."})]}),(0,w.jsxs)("div",{style:{marginBottom:12,display:"flex",gap:8,alignItems:"center"},children:[(0,w.jsx)("label",{style:{fontSize:"14px",color:"#666"},children:"Renderer:"}),(0,w.jsx)("button",{onClick:()=>c("original"),style:{padding:"4px 8px",backgroundColor:"original"===l?"#2196f3":"#f5f5f5",color:"original"===l?"white":"#333",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Original"}),(0,w.jsx)("button",{onClick:()=>c("honeycomb"),style:{padding:"4px 8px",backgroundColor:"honeycomb"===l?"#4caf50":"#f5f5f5",color:"honeycomb"===l?"white":"#333",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\ud83c\udf6f Honeycomb"}),(0,w.jsx)("button",{onClick:()=>s(!o),style:{padding:"4px 8px",backgroundColor:"#ff9800",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"Compare"})]}),"original"===l?(0,w.jsx)(En,{state:e,onTileClick:d}):(0,w.jsx)("div",{style:{height:"500px",border:"1px solid #ddd",borderRadius:"8px"},children:(0,w.jsx)(Mr,{state:e,onTileClick:d,selectedUnit:e.selectedUnit,showGrid:!0})}),(0,w.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,alignItems:"center"},children:[(0,w.jsxs)("button",{onClick:()=>{Xt(e),t((0,r.A)({},e))},disabled:"Victory"===e.phase||"Defeat"===e.phase,style:{padding:"8px 16px",backgroundColor:"Victory"===e.phase||"Defeat"===e.phase?"#ccc":"#4caf50",color:"white",border:"none",borderRadius:"4px",cursor:"Victory"===e.phase||"Defeat"===e.phase?"default":"pointer"},children:["Next Phase (",e.phase,")"]}),(0,w.jsx)("button",{onClick:function(){t(_r()),i(null)},style:{padding:"8px 16px",backgroundColor:"#2196f3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Reset Battle"}),n&&(0,w.jsxs)("span",{style:{padding:"4px 8px",backgroundColor:"#fff3cd",border:"1px solid #ffeaa7",borderRadius:"4px",fontSize:"12px"},children:["Target: (",n.q,", ",n.r,")"]})]})]}),(0,w.jsxs)("div",{style:{backgroundColor:"#f8f9fa",padding:16,borderRadius:8},children:[(0,w.jsx)("h3",{style:{marginTop:0,color:"#333"},children:"Hero Commands"}),(0,w.jsx)("div",{style:{marginBottom:16},children:e.commander.abilities.map(a=>(0,w.jsxs)("button",{onClick:()=>{return o=a.id,$t(e,"hero-1",o,n||{q:12,r:6})&&i(null),nn(e),void t((0,r.A)({},e));var o},disabled:u(a.id)||"Victory"===e.phase||"Defeat"===e.phase,style:{display:"block",width:"100%",marginBottom:8,padding:"8px 12px",backgroundColor:u(a.id)?"#e0e0e0":"#1976d2",color:u(a.id)?"#666":"white",border:"none",borderRadius:"4px",cursor:u(a.id)?"default":"pointer",textAlign:"left"},title:a.description,children:[(0,w.jsxs)("div",{style:{fontWeight:"bold"},children:[a.name,h(a.id)]}),(0,w.jsx)("div",{style:{fontSize:"11px",opacity:.8},children:a.description})]},a.id))}),(0,w.jsx)("h3",{style:{color:"#333"},children:"Commander Aura"}),(0,w.jsxs)("div",{style:{padding:8,backgroundColor:"#e8f5e8",borderRadius:4,marginBottom:16,fontSize:"12px"},children:[(0,w.jsx)("strong",{children:e.commander.aura.name}),(0,w.jsx)("br",{}),"ATK +",e.commander.aura.stats.atk,", DEF +",e.commander.aura.stats.def]}),(0,w.jsx)("h3",{style:{color:"#333"},children:"Battle Log"}),(0,w.jsx)("div",{style:{maxHeight:200,overflowY:"auto",backgroundColor:"#fff",border:"1px solid #ddd",borderRadius:4,padding:8},children:0===e.log.length?(0,w.jsx)("em",{style:{color:"#666"},children:"No events yet..."}):(0,w.jsx)("ul",{style:{margin:0,paddingLeft:20,fontSize:"12px"},children:e.log.slice(-10).map((e,t)=>(0,w.jsx)("li",{style:{marginBottom:4},children:e},t))})}),(0,w.jsxs)("div",{style:{marginTop:16,fontSize:"11px",color:"#666"},children:[(0,w.jsx)("strong",{children:"Battle Rules:"}),(0,w.jsx)("br",{}),"\u2022 Hero fights from off-field with special abilities",(0,w.jsx)("br",{}),"\u2022 Mercenaries deploy on battlefield tactically",(0,w.jsx)("br",{}),"\u2022 On world map: only Hero token visible",(0,w.jsx)("br",{}),"\u2022 Mercenaries stay in party menu outside battle"]})]})]})})}function Br(e){let{state:t,selectedUnit:n,onAbilityUse:r,onEndTurn:a,onDefend:i,onWait:o}=e;const s=e=>((t.commander.runtime.cooldowns||{})[e]||0)>0,l=e=>{const n=(t.commander.runtime.cooldowns||{})[e]||0;return n>0?" (".concat(n,")"):""},c="Victory"===t.phase||"Defeat"===t.phase;return(0,w.jsxs)("div",{style:{backgroundColor:"#1a1a1a",color:"#ffffff",padding:"16px",borderRadius:"8px",border:"1px solid #333",fontFamily:"system-ui, sans-serif"},children:[(0,w.jsxs)("div",{style:{marginBottom:"16px",paddingBottom:"12px",borderBottom:"1px solid #333",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("h3",{style:{margin:0,fontSize:"18px",fontWeight:"bold"},children:["Victory"===t.phase&&"\ud83c\udf89 Victory!","Defeat"===t.phase&&"\ud83d\udc80 Defeat",!c&&"".concat(t.phase," - Round ").concat(t.turn)]}),n&&(0,w.jsxs)("p",{style:{margin:"4px 0 0 0",fontSize:"14px",color:"#ccc"},children:[n.name," - ",n.stats.hp,"/",n.stats.maxHp," HP"]})]}),!c&&(0,w.jsxs)("button",{onClick:a,style:{padding:"8px 16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:["End ","HeroTurn"===t.phase?"Hero Turn":"Turn"]})]}),"HeroTurn"===t.phase&&!c&&(0,w.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 8px 0",fontSize:"16px"},children:"Hero Commands"}),(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:t.commander.abilities.map(e=>(0,w.jsxs)("button",{onClick:()=>r(e.id,"hero-1"),disabled:s(e.id),style:{padding:"8px 12px",backgroundColor:s(e.id)?"#333":"#2196F3",color:s(e.id)?"#666":"white",border:"none",borderRadius:"4px",cursor:s(e.id)?"default":"pointer",textAlign:"left",fontSize:"14px"},title:e.description,children:[(0,w.jsxs)("div",{style:{fontWeight:"bold"},children:[e.name,l(e.id)]}),(0,w.jsxs)("div",{style:{fontSize:"12px",opacity:.8},children:["Range: ",e.range," | ",e.description]})]},e.id))})]}),"UnitsTurn"===t.phase&&n&&"Player"===n.faction&&!c&&(0,w.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 8px 0",fontSize:"16px"},children:"Unit Actions"}),(0,w.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,w.jsx)("button",{onClick:()=>i(n.id),disabled:n.hasActed,style:{padding:"8px 12px",backgroundColor:n.hasActed?"#333":"#FF9800",color:n.hasActed?"#666":"white",border:"none",borderRadius:"4px",cursor:n.hasActed?"default":"pointer",fontSize:"14px"},children:"\ud83d\udee1\ufe0f Defend (+2 DEF)"}),(0,w.jsx)("button",{onClick:()=>o(n.id),disabled:n.hasActed,style:{padding:"8px 12px",backgroundColor:n.hasActed?"#333":"#607D8B",color:n.hasActed?"#666":"white",border:"none",borderRadius:"4px",cursor:n.hasActed?"default":"pointer",fontSize:"14px"},children:"\u23f8\ufe0f Wait"})]}),(0,w.jsxs)("div",{style:{marginTop:"8px",fontSize:"12px",color:"#999",display:"flex",gap:"16px"},children:[(0,w.jsxs)("span",{children:["Move: ",n.stats.move-(n.hasMoved?n.stats.move:0),"/",n.stats.move]}),(0,w.jsxs)("span",{children:["Range: ",n.stats.rng]}),(0,w.jsxs)("span",{children:["Status: ",n.hasActed?"Acted":n.hasMoved?"Moved":"Ready"]})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 8px 0",fontSize:"16px"},children:"Commander Aura"}),(0,w.jsxs)("div",{style:{padding:"8px",backgroundColor:"#2d4a2d",borderRadius:"4px",fontSize:"12px"},children:[(0,w.jsx)("strong",{children:t.commander.aura.name}),(0,w.jsx)("br",{}),Object.entries(t.commander.aura.stats).map(e=>{let[t,n]=e;return(0,w.jsxs)("span",{children:[t.toUpperCase()," +",n," "]},t)})]})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h4",{style:{margin:"0 0 8px 0",fontSize:"16px"},children:"Recent Events"}),(0,w.jsx)("div",{style:{maxHeight:"120px",overflowY:"auto",backgroundColor:"#0a0a0a",border:"1px solid #333",borderRadius:"4px",padding:"8px",fontSize:"12px"},children:0===t.log.length?(0,w.jsx)("em",{style:{color:"#666"},children:"No events yet..."}):(0,w.jsx)("div",{children:t.log.slice(-8).map((e,t)=>(0,w.jsx)("div",{style:{marginBottom:"2px",lineHeight:"1.3"},children:e},t))})})]}),(0,w.jsxs)("div",{style:{marginTop:"12px",fontSize:"11px",color:"#666",borderTop:"1px solid #333",paddingTop:"8px"},children:[(0,w.jsx)("strong",{children:"Tips:"})," Click hexes to move or target. Hero acts from off-field. Mercenaries fight on the battlefield."]})]})}function zr(e){let{state:t,selectedUnit:n,onHexClick:i,onUnitSelect:o,showGrid:s=!0,className:l,style:c}=e;const[d,u]=(0,a.useState)(null),h=(0,a.useCallback)(e=>{const r=t.units.find(t=>t.pos&&t.pos.q===e.q&&t.pos.r===e.r&&!t.isDead);r&&"Player"===r.faction&&"UnitsTurn"===t.phase?o(r):(n&&n.faction,i(e))},[t.units,t.phase,n,i,o]),p=(0,a.useCallback)(()=>{if(!n||!n.pos||n.hasMoved)return[];return[{q:n.pos.q+1,r:n.pos.r},{q:n.pos.q-1,r:n.pos.r},{q:n.pos.q,r:n.pos.r+1},{q:n.pos.q,r:n.pos.r-1},{q:n.pos.q+1,r:n.pos.r-1},{q:n.pos.q-1,r:n.pos.r+1}].filter(e=>{const n=t.grid.tiles.find(t=>t.q===e.q&&t.r===e.r);return n&&n.passable&&!n.occupied})},[n,t.grid.tiles])();return(0,w.jsxs)("div",{className:l,style:(0,r.A)({position:"relative",width:"100%",height:"100%",border:"1px solid #333",borderRadius:"8px",overflow:"hidden",backgroundColor:"#0a0a0a"},c),children:[(0,w.jsx)(Mr,{state:t,onTileClick:h,selectedUnit:null===n||void 0===n?void 0:n.id,showGrid:s}),(0,w.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",display:"flex",alignItems:"flex-start",justifyContent:"flex-start",padding:"12px"},children:(0,w.jsxs)("div",{style:{backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px 12px",borderRadius:"6px",fontSize:"14px",fontWeight:"bold",border:"1px solid #444"},children:["Victory"===t.phase&&"\ud83c\udf89 Victory!","Defeat"===t.phase&&"\ud83d\udc80 Defeat","HeroTurn"===t.phase&&"\ud83c\udf96\ufe0f Hero Turn","UnitsTurn"===t.phase&&"\u2694\ufe0f Units Turn","EnemyTurn"===t.phase&&"\ud83d\udd34 Enemy Turn","Setup"===t.phase&&"\ud83c\udfd7\ufe0f Setup"]})}),n&&(0,w.jsxs)("div",{style:{position:"absolute",bottom:"12px",left:"12px",backgroundColor:"rgba(0, 0, 0, 0.9)",color:"white",padding:"8px 12px",borderRadius:"6px",fontSize:"12px",border:"1px solid #444",pointerEvents:"none"},children:[(0,w.jsx)("div",{style:{fontWeight:"bold"},children:n.name}),(0,w.jsxs)("div",{children:["HP: ",n.stats.hp,"/",n.stats.maxHp]}),(0,w.jsxs)("div",{children:["Move: ",n.hasMoved?0:n.stats.move]}),p.length>0&&(0,w.jsxs)("div",{style:{color:"#4CAF50",fontSize:"11px"},children:[p.length," tiles in range"]})]}),t.initiative.length>0&&(0,w.jsxs)("div",{style:{position:"absolute",top:"12px",right:"12px",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"white",padding:"8px",borderRadius:"6px",fontSize:"11px",border:"1px solid #444",pointerEvents:"none",maxWidth:"150px"},children:[(0,w.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Initiative Order"}),t.initiative.slice(0,5).map((e,n)=>{const r=t.units.find(t=>t.id===e);return r?(0,w.jsxs)("div",{style:{padding:"2px 4px",backgroundColor:0===n?"rgba(76, 175, 80, 0.3)":"transparent",borderRadius:"3px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("span",{children:r.name}),(0,w.jsx)("span",{style:{fontSize:"10px",color:"Player"===r.faction?"#4CAF50":"#F44336"},children:r.stats.spd})]},e):null})]}),(0,w.jsxs)("div",{style:{position:"absolute",bottom:"12px",right:"12px",fontSize:"10px",color:"#666",pointerEvents:"none"},children:["Grid: ",s?"On":"Off"," | Click hexes to interact"]})]})}function Lr(){const{grid:e,friendly:t,enemy:n}=qt({seed:"quick-".concat(Date.now()),biome:"Grass"}),r={id:"battle-".concat(Date.now()),turn:0,phase:"Setup",grid:e,context:{seed:"quick-".concat(Date.now()),biome:"Grass"},commander:{unitId:"hero-1",aura:{name:"Heroic Presence",stats:{atk:2,def:1,spd:1}},abilities:[{id:"rally",name:"Rally",type:"command",apCost:0,range:6,shape:"ally",healing:5,cooldown:3,description:"Heal and inspire nearby allies"},{id:"fireball",name:"Fireball",type:"spell",apCost:0,range:8,shape:"blast1",damage:{amount:8,type:"fire"},aoeRadius:1,cooldown:2,description:"Explosive blast in target area"},{id:"lightning",name:"Lightning Strike",type:"spell",apCost:0,range:10,shape:"single",damage:{amount:6,type:"lightning"},cooldown:1,description:"Precise electrical attack"}],runtime:{cooldowns:{},actionPoints:3}},units:[{id:"p1",name:"Knight",kind:"Mercenary",faction:"Player",race:"Human",archetype:"Warrior",level:2,stats:{hp:18,maxHp:18,atk:6,def:4,mag:0,res:2,spd:3,rng:1,move:3},statuses:[],skills:[],pos:{q:2,r:4},isDead:!1,hasMoved:!1,hasActed:!1},{id:"p2",name:"Ranger",kind:"Mercenary",faction:"Player",race:"Human",archetype:"Archer",level:2,stats:{hp:12,maxHp:12,atk:5,def:2,mag:0,res:1,spd:5,rng:4,move:4},statuses:[],skills:[],pos:{q:1,r:5},isDead:!1,hasMoved:!1,hasActed:!1},{id:"p3",name:"Battle Mage",kind:"Mercenary",faction:"Player",race:"Human",archetype:"Mage",level:2,stats:{hp:10,maxHp:10,atk:2,def:1,mag:6,res:3,spd:4,rng:3,move:3},statuses:[],skills:[],pos:{q:3,r:6},isDead:!1,hasMoved:!1,hasActed:!1},{id:"e1",name:"Orc Warrior",kind:"Monster",faction:"Enemy",race:"Orc",archetype:"Brute",level:2,stats:{hp:16,maxHp:16,atk:5,def:2,mag:0,res:1,spd:3,rng:1,move:3},statuses:[],skills:[],pos:{q:12,r:5},isDead:!1,hasMoved:!1,hasActed:!1},{id:"e2",name:"Orc Archer",kind:"Monster",faction:"Enemy",race:"Orc",archetype:"Archer",level:2,stats:{hp:10,maxHp:10,atk:4,def:1,mag:0,res:0,spd:4,rng:3,move:3},statuses:[],skills:[],pos:{q:13,r:7},isDead:!1,hasMoved:!1,hasActed:!1},{id:"e3",name:"Orc Shaman",kind:"Monster",faction:"Enemy",race:"Orc",archetype:"Shaman",level:3,stats:{hp:12,maxHp:12,atk:2,def:2,mag:5,res:3,spd:3,rng:2,move:3},statuses:[],skills:[],pos:{q:14,r:6},isDead:!1,hasMoved:!1,hasActed:!1}],initiative:[],friendlyDeployment:t,enemyDeployment:n,log:[],turnLimit:void 0};return Kt(r),r}function Ir(){const[e,t]=(0,a.useState)(Lr()),[n,i]=(0,a.useState)(null),[o,s]=(0,a.useState)(null),l=(0,a.useCallback)(a=>{if(o&&"HeroTurn"===e.phase){return void($t(e,"hero-1",o,a)&&(s(null),nn(e),t((0,r.A)({},e))))}if(n&&"Player"===n.faction&&"UnitsTurn"===e.phase){if(!n.hasMoved&&n.pos){if(Vt(n.pos,a)<=n.stats.move){const i=Jt(e.grid,n.pos,a,n.stats.move);if(i&&i.length>1){const i=e.grid.tiles.find(e=>e.q===n.pos.q&&e.r===n.pos.r);i&&(i.occupied=void 0),n.pos=a,n.hasMoved=!0;const o=e.grid.tiles.find(e=>e.q===a.q&&e.r===a.r);o&&(o.occupied=n.id),e.log.push("".concat(n.name," moves to (").concat(a.q,", ").concat(a.r,")")),t((0,r.A)({},e))}}}const i=e.units.find(e=>e.pos&&e.pos.q===a.q&&e.pos.r===a.r&&e.faction!==n.faction&&!e.isDead);if(i&&!n.hasActed&&n.pos){if(Vt(n.pos,i.pos)<=n.stats.rng){const a=Math.max(1,n.stats.atk-i.stats.def);if(i.stats.hp=Math.max(0,i.stats.hp-a),0===i.stats.hp){i.isDead=!0;const t=e.grid.tiles.find(e=>e.q===i.pos.q&&e.r===i.pos.r);t&&(t.occupied=void 0)}n.hasActed=!0,e.log.push("".concat(n.name," attacks ").concat(i.name," for ").concat(a," damage!")),nn(e),t((0,r.A)({},e))}}}},[e,n,o]),c=(0,a.useCallback)(e=>{i(e),s(null)},[]),d=(0,a.useCallback)((n,a)=>{"hero-1"===a&&(s(n),e.log.push("Select target for ".concat(n)),t((0,r.A)({},e)))},[e]),u=(0,a.useCallback)(()=>{"UnitsTurn"===e.phase&&e.units.forEach(e=>{"Player"===e.faction&&(e.hasMoved=!1,e.hasActed=!1)}),Xt(e),i(null),s(null),t((0,r.A)({},e))},[e]),h=(0,a.useCallback)(n=>{const a=e.units.find(e=>e.id===n);a&&!a.hasActed&&(a.hasActed=!0,e.log.push("".concat(a.name," takes a defensive stance (+2 DEF until next turn)")),t((0,r.A)({},e)))},[e]),p=(0,a.useCallback)(n=>{const a=e.units.find(e=>e.id===n);a&&!a.hasActed&&(a.hasActed=!0,a.hasMoved=!0,e.log.push("".concat(a.name," waits...")),t((0,r.A)({},e)))},[e]),m=(0,a.useCallback)(()=>{t(Lr()),i(null),s(null)},[]);return(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 320px",gap:"16px",padding:"16px",height:"100vh",maxHeight:"100vh",overflow:"hidden",backgroundColor:"#121212",fontFamily:"system-ui, sans-serif"},children:[(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"12px",minHeight:0},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#1a1a1a",borderRadius:"8px",border:"1px solid #333"},children:[(0,w.jsx)("h1",{style:{margin:0,color:"#ffffff",fontSize:"24px"},children:"Tactical Battle System"}),(0,w.jsx)("div",{style:{display:"flex",gap:"8px"},children:(0,w.jsx)("button",{onClick:m,style:{padding:"8px 16px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"\ud83d\udd04 New Battle"})})]}),(0,w.jsx)("div",{style:{flex:1,minHeight:0},children:(0,w.jsx)(zr,{state:e,selectedUnit:n,onHexClick:l,onUnitSelect:c,showGrid:!0,style:{height:"100%"}})}),o&&(0,w.jsxs)("div",{style:{padding:"12px",backgroundColor:"#1a1a1a",borderRadius:"8px",border:"1px solid #FFC107",color:"#ffffff",textAlign:"center"},children:["\ud83c\udfaf ",(0,w.jsx)("strong",{children:"Targeting Mode:"})," Click a hex to use ",(0,w.jsx)("em",{children:o})]})]}),(0,w.jsx)("div",{style:{minHeight:0,overflowY:"auto"},children:(0,w.jsx)(Br,{state:e,selectedUnit:n,onAbilityUse:d,onEndTurn:u,onDefend:h,onWait:p})})]})}function qr(e){const t=e.q,n=e.r;return{x:t,y:-t-n,z:n}}function Dr(e,t){const n=qr(e),r=qr(t);return Math.max(Math.abs(n.x-r.x),Math.abs(n.y-r.y),Math.abs(n.z-r.z))}function Or(e){return"".concat(e.q,",").concat(e.r)}class Wr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{qMin:-8,qMax:8,rMin:-8,rMax:8};this.state=void 0,this.size=24;const n={};for(const o of e){var a;n[o.id]=(0,r.A)((0,r.A)({},o),{},{alive:null===(a=o.alive)||void 0===a||a})}const i=this.buildInitiativeOrder(Object.values(n));console.log("\ud83c\udfaf Initial initiative order: ".concat(i.map(e=>{const t=n[e];return"".concat(t.name,"(SPD:").concat(t.spd,")")}).join(" \u2192 "))),this.state={units:n,order:i,turnIndex:0,round:1,selectedUnitId:i[0],phase:"awaitAction",reachable:new Set,pathPreview:{},worldBounds:t}}buildInitiativeOrder(e){return e.filter(e=>e.alive).sort((e,t)=>t.spd-e.spd||e.name.localeCompare(t.name)).map(e=>e.id)}get current(){return this.state.units[this.state.selectedUnitId]}advanceToNextLiving(){var e;const t=this.state;let n=0;const r=2*t.order.length;do{var a;if(t.turnIndex=(t.turnIndex+1)%t.order.length,t.selectedUnitId=t.order[t.turnIndex],n++,n>=r){console.log("\u26a0\ufe0f Turn advancement stuck, rebuilding initiative order"),t.order=this.buildInitiativeOrder(Object.values(t.units)),t.turnIndex=0,t.selectedUnitId=t.order[0];break}}while((null===(a=this.state.units[t.selectedUnitId])||void 0===a||!a.alive)&&t.order.length>0);null!==(e=this.state.units[t.selectedUnitId])&&void 0!==e&&e.alive||console.log("\u274c No living units found! Current order:",t.order)}endTurn(){console.log("\ud83d\udd04 ".concat(this.current.name," ending turn..."));const e=this.state.turnIndex;if(this.advanceToNextLiving(),this.state.turnIndex<=e||0===this.state.turnIndex){this.state.round++,console.log("\ud83d\udd04 New round ".concat(this.state.round,": rebuilding initiative order"));const e=this.buildInitiativeOrder(Object.values(this.state.units));if(0===e.length)return void console.log("\ud83c\udfc1 No living units, battle should end");this.state.order=e,this.state.turnIndex=0,this.state.selectedUnitId=this.state.order[0]}const t=this.current;t?(console.log("\u27a1\ufe0f Next turn: ".concat(t.name," (").concat(t.team,") - Turn ").concat(this.state.turnIndex+1,"/").concat(this.state.order.length)),t.defended=!1,this.state.phase="awaitAction",this.state.reachable.clear(),this.state.pathPreview={}):console.log("\u274c No current unit found!")}wait(){const e=this.state,t=e.selectedUnitId;e.order=e.order.filter(e=>e!==t),e.order.push(t),e.turnIndex=e.order.indexOf(t),this.endTurn()}defend(){this.current.defended=!0,this.endTurn()}beginMove(){const e=this.current,t=new Set(Object.values(this.state.units).filter(t=>t.alive&&t.id!==e.id).map(e=>Or({q:e.q,r:e.r}))),n=function(e,t){const n=[];for(let r=-t;r<=t;r++){const a=Math.max(-t,-r-t),i=Math.min(t,-r+t);for(let t=a;t<=i;t++){const a={q:e.q+r,r:e.r+t};n.push(a)}}return n}({q:e.q,r:e.r},e.move),r=new Set,a={};for(const i of n){const n=this.state.worldBounds;if(i.q<n.qMin||i.q>n.qMax||i.r<n.rMin||i.r>n.rMax)continue;if(t.has(Or(i)))continue;const o=Or(i);r.add(o),a[o]=[{q:e.q,r:e.r},i]}this.state.phase="moveSelect",this.state.reachable=r,this.state.pathPreview=a}moveTo(e){if("moveSelect"!==this.state.phase)return!1;const t=Or(e);return!!this.state.reachable.has(t)&&(this.current.q=e.q,this.current.r=e.r,this.state.phase="awaitAction",this.state.reachable.clear(),this.state.pathPreview={},!0)}canMelee(e){const t=this.current,n=this.state.units[e];return!(!n||!n.alive||t.team===n.team)&&1===Dr({q:t.q,r:t.r},{q:n.q,r:n.r})}fight(e){if(!this.canMelee(e))return!1;const t=this.current,n=this.state.units[e],r=t.atk,a=n.def+(n.defended?2:0),i=Math.max(1,r-a);return n.hp-=i,n.hp<=0&&(n.hp=0,n.alive=!1),this.endTurn(),!0}unitAt(e,t){return Object.values(this.state.units).find(n=>n.alive&&n.q===e&&n.r===t)}doEnemyTurn(){const e=this.current;if(console.log("\ud83e\udd16 doEnemyTurn called for ".concat(e.name," (").concat(e.team,")")),"enemy"!==e.team)return void console.log("\u274c Not an enemy unit, skipping AI");const t=Object.values(this.state.units).filter(e=>e.alive&&"player"===e.team);if(console.log("\ud83c\udfaf Found ".concat(t.length," living players")),0===t.length)return console.log("\ud83c\udfc6 No players left, ending turn"),void this.endTurn();for(const i of t)if(this.canMelee(i.id))return console.log("\u2694\ufe0f ".concat(e.name," attacking ").concat(i.name,"!")),void this.fight(i.id);console.log("\ud83d\udeb6 No adjacent targets, moving toward nearest player");const n=t.reduce((t,n)=>Dr({q:e.q,r:e.r},{q:n.q,r:n.r})<Dr({q:e.q,r:e.r},{q:t.q,r:t.r})?n:t);console.log("\ud83c\udfaf Target: ".concat(n.name," at (").concat(n.q,", ").concat(n.r,")")),this.beginMove();let r=null,a=1/0;console.log("\ud83d\udccd Checking ".concat(this.state.reachable.size," reachable hexes"));for(const i of Array.from(this.state.reachable)){const[e,t]=i.split(",").map(Number),o={q:e,r:t},s=Dr(o,{q:n.q,r:n.r});s<a&&(a=s,r=o)}r?(console.log("\u2705 Moving to (".concat(r.q,", ").concat(r.r,"), distance: ").concat(a)),this.moveTo(r),this.endTurn()):(console.log("\u274c No valid move found, ending turn"),this.state.phase="awaitAction",this.state.reachable.clear(),this.state.pathPreview={},this.endTurn())}get isCurrentUnitEnemy(){return"enemy"===this.current.team}}function Hr(e){let{engine:t,onAction:n}=e;const a=t.state,i=t.current,o="player"===i.team,s=e=>{var t;return(0,w.jsx)("button",(0,r.A)((0,r.A)({},e),{},{className:"px-3 py-1 rounded bg-slate-800 text-white hover:bg-slate-700 disabled:opacity-50 "+(null!==(t=e.className)&&void 0!==t?t:""),style:(0,r.A)({padding:"8px 12px",borderRadius:"4px",backgroundColor:e.disabled?"#333":"#1a1a1a",color:e.disabled?"#666":"#fff",border:"1px solid #444",cursor:e.disabled?"default":"pointer",fontSize:"14px"},e.style)}))};return(0,w.jsxs)("div",{style:{position:"fixed",left:"50%",bottom:12,transform:"translateX(-50%)",background:"rgba(0,0,0,0.85)",color:"#fff",borderRadius:12,padding:"12px 16px",display:"flex",gap:12,alignItems:"center",pointerEvents:"auto",boxShadow:"0 8px 20px rgba(0,0,0,0.4)",border:"1px solid #444"},children:[(0,w.jsxs)("div",{style:{marginRight:8},children:[(0,w.jsxs)("div",{style:{fontWeight:700,fontSize:"16px"},children:[i.name," (",i.team,")"]}),(0,w.jsxs)("div",{style:{fontSize:12,opacity:.8},children:["HP ",i.hp,"/",i.maxHp," \u2022 Move ",i.move," \u2022 Round ",a.round]}),(0,w.jsxs)("div",{style:{fontSize:11,opacity:.6},children:["Phase: ",a.phase," | ATK ",i.atk," | DEF ",i.def]})]}),(0,w.jsx)(s,{onClick:()=>n("Move"),disabled:!o||"moveSelect"===a.phase,children:"moveSelect"===a.phase?"\ud83c\udfaf Click Hex":"\ud83d\udeb6 Move"}),(0,w.jsx)(s,{onClick:()=>n("Fight"),disabled:!o,children:"\ud83d\udde1\ufe0f Fight"}),(0,w.jsx)(s,{onClick:()=>n("Spells"),disabled:!o,children:"\u2728 Spells"}),(0,w.jsx)(s,{onClick:()=>n("Defend"),disabled:!o,children:"\ud83d\udee1\ufe0f Defend"}),(0,w.jsx)(s,{onClick:()=>n("Wait"),disabled:!o,children:"\u23f8\ufe0f Wait"}),(0,w.jsx)(s,{onClick:()=>n("EndTurn"),disabled:!o,style:{backgroundColor:o?"#4CAF50":"#333"},children:"\u23ed\ufe0f End Turn"})]})}function Fr(e,t){const n=Math.sqrt(3);return{x:t*(n*e.q+n/2*e.r),y:t*(1.5*e.r)}}function Gr(e){let{engine:t,onMove:n}=e;const r=(0,a.useRef)(null),i=(0,a.useRef)(),o=(0,a.useRef)({x:0,y:0,scale:1}),[,s]=(0,a.useState)(0),l=(0,a.useCallback)(()=>{s(e=>e+1)},[]);return(0,a.useEffect)(()=>{const e=r.current,a=e.getContext("2d"),s=()=>{const t=Math.max(1,window.devicePixelRatio||1),n=Math.floor(e.clientWidth*t),r=Math.floor(e.clientHeight*t);e.width===n&&e.height===r||(e.width=n,e.height=r),a.setTransform(t,0,0,t,0,0)},c=new ResizeObserver(s);c.observe(e),s();let d=!1,u=0,h=0;const p=t=>{t.preventDefault(),d=!0,u=t.clientX,h=t.clientY,e.setPointerCapture(t.pointerId)},m=e=>{d&&(o.current.x+=e.clientX-u,o.current.y+=e.clientY-h,u=e.clientX,h=e.clientY)},f=()=>{d=!1},g=e=>{e.preventDefault();const t=Math.exp(.001*-e.deltaY),{x:n,y:r,scale:a}=o.current,i=(e.clientX-n)/a,s=(e.clientY-r)/a;o.current.scale*=t,o.current.x=e.clientX-i*o.current.scale,o.current.y=e.clientY-s*o.current.scale},y=e=>{const r=o.current,a=function(e,t,n){const r=(e*Math.sqrt(3)/3-t/3)/n,a=2/3*t/n,i=-r-a;let o=Math.round(r),s=Math.round(i),l=Math.round(a);const c=Math.abs(o-r),d=Math.abs(s-i),u=Math.abs(l-a);return c>d&&c>u?o=-s-l:d>u?s=-o-l:l=-o-s,{q:o,r:l}}((e.clientX-r.x)/r.scale,(e.clientY-r.y)/r.scale,t.size);if("moveSelect"===t.state.phase){t.moveTo(a)&&n&&(n(),l())}};e.addEventListener("pointerdown",p),window.addEventListener("pointerup",f),e.addEventListener("pointermove",m),e.addEventListener("wheel",g,{passive:!1}),e.addEventListener("click",y),e.addEventListener("contextmenu",e=>e.preventDefault());const x=function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#4a4a4a",i=arguments.length>3?arguments[3]:void 0;const o=t.size,{x:s,y:l}=Fr({q:e,r:n},o),c=Math.PI/6,d=new Path2D;for(let t=0;t<6;t++){const e=c+t*Math.PI/3,n=s+o*Math.cos(e),r=l+o*Math.sin(e);0===t?d.moveTo(n,r):d.lineTo(n,r)}d.closePath(),i&&(a.fillStyle=i,a.fill(d)),a.strokeStyle=r,a.lineWidth=1,a.stroke(d)},v=()=>{a.save(),a.clearRect(0,0,e.clientWidth,e.clientHeight),a.translate(o.current.x,o.current.y),a.scale(o.current.scale,o.current.scale);const n=t.state.worldBounds;for(let e=n.rMin;e<=n.rMax;e++)for(let r=n.qMin;r<=n.qMax;r++){const n=Or({q:r,r:e}),a="moveSelect"===t.state.phase&&t.state.reachable.has(n)?"rgba(130,200,255,0.35)":void 0;x(r,e,"#404040",a)}for(const e of Object.values(t.state.units)){if(!e.alive)continue;const{x:n,y:r}=Fr({q:e.q,r:e.r},t.size),i=e.id===t.state.selectedUnitId;a.fillStyle=i?"#ffffff":"player"===e.team?"#4CAF50":"#F44336",a.beginPath(),a.arc(n,r,.6*t.size,0,2*Math.PI),a.fill(),a.strokeStyle=i?"#FFD700":"#000",a.lineWidth=i?3:1,a.stroke(),a.fillStyle="#000",a.font="12px sans-serif",a.textAlign="center",a.fillText(e.name,n,r+4),e.defended&&(a.fillStyle="#FFD700",a.fillRect(n-8,r-t.size,16,4));const o=32,s=4,l=r+.75*t.size;a.fillStyle="#333",a.fillRect(n-o/2,l,o,s);const c=e.hp/e.maxHp;a.fillStyle=c>.6?"#4CAF50":c>.3?"#FF9800":"#F44336",a.fillRect(n-o/2,l,o*c,s),a.fillStyle="#fff",a.font="10px sans-serif",a.fillText("".concat(e.hp,"/").concat(e.maxHp),n,l+14)}a.restore(),i.current=requestAnimationFrame(v)};return i.current=requestAnimationFrame(v),()=>{cancelAnimationFrame(i.current),c.disconnect(),e.removeEventListener("pointerdown",p),window.removeEventListener("pointerup",f),e.removeEventListener("pointermove",m),e.removeEventListener("wheel",g),e.removeEventListener("click",y)}},[t,n,l]),(0,w.jsxs)("div",{style:{position:"fixed",inset:0,overscrollBehavior:"none"},children:[(0,w.jsx)("canvas",{ref:r,style:{width:"100%",height:"100%",display:"block",touchAction:"none",cursor:"grab"},onMouseDown:e=>e.currentTarget.style.cursor="grabbing",onMouseUp:e=>e.currentTarget.style.cursor="grab"}),(0,w.jsxs)("div",{style:{position:"absolute",top:"16px",left:"16px",backgroundColor:"rgba(0,0,0,0.8)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"14px",fontWeight:"bold",border:"1px solid #444",pointerEvents:"none"},children:["Phase: ",t.state.phase," | Round: ",t.state.round]}),(0,w.jsx)("div",{style:{position:"absolute",top:"16px",right:"16px",backgroundColor:"rgba(0,0,0,0.8)",color:"#fff",padding:"8px 12px",borderRadius:"8px",fontSize:"12px",border:"1px solid #444",pointerEvents:"none",maxWidth:"200px"},children:"moveSelect"===t.state.phase?"\ud83c\udfaf Click a blue hex to move":"Use HUD buttons to take actions"})]})}function Ur(){const[e]=(0,a.useState)(()=>new Wr([{id:"p1",name:"Dale",team:"player",q:0,r:0,move:4,hp:10,maxHp:10,atk:4,def:1,spd:5},{id:"p2",name:"Kaelen",team:"player",q:1,r:1,move:3,hp:10,maxHp:10,atk:3,def:2,spd:4},{id:"e1",name:"Bandit",team:"enemy",q:3,r:0,move:3,hp:8,maxHp:8,atk:3,def:1,spd:6},{id:"e2",name:"Raider",team:"enemy",q:2,r:-1,move:3,hp:8,maxHp:8,atk:2,def:2,spd:3}])),[,t]=(0,a.useState)(0),n=()=>{t(e=>e+1)};(0,a.useEffect)(()=>{if(console.log("\ud83c\udfb2 Turn check: ".concat(e.current.name," (").concat(e.current.team,"), phase: ").concat(e.state.phase,", isEnemy: ").concat(e.isCurrentUnitEnemy)),e.isCurrentUnitEnemy&&"awaitAction"===e.state.phase){console.log("\ud83e\udd16 Enemy ".concat(e.current.name," taking turn..."));const t=setTimeout(()=>{e.doEnemyTurn(),n()},800);return()=>clearTimeout(t)}},[e.current.id,e.state.phase,e.state.turnIndex]);return(0,w.jsxs)("div",{style:{display:"flex",flexDirection:"column",height:"100vh",backgroundColor:"#121212",fontFamily:"system-ui, sans-serif"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"#1a1a1a",borderBottom:"1px solid #333",color:"#ffffff"},children:[(0,w.jsx)("h1",{style:{margin:0,fontSize:"24px"},children:"Minimal Tactical Battle"}),(0,w.jsx)("div",{style:{display:"flex",gap:"8px"},children:(0,w.jsx)("button",{onClick:()=>{e.state=new Wr([{id:"p1",name:"Dale",team:"player",q:0,r:0,move:4,hp:10,maxHp:10,atk:4,def:1,spd:5},{id:"p2",name:"Kaelen",team:"player",q:1,r:1,move:3,hp:10,maxHp:10,atk:3,def:2,spd:4},{id:"e1",name:"Bandit",team:"enemy",q:3,r:0,move:3,hp:8,maxHp:8,atk:3,def:1,spd:6},{id:"e2",name:"Raider",team:"enemy",q:2,r:-1,move:3,hp:8,maxHp:8,atk:2,def:2,spd:3}]).state,n()},style:{padding:"8px 16px",backgroundColor:"#2196F3",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px"},children:"\ud83d\udd04 Reset Battle"})})]}),(0,w.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,w.jsx)(Gr,{engine:e,onMove:n}),(0,w.jsx)(Hr,{engine:e,onAction:t=>{switch(t){case"Move":e.beginMove();break;case"Fight":{const t=e.current,n=Object.values(e.state.units).filter(e=>e.alive&&e.team!==t.team);for(const r of n)if(e.canMelee(r.id)){e.fight(r.id);break}break}case"Spells":case"EndTurn":e.endTurn();break;case"Defend":e.defend();break;case"Wait":e.wait()}n()}})]}),(0,w.jsxs)("div",{style:{padding:"8px 16px",backgroundColor:"#1a1a1a",borderTop:"1px solid #333",color:"#ffffff",fontSize:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:["Phase: ",e.state.phase," | Current: ",e.current.name," (",e.current.team,") | Round: ",e.state.round]}),(0,w.jsxs)("div",{children:["HP: ",e.current.hp,"/",e.current.maxHp," | Move: ",e.current.move," | ATK: ",e.current.atk," | DEF: ",e.current.def]})]})]})}function Vr(e){let{onBack:t}=e;const[n,o]=(0,a.useState)([]),[s,l]=(0,a.useState)([]),[c,d]=(0,a.useState)([]);a.useEffect(()=>{try{const e=JSON.parse(u.local.getItem("world-engine-characters")||"[]"),t=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]");console.log("Raw saved characters:",e);const n=[{name:"Elara the Cleric",class:"Cleric",baseStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},finalStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},hitPoints:32,level:3,knownSpells:["Cure Light Wounds","Healing Word","Prayer of Healing"]},{name:"Thorin Ironbeard",class:"Fighter",baseStats:{strength:16,constitution:15,wisdom:11,intelligence:9,dexterity:12,charisma:10},finalStats:{strength:16,constitution:15,wisdom:11,intelligence:9,dexterity:12,charisma:10},hitPoints:18,level:2},{name:"Luna Shadowstep",class:"Rogue",baseStats:{strength:10,constitution:12,wisdom:14,intelligence:13,dexterity:17,charisma:11},finalStats:{strength:10,constitution:12,wisdom:14,intelligence:13,dexterity:17,charisma:11},hitPoints:22,level:2}],r=[...n];e.forEach(e=>{if(e.characterClass&&e.name&&!r.find(t=>t.name===e.name)){var t;const n=e.data||e,a=n.constitution||(null===(t=n.baseStats)||void 0===t?void 0:t.constitution)||14,i=e.level||n.level||1,o=10+Math.floor((a-10)/2)*i,s=Math.max(o+6*i,20),l={name:e.name,class:e.characterClass,baseStats:{strength:n.strength||10,constitution:a,wisdom:n.wisdom||12,intelligence:n.intelligence||11,dexterity:n.dexterity||13,charisma:n.charisma||10},finalStats:{strength:n.strength||10,constitution:a,wisdom:n.wisdom||12,intelligence:n.intelligence||11,dexterity:n.dexterity||13,charisma:n.charisma||10},hitPoints:s,level:i,knownSpells:n.knownSpells||[],knownCantrips:n.knownCantrips||[]};r.push(l)}}),o(r),h("Loaded ".concat(r.length," characters for healing system (").concat(n.length," test + ").concat(r.length-n.length," saved)"));const a=r.filter(e=>!n.find(t=>t.name===e.name));a.length>0&&h("Custom characters loaded: ".concat(a.map(e=>"".concat(e.name," (").concat(e.hitPoints," HP)")).join(", "))),l(t)}catch(e){console.error("Error loading data:",e);o([{name:"Elara the Cleric",class:"Cleric",baseStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},finalStats:{strength:12,constitution:14,wisdom:16,intelligence:10,dexterity:13,charisma:15},hitPoints:32,level:3,knownSpells:["Cure Light Wounds","Healing Word","Prayer of Healing"]}]),h("Loaded fallback test characters")}},[]);const h=e=>{d(t=>[...t,e])},p=e=>Math.floor(i.Sh.next()*e)+1,m=e=>Math.floor((e-10)/2),f=e=>e<=0?"#991b1b":e<=25?"#dc2626":e<=50?"#f59e0b":e<=75?"#eab308":"#10b981",g=s.filter(e=>e.description.toLowerCase().includes("heal")||e.description.toLowerCase().includes("restore"));return(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",color:"#e2e8f0",padding:"2rem"},children:[(0,w.jsxs)("div",{style:{padding:"1.5rem 2rem",borderBottom:"1px solid #334155",background:"rgba(15, 23, 42, 0.8)",display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:"8px",marginBottom:"2rem"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h1",{style:{margin:0,fontSize:"2.5rem",fontWeight:"bold"},children:"\u2695\ufe0f Healing & Recovery System"}),(0,w.jsx)("p",{style:{margin:"0.5rem 0 0",opacity:.8},children:"Manage your party's health and use healing magic"})]}),t&&(0,w.jsx)("button",{onClick:t,style:{padding:"0.75rem 1.5rem",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"1rem"},children:"Back to Menu"})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem"},children:[(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1.5rem",border:"1px solid #334155"},children:[(0,w.jsx)("h2",{style:{margin:"0 0 1.5rem",color:"#f1f5f9"},children:"\ud83d\udc65 Party Health Status"}),0===n.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b",fontStyle:"italic"},children:"No characters found. Create some characters first!"}):(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:n.map((e,t)=>{return(0,w.jsxs)("div",{style:{padding:"1rem",background:"rgba(15, 23, 42, 0.8)",border:"2px solid ".concat(f(e.hitPoints)),borderRadius:"6px"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{style:{margin:"0 0 0.25rem",color:"#f1f5f9"},children:e.name}),(0,w.jsxs)("p",{style:{margin:0,color:"#94a3b8",fontSize:"0.9rem"},children:[e.class," \u2022 Level ",e.level]})]}),(0,w.jsxs)("div",{style:{textAlign:"right"},children:[(0,w.jsxs)("div",{style:{fontSize:"1.2rem",fontWeight:"bold",color:f(e.hitPoints)},children:[e.hitPoints,"/100 HP"]}),(0,w.jsx)("div",{style:{fontSize:"0.8rem",color:f(e.hitPoints)},children:(n=e.hitPoints,n<=0?"Unconscious":n<=25?"Critical":n<=50?"Injured":n<=75?"Wounded":"Healthy")})]})]}),(0,w.jsx)("div",{style:{marginTop:"0.75rem",width:"100%",height:"8px",background:"#374151",borderRadius:"4px",overflow:"hidden"},children:(0,w.jsx)("div",{style:{width:"".concat(e.hitPoints,"%"),height:"100%",background:f(e.hitPoints),transition:"width 0.3s ease"}})}),(0,w.jsxs)("div",{style:{marginTop:"1rem",display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[(0,w.jsx)("button",{onClick:()=>(e=>{const t=m(e.finalStats.constitution),n=Math.max(1,p(4)+t),a=e.hitPoints,i=Math.min(e.hitPoints+n,100);o(t=>t.map(t=>t.name===e.name?(0,r.A)((0,r.A)({},t),{},{hitPoints:i}):t));const s=i-a;h("\ud83d\udee1\ufe0f ".concat(e.name," takes a rest and recovers naturally")),h("\ud83d\udc9a Natural healing: ".concat(s," HP (").concat(a," \u2192 ").concat(i,")"))})(e),style:{padding:"0.5rem 1rem",background:"#059669",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:"\ud83d\udecf\ufe0f Natural Rest"}),(0,w.jsx)("button",{onClick:()=>(e=>{if(isNaN(e.hitPoints)||void 0===e.hitPoints)return void h("\u274c Error: ".concat(e.name," has invalid HP data. Cannot simulate injury."));const t=p(20)+p(6),n=e.hitPoints,a=Math.max(0,e.hitPoints-t);o(t=>t.map(t=>t.name===e.name?(0,r.A)((0,r.A)({},t),{},{hitPoints:a}):t)),h("\ud83d\udca5 ".concat(e.name," suffers an injury: ").concat(t," damage (").concat(n," \u2192 ").concat(a,")")),0===a&&h("\ud83d\udc80 ".concat(e.name," is unconscious and needs immediate healing!"))})(e),style:{padding:"0.5rem 1rem",background:"#dc2626",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:"\ud83d\udca5 Simulate Injury"})]})]},t);var n})})]}),(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1.5rem",border:"1px solid #334155"},children:[(0,w.jsx)("h2",{style:{margin:"0 0 1.5rem",color:"#f1f5f9"},children:"\u2728 Healing Magic"}),0===g.length?(0,w.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#64748b",fontStyle:"italic"},children:"No healing spells found. Generate some healing spells in the Spell Generator!"}):(0,w.jsxs)("div",{children:[(0,w.jsxs)("p",{style:{color:"#94a3b8",marginBottom:"1rem"},children:["Available healing spells: ",g.length]}),(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:g.map((e,t)=>(0,w.jsxs)("div",{style:{padding:"1rem",background:"rgba(15, 23, 42, 0.8)",border:"2px solid ".concat(e.color),borderRadius:"6px"},children:[(0,w.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.25rem",color:e.color},children:e.name}),(0,w.jsxs)("p",{style:{margin:0,fontSize:"0.8rem",color:"#94a3b8"},children:[0===e.level?"Cantrip":"Level ".concat(e.level)," \u2022 ",e.school]}),(0,w.jsx)("p",{style:{margin:"0.5rem 0",fontSize:"0.9rem",color:"#cbd5e1"},children:e.description})]}),(0,w.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,w.jsx)("label",{style:{fontSize:"0.9rem",color:"#94a3b8",marginBottom:"0.5rem",display:"block"},children:"Choose caster:"}),(0,w.jsxs)("select",{style:{width:"100%",padding:"0.5rem",background:"#374151",border:"1px solid #6b7280",borderRadius:"4px",color:"#f9fafb"},children:[(0,w.jsx)("option",{value:"",children:"Select a character..."}),n.map((e,t)=>(0,w.jsxs)("option",{value:t,children:[e.name," (Level ",e.level," ",e.class,")"]},t))]})]}),(0,w.jsxs)("div",{style:{marginBottom:"0.75rem"},children:[(0,w.jsx)("label",{style:{fontSize:"0.9rem",color:"#94a3b8",marginBottom:"0.5rem",display:"block"},children:"Choose target:"}),(0,w.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem"},children:n.map((t,a)=>(0,w.jsxs)("button",{onClick:()=>{const a=document.querySelector("select"),i=parseInt((null===a||void 0===a?void 0:a.value)||"0");null!==a&&void 0!==a&&a.value&&n[i]?((e,t,n)=>{const a=t.description.toLowerCase();if(!a.includes("heal")&&!a.includes("restore"))return void h("\u274c ".concat(t.name," is not a healing spell!"));let i=0;const s=m(e.finalStats.wisdom);i=0===t.level?p(4)+s:p(8)*t.level+s,i=Math.max(1,i);const l=n.hitPoints,c=Math.min(n.hitPoints+i,100);o(e=>e.map(e=>e.name===n.name?(0,r.A)((0,r.A)({},e),{},{hitPoints:c}):e));const d=c-l;h("\u2728 ".concat(e.name," casts ").concat(t.name," on ").concat(n.name)),h("\ud83d\udc9a ".concat(n.name," heals ").concat(d," HP (").concat(l," \u2192 ").concat(c,")")),0===d&&h("".concat(n.name," is already at full health!"))})(n[i],e,t):h("\u274c Please select a caster first!")},style:{padding:"0.5rem 0.75rem",background:t.hitPoints<100?"#3b82f6":"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:t.hitPoints<100?"pointer":"not-allowed",fontSize:"0.8rem"},disabled:t.hitPoints>=100,children:[t.name," (",t.hitPoints,"/100)"]},a))})]})]},t))})]})]})]}),(0,w.jsxs)("div",{style:{marginTop:"2rem",padding:"1.5rem",background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",border:"1px solid #334155"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 1rem",color:"#f1f5f9"},children:"\ud83d\udcdc Healing Log"}),(0,w.jsx)("div",{style:{background:"rgba(0, 0, 0, 0.3)",borderRadius:"4px",padding:"1rem",maxHeight:"200px",overflowY:"auto",fontSize:"0.9rem"},children:0===c.length?(0,w.jsx)("p",{style:{color:"#64748b",fontStyle:"italic"},children:"No healing actions yet..."}):c.slice(-10).map((e,t)=>(0,w.jsx)("div",{style:{marginBottom:"0.5rem",color:"#d1d5db"},children:e},t))}),(0,w.jsx)("button",{onClick:()=>d([]),style:{marginTop:"1rem",padding:"0.5rem 1rem",background:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"0.9rem"},children:"Clear Log"})]})]})}function Yr(e){let{playerCharacters:t,encounter:n,onBattleEnd:o,onBack:s}=e;const[l,c]=(0,a.useState)("setup"),[d,h]=(0,a.useState)(0),[p,m]=(0,a.useState)(1),[f,g]=(0,a.useState)([]),[y,x]=(0,a.useState)([]),[v,b]=(0,a.useState)(null),[k,S]=(0,a.useState)(null),[j,C]=(0,a.useState)([]),[M,T]=(0,a.useState)([]);(0,a.useEffect)(()=>{try{const e=JSON.parse(u.local.getItem("world-engine-saved-spells")||"[]");T(e)}catch(e){console.error("Error loading saved spells:",e)}},[]),(0,a.useEffect)(()=>{const e=[...t.map((e,t)=>({id:"player-".concat(t),name:e.name,type:"player",character:e,currentHP:e.hitPoints,maxHP:e.hitPoints,armorClass:10+A(e.finalStats.dexterity),initiative:E(e.finalStats.dexterity),statusEffects:[]})),...n.enemies.map((e,t)=>({id:"enemy-".concat(t),name:e.name,type:"enemy",enemy:e,currentHP:e.hitPoints,maxHP:e.hitPoints,armorClass:e.armorClass,initiative:E(12),statusEffects:[]}))],r=e.sort((e,t)=>t.initiative-e.initiative),a=r.map(e=>e.id);g(e),x(a),c("active"),R("\u2694\ufe0f Battle begins! ".concat(n.name)),R("Terrain: ".concat(n.terrain)),R("Initiative order: "+r.map(e=>"".concat(e.name," (").concat(e.initiative,")")).join(", "))},[t,n]);const A=e=>Math.floor((e-10)/2),E=e=>Math.floor(20*i.Sh.next())+1+A(e),P=e=>{const t=e.match(/(\d+)d(\d+)(?:\+(\d+))?/);if(!t)return 1;const n=parseInt(t[1]),r=parseInt(t[2]);let a=parseInt(t[3]||"0");for(let o=0;o<n;o++)a+=Math.floor(i.Sh.next()*r)+1;return a},R=e=>{C(t=>[...t,e])},_=()=>{if(0===y.length)return null;const e=y[d];return f.find(t=>t.id===e)||null},N=e=>{const t=e.description.toLowerCase();if("self"===e.range.toLowerCase())return"self";if(t.includes("heal")||t.includes("restore")||t.includes("protect"))return"ally";if(t.includes("damage")||t.includes("attack")||t.includes("harm"))return"enemy";const n=e.school.toLowerCase();return["evocation","necromancy","enchantment"].includes(n)?"enemy":["abjuration","divination"].includes(n)?"ally":"enemy"},B=(e,t)=>{switch(t.target){case"self":return[e];case"ally":case"all-allies":return f.filter(t=>t.type===e.type&&t.currentHP>0);case"enemy":case"all-enemies":return f.filter(t=>t.type!==e.type&&t.currentHP>0);default:return[]}},z=(e,t,n)=>{switch(t.type){case"attack":L(e,n[0]);break;case"cast-cantrip":case"cast-spell":I(e,t,n);break;case"defend":D(e);break;case"move":O(e)}},L=(e,t)=>{var n;const a=Math.floor(20*i.Sh.next())+1,o=e.character?A(e.character.finalStats.strength):(null===(n=e.enemy)||void 0===n?void 0:n.attack)||0,s=a+o;if(R("".concat(e.name," attacks ").concat(t.name,"! (").concat(a," + ").concat(o," = ").concat(s," vs AC ").concat(t.armorClass,")")),s>=t.armorClass){var l;const n=e.character?P("1d6")+A(e.character.finalStats.strength):P((null===(l=e.enemy)||void 0===l?void 0:l.damage)||"1d6"),a=Math.max(1,n);g(e=>e.map(e=>e.id===t.id?(0,r.A)((0,r.A)({},e),{},{currentHP:Math.max(0,e.currentHP-a)}):e)),R("\ud83c\udfaf Hit! ".concat(t.name," takes ").concat(a," damage.")),t.currentHP-a<=0&&R("\ud83d\udc80 ".concat(t.name," is defeated!"))}else R("\u274c Miss!")},I=(e,t,n)=>{const a=t.name.replace("Cast ",""),i=M.find(e=>e.name===a);if(i){if(R("\u2728 ".concat(e.name," casts ").concat(i.name,"!")),n.forEach(t=>{q(e,t,i)}),i.duration.toLowerCase().includes("concentration")){const t=i.duration.match(/(\d+)\s*rounds?/),n=t?parseInt(t[1]):3;g(t=>t.map(t=>t.id===e.id?(0,r.A)((0,r.A)({},t),{},{concentrationSpell:{name:i.name,duration:n,effect:i.description}}):t))}}else R("\u274c ".concat(e.name," failed to cast ").concat(a," - spell not found!"))},q=(e,t,n)=>{const a=n.description.toLowerCase(),i=n.school.toLowerCase(),o=n.level;let s="damage",l=0===o?4:Math.max(4,3*o);switch(a.includes("heal")||a.includes("restore")?(s="heal",l=0===o?3:Math.max(3,2*o)):a.includes("protect")||a.includes("barrier")||a.includes("shield")?(s="protection",l=2+o):(a.includes("damage")||a.includes("harm")||"evocation"===i)&&(s="damage",l=0===o?4:Math.max(4,3*o)),s){case"heal":const e=P("1d".concat(l+2))+(o>0?o:1);g(n=>n.map(n=>n.id===t.id?(0,r.A)((0,r.A)({},n),{},{currentHP:Math.min(n.maxHP,n.currentHP+e)}):n)),R("\ud83d\udc9a ".concat(t.name," heals ").concat(e," HP!"));break;case"damage":const a=P("1d".concat(l))+(o>0?o:0);g(e=>e.map(e=>e.id===t.id?(0,r.A)((0,r.A)({},e),{},{currentHP:Math.max(0,e.currentHP-a)}):e)),R("\ud83d\udca5 ".concat(t.name," takes ").concat(a," magical damage!")),t.currentHP-a<=0&&R("\ud83d\udc80 ".concat(t.name," is defeated by magic!"));break;case"protection":const i=Math.max(1,Math.floor(l/2));g(e=>e.map(e=>e.id===t.id?(0,r.A)((0,r.A)({},e),{},{statusEffects:[...e.statusEffects,{name:"".concat(n.name," Protection"),duration:i,effect:"+".concat(l," AC"),color:n.color}]}):e)),R("\ud83d\udee1\ufe0f ".concat(t.name," gains magical protection (+").concat(l," AC for ").concat(i," rounds)!"))}},D=e=>{g(t=>t.map(t=>t.id===e.id?(0,r.A)((0,r.A)({},t),{},{statusEffects:[...t.statusEffects,{name:"Defending",duration:1,effect:"+2 AC",color:"#10b981"}]}):t)),R("\ud83d\udee1\ufe0f ".concat(e.name," takes a defensive stance."))},O=e=>{R("\ud83c\udfc3 ".concat(e.name," moves to a better position."))},W=()=>{g(e=>e.map(e=>(0,r.A)((0,r.A)({},e),{},{statusEffects:e.statusEffects.map(e=>(0,r.A)((0,r.A)({},e),{},{duration:e.duration-1})).filter(e=>e.duration>0),concentrationSpell:e.concentrationSpell&&e.concentrationSpell.duration>1?(0,r.A)((0,r.A)({},e.concentrationSpell),{},{duration:e.concentrationSpell.duration-1}):void 0})));let e=(d+1)%y.length;0===e&&(m(e=>e+1),R("\n--- Round ".concat(p+1," ---"))),h(e),b(null),S(null);const t=f.filter(e=>"player"===e.type&&e.currentHP>0),a=f.filter(e=>"enemy"===e.type&&e.currentHP>0);0===t.length?(c("defeat"),o("defeat")):0===a.length&&(c("victory"),o("victory",{experience:100*n.enemies.length,gold:Math.floor(50*i.Sh.next())+10}))},H=e=>{if(!v)return;const t=_();if(!t)return;const n=f.find(t=>t.id===e);n&&(z(t,v,[n]),setTimeout(()=>{W()},1500))},F=()=>{const e=_();"enemy"===(null===e||void 0===e?void 0:e.type)&&((e=>{const t=f.filter(e=>"player"===e.type&&e.currentHP>0);if(0===t.length)return;const n=t[Math.floor(i.Sh.next()*t.length)];z(e,{type:"attack",name:"Attack",description:"Enemy attack",target:"enemy"},[n])})(e),setTimeout(()=>{W()},2e3))};if((0,a.useEffect)(()=>{const e=_();if("enemy"===(null===e||void 0===e?void 0:e.type)&&"active"===l){const e=setTimeout(()=>{F()},1e3);return()=>clearTimeout(e)}},[d,l]),"setup"===l)return(0,w.jsx)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"#f1f5f9",padding:"2rem",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,w.jsxs)("div",{style:{textAlign:"center"},children:[(0,w.jsx)("h2",{children:"\u2694\ufe0f Preparing for Battle..."}),(0,w.jsx)("p",{children:"Rolling initiative and setting up the encounter"})]})});const G=_(),U="player"===(null===G||void 0===G?void 0:G.type);return(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"#f1f5f9",padding:"1rem"},children:[(0,w.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem",padding:"1rem",background:"rgba(15, 23, 42, 0.8)",borderRadius:"8px",border:"1px solid #334155"},children:[(0,w.jsxs)("h1",{style:{margin:"0 0 0.5rem",fontSize:"1.8rem"},children:["\u2694\ufe0f ",n.name]}),(0,w.jsxs)("p",{style:{margin:0,color:"#94a3b8"},children:["Round ",p," \u2022 ",null===G||void 0===G?void 0:G.name,"'s Turn (",null===G||void 0===G?void 0:G.type,")"]}),s&&(0,w.jsx)("button",{onClick:s,style:{position:"absolute",top:"1rem",left:"1rem",padding:"0.5rem 1rem",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"4px",cursor:"pointer"},children:"\u2190 Back"})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 300px",gap:"1rem",height:"calc(100vh - 200px)"},children:[(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1rem",border:"2px solid #059669"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 1rem",color:"#10b981"},children:"\ud83d\udc65 Player Characters"}),(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:f.filter(e=>"player"===e.type).map(e=>{var t;return(0,w.jsxs)("div",{onClick:()=>v&&B(G,v).some(t=>t.id===e.id)&&H(e.id),style:{padding:"0.75rem",background:(null===G||void 0===G?void 0:G.id)===e.id?"rgba(59, 130, 246, 0.3)":"rgba(15, 23, 42, 0.8)",border:(null===G||void 0===G?void 0:G.id)===e.id?"2px solid #3b82f6":v&&B(G,v).some(t=>t.id===e.id)?"2px solid #f59e0b":"1px solid #334155",borderRadius:"6px",cursor:v&&B(G,v).some(t=>t.id===e.id)?"pointer":"default"},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:e.name}),(0,w.jsxs)("span",{style:{color:"#94a3b8",fontSize:"0.9rem",marginLeft:"0.5rem"},children:["(",null===(t=e.character)||void 0===t?void 0:t.class,")"]})]}),(0,w.jsxs)("div",{style:{textAlign:"right"},children:[(0,w.jsxs)("div",{style:{color:e.currentHP<=.3*e.maxHP?"#ef4444":"#10b981"},children:["HP: ",e.currentHP,"/",e.maxHP]}),(0,w.jsxs)("div",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:["AC: ",e.armorClass]})]})]}),e.statusEffects.length>0&&(0,w.jsx)("div",{style:{marginTop:"0.5rem",display:"flex",gap:"0.25rem",flexWrap:"wrap"},children:e.statusEffects.map((e,t)=>(0,w.jsxs)("span",{style:{background:e.color,color:"white",fontSize:"0.7rem",padding:"0.2rem 0.4rem",borderRadius:"3px"},children:[e.name," (",e.duration,"r)"]},t))}),e.concentrationSpell&&(0,w.jsxs)("div",{style:{marginTop:"0.5rem",fontSize:"0.8rem",color:"#a78bfa",fontStyle:"italic"},children:["Concentrating: ",e.concentrationSpell.name," (",e.concentrationSpell.duration,"r)"]})]},e.id)})})]}),(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1rem",border:"2px solid #dc2626"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 1rem",color:"#ef4444"},children:"\ud83d\udc79 Enemies"}),(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:f.filter(e=>"enemy"===e.type).map(e=>(0,w.jsxs)("div",{onClick:()=>v&&B(G,v).some(t=>t.id===e.id)&&H(e.id),style:{padding:"0.75rem",background:(null===G||void 0===G?void 0:G.id)===e.id?"rgba(239, 68, 68, 0.3)":"rgba(15, 23, 42, 0.8)",border:(null===G||void 0===G?void 0:G.id)===e.id?"2px solid #ef4444":v&&B(G,v).some(t=>t.id===e.id)?"2px solid #f59e0b":"1px solid #334155",borderRadius:"6px",cursor:v&&B(G,v).some(t=>t.id===e.id)?"pointer":"default",opacity:e.currentHP<=0?.5:1},children:[(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:e.name}),e.currentHP<=0&&(0,w.jsx)("span",{style:{color:"#6b7280",marginLeft:"0.5rem"},children:"\ud83d\udc80 Defeated"})]}),(0,w.jsxs)("div",{style:{textAlign:"right"},children:[(0,w.jsxs)("div",{style:{color:e.currentHP<=.3*e.maxHP?"#ef4444":"#10b981"},children:["HP: ",e.currentHP,"/",e.maxHP]}),(0,w.jsxs)("div",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:["AC: ",e.armorClass]})]})]}),e.enemy&&(0,w.jsx)("div",{style:{fontSize:"0.8rem",color:"#94a3b8",marginTop:"0.25rem"},children:e.enemy.description})]},e.id))})]}),(0,w.jsxs)("div",{style:{background:"rgba(15, 23, 42, 0.6)",borderRadius:"8px",padding:"1rem",border:"1px solid #334155"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 1rem",color:"#f1f5f9"},children:U?"\ud83c\udfb2 Your Actions":"\u23f3 Enemy Turn"}),U?(0,w.jsx)("div",{children:v?(0,w.jsxs)("div",{children:[(0,w.jsxs)("h4",{style:{color:"#3b82f6"},children:["Selected: ",v.name]}),(0,w.jsx)("p",{style:{fontSize:"0.9rem",color:"#94a3b8",margin:"0.5rem 0"},children:v.description}),"self"!==v.target?(0,w.jsx)("p",{style:{color:"#f59e0b",fontSize:"0.9rem"},children:"Click a target to continue..."}):(0,w.jsx)("button",{onClick:()=>H(G.id),style:{padding:"0.75rem",background:"#059669",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",width:"100%"},children:"Execute Action"}),(0,w.jsx)("button",{onClick:()=>b(null),style:{padding:"0.5rem",background:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%",marginTop:"0.5rem"},children:"Cancel"})]}):(0,w.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:(e=>{const t=[{type:"attack",name:"Attack",description:"Make a basic weapon or unarmed attack",target:"enemy"},{type:"defend",name:"Defend",description:"Gain +2 AC until your next turn",target:"self"},{type:"move",name:"Move",description:"Change position or take cover",target:"self"}];if(e.character){const n=e.character;n.knownCantrips&&n.knownCantrips.length>0&&n.knownCantrips.forEach(e=>{const n=M.find(t=>t.name===e&&0===t.level);n&&t.push({type:"cast-cantrip",name:"Cast ".concat(n.name),description:n.description,target:N(n)})}),n.knownSpells&&n.knownSpells.length>0&&n.knownSpells.forEach(e=>{const n=M.find(t=>t.name===e&&t.level>0);n&&t.push({type:"cast-spell",name:"Cast ".concat(n.name),description:n.description,target:N(n)})})}return t})(G).map((e,t)=>(0,w.jsxs)("button",{onClick:()=>(e=>{b(e),S(null)})(e),style:{padding:"0.75rem",background:"#374151",color:"#f9fafb",border:"1px solid #6b7280",borderRadius:"6px",cursor:"pointer",textAlign:"left"},children:[(0,w.jsx)("div",{style:{fontWeight:"bold"},children:e.name}),(0,w.jsx)("div",{style:{fontSize:"0.8rem",color:"#9ca3af"},children:e.description})]},t))})}):(0,w.jsx)("div",{style:{textAlign:"center",color:"#94a3b8"},children:(0,w.jsx)("p",{children:"Enemy is deciding their action..."})}),(0,w.jsxs)("div",{style:{marginTop:"1.5rem",padding:"0.75rem",background:"rgba(0, 0, 0, 0.3)",borderRadius:"4px",maxHeight:"200px",overflowY:"auto",fontSize:"0.8rem",border:"1px solid #334155"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 0.5rem",color:"#94a3b8"},children:"Battle Log"}),j.slice(-8).map((e,t)=>(0,w.jsx)("div",{style:{marginBottom:"0.25rem",color:"#d1d5db"},children:e},t))]})]})]})]})}function Kr(e){let{seedStr:t="enhanced-world-001",onBack:n}=e;const[r,i]=(0,a.useState)({x:0,y:0}),[o,s]=(0,a.useState)(null),[l,c]=(0,a.useState)({x:-9,y:-9}),[d,u]=(0,a.useState)(null),[h,p]=(0,a.useState)(null),[m,f]=(0,a.useState)(new Set(["0,0"])),[g,y]=(0,a.useState)({season:"Spring",week:1,year:1}),[x,v]=(0,a.useState)({gold:1e3,mana:50,influence:10}),b={name:"Ocean",color:"#0369a1",emoji:"\ud83c\udf0a",movementCost:99,defenseBonus:0,canBuildOn:!1},k={name:"Coast",color:"#0ea5e9",emoji:"\ud83c\udfd6\ufe0f",movementCost:1,defenseBonus:0,canBuildOn:!0},S={name:"Plains",color:"#84cc16",emoji:"\ud83c\udf3e",movementCost:1,defenseBonus:0,canBuildOn:!0,resources:["Food"]},j={name:"Forest",color:"#16a34a",emoji:"\ud83c\udf32",movementCost:2,defenseBonus:1,canBuildOn:!0,resources:["Wood"]},C={name:"Mountain",color:"#64748b",emoji:"\u26f0\ufe0f",movementCost:3,defenseBonus:2,canBuildOn:!0,resources:["Stone","Metals"]},M={name:"Swamp",color:"#10b981",emoji:"\ud83e\udeb5",movementCost:3,defenseBonus:1,canBuildOn:!1,resources:["Herbs"]},T={name:"Desert",color:"#eab308",emoji:"\ud83c\udfdc\ufe0f",movementCost:2,defenseBonus:0,canBuildOn:!0,resources:["Gems"]},A={name:"Tundra",color:"#94a3b8",emoji:"\ud83e\uddca",movementCost:2,defenseBonus:0,canBuildOn:!0},E={name:"River",color:"#06b6d4",emoji:"\ud83d\udca7",movementCost:1,defenseBonus:0,canBuildOn:!1,resources:["Water"]},P=[{name:"Crystal Empire",color:"#8b5cf6",emoji:"\ud83d\udc8e",description:"Masters of magical crystals and ancient knowledge",territory:["mountain","desert"],relationship:"neutral"},{name:"Forest Alliance",color:"#16a34a",emoji:"\ud83c\udf32",description:"Guardians of nature and the old ways",territory:["forest","swamp"],relationship:"friendly"},{name:"Iron Legion",color:"#374151",emoji:"\u2694\ufe0f",description:"Military confederation seeking territorial expansion",territory:["plains","coast"],relationship:"hostile"},{name:"Free Cities",color:"#f59e0b",emoji:"\ud83c\udfdb\ufe0f",description:"Independent trading cities and merchant guilds",territory:["coast","river"],relationship:"neutral"}],R=(0,a.useCallback)((e,t,n)=>{const r="".concat(n,"-").concat(e,"-").concat(t);let a=0;for(let i=0;i<r.length;i++){a=(a<<5)-a+r.charCodeAt(i),a&=a}return Math.abs(a)/2147483647},[]),_=(0,a.useCallback)((e,n)=>{const r=Math.sqrt(e*e+n*n),a=2*(2*R(e,n,t+"n1")-1+.6*(2*R(Math.floor(.3*e),Math.floor(.3*n),t+"n2")-1)),i=r+a;if(i>25)return b;if(i>22)return k;const o=Math.abs(n+a);if(o>18)return A;if(o>15)return C;if(R(Math.floor(.4*e),Math.floor(.4*n),t+"mountain")>.75)return C;if(R(Math.floor(.7*e),Math.floor(.7*n),t+"river")>.85&&i<15)return E;const s=R(e,n,t+"biome");return R(Math.floor(.2*e),Math.floor(.2*n),t+"temp")>.7?T:s>.6?j:s>.3&&o<10?M:S},[t,R]),N=(0,a.useCallback)((e,n)=>{const r=_(e,n);if(!r.canBuildOn)return null;const a=Math.sqrt(e*e+n*n),i=R(e,n,t+"settlement");if(0===e&&0===n)return{type:"capital",name:"Arcanum Throne",population:5e4,faction:"Crystal Empire",description:"The great crystal spire where magic and politics intertwine.",emoji:"\ud83d\udc51",level:5,garrison:1e3,resources:["Gold","Mana","Crystals"],services:["Palace","Grand Market","Academy","Temple","Guild Halls"],isPlayerControlled:!0};if(a>8&&a<20){if(i>.95){const a=P[Math.floor(R(e,n,t+"fac")*P.length)];return{type:"city",name:B(e,n,a.name),population:Math.floor(8e3+12e3*R(e,n,t+"pop")),faction:a.name,description:"A major ".concat(a.description.toLowerCase()," stronghold."),emoji:a.emoji,level:4,garrison:Math.floor(200+300*R(e,n,t+"gar")),resources:r.resources||[],services:["Market","Barracks","Temple","Inn"]}}if(i>.88){const a=P[Math.floor(R(e,n,t+"fac2")*P.length)];return{type:"town",name:B(e,n,a.name),population:Math.floor(2e3+4e3*R(e,n,t+"pop2")),faction:a.name,description:"A ".concat(a.description.toLowerCase()," settlement."),emoji:"\ud83c\udfd8\ufe0f",level:3,garrison:Math.floor(50+100*R(e,n,t+"gar2")),resources:r.resources||[],services:["Market","Inn","Temple"]}}}return i>.97?{type:"village",name:B(e,n,"Village"),population:Math.floor(100+500*R(e,n,t+"vpop")),faction:"Independent",description:"A small independent settlement.",emoji:"\ud83c\udfe1",level:1,garrison:Math.floor(10+20*R(e,n,t+"vgar")),services:["Inn"]}:null},[_,t,R]),B=(e,n,r)=>{const a={"Crystal Empire":["Crystal","Arcane","Mystic","Star"],"Forest Alliance":["Green","Wild","Elder","Grove"],"Iron Legion":["Iron","Steel","War","Battle"],"Free Cities":["Port","Trade","Golden","Free"],Village:["Little","Old","New","Fair"]},i=["hold","haven","ford","burg","ton","vale","ridge","gate"],o=a[r]||a.Village,s=o[Math.floor(R(e,n,t+"name1")*o.length)],l=i[Math.floor(R(e,n,t+"name2")*i.length)];return"".concat(s).concat(l)},z=(0,a.useCallback)((e,n)=>{if(N(e,n))return null;const r=_(e,n),a=Math.sqrt(e*e+n*n),i=R(e,n,t+"encounter");if("Ocean"===r.name)return null;if(a>15&&i>.98)return{type:"creature",name:"Ancient Dragon",description:"A legendary wyrm guarding ancient treasures.",emoji:"\ud83d\udc09",danger:"extreme",level:10,isDiscovered:!1};if(r.resources&&i>.92){const e=r.resources[0];return{type:"resource",name:"".concat(e," Deposit"),description:"Rich deposits of ".concat(e.toLowerCase()," ready for extraction."),emoji:L(e),danger:"low",level:Math.floor(1+a/5),isDiscovered:!1}}return i>.94?{type:"ruins",name:"Ancient Ruins",description:"Crumbling stones hide secrets of a forgotten age.",emoji:"\ud83c\udfdb\ufe0f",danger:"medium",level:Math.floor(1+a/3),isDiscovered:!1}:i>.85?I(r,a):null},[N,_,t,R]),L=e=>({Food:"\ud83c\udf3e",Wood:"\ud83e\udeb5",Stone:"\ud83e\udea8",Metals:"\u2692\ufe0f",Herbs:"\ud83c\udf3f",Gems:"\ud83d\udc8e",Water:"\ud83d\udca7",Gold:"\ud83d\udfe1",Mana:"\ud83d\udd2e",Crystals:"\ud83d\udc8e"}[e]||"\ud83d\udce6"),I=(e,t)=>{const n=Math.max(1,Math.floor(t/4));switch(e.name){case"Forest":return{type:"creature",name:"Forest Guardians",emoji:"\ud83e\uddda\u200d\u2640\ufe0f",description:"Mystical protectors of the ancient woods.",danger:"medium",level:n,isDiscovered:!1};case"Mountain":return{type:"creature",name:"Mountain Bandits",emoji:"\ud83c\udff9",description:"Outlaws hiding in the rocky peaks.",danger:"high",level:n,isDiscovered:!1};case"Desert":return{type:"mystery",name:"Mirage Oasis",emoji:"\ud83c\udfd6\ufe0f",description:"A shimmering vision that may hide treasure or danger.",danger:"medium",level:n,isDiscovered:!1};default:return{type:"creature",name:"Wild Beasts",emoji:"\ud83d\udc3a",description:"Dangerous creatures roam these lands.",danger:"low",level:n,isDiscovered:!1}}};(0,a.useEffect)(()=>{const e=e=>{let t=r.x,n=r.y;switch(e.key.toLowerCase()){case"w":case"arrowup":n+=1;break;case"s":case"arrowdown":n-=1;break;case"a":case"arrowleft":t-=1;break;case"d":case"arrowright":t+=1;break;default:return}e.preventDefault();if(_(t,n).movementCost>=99)return;i({x:t,y:n}),f(e=>{const r=new Set(e);return r.add("".concat(t,",").concat(n)),r});const a=Math.floor(9.5);c({x:t-a,y:n-a})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,_,19]);const q=(()=>{const e=[];for(let t=0;t<19;t++){const n=[];for(let e=0;e<19;e++){const a=l.x+e,i=l.y+t,o=a===r.x&&i===r.y,s=m.has("".concat(a,",").concat(i)),c=_(a,i),d=N(a,i),u=d?null:z(a,i);n.push({x:a,y:i,terrain:c,settlement:d,encounter:u,isPlayer:o,isExplored:s})}e.push(n)}return e})(),D=e=>{switch(e){case"safe":return"#10b981";case"low":return"#f59e0b";case"medium":return"#f97316";case"high":return"#ef4444";case"extreme":return"#991b1b";default:return"#6b7280"}};return(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"#0f172a",color:"#f1f5f9",padding:"20px"},children:[(0,w.jsxs)("div",{style:{textAlign:"center",marginBottom:"20px"},children:[(0,w.jsx)("h1",{style:{margin:"0 0 10px 0",color:"#8b5cf6"},children:"\u2694\ufe0f Strategic World Map \u2694\ufe0f"}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"20px",marginBottom:"10px"},children:[(0,w.jsxs)("div",{children:["\ud83d\udccd Position: (",r.x,", ",r.y,")"]}),(0,w.jsxs)("div",{children:["\ud83c\udf0d Terrain: ",_(r.x,r.y).name]}),(0,w.jsxs)("div",{children:["\ud83d\udcc5 ",g.season," Week ",g.week,", Year ",g.year]})]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"20px",fontSize:"14px",color:"#94a3b8"},children:[(0,w.jsxs)("div",{children:["\ud83d\udcb0 Gold: ",x.gold]}),(0,w.jsxs)("div",{children:["\ud83d\udd2e Mana: ",x.mana]}),(0,w.jsxs)("div",{children:["\ud83d\udc51 Influence: ",x.influence]}),(0,w.jsxs)("div",{children:["\ud83d\uddfa\ufe0f Explored: ",m.size," tiles"]})]}),(0,w.jsx)("p",{style:{fontSize:"14px",color:"#94a3b8",margin:"10px 0"},children:"WASD/Arrows: Move \u2022 Click: Interact \u2022 Only explored tiles are visible"}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"10px",marginTop:"10px"},children:[(0,w.jsx)("button",{onClick:()=>{i({x:0,y:0}),c({x:-9,y:-9})},style:{padding:"6px 12px",background:"#1e40af",color:"#f9fafb",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},children:"\ud83d\udccd Return to Capital"}),n&&(0,w.jsx)("button",{onClick:n,style:{padding:"8px 16px",background:"#059669",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer"},children:"\u2190 Back to Menu"})]})]}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(19,", 28px)"),gap:"1px",padding:"20px",background:"#1e293b",borderRadius:"16px",margin:"0 auto",width:"fit-content",boxShadow:"0 4px 20px rgba(0,0,0,0.3)"},children:q.flat().map(e=>{let{x:t,y:n,terrain:r,settlement:a,encounter:i,isPlayer:l,isExplored:c}=e;const d=(null===o||void 0===o?void 0:o.x)===t&&(null===o||void 0===o?void 0:o.y)===n;return(0,w.jsx)("div",{onClick:()=>((e,t)=>{if(!m.has("".concat(e,",").concat(t)))return;s({x:e,y:t});const n=N(e,t),r=z(e,t);n?(u(n),p(null)):r?(p(r),u(null)):(u(null),p(null))})(t,n),title:c?"".concat(r.name," (").concat(t,", ").concat(n,")").concat(l?" - You are here!":"").concat(a?" - ".concat(a.name):"").concat(i?" - ".concat(i.name):""):"Unexplored (".concat(t,", ").concat(n,")"),style:{width:"28px",height:"28px",background:c?r.color:"#374151",border:d?"3px solid #fff":l?"3px solid #ffd93d":null!==a&&void 0!==a&&a.isPlayerControlled?"2px solid #10b981":a?"2px solid #8b5cf6":i?"2px solid ".concat(D(i.danger)):"1px solid rgba(0,0,0,0.2)",cursor:c?"pointer":"default",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",borderRadius:"3px",position:"relative",opacity:c?1:.3,boxShadow:l?"inset 0 0 15px rgba(255, 215, 0, 0.6)":null!==a&&void 0!==a&&a.isPlayerControlled?"inset 0 0 10px rgba(16, 185, 129, 0.4)":a?"inset 0 0 10px rgba(139, 92, 246, 0.3)":i?"inset 0 0 10px ".concat(D(i.danger),"40"):"none"},children:c?l?"\ud83d\udc64":a?a.emoji:i?i.emoji:r.emoji:"\u2753"},"".concat(t,",").concat(n))})}),d&&(0,w.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",padding:"20px",background:"#1e293b",borderRadius:"16px",maxWidth:"600px",margin:"20px auto",border:"2px solid #8b5cf6"},children:[(0,w.jsxs)("h3",{style:{margin:"0 0 15px 0",color:"#8b5cf6",fontSize:"24px"},children:[d.emoji," ",d.name]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"15px",textAlign:"left"},children:[(0,w.jsxs)("div",{children:[(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Type:"})," ",d.type.charAt(0).toUpperCase()+d.type.slice(1)]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Population:"})," ",d.population.toLocaleString()]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Faction:"})," ",d.faction]}),(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Level:"})," ",d.level,"/5"]}),d.garrison&&(0,w.jsxs)("p",{children:[(0,w.jsx)("strong",{children:"Garrison:"})," ",d.garrison]})]}),(0,w.jsx)("div",{children:d.resources&&d.resources.length>0&&(0,w.jsxs)("div",{children:[(0,w.jsx)("p",{children:(0,w.jsx)("strong",{children:"Resources:"})}),(0,w.jsx)("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap"},children:d.resources.map(e=>(0,w.jsxs)("span",{style:{background:"#374151",padding:"2px 6px",borderRadius:"4px",fontSize:"12px"},children:[L(e)," ",e]},e))})]})})]}),(0,w.jsx)("p",{style:{margin:"15px 0",color:"#d1d5db",fontStyle:"italic"},children:d.description}),d.services&&d.services.length>0&&(0,w.jsxs)("div",{style:{marginTop:"15px"},children:[(0,w.jsx)("p",{children:(0,w.jsx)("strong",{children:"Available Services:"})}),(0,w.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"8px",flexWrap:"wrap"},children:d.services.map(e=>(0,w.jsx)("span",{style:{background:"#059669",color:"white",padding:"4px 8px",borderRadius:"6px",fontSize:"12px",fontWeight:"bold"},children:e},e))})]}),(0,w.jsxs)("div",{style:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"center"},children:[(0,w.jsx)("button",{style:{padding:"10px 20px",background:"#8b5cf6",color:"#f9fafb",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},children:"Enter Settlement"}),(0,w.jsx)("button",{style:{padding:"10px 20px",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Trade"})]})]}),h&&(0,w.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",padding:"20px",background:"#1e293b",borderRadius:"16px",maxWidth:"600px",margin:"20px auto",border:"2px solid ".concat(D(h.danger))},children:[(0,w.jsxs)("h3",{style:{margin:"0 0 15px 0",color:D(h.danger),fontSize:"20px"},children:[h.emoji," ",h.name]}),(0,w.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"20px",marginBottom:"15px"},children:[(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Type:"})," ",h.type]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Danger:"})," ",(0,w.jsx)("span",{style:{color:D(h.danger)},children:h.danger.toUpperCase()})]}),h.level&&(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Level:"})," ",h.level]})]}),(0,w.jsx)("p",{style:{margin:"15px 0",color:"#d1d5db",fontStyle:"italic"},children:h.description}),(0,w.jsxs)("div",{style:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"center"},children:[(0,w.jsx)("button",{style:{padding:"10px 20px",background:D(h.danger),color:"#f9fafb",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},children:"Investigate"}),(0,w.jsx)("button",{style:{padding:"10px 20px",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"8px",cursor:"pointer"},children:"Avoid"})]})]}),(0,w.jsxs)("div",{style:{marginTop:"20px",padding:"15px",background:"#1e293b",borderRadius:"12px",maxWidth:"800px",margin:"20px auto"},children:[(0,w.jsx)("h4",{style:{margin:"0 0 10px 0",textAlign:"center",color:"#8b5cf6"},children:"Major Factions"}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"10px"},children:P.map(e=>(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,w.jsx)("span",{style:{fontSize:"18px"},children:e.emoji}),(0,w.jsxs)("div",{children:[(0,w.jsx)("div",{style:{fontWeight:"bold",color:e.color},children:e.name}),(0,w.jsxs)("div",{style:{fontSize:"12px",color:"#94a3b8"},children:[e.relationship," \u2022 ",e.territory.join(", ")]})]})]},e.name))})]})]})}class Xr{constructor(e){this.seed=void 0,this.seed=this.hashString(e)}hashString(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return Math.abs(t)}next(){return this.seed=(1664525*this.seed+1013904223)%4294967296,this.seed/4294967296}nextInt(e,t){return Math.floor(this.next()*(t-e))+e}pick(e){return e[this.nextInt(0,e.length)]}shuffle(e){const t=[...e];for(let n=t.length-1;n>0;n--){const e=this.nextInt(0,n+1);[t[n],t[e]]=[t[e],t[n]]}return t}chance(e){return this.next()<e}}const Jr={types:["delivery","rescue","elimination","exploration","escort","collection","investigation","diplomatic"],objectives:{delivery:["Deliver a package","Transport goods","Carry a message","Bring supplies"],rescue:["Save the prisoner","Rescue the merchant","Find the missing child","Free the captives"],elimination:["Eliminate the threat","Clear the monsters","Defeat the bandit leader","Stop the cult"],exploration:["Map the area","Find the ancient ruins","Discover the secret","Explore the dungeon"],escort:["Protect the caravan","Guard the diplomat","Escort the noble","Safeguard the witness"],collection:["Gather rare herbs","Collect magical components","Retrieve stolen items","Find the artifacts"],investigation:["Solve the mystery","Uncover the truth","Find the culprit","Investigate the disappearance"],diplomatic:["Negotiate peace","Establish trade","Arrange alliance","Mediate dispute"]},locations:["ancient ruins","dark forest","abandoned mine","mountain pass","haunted mansion","bandit camp","mystical grove","underground cavern"],rewards:["gold coins","magical item","rare weapon","ancient scroll","precious gems","land deed","noble title","magical knowledge"],complications:["time limit","rival party","dangerous weather","political intrigue","cursed location","false information","hostile locals","ancient guardian"]},Qr=["friendly","suspicious","helpful","greedy","wise","eccentric","stern","cheerful","mysterious","ambitious"],$r=["merchant","guard","scholar","priest","blacksmith","innkeeper","farmer","noble","thief","hunter"],Zr=["has hidden wealth","knows ancient lore","is secretly noble","has criminal past","possesses magic item","owes large debt","is hiding identity","has powerful enemy"];class ea{constructor(e,t,n){this.rng=void 0,this.rng=new Xr("".concat(e,"-settlement-").concat(t,"-").concat(n))}generate(){const e=this.rng.pick(["city","town","village","outpost","trading_post"]),t=["Iron","Gold","Silver","Stone","Wood","River","Hill","Vale","North","South","East","West"],n=["hold","haven","ford","bury","ton","ham","stead","bridge","gate","peak","dale","brook"],r=this.rng.pick(t)+this.rng.pick(n),a=this.generateServices(e),i=this.generateNPCs(e);return{name:r,type:e,population:this.getPopulation(e),services:a,npcs:i,description:this.generateDescription(r,e)}}getPopulation(e){const t={city:[5e3,2e4],town:[1e3,5e3],village:[100,1e3],outpost:[20,100],trading_post:[50,200]}[e]||[100,1e3];return this.rng.nextInt(t[0],t[1])}generateServices(e){const t="city"===e?8:"town"===e?6:"village"===e?4:2;return this.rng.shuffle(["inn","blacksmith","general_store","temple","market","barracks","library","alchemist","stable","bank"]).slice(0,t)}generateNPCs(e){const t="city"===e?5:"town"===e?3:2,n=[];for(let r=0;r<t;r++)n.push({name:this.generateNPCName(),occupation:this.rng.pick($r),personality:this.rng.pick(Qr),secret:this.rng.chance(.3)?this.rng.pick(Zr):void 0});return n}generateNPCName(){return this.rng.pick(["Gareth","Elena","Marcus","Aria","Thane","Vera","Aldric","Kira","Owen","Luna"])+" "+this.rng.pick(["Blackwood","Silverstone","Ironforge","Goldleaf","Stormwind","Ravencrest","Thornfield","Ashworth"])}generateDescription(e,t){return{city:"".concat(e," is a bustling metropolis with towering walls and busy markets."),town:"".concat(e," is a prosperous town known for its skilled craftsmen and trade."),village:"".concat(e," is a quiet village where everyone knows each other."),outpost:"".concat(e," is a frontier outpost guarding the wilderness."),trading_post:"".concat(e," is a vital trading post connecting distant regions.")}[t]||"".concat(e," is a settlement of some renown.")}}class ta{constructor(e,t,n){this.rng=void 0,this.rng=new Xr("".concat(e,"-quest-").concat(t,"-").concat(n))}generate(){const e=this.rng.pick(Jr.types),t=this.rng.pick(Jr.objectives[e]),n=this.rng.pick(Jr.locations),r=this.rng.pick(Jr.rewards),a=this.rng.chance(.4)?this.rng.pick(Jr.complications):null;return{title:this.generateTitle(t,n),type:e,objective:t,location:n,reward:r,complication:a,description:this.generateDescription(t,n,r,a),difficulty:this.rng.pick(["easy","medium","hard","epic"])}}generateTitle(e,t){const n=["The ".concat(t," ").concat(e.split(" ").slice(-1)[0]),"".concat(e," at the ").concat(t),"Quest for the ".concat(t),"The ".concat(t," Mystery")];return this.rng.pick(n)}generateDescription(e,t,n,r){let a="".concat(e," in the ").concat(t,". ");return a+="Success will be rewarded with ".concat(n,". "),r&&(a+="However, beware of ".concat(r,".")),a}}function na(e){let{encounter:t,playerCharacters:n,onEncounterEnd:o,onBack:s}=e;const[l,c]=(0,a.useState)("approaching"),[d,u]=(0,a.useState)(null),[h,p]=(0,a.useState)(""),[m,f]=(0,a.useState)(null),[g,y]=(0,a.useState)(""),x=()=>{const e=["Dense Forest","Rocky Outcrop","Misty Clearing","Ancient Ruins","Thorny Undergrowth","Crystal Cave","Moonlit Grove","Shadow-touched Hollow"];return e[Math.floor(i.Sh.next()*e.length)]},v=e=>{switch(y(e),e){case"investigate":b();break;case"combat":k();break;case"flee":o("fled")}},b=()=>{c("investigating");let e="",n=null;switch(t.type){case"mystery":if("safe"!==t.danger&&"low"!==t.danger)return e="As you investigate, you trigger ancient defenses! The mystery guardians awaken...",void setTimeout(()=>k(),2e3);e="Your careful investigation reveals hidden secrets. You successfully solve the mystery without danger!",n={experience:150,gold:Math.floor(30*i.Sh.next())+10,special:"Ancient Knowledge: +1 to your next spell attack roll"};break;case"treasure":e="You carefully examine the area and discover valuable treasures hidden from plain sight!",n={gold:Math.floor(100*i.Sh.next())+50,items:["Magical Component Pouch","Healing Potion"],experience:100};break;case"event":e="You take time to properly assess the situation. Your wisdom grants you insight and safe passage.",n={experience:75,buff:"Well-Rested: +2 to all rolls for the next encounter"};break;case"quest":e="You gather information and clues about this quest. Your investigation reveals the best course of action.",n={experience:125,questProgress:"Gained valuable quest information"};break;default:if("safe"!==t.danger)return e="Your investigation alerts the hostile creatures! Prepare for battle!",void setTimeout(()=>k(),2e3);e="Your cautious approach pays off. You handle the situation peacefully.",n={experience:50}}p(e),f(n),setTimeout(()=>{c("resolved"),o("completed",n)},3e3)},k=()=>{const e=(e=>{const t={"Wild Beasts":{name:"Wild Wolf",hitPoints:11,maxHitPoints:11,armorClass:13,attack:4,damage:"2d4+2",abilities:["Pack Tactics"],description:"A fierce predator with sharp fangs"},Bandits:{name:"Bandit",hitPoints:15,maxHitPoints:15,armorClass:12,attack:3,damage:"1d6+1",abilities:["Sneak Attack"],description:"A desperate criminal looking for easy targets"},"Ancient Guardian":{name:"Stone Guardian",hitPoints:35,maxHitPoints:35,armorClass:17,attack:6,damage:"2d8+4",abilities:["Magic Resistance","Slam"],description:"An ancient construct awakened to defend sacred grounds"},"Lost Spirits":{name:"Wandering Spirit",hitPoints:22,maxHitPoints:22,armorClass:14,attack:5,damage:"2d6+3",abilities:["Ethereal","Life Drain"],description:"A tormented soul seeking peace or revenge"},"Corrupted Dryad":{name:"Twisted Dryad",hitPoints:30,maxHitPoints:30,armorClass:15,attack:7,damage:"1d8+4",abilities:["Nature Magic","Entangle","Barkskin"],description:"Once a protector of nature, now corrupted by dark magic"},"Thornbeast Pack":{name:"Thornbeast",hitPoints:18,maxHitPoints:18,armorClass:14,attack:5,damage:"1d8+3",abilities:["Thorned Hide","Pounce"],description:"A predator with living vines as armor"}};if("creature"!==e.type||"safe"===e.danger)return[];const n=t[e.name]||t["Wild Beasts"],a={safe:0,low:1,medium:2,high:3,extreme:4}[e.danger],i=[],o=Math.max(1,a);for(let s=0;s<o;s++)i.push((0,r.A)((0,r.A)({},n),{},{name:o>1?"".concat(n.name," ").concat(s+1):n.name,hitPoints:n.hitPoints+5*a,maxHitPoints:n.maxHitPoints+5*a,attack:n.attack+Math.floor(a/2),armorClass:n.armorClass+Math.floor(a/3)}));return i})(t);if(0===e.length)return p("There are no hostile creatures here. You approach safely."),f({experience:25}),void setTimeout(()=>{c("resolved"),o("completed",{experience:25})},2e3);const n={name:t.name,description:t.description,enemies:e,terrain:x()};u(n),c("combat")},S=(e,t)=>{"victory"===e?o("completed",t):o("defeat"===e?"failed":"fled")};return"combat"===l&&d?(0,w.jsx)(Yr,{playerCharacters:n,encounter:d,onBattleEnd:S,onBack:s}):(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #1e293b 0%, #334155 100%)",color:"#f1f5f9",padding:"2rem",display:"flex",alignItems:"center",justifyContent:"center"},children:[(0,w.jsxs)("div",{style:{maxWidth:"800px",background:"rgba(15, 23, 42, 0.8)",borderRadius:"12px",padding:"2rem",border:"2px solid ".concat(ra(t.danger)),textAlign:"center"},children:["approaching"===l&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)("h1",{style:{margin:"0 0 1rem",fontSize:"2.5rem",color:ra(t.danger)},children:[t.emoji," ",t.name]}),(0,w.jsx)("div",{style:{margin:"1rem 0",padding:"1rem",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"1.1rem",lineHeight:"1.6"},children:t.description}),(0,w.jsxs)("div",{style:{margin:"1rem 0",padding:"0.75rem",background:ra(t.danger)+"20",border:"1px solid ".concat(ra(t.danger)),borderRadius:"6px",fontSize:"1rem",fontWeight:"bold"},children:["Danger Level: ",t.danger.charAt(0).toUpperCase()+t.danger.slice(1)]}),(0,w.jsxs)("div",{style:{marginTop:"2rem",display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[(0,w.jsx)("button",{onClick:()=>v("investigate"),style:{padding:"1rem 2rem",background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.1rem",fontWeight:"bold"},children:"\ud83d\udd0d Investigate Carefully"}),(0,w.jsx)("button",{onClick:()=>v("combat"),style:{padding:"1rem 2rem",background:"#dc2626",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.1rem",fontWeight:"bold"},children:"\u2694\ufe0f Attack Directly"}),(0,w.jsx)("button",{onClick:()=>v("flee"),style:{padding:"1rem 2rem",background:"#6b7280",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"1.1rem"},children:"\ud83c\udfc3 Avoid and Leave"})]}),s&&(0,w.jsx)("button",{onClick:s,style:{position:"absolute",top:"2rem",left:"2rem",padding:"0.75rem 1.5rem",background:"#374151",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer"},children:"\u2190 Back to Map"})]}),"investigating"===l&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("h2",{style:{color:"#3b82f6"},children:"\ud83d\udd0d Investigation in Progress..."}),(0,w.jsxs)("div",{style:{margin:"2rem 0",padding:"1.5rem",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"1.1rem"},children:[(0,w.jsxs)("p",{children:["You carefully examine the ",t.name.toLowerCase(),"..."]}),(0,w.jsx)("p",{children:"Your party moves with caution, using wisdom and experience to navigate the situation."}),(0,w.jsxs)("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"center",alignItems:"center",gap:"0.5rem"},children:[(0,w.jsx)("div",{style:{width:"20px",height:"20px",border:"3px solid #3b82f6",borderTop:"3px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,w.jsx)("span",{children:"Investigating..."})]})]})]}),"resolved"===l&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("h2",{style:{color:"#10b981"},children:"\u2705 Encounter Resolved"}),(0,w.jsx)("div",{style:{margin:"2rem 0",padding:"1.5rem",background:"rgba(0, 0, 0, 0.3)",borderRadius:"8px",fontSize:"1.1rem",lineHeight:"1.6"},children:h}),m&&(0,w.jsxs)("div",{style:{margin:"1rem 0",padding:"1rem",background:"rgba(16, 185, 129, 0.1)",border:"1px solid #10b981",borderRadius:"8px"},children:[(0,w.jsx)("h3",{style:{color:"#10b981",margin:"0 0 1rem"},children:"\ud83c\udf81 Rewards Gained"}),m.experience&&(0,w.jsxs)("p",{children:["Experience: +",m.experience," XP"]}),m.gold&&(0,w.jsxs)("p",{children:["Gold: +",m.gold," coins"]}),m.items&&(0,w.jsxs)("p",{children:["Items: ",m.items.join(", ")]}),m.special&&(0,w.jsxs)("p",{style:{color:"#a78bfa"},children:["Special: ",m.special]}),m.buff&&(0,w.jsxs)("p",{style:{color:"#f59e0b"},children:["Buff: ",m.buff]}),m.questProgress&&(0,w.jsx)("p",{style:{color:"#3b82f6"},children:m.questProgress})]})]})]}),(0,w.jsx)("style",{children:"\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n      "})]})}function ra(e){switch(e){case"safe":return"#10b981";case"low":return"#f59e0b";case"medium":return"#f97316";case"high":return"#ef4444";case"extreme":return"#991b1b";default:return"#6b7280"}}function aa(e){let{seedStr:t="verdance-seed-001",onBack:n}=e;const[r,i]=(0,a.useState)({x:0,y:0}),[o,s]=(0,a.useState)(null),[l,c]=(0,a.useState)({x:-7,y:-7}),[d,h]=(0,a.useState)(null),[p,m]=(0,a.useState)(null),[f,g]=(0,a.useState)(!1),[y,x]=(0,a.useState)([]);(0,a.useEffect)(()=>{try{const e=JSON.parse(u.local.getItem("world-engine-saved-characters")||"[]");x(e.slice(0,4))}catch(e){console.error("Error loading saved characters:",e),x([{name:"Adventurer",class:"Fighter",baseStats:{strength:15,constitution:14,wisdom:12,intelligence:10,dexterity:13,charisma:11},finalStats:{strength:15,constitution:14,wisdom:12,intelligence:10,dexterity:13,charisma:11},hitPoints:20,level:1,knownSpells:[],knownCantrips:[]}])}},[]);const v=15,b=(e,t,n)=>{const r="".concat(n,"-").concat(e,"-").concat(t);let a=0;for(let i=0;i<r.length;i++){a=(a<<5)-a+r.charCodeAt(i),a&=a}return Math.abs(a)/2147483647},k=(e,n)=>{const r=[{name:"Ocean",color:"#0ea5e9",emoji:"\ud83c\udf0a"},{name:"Coast",color:"#38bdf8",emoji:"\ud83c\udfd6\ufe0f"},{name:"Desert",color:"#eab308",emoji:"\ud83c\udfdc\ufe0f"},{name:"Grass",color:"#84cc16",emoji:"\ud83c\udf31"},{name:"Forest",color:"#16a34a",emoji:"\ud83c\udf32"},{name:"Mountain",color:"#64748b",emoji:"\u26f0\ufe0f"},{name:"Swamp",color:"#10b981",emoji:"\ud83e\udeb5"},{name:"Jungle",color:"#065f46",emoji:"\ud83c\udf34"},{name:"Taiga",color:"#0e7490",emoji:"\ud83c\udf32"},{name:"Tundra",color:"#94a3b8",emoji:"\ud83e\uddca"},{name:"Savanna",color:"#f59e0b",emoji:"\ud83c\udf3e"},{name:"Snow",color:"#e2e8f0",emoji:"\u2744\ufe0f"}],a=2*b(e,n,t+"n1")-1,i=2*b(Math.floor(.5*e),Math.floor(.5*n),t+"n2")-1,o=1.5*(a+.5*i),s=Math.sqrt(e*e+n*n)+o,l=n+2*o;if(s>25)return r[0];if(s>22)return r[1];if(l<-15)return s>12?r[9]:r[11];if(l>15)return Math.abs(e+3*a)>8?r[2]:r[7];if(b(Math.floor(.3*e),Math.floor(.3*n),t+"mtn")>.7||Math.abs(e+2*i)>18)return r[5];if(Math.abs(l)<5){if(Math.abs(e+a)<3)return r[3];if(Math.abs(e)<12)return r[4]}return l>5&&l<15?e+2*i>0?r[10]:r[6]:l<-5&&l>-15?r[8]:r[3]},S={roads:[{from:{x:0,y:0},to:{x:-5,y:0},name:"West Road"},{from:{x:-5,y:0},to:{x:-5,y:3},name:"Shadow Road"},{from:{x:0,y:0},to:{x:4,y:0},name:"East Road"},{from:{x:4,y:0},to:{x:4,y:-2},name:"Bright Way"},{from:{x:0,y:0},to:{x:0,y:-6},name:"South Road"},{from:{x:0,y:-6},to:{x:-2,y:-6},name:"Thorn Path"},{from:{x:-5,y:3},to:{x:-8,y:3},name:"Umbral Trail"},{from:{x:-8,y:3},to:{x:-8,y:-1},name:"Umbral Trail"},{from:{x:4,y:-2},to:{x:6,y:-2},name:"Brook Trail"},{from:{x:6,y:-2},to:{x:6,y:5},name:"Brook Trail"},{from:{x:0,y:0},to:{x:0,y:7},name:"Pilgrimage Path"},{from:{x:0,y:7},to:{x:3,y:7},name:"Pilgrimage Path"},{from:{x:-2,y:-6},to:{x:4,y:-6},name:"Merchant's Route"},{from:{x:4,y:-6},to:{x:4,y:-2},name:"Merchant's Route"}],settlements:[{x:0,y:0,type:"city",name:"Rootspire",population:12e3,faction:"The Rootspeakers",description:"The great tree-city where ancient roots form living architecture. Center of Verdance civilization.",emoji:"\ud83c\udff0",services:["Market","Inn","Temple","Guild Hall","Library"]},{x:-5,y:3,type:"town",name:"Shadowvale",population:2500,faction:"Hollowshade Clan",description:"A town built within the hollow of a massive dead tree, shrouded in perpetual twilight.",emoji:"\ud83c\udfd8\ufe0f",services:["Market","Inn","Shadow Temple"]},{x:4,y:-2,type:"town",name:"Brightmeadow",population:3200,faction:"Valebright Court",description:"A gleaming settlement of crystal greenhouses and manicured gardens.",emoji:"\ud83c\udfd8\ufe0f",services:["Market","Inn","Temple","Botanical Gardens"]},{x:-2,y:-6,type:"village",name:"Thornwall",population:450,faction:"Thornweave Syndicate",description:"A fortified trading post surrounded by massive thorn barriers.",emoji:"\ud83c\udfe1",services:["Trading Post","Armory"]},{x:6,y:5,type:"village",name:"Mistbrook",population:280,faction:"The Rootspeakers",description:"A peaceful fishing village by a spirit-touched stream.",emoji:"\ud83c\udfe1",services:["Inn","Shrine"]},{x:-8,y:-1,type:"outpost",name:"Umbral Watch",population:45,faction:"Hollowshade Clan",description:"A remote watchtower monitoring the deep shadow forests.",emoji:"\u2694\ufe0f",services:["Armory","Supplies"]},{x:3,y:7,type:"shrine",name:"Grove of First Growth",population:12,faction:"The Rootspeakers",description:"The sacred site where the first spirit plant bloomed.",emoji:"\ud83c\udf33",services:["Sacred Grove","Pilgrimage"]}],roadEncounters:[{x:-2,y:1,type:"faction",name:"Rootspeaker Patrol",description:"Friendly guards ensuring safe passage along the main roads.",emoji:"\ud83d\udee1\ufe0f",danger:"safe"},{x:2,y:-1,type:"faction",name:"Traveling Merchants",description:"A caravan of traders with goods from distant settlements.",emoji:"\ud83c\udf92",danger:"safe"},{x:-3,y:2,type:"event",name:"Road Shrine",description:"A small wayside shrine where travelers leave offerings.",emoji:"\u26e9\ufe0f",danger:"safe"},{x:1,y:-3,type:"faction",name:"Courier Station",description:"A rest stop where messages are exchanged between settlements.",emoji:"\ud83d\udceb",danger:"safe"}],wildernessEncounters:[{x:1,y:2,type:"mystery",name:"The Whispering Oak",description:"An ancient oak that speaks in riddles about the old times. Its advice is cryptic but valuable.",emoji:"\ud83c\udf32",danger:"medium"},{x:2,y:-4,type:"creature",name:"Luminous Stag",description:"A magnificent deer whose antlers glow with spirit energy. A good omen if encountered.",emoji:"\ud83e\udd8c",danger:"safe"},{x:-6,y:1,type:"mystery",name:"Shadow Hollow",description:"A clearing where shadows move independently. Hollowshade Clan secrets lie hidden here.",emoji:"\ud83d\udd73\ufe0f",danger:"high"},{x:5,y:0,type:"treasure",name:"Blooming Crystal",description:"A rare crystal formation that enhances plant growth. Valuable to all factions.",emoji:"\ud83d\udc8e",danger:"medium"},{x:0,y:-5,type:"creature",name:"Thornbeast Pack",description:"Predators covered in living vines. They guard ancient Syndicate territories.",emoji:"\ud83d\udc3a",danger:"extreme"},{x:-4,y:4,type:"event",name:"Spirit Plant Grove",description:"A grove where spirit plants pulse in harmony. Their light reveals hidden truths.",emoji:"\u2728",danger:"low"},{x:7,y:-3,type:"mystery",name:"Abandoned Greenhouse",description:"A ruined Valebright facility overgrown with wild plants. What experiments happened here?",emoji:"\ud83c\udfda\ufe0f",danger:"high"},{x:-1,y:6,type:"creature",name:"Ancient Treant",description:"An old tree-guardian that has awakened from its slumber. Unpredictable.",emoji:"\ud83c\udf33",danger:"extreme"},{x:4,y:4,type:"creature",name:"Will-o-Wisp Cluster",description:"Dancing lights that lead travelers astray... or to hidden treasures.",emoji:"\ud83d\udca1",danger:"medium"},{x:-7,y:-3,type:"creature",name:"Corrupted Dryad",description:"A nature spirit twisted by dark magic. Extremely hostile to all travelers.",emoji:"\ud83e\uddda\u200d\u2640\ufe0f",danger:"extreme"}]},j=(e,t)=>S.roads.some(n=>{const{from:r,to:a}=n;if(r.x===a.x){const n=Math.min(r.y,a.y),i=Math.max(r.y,a.y);return e===r.x&&t>=n&&t<=i}if(r.y===a.y){const n=Math.min(r.x,a.x),i=Math.max(r.x,a.x);return t===r.y&&e>=n&&e<=i}return!1}),C=(e,t)=>{const n=S.roads.find(n=>{const{from:r,to:a}=n;if(r.x===a.x){const n=Math.min(r.y,a.y),i=Math.max(r.y,a.y);return e===r.x&&t>=n&&t<=i}if(r.y===a.y){const n=Math.min(r.x,a.x),i=Math.max(r.x,a.x);return t===r.y&&e>=n&&e<=i}return!1});return n?n.name:null},M=(e,n)=>{if("Ocean"===k(e,n).name)return null;if(!new Xr("".concat(t,"-settlement-check-").concat(e,"-").concat(n,"-").concat(Math.abs(e*n))).chance(.03))return null;const r=new ea(t,e,n).generate();return{type:r.type,name:r.name,population:r.population,description:r.description,emoji:{city:"\ud83c\udff0",town:"\ud83c\udfd8\ufe0f",village:"\ud83c\udfe1",outpost:"\u26fa",trading_post:"\ud83c\udfea"}[r.type]||"\ud83c\udfd8\ufe0f",services:r.services,npcs:r.npcs}},T=(e,n)=>{if(M(e,n))return null;if("Ocean"===k(e,n).name){return new Xr("".concat(t,"-ocean-encounter-").concat(e,"-").concat(n,"-").concat(Math.abs(e+3*n))).chance(.002)?P(e,n):null}const r=new Xr("".concat(t,"-encounter-check-").concat(e,"-").concat(n,"-").concat(Math.abs(e+3*n)));return j(e,n)?r.chance(.015)?A(e,n):null:r.chance(.03)?E(e,n):null},A=(e,n)=>{const r=new Xr("".concat(t,"-road-encounter-").concat(e,"-").concat(n)),a=r.pick(["quest","mystery","creature","event"]);if("quest"===a){const r=new ta(t,e,n).generate();return{type:"quest",name:r.title,description:r.description,emoji:"\ud83d\udcdc",danger:"safe",quest:r}}if("mystery"===a){const e=["Ancient Riddle Stone","Cryptic Map Fragment","Puzzle Box","Mysterious Inscription","Locked Chest with Riddle","Weathered Treasure Map"],t=r.pick(e);return{type:"mystery",name:t,description:"You find a ".concat(t.toLowerCase(),". It seems to hold secrets, but requires wit to unlock."),emoji:"\ufffd\ufe0f",danger:"safe"}}if("creature"===a){const e=["Traveling Merchant","Lost Pilgrim","Wandering Minstrel","Road Patrol"],t=["safe","safe","safe","low"],n=r.nextInt(0,e.length);return{type:"creature",name:e[n],description:"You encounter a ".concat(e[n].toLowerCase()," on the road."),emoji:"\ud83d\udc64",danger:t[n]}}{const e=["Bridge Out","Caravan Rest","Crossroads Marker","Old Shrine"],t=r.pick(e);return{type:"event",name:t,description:"You come across: ".concat(t),emoji:"\ud83d\udee4\ufe0f",danger:"safe"}}},E=(e,n)=>{const r=new Xr("".concat(t,"-wild-encounter-").concat(e,"-").concat(n)),a=r.pick(["creature","mystery","quest"]);if("quest"===a){const a=new ta(t,e,n).generate();return{type:"quest",name:a.title,description:a.description,emoji:"\u2694\ufe0f",danger:r.pick(["medium","high","extreme"]),quest:a}}if("creature"===a){const e=["Wild Beasts","Bandits","Mysterious Figure","Ancient Guardian","Lost Spirits"],t=["medium","high","medium","extreme","high"],n=r.nextInt(0,e.length);return{type:"creature",name:e[n],description:"Dangerous encounter: ".concat(e[n]),emoji:"\ud83d\udc3a",danger:t[n]}}{const e=["Ancient Temple with Sealed Door","Ruined Observatory with Star Puzzle","Forgotten Shrine with Symbol Lock","Crystal Cave with Harmonic Puzzle","Stone Circle with Elemental Trial","Buried Vault with Riddle Guardian"],t=r.pick(e);return{type:"mystery",name:t,description:"You discover a ".concat(t.toLowerCase(),". Ancient magic protects its secrets - only the clever may claim its treasures."),emoji:"\ud83c\udfdb\ufe0f",danger:r.pick(["medium","high"])}}},P=(e,n)=>{const r=new Xr("".concat(t,"-maritime-encounter-").concat(e,"-").concat(n)),a=r.pick(["creature","mystery","event"]);if("creature"===a){const e=["Sea Serpent","Merchant Ship","Pirate Vessel","Whale Pod","Mysterious Fog"],t=["extreme","safe","high","safe","medium"],n=r.nextInt(0,e.length);return{type:"creature",name:e[n],description:"Maritime encounter: ".concat(e[n]),emoji:"\ud83d\udea2",danger:t[n]}}if("mystery"===a){const e=["Siren's Song Echo","Ancient Sea Chart Fragment","Mysterious Island Mirage","Floating Witch's Bottle","Ghostly Ship Sighting"],t=r.pick(e);return{type:"mystery",name:t,description:"A rare oceanic phenomenon: ".concat(t,". The sea holds its secrets well."),emoji:"\ud83d\udd31",danger:r.pick(["safe","low"])}}{const e=["Storm Clouds","Calm Waters","Dolphin Pod","Seabird Flock","Coral Reef"],t=r.pick(e);return{type:"event",name:t,description:"The ocean shows: ".concat(t),emoji:"\ud83c\udf0a",danger:"safe"}}},R=(e,t)=>{if(g(!1),h(null),"completed"===e&&t){let e="\u2705 Encounter completed successfully!\n\n";t.experience&&(e+="Experience gained: ".concat(t.experience," XP\n")),t.gold&&(e+="Gold found: ".concat(t.gold," coins\n")),t.items&&(e+="Items found: ".concat(t.items.join(", "),"\n")),t.special&&(e+="Special reward: ".concat(t.special,"\n")),t.buff&&(e+="Temporary effect: ".concat(t.buff,"\n")),t.questProgress&&(e+="Quest progress: ".concat(t.questProgress,"\n")),alert(e)}else"fled"===e?alert("\ud83c\udfc3 Your party fled from the encounter safely."):"failed"===e&&alert("\ud83d\udc80 The encounter ended badly for your party...")};(0,a.useEffect)(()=>{const e=e=>{let t=r.x,n=r.y;switch(e.key.toLowerCase()){case"w":case"arrowup":n-=1;break;case"s":case"arrowdown":n+=1;break;case"a":case"arrowleft":t-=1;break;case"d":case"arrowright":t+=1;break;default:return}e.preventDefault(),i({x:t,y:n});const a=Math.floor(7.5);c({x:t-a,y:n-a})};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[r,v]);const _=(()=>{const e=[];for(let t=0;t<v;t++){const n=[];for(let e=0;e<v;e++){const a=l.x+e,i=l.y+t,o=a===r.x&&i===r.y,s=k(a,i),c=M(a,i),d=c?null:T(a,i);n.push({x:a,y:i,biome:s,settlement:c,encounter:d,isPlayer:o})}e.push(n)}return e})(),N=e=>{switch(e){case"safe":return"#10b981";case"low":return"#f59e0b";case"medium":return"#f97316";case"high":return"#ef4444";case"extreme":return"#991b1b";default:return"#6b7280"}};return f&&d&&y.length>0?(0,w.jsx)(na,{encounter:d,playerCharacters:y,onEncounterEnd:R,onBack:()=>g(!1)}):(0,w.jsxs)("div",{style:{minHeight:"100vh",background:"#0f172a",color:"#f1f5f9",padding:"20px"},children:[(0,w.jsxs)("div",{style:{textAlign:"center",marginBottom:"20px"},children:[(0,w.jsx)("h1",{children:"The Verdance \u2014 Campaign Map"}),(0,w.jsxs)("p",{children:["Position: ",r.x,", ",r.y," | Current: ",k(r.x,r.y).name]}),(0,w.jsx)("p",{style:{fontSize:"14px",color:"#94a3b8"},children:"Use WASD or arrow keys to explore \u2022 Click tiles for encounters"}),(0,w.jsx)("button",{onClick:()=>i({x:0,y:0}),style:{padding:"6px 12px",background:"#1e40af",color:"#f9fafb",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"8px",marginRight:"10px",fontSize:"12px"},children:"\ud83d\udccd Return to Origin (0,0)"}),n&&(0,w.jsx)("button",{onClick:n,style:{padding:"8px 16px",background:"#059669",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer",marginTop:"10px"},children:"\u2190 Back to Menu"})]}),(0,w.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(v,", 24px)"),gap:"1px",padding:"16px",background:"#1e293b",borderRadius:"12px",margin:"0 auto",width:"fit-content"},children:_.flat().map(e=>{let{x:t,y:n,biome:r,settlement:a,encounter:i,isPlayer:l}=e;const c=(null===o||void 0===o?void 0:o.x)===t&&(null===o||void 0===o?void 0:o.y)===n,d=j(t,n);return(0,w.jsxs)("div",{onClick:()=>((e,t)=>{s({x:e,y:t});const n=M(e,t),r=n?null:T(e,t);n?(m(n),h(null)):r?(h(r),m(null)):(m(null),h(null))})(t,n),title:"".concat(r.name," (").concat(t,", ").concat(n,")").concat(l?" - You are here!":"").concat(d?" - On ".concat(C(t,n)):"").concat(a?" - ".concat(a.name):"").concat(i?" - ".concat(i.name):""),style:{width:"24px",height:"24px",background:r.color,border:c?"2px solid #fff":l?"2px solid #ffd93d":a?"2px solid #8b5cf6":i?"2px solid ".concat(N(i.danger)):d?"2px solid #D2691E":"1px solid rgba(0,0,0,0.2)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",borderRadius:"2px",position:"relative",boxShadow:l?"inset 0 0 12px rgba(255, 107, 107, 0.4)":a?"inset 0 0 8px rgba(139, 92, 246, 0.3)":i?"inset 0 0 8px ".concat(N(i.danger),"40"):d?"inset 0 0 6px rgba(210, 105, 30, 0.3)":"none"},children:[l?"\ud83d\udc64":a?a.emoji:i?i.emoji:r.emoji," "]},"".concat(t,",").concat(n))})}),p&&(0,w.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",padding:"16px",background:"#1e293b",borderRadius:"12px",maxWidth:"500px",margin:"20px auto"},children:[(0,w.jsxs)("h3",{style:{margin:"0 0 10px 0",color:"#8b5cf6"},children:[p.emoji," ",p.name]}),(0,w.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px",color:"#94a3b8"},children:[p.type.charAt(0).toUpperCase()+p.type.slice(1)," \u2022 Population: ",p.population.toLocaleString()]}),(0,w.jsx)("p",{style:{margin:"10px 0",color:"#d1d5db"},children:p.description}),(0,w.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px"},children:[(0,w.jsx)("strong",{children:"Controlled by:"})," ",p.faction]}),p.services&&p.services.length>0&&(0,w.jsxs)("div",{style:{marginTop:"10px"},children:[(0,w.jsx)("p",{style:{fontSize:"14px",margin:"5px 0"},children:(0,w.jsx)("strong",{children:"Services:"})}),(0,w.jsx)("div",{style:{display:"flex",justifyContent:"center",gap:"8px",flexWrap:"wrap"},children:p.services.map(e=>(0,w.jsx)("span",{style:{background:"#374151",padding:"2px 8px",borderRadius:"4px",fontSize:"12px"},children:e},e))})]}),(0,w.jsxs)("div",{style:{marginTop:"15px",display:"flex",gap:"10px",justifyContent:"center"},children:[(0,w.jsx)("button",{onClick:()=>alert("Entering ".concat(p.name,"... (Campaign features coming soon!)")),style:{padding:"8px 16px",background:"#8b5cf6",color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Enter Settlement"}),(0,w.jsx)("button",{onClick:()=>{i({x:o.x,y:o.y});const e=Math.floor(7.5);c({x:o.x-e,y:o.y-e})},style:{padding:"6px 12px",background:"#374151",color:"#9ca3af",border:"1px solid #6b7280",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},title:"Developer tool - breaks immersion",children:"[DEV] Fast Travel"})]})]}),d&&(0,w.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",padding:"16px",background:"#1e293b",borderRadius:"12px",maxWidth:"500px",margin:"20px auto",border:"2px solid ".concat(N(d.danger))},children:[(0,w.jsxs)("h3",{style:{margin:"0 0 10px 0",color:N(d.danger)},children:[d.emoji," ",d.name]}),(0,w.jsxs)("p",{style:{margin:"5px 0",fontSize:"14px",color:"#94a3b8"},children:[d.type.charAt(0).toUpperCase()+d.type.slice(1)," \u2022 Danger: ",(0,w.jsx)("span",{style:{color:N(d.danger)},children:d.danger.charAt(0).toUpperCase()+d.danger.slice(1)})]}),(0,w.jsx)("p",{style:{margin:"10px 0",color:"#d1d5db"},children:d.description}),(0,w.jsxs)("div",{style:{marginTop:"15px",display:"flex",gap:"10px",justifyContent:"center"},children:[(0,w.jsx)("button",{onClick:()=>(h(d),void g(!0)),style:{padding:"8px 16px",background:N(d.danger),color:"#f9fafb",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Investigate"}),(0,w.jsx)("button",{onClick:()=>{i({x:o.x,y:o.y});const e=Math.floor(7.5);c({x:o.x-e,y:o.y-e})},style:{padding:"6px 12px",background:"#374151",color:"#9ca3af",border:"1px solid #6b7280",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},title:"Developer tool - breaks immersion",children:"[DEV] Fast Travel"})]})]}),o&&!p&&!d&&(0,w.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",padding:"16px",background:"#1e293b",borderRadius:"12px",maxWidth:"400px",margin:"20px auto"},children:[(0,w.jsx)("h3",{style:{margin:"0 0 10px 0"},children:"Selected Location"}),(0,w.jsxs)("p",{children:["Biome: ",k(o.x,o.y).name," ",k(o.x,o.y).emoji]}),(0,w.jsxs)("p",{children:["Coordinates: ",o.x,", ",o.y]}),(0,w.jsx)("button",{onClick:()=>{i(o);const e=Math.floor(7.5);c({x:o.x-e,y:o.y-e})},style:{padding:"6px 12px",background:"#374151",color:"#9ca3af",border:"1px solid #6b7280",borderRadius:"4px",cursor:"pointer",fontSize:"12px"},title:"Developer tool - use WASD to explore naturally",children:"[DEV] Fast Travel Here"})]}),(0,w.jsxs)("div",{style:{textAlign:"center",marginTop:"30px",fontSize:"14px",color:"#94a3b8"},children:[(0,w.jsx)("p",{children:"\ud83c\udff0 Purple borders = Settlements \u2022 \ud83c\udfb2 Colored borders = Encounters \u2022 \ufffd Orange borders = Roads"}),(0,w.jsxs)("p",{children:["\ud83d\udee1\ufe0f ",(0,w.jsx)("strong",{children:"Stay on roads for safety"})," - scripted encounters, friendly patrols"]}),(0,w.jsxs)("p",{children:["\u2694\ufe0f ",(0,w.jsx)("strong",{children:"Venture into wilderness"})," - dangerous creatures, valuable treasures"]}),(0,w.jsx)("p",{children:"The spirit plants of Verdance pulse with life across this realm. Choose your path wisely."}),(0,w.jsxs)("p",{style:{fontSize:"12px",marginTop:"10px"},children:["Seed: ",t]})]})]})}function ia(e){let{tile:t,x:n,y:r,size:a,isExplored:i}=e;if(!i)return(0,w.jsx)("div",{style:{position:"absolute",left:n*a,top:r*a,width:a,height:a,backgroundColor:"#1e293b",border:"1px solid #374151"}});const o={grass:"#16a34a",forest:"#065f46",water:"#0ea5e9",mountain:"#78716c",desert:"#eab308",snow:"#f8fafc",swamp:"#365314",road:"#a3a3a3",town:"#dc2626",dungeon:"#7c2d12",ruins:"#6b7280",cave:"#44403c",bridge:"#8b5cf6"}[t.type]||"#4b5563";return(0,w.jsxs)("div",{style:{position:"absolute",left:n*a,top:r*a,width:a,height:a,backgroundColor:o,border:"1px solid rgba(0, 0, 0, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"white",textShadow:"1px 1px 2px rgba(0, 0, 0, 0.8)"},title:"".concat(t.type," (").concat(n,", ").concat(r,")"),children:[t.features&&t.features.length>0&&(0,w.jsx)("span",{style:{fontSize:"10px"},children:t.features[0].charAt(0).toUpperCase()}),t.structure&&(0,w.jsx)("span",{style:{fontSize:"14px",fontWeight:"bold"},children:"settlement"===t.structure?"\ud83c\udfd8\ufe0f":"dungeon"===t.structure?"\ud83c\udff0":"ruins"===t.structure?"\ud83c\udfdb\ufe0f":"\u2b50"})]})}function oa(e){let{engine:t,showGrid:n,width:r,height:a,canvasRef:i}=e;const o=24,s=Math.floor(r/o),l=Math.floor(a/o),c=t.state.party.x,d=t.state.party.y,u=Math.floor(c-s/2),h=Math.floor(d-l/2),p=u+s,m=h+l,f=[];for(let x=h;x<m;x++)for(let e=u;e<p;e++){const n=t.getTile(e,x),r=t.isDiscovered(e,x);f.push((0,w.jsx)(ia,{tile:n,x:e-u,y:x-h,size:o,isExplored:r},"".concat(e,",").concat(x)))}const g=Math.floor(s/2),y=Math.floor(l/2);return(0,w.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:"#0f172a"},children:[i&&(0,w.jsx)("canvas",{ref:i,width:r,height:a,style:{position:"absolute",top:0,left:0,pointerEvents:"none",zIndex:1}}),(0,w.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:f}),n&&(0,w.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundImage:"\n            linear-gradient(to right, rgba(255, 255, 255, 0.1) 1px, transparent 1px),\n            linear-gradient(to bottom, rgba(255, 255, 255, 0.1) 1px, transparent 1px)\n          ",backgroundSize:"".concat(o,"px ").concat(o,"px"),pointerEvents:"none",zIndex:3}}),(0,w.jsx)("div",{style:{position:"absolute",left:g*o+12-8,top:y*o+12-8,width:16,height:16,backgroundColor:"#3b82f6",borderRadius:"50%",border:"2px solid white",zIndex:10,boxShadow:"0 0 8px rgba(59, 130, 246, 0.8)",animation:"pulse 2s infinite"}}),"Clear"!==t.state.weather.type&&(0,w.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:(()=>{const e=t.state.weather.intensity;switch(t.state.weather.type){case"Rain":return"linear-gradient(45deg, transparent 30%, rgba(59, 130, 246, ".concat(.3*e,") 50%, transparent 70%)");case"Storm":return"linear-gradient(45deg, transparent 20%, rgba(59, 130, 246, ".concat(.5*e,") 40%, transparent 60%)");case"Snow":return"radial-gradient(circle, rgba(248, 250, 252, ".concat(.4*e,") 2px, transparent 3px)");case"Fog":return"rgba(156, 163, 175, ".concat(.6*e,")");case"Wind":return"linear-gradient(30deg, transparent 40%, rgba(234, 179, 8, ".concat(.2*e,") 60%, transparent 80%)");default:return"none"}})(),backgroundSize:"Snow"===t.state.weather.type?"20px 20px":"100% 100%",pointerEvents:"none",zIndex:5,animation:"Rain"===t.state.weather.type||"Storm"===t.state.weather.type?"rainFall 0.5s linear infinite":"Snow"===t.state.weather.type?"snowFall 3s linear infinite":"none"}}),(0,w.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:(()=>{const e=Math.floor(t.state.time.minutes/60)%24;return e>=6&&e<18?"rgba(255, 255, 255, 0.1)":e>=18&&e<20||e>=5&&e<7?"rgba(234, 179, 8, 0.2)":"rgba(15, 23, 42, 0.6)"})(),pointerEvents:"none",zIndex:6}}),(0,w.jsx)("style",{children:"\n        @keyframes pulse {\n          0%, 100% { \n            box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);\n          }\n          50% { \n            box-shadow: 0 0 16px rgba(59, 130, 246, 1);\n          }\n        }\n        \n        @keyframes rainFall {\n          0% { background-position: 0% 0%; }\n          100% { background-position: 100% 100%; }\n        }\n        \n        @keyframes snowFall {\n          0% { background-position: 0% 0%; }\n          100% { background-position: 20px 20px; }\n        }\n      "})]})}function sa(e){let{seedStr:t="world-001",onBack:n}=e;const r=(0,a.useCallback)(e=>({chunks:e.chunks,discovered:e.discovered,timeOfDay:"number"===typeof e.timeOfDay?e.timeOfDay<.25?"Night":e.timeOfDay<.5?"Morning":e.timeOfDay<.75?"Day":"Evening":e.timeOfDay,gameTime:e.gameTime}),[]),[o]=(0,a.useState)(()=>(console.log("\ud83d\ude80 Creating WorldEngine with seed:",t),new ae(t))),[,s]=a.useReducer(e=>e+1,0),[l,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!0),[h,p]=(0,a.useState)(()=>r(o.getStats())),[m,f]=(0,a.useState)(!1),[g,y]=(0,a.useState)(!1),[x,v]=(0,a.useState)(!1),[b,k]=(0,a.useState)(!1),[S,j]=(0,a.useState)({width:800,height:600});(0,a.useEffect)(()=>{const e=setInterval(()=>{p(r(o.getStats()))},1e3);return()=>clearInterval(e)},[o,r]),(0,a.useEffect)(()=>{o.wasLoadedFromSave()&&(console.log("Engine was loaded from save, updating React state..."),p(r(o.getStats())),s())},[o,r]),(0,a.useEffect)(()=>{o.getActiveEncounter()&&!g&&y(!0)},[o,g]),(0,a.useEffect)(()=>{const e=()=>{const e=document.querySelector(".world-container");e&&j({width:e.clientWidth,height:e.clientHeight})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const C=(0,a.useCallback)((e,t)=>{o.tickTravel(e,t)&&p(r(o.getStats()))},[o,r]),M=(0,a.useCallback)(e=>{o.rest(e),p(r(o.getStats())),console.log("\ud83d\udca4 Rested ".concat(e,"h. HP: ").concat(o.state.party.hitPoints,"/").concat(o.state.party.maxHitPoints))},[o,r]);(0,a.useEffect)(()=>{const e=e=>{if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement||m||g||x||b))switch(e.key.toLowerCase()){case"w":case"arrowup":e.preventDefault(),C(0,-1);break;case"s":case"arrowdown":e.preventDefault(),C(0,1);break;case"a":case"arrowleft":e.preventDefault(),C(-1,0);break;case"d":case"arrowright":e.preventDefault(),C(1,0);break;case"q":e.preventDefault(),C(-1,-1);break;case"e":e.preventDefault(),C(1,-1);break;case"z":e.preventDefault(),C(-1,1);break;case"c":e.preventDefault(),C(1,1);break;case"r":e.preventDefault(),M(e.shiftKey?8:1);break;case"m":e.preventDefault(),f(!m);break;case"i":case"tab":e.preventDefault(),v(!x);break;case"g":e.preventDefault(),c(!l);break;case"l":e.preventDefault(),u(!d);break;case"escape":e.preventDefault(),m?f(!1):g?y(!1):x?v(!1):b&&k(!1)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[C,M,m,g,x,b,l,d]);const T=(0,a.useCallback)(e=>{if(!o.getActiveEncounter())return;let t=!0;switch(e){case"fight":t=i.Sh.next()>.3;break;case"flee":t=i.Sh.next()>.2;break;case"negotiate":t=i.Sh.next()>.4;break;case"explore":t=!0}o.completeEncounter(t),y(!1),p(r(o.getStats())),console.log("\ud83c\udfad Encounter: ".concat(e," -> ").concat(t?"Success!":"Failed!"))},[o,r]),A=(0,a.useCallback)(e=>{Object.keys(e).length>0&&(o.updateWorldConfig(e),p(r(o.getStats())),console.log("\ud83c\udf0d World config updated"))},[o,r]);return console.log("\ud83c\udfae Rendering WorldMapEngine with modular components"),(0,w.jsxs)("div",{style:{width:"100vw",height:"100vh",position:"relative",backgroundColor:"#0f172a",overflow:"hidden",fontFamily:"monospace"},children:[(0,w.jsx)("div",{className:"world-container",style:{width:"100%",height:"100%",position:"relative"},children:(0,w.jsx)(oa,{engine:o,showGrid:l,width:S.width,height:S.height})}),(0,w.jsx)(V,{engine:o,stats:h,onBack:n,cameraLocked:d,onCenterParty:()=>console.log("\ud83c\udfaf Center camera on party")}),(0,w.jsx)(W,{engine:o,isVisible:m,onClose:()=>f(!1),showGrid:l,onToggleGrid:()=>c(!l),cameraLocked:d,onToggleCameraLock:()=>u(!d),onRefresh:()=>{s(),p(r(o.getStats()))},stats:h}),(0,w.jsx)(Y,{engine:o,showWorldGenModal:b,onCloseWorldGenModal:()=>k(!1),onWorldGenSubmit:A,showEncounterModal:g,onCloseEncounterModal:()=>{o.dismissEncounter(),y(!1)},onEncounterAction:T,showCharacterModal:x,onCloseCharacterModal:()=>v(!1)}),(0,w.jsxs)("div",{style:{position:"absolute",bottom:"20px",left:"20px",backgroundColor:"rgba(0, 0, 0, 0.8)",color:"#e2e8f0",padding:"12px",borderRadius:"6px",fontSize:"11px",lineHeight:"1.4",maxWidth:"300px",border:"1px solid rgba(75, 85, 99, 0.5)"},children:[(0,w.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px",color:"#3b82f6"},children:"\ud83c\udfae Controls"}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Move:"})," WASD / Arrow Keys"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Rest:"})," R (1hr) / Shift+R (8hr)"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Menu:"})," M \u2022 ",(0,w.jsx)("strong",{children:"Character:"})," I/Tab"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Grid:"})," G \u2022 ",(0,w.jsx)("strong",{children:"Camera:"})," L"]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("strong",{children:"Close:"})," ESC"]})]}),!1]})}var la=n(27);n(32),n(986);const ca={maxChunks:100,maxMemoryMB:50,persistToDisk:!0,trackStats:!0};class da{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.chunkId=e,this.chunk=t,this.prev=n,this.next=r}}class ua{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=void 0,this.cache=new Map,this.head=null,this.tail=null,this.stats={hits:0,misses:0,generations:0,evictions:0,totalMemoryBytes:0,averageGenerationTime:0},this.totalGenerationTime=0,this.config=(0,r.A)((0,r.A)({},ca),e),this.loadPersistedChunks()}get(e){const t=this.chunkKey(e),n=this.cache.get(t);return n?(this.moveToFront(n),this.config.trackStats&&this.stats.hits++,n.chunk):(this.config.trackStats&&this.stats.misses++,null)}set(e){const t=this.chunkKey(e.id),n=this.cache.get(t);if(n)n.chunk=e,this.moveToFront(n);else{const n=new da(e.id,e);this.cache.set(t,n),this.addToFront(n),this.config.trackStats&&(this.stats.generations++,this.totalGenerationTime+=e.meta.lastGenTime,this.stats.averageGenerationTime=this.totalGenerationTime/this.stats.generations),this.enforceCapacity()}this.updateMemoryStats(),this.config.persistToDisk&&this.persistChunk(e)}has(e){return this.cache.has(this.chunkKey(e))}delete(e){const t=this.chunkKey(e),n=this.cache.get(t);return!!n&&(this.removeNode(n),this.cache.delete(t),this.updateMemoryStats(),this.config.persistToDisk&&this.deletePersistedChunk(e),!0)}clear(){this.cache.clear(),this.head=null,this.tail=null,this.stats.totalMemoryBytes=0,this.config.persistToDisk&&this.clearPersistedChunks()}getStats(){return(0,r.A)({},this.stats)}getHitRatio(){const e=this.stats.hits+this.stats.misses;return e>0?this.stats.hits/e:0}getCachedChunkIds(){return Array.from(this.cache.keys()).map(e=>this.parseChunkKey(e))}evictLRU(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[];for(let n=0;n<e&&this.tail;n++){const e=(0,r.A)({},this.tail.chunkId);this.delete(e),t.push(e),this.config.trackStats&&this.stats.evictions++}return t}preloadAround(e,t){const n=[];for(let r=-t;r<=t;r++)for(let a=-t;a<=t;a++){const t={cx:e.cx+r,cy:e.cy+a};this.has(t)||n.push(Promise.resolve())}return Promise.all(n).then(()=>{})}chunkKey(e){return"".concat(e.cx,",").concat(e.cy)}parseChunkKey(e){const[t,n]=e.split(",").map(Number);return{cx:t,cy:n}}moveToFront(e){e!==this.head&&(this.removeNode(e),this.addToFront(e))}addToFront(e){e.next=this.head,e.prev=null,this.head&&(this.head.prev=e),this.head=e,this.tail||(this.tail=e)}removeNode(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}enforceCapacity(){for(;this.cache.size>this.config.maxChunks;)this.evictLRU(1);const e=1024*this.config.maxMemoryMB*1024;for(;this.stats.totalMemoryBytes>e&&this.tail;)this.evictLRU(1)}updateMemoryStats(){if(!this.config.trackStats)return;let e=0;this.cache.forEach(t=>{const n=t.chunk;e+=n.tiles.byteLength,e+=n.biomes.byteLength,e+=2*JSON.stringify(n.meta).length,e+=200}),this.stats.totalMemoryBytes=e}persistChunk(e){try{const t="world_chunk_".concat(this.chunkKey(e.id)),n={id:e.id,tiles:Array.from(e.tiles),biomes:Array.from(e.biomes),width:e.width,height:e.height,meta:e.meta,hash:e.hash,version:1};localStorage.setItem(t,JSON.stringify(n))}catch(t){console.warn("\ud83d\uddc2\ufe0f Failed to persist chunk:",t)}}loadPersistedChunks(){if(this.config.persistToDisk)try{const t=Object.keys(localStorage).filter(e=>e.startsWith("world_chunk_"));for(const n of t)try{const e=JSON.parse(localStorage.getItem(n)||"{}");if(1===e.version){const t={id:e.id,tiles:new Uint8Array(e.tiles),biomes:new Uint8Array(e.biomes),width:e.width,height:e.height,meta:e.meta,generated:!0,hash:e.hash},n=new da(t.id,t);this.cache.set(this.chunkKey(t.id),n),this.addToFront(n)}}catch(e){console.warn("\ud83d\uddc2\ufe0f Failed to load persisted chunk:",n,e),localStorage.removeItem(n)}console.log("\ud83d\uddc2\ufe0f Loaded ".concat(this.cache.size," persisted chunks"))}catch(e){console.warn("\ud83d\uddc2\ufe0f Failed to load persisted chunks:",e)}}deletePersistedChunk(e){const t="world_chunk_".concat(this.chunkKey(e));localStorage.removeItem(t)}clearPersistedChunks(){const e=Object.keys(localStorage).filter(e=>e.startsWith("world_chunk_"));e.forEach(e=>localStorage.removeItem(e))}}const ha=new ua;var pa=n(571);const ma={small:{id:"small",name:"small",displayName:"\ud83c\udfe0 Small World",description:"Perfect for laptops and older PCs. Limited exploration area with aggressive memory management.",maxChunks:25,maxCachedChunks:16,maxMemoryMB:15,worldBounds:{minChunkX:-2,maxChunkX:2,minChunkY:-2,maxChunkY:2},chunkSize:32,streamRadius:1,preloadRadius:0,generateAsync:!1,fogEnabled:!0,fogDecayRate:.1,revealRadius:8,aggressiveCleanup:!0,cleanupInterval:30},medium:{id:"medium",name:"medium",displayName:"\ud83c\udff0 Medium World",description:"Good balance for most gaming PCs. Substantial exploration with smart memory limits.",maxChunks:100,maxCachedChunks:49,maxMemoryMB:30,worldBounds:{minChunkX:-5,maxChunkX:4,minChunkY:-5,maxChunkY:4},chunkSize:48,streamRadius:2,preloadRadius:1,generateAsync:!0,fogEnabled:!0,fogDecayRate:.05,revealRadius:12,aggressiveCleanup:!1,cleanupInterval:60},large:{id:"large",name:"large",displayName:"\ud83c\udf0d Large World",description:"Extensive exploration for powerful PCs. Large memory usage but rich content.",maxChunks:400,maxCachedChunks:100,maxMemoryMB:50,worldBounds:{minChunkX:-10,maxChunkX:9,minChunkY:-10,maxChunkY:9},chunkSize:64,streamRadius:3,preloadRadius:2,generateAsync:!0,fogEnabled:!0,fogDecayRate:.02,revealRadius:16,aggressiveCleanup:!1,cleanupInterval:120},extraLarge:{id:"extraLarge",name:"extraLarge",displayName:"\ud83d\uddfa\ufe0f Extra Large World",description:"Massive exploration for high-end gaming rigs. Requires 8GB+ RAM and dedicated GPU.",maxChunks:1600,maxCachedChunks:225,maxMemoryMB:100,worldBounds:{minChunkX:-20,maxChunkX:19,minChunkY:-20,maxChunkY:19},chunkSize:64,streamRadius:4,preloadRadius:3,generateAsync:!0,fogEnabled:!0,fogDecayRate:.01,revealRadius:20,aggressiveCleanup:!1,cleanupInterval:300},extremelyLarge:{id:"extremelyLarge",name:"extremelyLarge",displayName:"\ud83c\udf0c Extremely Large World",description:"For enthusiasts with workstation-class hardware. 16GB+ RAM recommended.",maxChunks:6400,maxCachedChunks:400,maxMemoryMB:200,worldBounds:{minChunkX:-40,maxChunkX:39,minChunkY:-40,maxChunkY:39},chunkSize:64,streamRadius:5,preloadRadius:4,generateAsync:!0,fogEnabled:!1,fogDecayRate:.005,revealRadius:24,aggressiveCleanup:!1,cleanupInterval:600},infinite:{id:"infinite",name:"infinite",displayName:"\u267e\ufe0f Infinite World",description:"Unlimited exploration for the brave. No size limits - explore until your system says no!",maxChunks:1/0,maxCachedChunks:500,maxMemoryMB:300,worldBounds:void 0,chunkSize:64,streamRadius:3,preloadRadius:1,generateAsync:!0,fogEnabled:!1,fogDecayRate:.001,revealRadius:16,aggressiveCleanup:!0,cleanupInterval:60}};function fa(e){return ma[e]||ma.medium}const ga={globalSeed:12345,chunkSize:64,streamRadius:2,preloadRadius:1,generateAsync:!0,worldSizeId:"medium"};class ya{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;this.config=void 0,this.worldSizeConfig=void 0,this.cache=void 0,this.playerPos=void 0,this.loadedChunks=new Set,this.generationQueue=[],this.isGenerating=!1,this.rng=void 0,this.regionalData={politicalControl:new Map,roads:{segments:[],connections:new Map},tradePosts:[],conflicts:[]},this.config=(0,r.A)((0,r.A)({},ga),e);const n="undefined"!==typeof jest||!1?"infinite":"medium";this.worldSizeConfig=fa(this.config.worldSizeId||n),this.applyWorldSizeSettings(),this.cache=t||ha,this.rng=(0,pa.sW)(this.config.globalSeed),this.playerPos=this.calculatePlayerPosition(0,0),console.log("\ud83d\uddfa\ufe0f World Manager initialized:",{seed:this.config.globalSeed,chunkSize:this.config.chunkSize,worldSize:this.worldSizeConfig.displayName,bounds:this.getEffectiveWorldBounds(),initialPosition:this.playerPos})}applyWorldSizeSettings(){this.config.chunkSize&&this.config.chunkSize!==ga.chunkSize||(this.config.chunkSize=this.worldSizeConfig.chunkSize),this.config.streamRadius&&this.config.streamRadius!==ga.streamRadius||(this.config.streamRadius=this.worldSizeConfig.streamRadius),this.config.preloadRadius&&this.config.preloadRadius!==ga.preloadRadius||(this.config.preloadRadius=this.worldSizeConfig.preloadRadius),void 0===this.config.generateAsync&&(this.config.generateAsync=this.worldSizeConfig.generateAsync),this.cache=new ua({maxChunks:this.worldSizeConfig.maxCachedChunks,maxMemoryMB:this.worldSizeConfig.maxMemoryMB,persistToDisk:!0,trackStats:!0})}getEffectiveWorldBounds(){return this.config.worldBounds?this.config.worldBounds:this.worldSizeConfig.worldBounds||null}isChunkInBounds(e){const t=this.getEffectiveWorldBounds();return!t||e.cx>=t.minChunkX&&e.cx<=t.maxChunkX&&e.cy>=t.minChunkY&&e.cy<=t.maxChunkY}async updatePlayerPosition(e,t){const n=this.playerPos.chunkId;this.playerPos=this.calculatePlayerPosition(e,t),this.playerPos.chunkId.cx===n.cx&&this.playerPos.chunkId.cy===n.cy||(console.log("\ud83d\udeb6 Player moved to new chunk:",this.playerPos.chunkId),await this.updateChunkStreaming())}async getChunk(e){if(!this.isChunkInBounds(e))throw new Error("Chunk ".concat(e.cx,",").concat(e.cy," is outside world bounds"));let t=this.cache.get(e);if(t)return t;if(this.loadedChunks.size>=this.worldSizeConfig.maxChunks){console.warn("\ud83d\udeab World size limit reached. Cleaning up distant chunks...");this.cleanupDistantChunks();if(this.loadedChunks.size>=this.worldSizeConfig.maxChunks)throw new Error("World size limit reached (".concat(this.worldSizeConfig.maxChunks," chunks). Cannot generate more chunks."))}return console.log("\ud83c\udfd7\ufe0f Generating chunk:",e),t=(0,la.zs)(this.config.globalSeed,e,{chunkSize:this.config.chunkSize}),this.cache.set(t),this.loadedChunks.add(this.chunkKey(e)),t}async getChunksInRegion(e,t,n,r){const a=[];for(let i=e;i<=n;i++)for(let e=t;e<=r;e++){const t=await this.getChunk({cx:i,cy:e});a.push(t)}return a}async sampleForBattle(e,t,r,a){const{chunkId:i,localX:o,localY:s}=(0,la.Pe)(e,t,this.config.chunkSize),l=await this.getChunk(i);if(o+r>this.config.chunkSize||s+a>this.config.chunkSize)return this.sampleMultiChunk(e,t,r,a);const{sampleChunkArea:c}=await Promise.resolve().then(n.bind(n,27));return c(l,o,s,r,a)}getPlayerPosition(){return(0,r.A)({},this.playerPos)}getConfig(){return(0,r.A)({},this.config)}getWorldSizeConfig(){return this.worldSizeConfig}getWorldBounds(){return this.getEffectiveWorldBounds()}getWorldSizeStats(){const e=this.getEffectiveWorldBounds(),t=this.cache.getStats();return{currentChunks:this.loadedChunks.size,maxChunks:this.worldSizeConfig.maxChunks,memoryUsage:t.totalMemoryBytes/1048576,maxMemory:this.worldSizeConfig.maxMemoryMB,boundsInfo:e?"".concat(e.maxChunkX-e.minChunkX+1,"\xd7").concat(e.maxChunkY-e.minChunkY+1," chunks"):"Infinite",utilizationPercent:this.worldSizeConfig.maxChunks===1/0?0:this.loadedChunks.size/this.worldSizeConfig.maxChunks*100}}getCacheStats(){return this.cache.getStats()}getLoadedChunkCount(){return this.loadedChunks.size}cleanupDistantChunks(){const e=this.config.streamRadius+1,t=[];return this.loadedChunks.forEach(n=>{const r=this.parseChunkKey(n);Math.max(Math.abs(r.cx-this.playerPos.chunkId.cx),Math.abs(r.cy-this.playerPos.chunkId.cy))>e&&t.push(n)}),t.forEach(e=>{const t=this.parseChunkKey(e);this.cache.delete(t),this.loadedChunks.delete(e)}),t.length>0&&console.log("\ud83e\uddf9 Cleaned up ".concat(t.length," distant chunks")),t.length}getRegionalData(){return this.regionalData}setChunkControl(e,t){this.regionalData.politicalControl.set(this.chunkKey(e),t)}async findNearestPOI(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;const r=(0,la.Pe)(e,t,this.config.chunkSize);for(let a=0;a<=n;a++)for(let n=-a;n<=a;n++)for(let i=-a;i<=a;i++){if(Math.abs(n)!==a&&Math.abs(i)!==a)continue;const o={cx:r.chunkId.cx+n,cy:r.chunkId.cy+i},s=await this.getChunk(o);if(s.meta.pois.length>0){const n=s.meta.pois.reduce((n,r)=>{const a=(0,la.f$)(o,r.x,r.y,this.config.chunkSize),i=Math.sqrt(Math.pow(a.x-e,2)+Math.pow(a.y-t,2));return!n||i<n.distance?{poi:r,distance:i,chunkId:o}:n},null);if(n)return n}}return null}calculatePlayerPosition(e,t){const{chunkId:n,localX:r,localY:a}=(0,la.Pe)(e,t,this.config.chunkSize);return{worldX:e,worldY:t,chunkId:n,localX:r,localY:a}}async updateChunkStreaming(){const e=[];for(let t=-this.config.streamRadius;t<=this.config.streamRadius;t++)for(let n=-this.config.streamRadius;n<=this.config.streamRadius;n++){const r={cx:this.playerPos.chunkId.cx+t,cy:this.playerPos.chunkId.cy+n};this.cache.has(r)||(this.config.generateAsync?this.generationQueue.push(r):e.push(this.getChunk(r).then(()=>{})))}e.length>0&&await Promise.all(e),this.config.generateAsync&&!this.isGenerating&&this.processGenerationQueue(),this.cleanupDistantChunks()}async processGenerationQueue(){if(0!==this.generationQueue.length){this.isGenerating=!0;try{for(;this.generationQueue.length>0;){const e=this.generationQueue.shift();Math.max(Math.abs(e.cx-this.playerPos.chunkId.cx),Math.abs(e.cy-this.playerPos.chunkId.cy))<=this.config.streamRadius&&await this.getChunk(e),this.generationQueue.length%5===0&&await new Promise(e=>setTimeout(e,0))}}finally{this.isGenerating=!1}}}async sampleMultiChunk(e,t,r,a){const i=[],o=[];for(let s=0;s<a;s++){const a=[],l=[];for(let i=0;i<r;i++){const r=e+i,o=t+s,{chunkId:c,localX:d,localY:u}=(0,la.Pe)(r,o,this.config.chunkSize),h=await this.getChunk(c),{getChunkTile:p,getChunkBiome:m}=await Promise.resolve().then(n.bind(n,27));a.push(p(h,d,u)||"water"),l.push(m(h,d,u)||"deep_ocean")}i.push(a),o.push(l)}return{tiles:i,biomes:o}}chunkKey(e){return"".concat(e.cx,",").concat(e.cy)}parseChunkKey(e){const[t,n]=e.split(",").map(Number);return{cx:t,cy:n}}}let xa;const va={water:"#1e40af",shallows:"#3b82f6",sand:"#fbbf24",grass:"#10b981",forest:"#065f46",rock:"#6b7280",snow:"#f3f4f6",swamp:"#059669",desert:"#f59e0b",tundra:"#e5e7eb",road:"#8b5cf6",town:"#dc2626",ruin:"#7c2d12",shrine:"#fbbf24",mine:"#374151",crystal:"#c084fc"};const ba=function(e){let{className:t=""}=e;const[n,r]=(0,a.useState)(12345),[i,o]=(0,a.useState)(0),[s,l]=(0,a.useState)(0),[c,d]=(0,a.useState)(null),[u,h]=(0,a.useState)(!1),[p,m]=(0,a.useState)(null),[f,g]=(0,a.useState)(null),y=(0,a.useRef)(null);(0,a.useEffect)(()=>{const e=(xa=new ya({globalSeed:n,chunkSize:32}),xa);g(e)},[n]),(0,a.useEffect)(()=>{f&&x()},[f,i,s]),(0,a.useEffect)(()=>{c&&y.current&&v()},[c]);const x=async()=>{if(f){h(!0);try{const e={cx:i,cy:s},t=await f.getChunk(e);d(t)}catch(e){console.error("\ud83d\uddfa\ufe0f Failed to generate chunk:",e)}finally{h(!1)}}},v=()=>{if(!c||!y.current)return;const e=y.current,t=e.getContext("2d");if(!t)return;const n=c.width,r=Math.floor(256/n);e.width=n*r,e.height=n*r,t.fillStyle="#000000",t.fillRect(0,0,e.width,e.height);for(let a=0;a<n;a++)for(let e=0;e<n;e++){const n=(0,la.getChunkTile)(c,e,a),i=va[n||"water"]||"#000000";t.fillStyle=i,t.fillRect(e*r,a*r,r,r)}t.fillStyle="#ff0000",c.meta.pois.forEach(e=>{const n=e.x*r+r/2,a=e.y*r+r/2;t.beginPath(),t.arc(n,a,3,0,2*Math.PI),t.fill()}),t.strokeStyle="#0066cc",t.lineWidth=2,c.meta.rivers.forEach(e=>{const n=e.x*r+r/2,a=e.y*r+r/2;t.beginPath(),t.arc(n,a,2*e.width,0,2*Math.PI),t.stroke()})},b=(e,t)=>{o(t=>t+e),l(e=>e+t)};return(0,w.jsx)("div",{className:"procedural-dev-tools ".concat(t),children:(0,w.jsxs)("div",{style:{display:"flex",gap:"20px",padding:"20px"},children:[(0,w.jsxs)("div",{style:{flex:"0 0 300px"},children:[(0,w.jsx)("h3",{children:"\ud83d\uddfa\ufe0f Procedural Generation DevTools"}),(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{children:"World Settings"}),(0,w.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,w.jsx)("label",{children:"Global Seed: "}),(0,w.jsx)("input",{type:"number",value:n,onChange:e=>r(Number(e.target.value)),style:{width:"100px"}}),(0,w.jsx)("button",{onClick:()=>{r(Math.floor(1e6*Math.random()))},style:{marginLeft:"10px"},children:"\ud83c\udfb2 Random"})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{children:"Chunk Navigation"}),(0,w.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,w.jsx)("label",{children:"Chunk X: "}),(0,w.jsx)("input",{type:"number",value:i,onChange:e=>o(Number(e.target.value)),style:{width:"80px"}})]}),(0,w.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,w.jsx)("label",{children:"Chunk Y: "}),(0,w.jsx)("input",{type:"number",value:s,onChange:e=>l(Number(e.target.value)),style:{width:"80px"}})]}),(0,w.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"5px",maxWidth:"150px"},children:[(0,w.jsx)("button",{onClick:()=>b(-1,-1),children:"\u2196"}),(0,w.jsx)("button",{onClick:()=>b(0,-1),children:"\u2191"}),(0,w.jsx)("button",{onClick:()=>b(1,-1),children:"\u2197"}),(0,w.jsx)("button",{onClick:()=>b(-1,0),children:"\u2190"}),(0,w.jsx)("button",{onClick:()=>b(0,0),children:"\u2299"}),(0,w.jsx)("button",{onClick:()=>b(1,0),children:"\u2192"}),(0,w.jsx)("button",{onClick:()=>b(-1,1),children:"\u2199"}),(0,w.jsx)("button",{onClick:()=>b(0,1),children:"\u2193"}),(0,w.jsx)("button",{onClick:()=>b(1,1),children:"\u2198"})]})]}),(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{children:"Testing"}),(0,w.jsx)("button",{onClick:()=>{const e={cx:i,cy:s},t=(0,la.LD)(n,e);alert("Determinism test: ".concat(t?"PASSED":"FAILED"))},style:{marginBottom:"10px",display:"block"},children:"\ud83e\uddea Test Determinism"}),(0,w.jsx)("button",{onClick:()=>{m(null);const e=(0,la.we)(n,10);m(e)},style:{marginBottom:"10px",display:"block"},children:"\u23f1\ufe0f Benchmark (10 chunks)"})]}),c&&(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{children:"Chunk Metadata"}),(0,w.jsxs)("div",{style:{fontSize:"12px",fontFamily:"monospace"},children:[(0,w.jsxs)("div",{children:["Hash: ",c.hash]}),(0,w.jsxs)("div",{children:["Size: ",c.width,"\xd7",c.height]}),(0,w.jsxs)("div",{children:["Avg Height: ",c.meta.averageHeight.toFixed(3)]}),(0,w.jsxs)("div",{children:["Avg Temp: ",c.meta.averageTemperature.toFixed(3)]}),(0,w.jsxs)("div",{children:["Avg Moisture: ",c.meta.averageMoisture.toFixed(3)]}),(0,w.jsxs)("div",{children:["Dominant: ",c.meta.dominantBiome]}),(0,w.jsxs)("div",{children:["POIs: ",c.meta.pois.length]}),(0,w.jsxs)("div",{children:["Rivers: ",c.meta.rivers.length]}),(0,w.jsxs)("div",{children:["Gen Time: ",c.meta.lastGenTime.toFixed(1),"ms"]})]})]}),p&&(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{children:"Benchmark Results"}),(0,w.jsxs)("div",{style:{fontSize:"12px",fontFamily:"monospace"},children:[(0,w.jsxs)("div",{children:["Avg: ",p.averageTime.toFixed(1),"ms"]}),(0,w.jsxs)("div",{children:["Min: ",p.minTime.toFixed(1),"ms"]}),(0,w.jsxs)("div",{children:["Max: ",p.maxTime.toFixed(1),"ms"]}),(0,w.jsxs)("div",{children:["Total: ",p.totalTime.toFixed(1),"ms"]})]})]}),f&&(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h4",{children:"Cache Stats"}),(0,w.jsx)("div",{style:{fontSize:"12px",fontFamily:"monospace"},children:JSON.stringify(f.getCacheStats(),null,2).split("\n").map((e,t)=>(0,w.jsx)("div",{children:e},t))})]})]}),(0,w.jsxs)("div",{style:{flex:"1"},children:[(0,w.jsxs)("h4",{children:["Chunk Visualization ",u&&"(Generating...)"]}),(0,w.jsx)("canvas",{ref:y,style:{border:"1px solid #ccc",maxWidth:"500px",maxHeight:"500px",imageRendering:"pixelated"}}),(0,w.jsxs)("div",{style:{marginTop:"10px",display:"flex",flexWrap:"wrap",gap:"10px"},children:[Object.entries(va).map(e=>{let[t,n]=e;return(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[(0,w.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:n,border:"1px solid #000"}}),(0,w.jsx)("span",{style:{fontSize:"12px"},children:t})]},t)}),(0,w.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[(0,w.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:"#ff0000",borderRadius:"50%"}}),(0,w.jsx)("span",{style:{fontSize:"12px"},children:"POI"})]})]})]})]})})};function wa(){var e,t,n,i,o,s;const[l,c]=a.useState("menu"),[d,h]=a.useState([]),[m,f]=a.useState(null),[,g]=a.useReducer(e=>e+1,0);a.useEffect(()=>{const e=u.session.getItem("world-engine-emergency-save");if(e)try{const t=JSON.parse(e);console.log("Found emergency save, attempting recovery...");const n=JSON.parse(u.local.getItem("world-engine-campaigns")||"[]"),r=n.findIndex(e=>e.id===t.id);r>=0?n[r]=t:n.push(t),u.local.setItem("world-engine-campaigns",JSON.stringify(n)),u.session.removeItem("world-engine-emergency-save"),alert("Emergency save recovered from previous session!")}catch(n){console.error("Failed to recover emergency save:",n)}const t=setInterval(()=>{try{const e=JSON.parse(u.local.getItem("world-engine-campaigns")||"[]");e.length>0&&(u.session.setItem("world-engine-campaigns-session",JSON.stringify(e)),console.log("Periodic session backup completed"))}catch(n){console.error("Periodic backup failed:",n)}},3e5);return()=>clearInterval(t)},[]);const y=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"world-engine-campaigns-backup";try{const n={campaigns:e,exportDate:(new Date).toISOString(),version:"2.0",worldEngineVersion:"v1.0.0"},r=JSON.stringify(n,null,2),a=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(a),o=document.createElement("a");o.href=i,o.download="".concat(t,"-").concat((new Date).toISOString().split("T")[0],".json"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),console.log("Campaign backup downloaded")}catch(n){console.error("Error downloading backup:",n)}},x={state:{meta:{seed:"undefined"!==typeof window&&u.local.getItem("world-seed")||void 0,presets:{list:[],loaded:"undefined"!==typeof window&&u.local.getItem("world-preset")||void 0}}},applyPresetByName:e=>{console.log("applyPresetByName",e),x.state=(0,r.A)((0,r.A)({},x.state),{},{meta:(0,r.A)((0,r.A)({},x.state.meta),{},{presets:(0,r.A)((0,r.A)({},x.state.meta.presets),{},{loaded:e})})});try{u.local.setItem("world-preset",e)}catch(t){}g()},setSeed:e=>{console.log("setSeed",e),x.state=(0,r.A)((0,r.A)({},x.state),{},{meta:(0,r.A)((0,r.A)({},x.state.meta),{},{seed:e})});try{u.local.setItem("world-seed",e)}catch(t){}g()},loadWorldPresets:async function(){console.log("loadWorldPresets called");const e="worlds.json";try{console.log("Fetching",e,"...");const t=await fetch(e,{cache:"no-store"});if(console.log("Fetch response:",t.status,t.statusText),!t.ok)throw new Error("HTTP ".concat(t.status));const n=await t.json();console.log("Raw JSON data:",n);const a=n&&Array.isArray(n.list)?n.list:[];x.state=(0,r.A)((0,r.A)({},x.state),{},{meta:(0,r.A)((0,r.A)({},x.state.meta),{},{presets:{list:a,loaded:x.state.meta.presets.loaded}})}),console.log("World presets loaded:",a.map(e=>e.name)),g()}catch(t){console.error("Failed to load world presets from",e,":",t),x.state=(0,r.A)((0,r.A)({},x.state),{},{meta:(0,r.A)((0,r.A)({},x.state.meta),{},{presets:{list:p,loaded:x.state.meta.presets.loaded}})}),console.warn("Using DEFAULT_WORLDS fallback (",p.length,")"),g()}}};return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(ie,{}),"menu"===l&&(0,w.jsx)(T,{onNewCampaign:()=>{const e={id:"campaign-".concat(Date.now()),name:"Campaign ".concat(Date.now().toString().slice(-4)),worldPreset:"",seed:"",characters:[]};f(e),c("world")},onLoadCampaign:e=>{var t,n;(f(e),e.worldPreset)&&(null===(t=x.applyPresetByName)||void 0===t||t.call(x,e.worldPreset));e.seed&&(null===(n=x.setSeed)||void 0===n||n.call(x,e.seed));c("worldmap")},onNameGenerator:()=>{c("namegen")},onSpellGenerator:()=>{c("spellgen")},onSpellAssignment:()=>{c("spellassign")},onHealingSystem:()=>{c("healing")},onCharacterCreate:()=>{c("charactercreate")},onClassicCharacterCreate:()=>{c("classiccharacter")},onPortraitTest:()=>{c("portraittest")},onAutoUpdater:()=>{c("autoupdater")},onBattleSystem:()=>{c("battlesystem")},onBattlePage:()=>{c("battle")},onMinimalBattle:()=>{c("minimalBattle")},onEnhancedMap:()=>{c("enhancedmap")},onSimpleMap:()=>{c("simplemap")},onProcedural:()=>{c("procedural")}}),"world"===l&&(0,w.jsx)(oe,{eng:x,onNext:()=>{if(m){var e,t,n,a,i;const o=(0,r.A)((0,r.A)({},m),{},{worldPreset:(null===x||void 0===x||null===(e=x.state)||void 0===e||null===(t=e.meta)||void 0===t||null===(n=t.presets)||void 0===n?void 0:n.loaded)||"",seed:(null===x||void 0===x||null===(a=x.state)||void 0===a||null===(i=a.meta)||void 0===i?void 0:i.seed)||""});f(o),(e=>{try{const t=(new Date).toISOString(),n=JSON.parse(u.local.getItem("world-engine-campaigns")||"[]"),a=n.findIndex(t=>t.id===e.id),i=(0,r.A)((0,r.A)({},e),{},{lastPlayed:t,saveVersion:"2.0"},a<0&&{createdAt:t});a>=0?n[a]=i:n.push(i),u.local.setItem("world-engine-campaigns",JSON.stringify(n)),u.local.setItem("world-engine-campaigns-backup",JSON.stringify({campaigns:n,backupTime:t,version:"2.0"})),u.session.setItem("world-engine-campaigns-session",JSON.stringify(n)),u.local.setItem("world-engine-campaign-".concat(e.id),JSON.stringify(i));const o=parseInt(u.local.getItem("world-engine-save-count")||"0")+1;u.local.setItem("world-engine-save-count",o.toString()),o%10===0&&y(n,"auto-backup-".concat(o)),console.log("Campaign saved with ".concat(n.length," total campaigns (save #").concat(o,")"))}catch(t){console.error("Error saving campaign:",t);try{u.session.setItem("world-engine-emergency-save",JSON.stringify(e)),alert("Primary save failed, but emergency backup created. Please export your campaign manually.")}catch(n){console.error("Emergency save also failed:",n),alert("Critical: All save attempts failed. Please export your campaign data immediately.")}}})(o)}c("party")}}),"party"===l&&(0,w.jsx)(qe,{eng:x,party:d,setParty:h,onStart:()=>c("worldmap"),onCreateNew:()=>c("worldmap")}),"namegen"===l&&(0,w.jsx)(Fe,{onBack:()=>c("menu")}),"spellgen"===l&&(0,w.jsx)(At,{onBack:()=>c("menu")}),"spellassign"===l&&(0,w.jsx)(Mt,{onBack:()=>c("menu")}),"healing"===l&&(0,w.jsx)(Vr,{onBack:()=>c("menu")}),"worldmap"===l&&(0,w.jsx)(sa,{seedStr:null===x||void 0===x||null===(e=x.state)||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.seed,onBack:()=>c("menu")}),"charactercreate"===l&&(0,w.jsxs)("div",{style:{position:"relative"},children:[(0,w.jsx)("button",{onClick:()=>c("menu"),style:{position:"absolute",top:"20px",left:"20px",zIndex:1e3,background:"#374151",color:"#f8fafc",border:"none",borderRadius:"8px",padding:"10px 15px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Menu"}),(0,w.jsx)(Be,{})]}),"classiccharacter"===l&&(0,w.jsx)(ft,{onCharacterCreated:e=>{console.log("Character created:",e),c("menu")},onCancel:()=>c("menu")}),"portraittest"===l&&(0,w.jsxs)("div",{style:{position:"relative"},children:[(0,w.jsx)("button",{onClick:()=>c("menu"),style:{position:"absolute",top:"20px",left:"20px",zIndex:1e3,background:"#374151",color:"#f8fafc",border:"none",borderRadius:"8px",padding:"10px 15px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Menu"}),(0,w.jsx)(j,{})]}),"autoupdater"===l&&(0,w.jsx)("div",{style:{position:"relative"},children:(0,w.jsx)("button",{onClick:()=>c("menu"),style:{position:"absolute",top:"20px",left:"20px",zIndex:1e3,background:"#374151",color:"#f8fafc",border:"none",borderRadius:"8px",padding:"10px 15px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Menu"})}),"battlesystem"===l&&(0,w.jsxs)("div",{style:{position:"relative"},children:[(0,w.jsx)("button",{onClick:()=>c("menu"),style:{position:"absolute",top:"20px",left:"20px",zIndex:1e3,background:"#374151",color:"#f8fafc",border:"none",borderRadius:"8px",padding:"10px 15px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Menu"}),(0,w.jsx)(Nr,{})]}),"battle"===l&&(0,w.jsxs)("div",{style:{position:"relative",width:"100vw",height:"100vh"},children:[(0,w.jsx)("button",{onClick:()=>c("menu"),style:{position:"absolute",top:"20px",left:"20px",zIndex:1e3,background:"#374151",color:"#f8fafc",border:"none",borderRadius:"8px",padding:"10px 15px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Menu"}),(0,w.jsx)(Ir,{})]}),"minimalBattle"===l&&(0,w.jsxs)("div",{style:{position:"relative",width:"100vw",height:"100vh"},children:[(0,w.jsx)("button",{onClick:()=>c("menu"),style:{position:"absolute",top:"20px",left:"20px",zIndex:1e3,background:"#374151",color:"#f8fafc",border:"none",borderRadius:"8px",padding:"10px 15px",cursor:"pointer",fontSize:"14px",fontWeight:"bold"},children:"Back to Menu"}),(0,w.jsx)(Ur,{})]}),"enhancedmap"===l&&(0,w.jsx)("div",{style:{position:"relative"},children:(0,w.jsx)(Kr,{seedStr:null===x||void 0===x||null===(n=x.state)||void 0===n||null===(i=n.meta)||void 0===i?void 0:i.seed,onBack:()=>c("menu")})}),"simplemap"===l&&(0,w.jsx)("div",{style:{position:"relative"},children:(0,w.jsx)(aa,{seedStr:null===x||void 0===x||null===(o=x.state)||void 0===o||null===(s=o.meta)||void 0===s?void 0:s.seed,onBack:()=>c("menu")})}),"procedural"===l&&(0,w.jsxs)("div",{style:{position:"relative"},children:[(0,w.jsx)(ba,{}),(0,w.jsx)("button",{onClick:()=>c("menu"),style:{position:"absolute",top:"20px",right:"20px",padding:"10px 20px",backgroundColor:"#4f46e5",color:"white",border:"none",borderRadius:"8px",cursor:"pointer"},children:"\u2190 Back to Menu"})]})]})}(0,o.H)(document.getElementById("root")).render((0,w.jsx)(wa,{}))})();